var _d=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},fh={exports:{}};(function(M,N){(function(V,tt){M.exports=tt()})(_d,function(){var V,tt,ot;function ht(u,Ot){if(!V)V=Ot;else if(!tt)tt=Ot;else{var st="var sharedChunk = {}; ("+V+")(sharedChunk); ("+tt+")(sharedChunk);",Mt={};V(Mt),ot=Ot(Mt),typeof window!="undefined"&&(ot.workerUrl=window.URL.createObjectURL(new Blob([st],{type:"text/javascript"})))}}return ht(["exports"],function(u){function Ot(t,e){return t(e={exports:{}},e.exports),e.exports}var st=Mt;function Mt(t,e,r,a){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=a,this.p2x=r,this.p2y=a}Mt.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},Mt.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},Mt.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},Mt.prototype.solveCurveX=function(t,e){var r,a,l,c,h;for(e===void 0&&(e=1e-6),l=t,h=0;h<8;h++){if(c=this.sampleCurveX(l)-t,Math.abs(c)<e)return l;var m=this.sampleCurveDerivativeX(l);if(Math.abs(m)<1e-6)break;l-=c/m}if((l=t)<(r=0))return r;if(l>(a=1))return a;for(;r<a;){if(c=this.sampleCurveX(l),Math.abs(c-t)<e)return l;t>c?r=l:a=l,l=.5*(a-r)+r}return l},Mt.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var Dt=Ke;function Ke(t,e){this.x=t,this.y=e}Ke.prototype={clone:function(){return new Ke(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),a=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=a,this},_rotateAround:function(t,e){var r=Math.cos(t),a=Math.sin(t),l=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-a*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ke.convert=function(t){return t instanceof Ke?t:Array.isArray(t)?new Ke(t[0],t[1]):t};var vt=typeof self!="undefined"?self:{},mr=Math.pow(2,53)-1;function rr(t,e,r,a){var l=new st(t,e,r,a);return function(c){return l.solve(c)}}var De=rr(.25,.1,.25,1);function Tr(t,e,r){return Math.min(r,Math.max(e,t))}function Ti(t,e,r){var a=r-e,l=((t-e)%a+a)%a+e;return l===e?r:l}function He(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];for(var a=0,l=e;a<l.length;a+=1){var c=l[a];for(var h in c)t[h]=c[h]}return t}var Sa=1;function uo(){return Sa++}function qi(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function co(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function po(t,e){t.forEach(function(r){e[r]&&(e[r]=e[r].bind(e))})}function kn(t,e){return t.indexOf(e,t.length-e.length)!==-1}function kr(t,e,r){var a={};for(var l in t)a[l]=e.call(r||this,t[l],l,t);return a}function Zi(t,e,r){var a={};for(var l in t)e.call(r||this,t[l],l,t)&&(a[l]=t[l]);return a}function Ii(t){return Array.isArray(t)?t.map(Ii):typeof t=="object"&&t?kr(t,Ii):t}var ho={};function qe(t){ho[t]||(typeof console!="undefined"&&console.warn(t),ho[t]=!0)}function Kr(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function Ta(t){for(var e=0,r=0,a=t.length,l=a-1,c=void 0,h=void 0;r<a;l=r++)e+=((h=t[l]).x-(c=t[r]).x)*(c.y+h.y);return e}function ii(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function fo(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(a,l,c,h){var m=c||h;return e[l]=!m||m.toLowerCase(),""}),e["max-age"]){var r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}var mo=null;function Ia(t){if(mo==null){var e=t.navigator?t.navigator.userAgent:null;mo=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return mo}function on(t){try{var e=vt[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}var Ei,Li,Cn,Mn,an=vt.performance&&vt.performance.now?vt.performance.now.bind(vt.performance):Date.now.bind(Date),Ls=vt.requestAnimationFrame||vt.mozRequestAnimationFrame||vt.webkitRequestAnimationFrame||vt.msRequestAnimationFrame,Cr=vt.cancelAnimationFrame||vt.mozCancelAnimationFrame||vt.webkitCancelAnimationFrame||vt.msCancelAnimationFrame,Gi={now:an,frame:function(t){var e=Ls(t);return{cancel:function(){return Cr(e)}}},getImageData:function(t,e){e===void 0&&(e=0);var r=vt.document.createElement("canvas"),a=r.getContext("2d");if(!a)throw new Error("failed to create canvas 2d context");return r.width=t.width,r.height=t.height,a.drawImage(t,0,0,t.width,t.height),a.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:function(t){return Ei||(Ei=vt.document.createElement("a")),Ei.href=t,Ei.href},hardwareConcurrency:vt.navigator&&vt.navigator.hardwareConcurrency||4,get devicePixelRatio(){return vt.devicePixelRatio},get prefersReducedMotion(){return!!vt.matchMedia&&(Li==null&&(Li=vt.matchMedia("(prefers-reduced-motion: reduce)")),Li.matches)}},ve={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Ri={supported:!1,testSupport:function(t){!yo&&Mn&&(Ai?le(t):Cn=t)}},yo=!1,Ai=!1;function le(t){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Mn),t.isContextLost())return;Ri.supported=!0}catch{}t.deleteTexture(e),yo=!0}vt.document&&((Mn=vt.document.createElement("img")).onload=function(){Cn&&le(Cn),Cn=null,Ai=!0},Mn.onerror=function(){yo=!0,Cn=null},Mn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var sn="01",Mr=function(t,e){this._transformRequestFn=t,this._customAccessToken=e,this._createSkuToken()};function pi(t){return t.indexOf("mapbox:")===0}Mr.prototype._createSkuToken=function(){var t=function(){for(var e="",r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",sn,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},Mr.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Mr.prototype.transformRequest=function(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}},Mr.prototype.normalizeStyleURL=function(t,e){if(!pi(t))return t;var r=hi(t);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||e)},Mr.prototype.normalizeGlyphsURL=function(t,e){if(!pi(t))return t;var r=hi(t);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||e)},Mr.prototype.normalizeSourceURL=function(t,e){if(!pi(t))return t;var r=hi(t);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||e)},Mr.prototype.normalizeSpriteURL=function(t,e,r,a){var l=hi(t);return pi(t)?(l.path="/styles/v1"+l.path+"/sprite"+e+r,this._makeAPIURL(l,this._customAccessToken||a)):(l.path+=""+e+r,Dn(l))},Mr.prototype.normalizeTileURL=function(t,e){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!pi(t))return t;var r=hi(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Gi.devicePixelRatio>=2||e===512?"@2x":"")+(Ri.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var a=this._customAccessToken||function(l){for(var c=0,h=l;c<h.length;c+=1){var m=h[c].match(/^access_token=(.*)$/);if(m)return m[1]}return null}(r.params)||ve.ACCESS_TOKEN;return ve.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,a)},Mr.prototype.canonicalizeTileURL=function(t,e){var r=hi(t);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return t;var a="mapbox://tiles/";a+=r.path.replace("/v4/","");var l=r.params;return e&&(l=l.filter(function(c){return!c.match(/^access_token=/)})),l.length&&(a+="?"+l.join("&")),a},Mr.prototype.canonicalizeTileset=function(t,e){for(var r=!!e&&pi(e),a=[],l=0,c=t.tiles||[];l<c.length;l+=1){var h=c[l];Pi(h)?a.push(this.canonicalizeTileURL(h,r)):a.push(h)}return a},Mr.prototype._makeAPIURL=function(t,e){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",a=hi(ve.API_URL);if(t.protocol=a.protocol,t.authority=a.authority,t.protocol==="http"){var l=t.params.indexOf("secure");l>=0&&t.params.splice(l,1)}if(a.path!=="/"&&(t.path=""+a.path+t.path),!ve.REQUIRE_ACCESS_TOKEN)return Dn(t);if(!(e=e||ve.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if(e[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return t.params=t.params.filter(function(c){return c.indexOf("access_token")===-1}),t.params.push("access_token="+e),Dn(t)},Mr.prototype.setTransformRequest=function(t){this._transformRequestFn=t};var Rs=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Pi(t){return Rs.test(t)}var Vo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function hi(t){var e=t.match(Vo);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Dn(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}function go(t){if(!t)return null;var e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(vt.atob(e[1]).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch{return null}}var fi=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};fi.prototype.getStorageKey=function(t){var e,r=go(ve.ACCESS_TOKEN);return e=r&&r.u?vt.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,function(a,l){return String.fromCharCode(Number("0x"+l))})):ve.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+e:"mapbox.eventData:"+e},fi.prototype.fetchEventData=function(){var t=on("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{var a=vt.localStorage.getItem(e);a&&(this.eventData=JSON.parse(a));var l=vt.localStorage.getItem(r);l&&(this.anonId=l)}catch{qe("Unable to read from LocalStorage")}},fi.prototype.saveEventData=function(){var t=on("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{vt.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&vt.localStorage.setItem(e,JSON.stringify(this.eventData))}catch{qe("Unable to write to LocalStorage")}},fi.prototype.processRequests=function(t){},fi.prototype.postEvent=function(t,e,r,a){var l=this;if(ve.EVENTS_URL){var c=hi(ve.EVENTS_URL);c.params.push("access_token="+(a||ve.ACCESS_TOKEN||""));var h={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.15.2",skuId:sn,userId:this.anonId},m=e?He(h,e):h,g={url:Dn(c),headers:{"Content-Type":"text/plain"},body:JSON.stringify([m])};this.pendingRequest=w(g,function(v){l.pendingRequest=null,r(v),l.saveEventData(),l.processRequests(a)})}},fi.prototype.queueRequest=function(t,e){this.queue.push(t),this.processRequests(e)};var di,Ln,zi=function(t){function e(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postMapLoadEvent=function(r,a,l,c){this.skuToken=l,(ve.EVENTS_URL&&c||ve.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(h){return pi(h)||Pi(h)}))&&this.queueRequest({id:a,timestamp:Date.now()},c)},e.prototype.processRequests=function(r){var a=this;if(!this.pendingRequest&&this.queue.length!==0){var l=this.queue.shift(),c=l.id,h=l.timestamp;c&&this.success[c]||(this.anonId||this.fetchEventData(),co(this.anonId)||(this.anonId=qi()),this.postEvent(h,{skuToken:this.skuToken},function(m){m||c&&(a.success[c]=!0)},r))}},e}(fi),Ea=new(function(t){function e(r){t.call(this,"appUserTurnstile"),this._customAccessToken=r}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postTurnstileEvent=function(r,a){ve.EVENTS_URL&&ve.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(l){return pi(l)||Pi(l)})&&this.queueRequest(Date.now(),a)},e.prototype.processRequests=function(r){var a=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var l=go(ve.ACCESS_TOKEN),c=l?l.u:ve.ACCESS_TOKEN,h=c!==this.eventData.tokenU;co(this.anonId)||(this.anonId=qi(),h=!0);var m=this.queue.shift();if(this.eventData.lastSuccess){var g=new Date(this.eventData.lastSuccess),v=new Date(m),x=(m-this.eventData.lastSuccess)/864e5;h=h||x>=1||x<-1||g.getDate()!==v.getDate()}else h=!0;if(!h)return this.processRequests();this.postEvent(m,{"enabled.telemetry":!1},function(b){b||(a.eventData.lastSuccess=m,a.eventData.tokenU=c)},r)}},e}(fi)),Aa=Ea.postTurnstileEvent.bind(Ea),No=new zi,jo=No.postMapLoadEvent.bind(No),vo=500,Pa=50;function _o(){vt.caches&&!di&&(di=vt.caches.open("mapbox-tiles"))}function qo(t){var e=t.indexOf("?");return e<0?t:t.slice(0,e)}var Rn,Zo=1/0;function Go(){return Rn==null&&(Rn=vt.OffscreenCanvas&&new vt.OffscreenCanvas(1,1).getContext("2d")&&typeof vt.createImageBitmap=="function"),Rn}var za={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(za);var ka=function(t){function e(r,a,l){a===401&&Pi(l)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,r),this.status=a,this.url=l,this.name=this.constructor.name,this.message=r}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error),Bn=ii()?function(){return self.worker&&self.worker.referrer}:function(){return(vt.location.protocol==="blob:"?vt.parent:vt).location.href};function On(t,e){var r,a=new vt.AbortController,l=new vt.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:Bn(),signal:a.signal}),c=!1,h=!1,m=(r=l.url).indexOf("sku=")>0&&Pi(r);t.type==="json"&&l.headers.set("Accept","application/json");var g=function(x,b,T){if(!h){if(x&&x.message!=="SecurityError"&&qe(x),b&&T)return v(b);var A=Date.now();vt.fetch(l).then(function(L){if(L.ok){var R=m?L.clone():null;return v(L,R,A)}return e(new ka(L.statusText,L.status,t.url))}).catch(function(L){L.code!==20&&e(new Error(L.message))})}},v=function(x,b,T){(t.type==="arrayBuffer"?x.arrayBuffer():t.type==="json"?x.json():x.text()).then(function(A){h||(b&&T&&function(L,R,W){if(_o(),di){var q={status:R.status,statusText:R.statusText,headers:new vt.Headers};R.headers.forEach(function($,rt){return q.headers.set(rt,$)});var Y=fo(R.headers.get("Cache-Control")||"");Y["no-store"]||(Y["max-age"]&&q.headers.set("Expires",new Date(W+1e3*Y["max-age"]).toUTCString()),new Date(q.headers.get("Expires")).getTime()-W<42e4||function($,rt){if(Ln===void 0)try{new Response(new ReadableStream),Ln=!0}catch{Ln=!1}Ln?rt($.body):$.blob().then(rt)}(R,function($){var rt=new vt.Response($,q);_o(),di&&di.then(function(it){return it.put(qo(L.url),rt)}).catch(function(it){return qe(it.message)})}))}}(l,b,T),c=!0,e(null,A,x.headers.get("Cache-Control"),x.headers.get("Expires")))}).catch(function(A){h||e(new Error(A.message))})};return m?function(x,b){if(_o(),!di)return b(null);var T=qo(x.url);di.then(function(A){A.match(T).then(function(L){var R=function(W){if(!W)return!1;var q=new Date(W.headers.get("Expires")||0),Y=fo(W.headers.get("Cache-Control")||"");return q>Date.now()&&!Y["no-cache"]}(L);A.delete(T),R&&A.put(T,L.clone()),b(null,L,R)}).catch(b)}).catch(b)}(l,g):g(null,null),{cancel:function(){h=!0,c||a.abort()}}}var ln,Fn,xo=function(t,e){if(/:\/\//.test(t.url)&&!/^https?:|^file:/.test(t.url)){if(ii()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e);if(!ii()){var r=t.url.substring(0,t.url.indexOf("://"));return(ve.REGISTERED_PROTOCOLS[r]||On)(t,e)}}if(!(/^file:/.test(a=t.url)||/^file:/.test(Bn())&&!/^\w+:/.test(a))){if(vt.fetch&&vt.Request&&vt.AbortController&&vt.Request.prototype.hasOwnProperty("signal"))return On(t,e);if(ii()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var a;return function(l,c){var h=new vt.XMLHttpRequest;for(var m in h.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(h.responseType="arraybuffer"),l.headers)h.setRequestHeader(m,l.headers[m]);return l.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=l.credentials==="include",h.onerror=function(){c(new Error(h.statusText))},h.onload=function(){if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){var g=h.response;if(l.type==="json")try{g=JSON.parse(h.response)}catch(v){return c(v)}c(null,g,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else c(new ka(h.statusText,h.status,l.url))},h.send(l.body),{cancel:function(){return h.abort()}}}(t,e)},Ve=function(t,e){return xo(He(t,{type:"arrayBuffer"}),e)},w=function(t,e){return xo(He(t,{method:"POST"}),e)},I="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";ln=[],Fn=0;var E=function(t,e){if(Ri.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Fn>=ve.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:t,callback:e,cancelled:!1,cancel:function(){this.cancelled=!0}};return ln.push(r),r}Fn++;var a=!1,l=function(){if(!a)for(a=!0,Fn--;ln.length&&Fn<ve.MAX_PARALLEL_IMAGE_REQUESTS;){var h=ln.shift();h.cancelled||(h.cancel=E(h.requestParameters,h.callback).cancel)}},c=Ve(t,function(h,m,g,v){l(),h?e(h):m&&(Go()?function(x,b){var T=new vt.Blob([new Uint8Array(x)],{type:"image/png"});vt.createImageBitmap(T).then(function(A){b(null,A)}).catch(function(A){b(new Error("Could not load image because of "+A.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(m,e):function(x,b,T,A){var L=new vt.Image,R=vt.URL;L.onload=function(){b(null,L),R.revokeObjectURL(L.src),L.onload=null,vt.requestAnimationFrame(function(){L.src=I})},L.onerror=function(){return b(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var W=new vt.Blob([new Uint8Array(x)],{type:"image/png"});L.cacheControl=T,L.expires=A,L.src=x.byteLength?R.createObjectURL(W):I}(m,e,g,v))});return{cancel:function(){c.cancel(),l()}}};function C(t,e,r){r[t]&&r[t].indexOf(e)!==-1||(r[t]=r[t]||[],r[t].push(e))}function F(t,e,r){if(r&&r[t]){var a=r[t].indexOf(e);a!==-1&&r[t].splice(a,1)}}var K=function(t,e){e===void 0&&(e={}),He(this,e),this.type=t},J=function(t){function e(r,a){a===void 0&&(a={}),t.call(this,"error",He({error:r},a))}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(K),X=function(){};X.prototype.on=function(t,e){return this._listeners=this._listeners||{},C(t,e,this._listeners),this},X.prototype.off=function(t,e){return F(t,e,this._listeners),F(t,e,this._oneTimeListeners),this},X.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},C(t,e,this._oneTimeListeners),this},X.prototype.fire=function(t,e){typeof t=="string"&&(t=new K(t,e||{}));var r=t.type;if(this.listens(r)){t.target=this;for(var a=0,l=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];a<l.length;a+=1)l[a].call(this,t);for(var c=0,h=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];c<h.length;c+=1){var m=h[c];F(r,m,this._oneTimeListeners),m.call(this,t)}var g=this._eventedParent;g&&(He(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(t))}else t instanceof J&&console.error(t.error);return this},X.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},X.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var D={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},j=function(t,e,r,a){this.message=(t?t+": ":"")+r,a&&(this.identifier=a),e!=null&&e.__line__&&(this.line=e.__line__)};function dt(t){var e=t.value;return e?[new j(t.key,e,"constants have been deprecated as of v8")]:[]}function xt(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];for(var a=0,l=e;a<l.length;a+=1){var c=l[a];for(var h in c)t[h]=c[h]}return t}function et(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function mt(t){if(Array.isArray(t))return t.map(mt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var e={};for(var r in t)e[r]=mt(t[r]);return e}return et(t)}var At=function(t){function e(r,a){t.call(this,a),this.message=a,this.key=r}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Error),zt=function(t,e){e===void 0&&(e=[]),this.parent=t,this.bindings={};for(var r=0,a=e;r<a.length;r+=1){var l=a[r];this.bindings[l[0]]=l[1]}};zt.prototype.concat=function(t){return new zt(this,t)},zt.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},zt.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var Ft={kind:"null"},pt={kind:"number"},wt={kind:"string"},ft={kind:"boolean"},Qt={kind:"color"},$t={kind:"object"},Lt={kind:"value"},Te={kind:"collator"},oe={kind:"formatted"},Ae={kind:"resolvedImage"};function Ce(t,e){return{kind:"array",itemType:t,N:e}}function ce(t){if(t.kind==="array"){var e=ce(t.itemType);return typeof t.N=="number"?"array<"+e+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+e+">"}return t.kind}var Ie=[Ft,pt,wt,ft,Qt,oe,$t,Ce(Lt),Ae];function Ne(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Ne(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(var r=0,a=Ie;r<a.length;r+=1)if(!Ne(a[r],e))return null}}return"Expected "+ce(t)+" but found "+ce(e)+" instead."}function Ee(t,e){return e.some(function(r){return r.kind===t.kind})}function ie(t,e){return e.some(function(r){return r==="null"?t===null:r==="array"?Array.isArray(t):r==="object"?t&&!Array.isArray(t)&&typeof t=="object":r===typeof t})}var bo=Ot(function(t,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function a(m){return(m=Math.round(m))<0?0:m>255?255:m}function l(m){return a(m[m.length-1]==="%"?parseFloat(m)/100*255:parseInt(m))}function c(m){return(g=m[m.length-1]==="%"?parseFloat(m)/100:parseFloat(m))<0?0:g>1?1:g;var g}function h(m,g,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?m+(g-m)*v*6:2*v<1?g:3*v<2?m+(g-m)*(2/3-v)*6:m}try{e.parseCSSColor=function(m){var g,v=m.replace(/ /g,"").toLowerCase();if(v in r)return r[v].slice();if(v[0]==="#")return v.length===4?(g=parseInt(v.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:v.length===7&&(g=parseInt(v.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var x=v.indexOf("("),b=v.indexOf(")");if(x!==-1&&b+1===v.length){var T=v.substr(0,x),A=v.substr(x+1,b-(x+1)).split(","),L=1;switch(T){case"rgba":if(A.length!==4)return null;L=c(A.pop());case"rgb":return A.length!==3?null:[l(A[0]),l(A[1]),l(A[2]),L];case"hsla":if(A.length!==4)return null;L=c(A.pop());case"hsl":if(A.length!==3)return null;var R=(parseFloat(A[0])%360+360)%360/360,W=c(A[1]),q=c(A[2]),Y=q<=.5?q*(W+1):q+W-q*W,$=2*q-Y;return[a(255*h($,Y,R+1/3)),a(255*h($,Y,R)),a(255*h($,Y,R-1/3)),L];default:return null}}return null}}catch{}}).parseCSSColor,se=function(t,e,r,a){a===void 0&&(a=1),this.r=t,this.g=e,this.b=r,this.a=a};se.parse=function(t){if(t){if(t instanceof se)return t;if(typeof t=="string"){var e=bo(t);if(e)return new se(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},se.prototype.toString=function(){var t=this.toArray(),e=t[1],r=t[2],a=t[3];return"rgba("+Math.round(t[0])+","+Math.round(e)+","+Math.round(r)+","+a+")"},se.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},se.black=new se(0,0,0,1),se.white=new se(1,1,1,1),se.transparent=new se(0,0,0,0),se.red=new se(1,0,0,1);var Un=function(t,e,r){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Un.prototype.compare=function(t,e){return this.collator.compare(t,e)},Un.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Ca=function(t,e,r,a,l){this.text=t,this.image=e,this.scale=r,this.fontStack=a,this.textColor=l},yr=function(t){this.sections=t};yr.fromString=function(t){return new yr([new Ca(t,null,null,null,null)])},yr.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},yr.factory=function(t){return t instanceof yr?t:yr.fromString(t)},yr.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},yr.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var a=r[e];if(a.image)t.push(["image",a.image.name]);else{t.push(a.text);var l={};a.fontStack&&(l["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(l["font-scale"]=a.scale),a.textColor&&(l["text-color"]=["rgba"].concat(a.textColor.toArray())),t.push(l)}}return t};var Vr=function(t){this.name=t.name,this.available=t.available};function Bs(t,e,r,a){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:"Invalid rgba value ["+[t,e,r,a].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof a=="number"?[t,e,r,a]:[t,e,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Vn(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof se||t instanceof Un||t instanceof yr||t instanceof Vr)return!0;if(Array.isArray(t)){for(var e=0,r=t;e<r.length;e+=1)if(!Vn(r[e]))return!1;return!0}if(typeof t=="object"){for(var a in t)if(!Vn(t[a]))return!1;return!0}return!1}function cr(t){if(t===null)return Ft;if(typeof t=="string")return wt;if(typeof t=="boolean")return ft;if(typeof t=="number")return pt;if(t instanceof se)return Qt;if(t instanceof Un)return Te;if(t instanceof yr)return oe;if(t instanceof Vr)return Ae;if(Array.isArray(t)){for(var e,r=t.length,a=0,l=t;a<l.length;a+=1){var c=cr(l[a]);if(e){if(e===c)continue;e=Lt;break}e=c}return Ce(e||Lt,r)}return $t}function Bi(t){var e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof se||t instanceof yr||t instanceof Vr?t.toString():JSON.stringify(t)}Vr.prototype.toString=function(){return this.name},Vr.fromString=function(t){return t?new Vr({name:t,available:!1}):null},Vr.prototype.serialize=function(){return["image",this.name]};var mi=function(t,e){this.type=t,this.value=e};mi.parse=function(t,e){if(t.length!==2)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!Vn(t[1]))return e.error("invalid value");var r=t[1],a=cr(r),l=e.expectedType;return a.kind!=="array"||a.N!==0||!l||l.kind!=="array"||typeof l.N=="number"&&l.N!==0||(a=l),new mi(a,r)},mi.prototype.evaluate=function(){return this.value},mi.prototype.eachChild=function(){},mi.prototype.outputDefined=function(){return!0},mi.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof se?["rgba"].concat(this.value.toArray()):this.value instanceof yr?this.value.serialize():this.value};var Le=function(t){this.name="ExpressionEvaluationError",this.message=t};Le.prototype.toJSON=function(){return this.message};var Nr={string:wt,number:pt,boolean:ft,object:$t},Ir=function(t,e){this.type=t,this.args=e};Ir.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r,a=1,l=t[0];if(l==="array"){var c,h;if(t.length>2){var m=t[1];if(typeof m!="string"||!(m in Nr)||m==="object")return e.error('The item type argument of "array" must be one of string, number, boolean',1);c=Nr[m],a++}else c=Lt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);h=t[2],a++}r=Ce(c,h)}else r=Nr[l];for(var g=[];a<t.length;a++){var v=e.parse(t[a],a,Lt);if(!v)return null;g.push(v)}return new Ir(r,g)},Ir.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var r=this.args[e].evaluate(t);if(!Ne(this.type,cr(r)))return r;if(e===this.args.length-1)throw new Le("Expected value to be of type "+ce(this.type)+", but found "+ce(cr(r))+" instead.")}return null},Ir.prototype.eachChild=function(t){this.args.forEach(t)},Ir.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},Ir.prototype.serialize=function(){var t=this.type,e=[t.kind];if(t.kind==="array"){var r=t.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){e.push(r.kind);var a=t.N;(typeof a=="number"||this.args.length>1)&&e.push(a)}}return e.concat(this.args.map(function(l){return l.serialize()}))};var Hr=function(t){this.type=oe,this.sections=t};Hr.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r=t[1];if(!Array.isArray(r)&&typeof r=="object")return e.error("First argument must be an image or text section.");for(var a=[],l=!1,c=1;c<=t.length-1;++c){var h=t[c];if(l&&typeof h=="object"&&!Array.isArray(h)){l=!1;var m=null;if(h["font-scale"]&&!(m=e.parse(h["font-scale"],1,pt)))return null;var g=null;if(h["text-font"]&&!(g=e.parse(h["text-font"],1,Ce(wt))))return null;var v=null;if(h["text-color"]&&!(v=e.parse(h["text-color"],1,Qt)))return null;var x=a[a.length-1];x.scale=m,x.font=g,x.textColor=v}else{var b=e.parse(t[c],1,Lt);if(!b)return null;var T=b.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");l=!0,a.push({content:b,scale:null,font:null,textColor:null})}}return new Hr(a)},Hr.prototype.evaluate=function(t){return new yr(this.sections.map(function(e){var r=e.content.evaluate(t);return cr(r)===Ae?new Ca("",r,null,null,null):new Ca(Bi(r),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)}))},Hr.prototype.eachChild=function(t){for(var e=0,r=this.sections;e<r.length;e+=1){var a=r[e];t(a.content),a.scale&&t(a.scale),a.font&&t(a.font),a.textColor&&t(a.textColor)}},Hr.prototype.outputDefined=function(){return!1},Hr.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var a=r[e];t.push(a.content.serialize());var l={};a.scale&&(l["font-scale"]=a.scale.serialize()),a.font&&(l["text-font"]=a.font.serialize()),a.textColor&&(l["text-color"]=a.textColor.serialize()),t.push(l)}return t};var Xi=function(t){this.type=Ae,this.input=t};Xi.parse=function(t,e){if(t.length!==2)return e.error("Expected two arguments.");var r=e.parse(t[1],1,wt);return r?new Xi(r):e.error("No image name provided.")},Xi.prototype.evaluate=function(t){var e=this.input.evaluate(t),r=Vr.fromString(e);return r&&t.availableImages&&(r.available=t.availableImages.indexOf(e)>-1),r},Xi.prototype.eachChild=function(t){t(this.input)},Xi.prototype.outputDefined=function(){return!1},Xi.prototype.serialize=function(){return["image",this.input.serialize()]};var qu={"to-boolean":ft,"to-color":Qt,"to-number":pt,"to-string":wt},yi=function(t,e){this.type=t,this.args=e};yi.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r=t[0];if((r==="to-boolean"||r==="to-string")&&t.length!==2)return e.error("Expected one argument.");for(var a=qu[r],l=[],c=1;c<t.length;c++){var h=e.parse(t[c],c,Lt);if(!h)return null;l.push(h)}return new yi(a,l)},yi.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var e,r,a=0,l=this.args;a<l.length;a+=1){if(r=null,(e=l[a].evaluate(t))instanceof se)return e;if(typeof e=="string"){var c=t.parseColor(e);if(c)return c}else if(Array.isArray(e)&&!(r=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":Bs(e[0],e[1],e[2],e[3])))return new se(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new Le(r||"Could not parse color from value '"+(typeof e=="string"?e:String(JSON.stringify(e)))+"'")}if(this.type.kind==="number"){for(var h=null,m=0,g=this.args;m<g.length;m+=1){if((h=g[m].evaluate(t))===null)return 0;var v=Number(h);if(!isNaN(v))return v}throw new Le("Could not convert "+JSON.stringify(h)+" to number.")}return this.type.kind==="formatted"?yr.fromString(Bi(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Vr.fromString(Bi(this.args[0].evaluate(t))):Bi(this.args[0].evaluate(t))},yi.prototype.eachChild=function(t){this.args.forEach(t)},yi.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},yi.prototype.serialize=function(){if(this.type.kind==="formatted")return new Hr([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Xi(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(e){t.push(e.serialize())}),t};var Ol=["Unknown","Point","LineString","Polygon"],Wi=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Wi.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Wi.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Ol[this.feature.type]:this.feature.type:null},Wi.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Wi.prototype.canonicalID=function(){return this.canonical},Wi.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Wi.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=se.parse(t)),e};var gr=function(t,e,r,a){this.name=t,this.type=e,this._evaluate=r,this.args=a};gr.prototype.evaluate=function(t){return this._evaluate(t,this.args)},gr.prototype.eachChild=function(t){this.args.forEach(t)},gr.prototype.outputDefined=function(){return!1},gr.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},gr.parse=function(t,e){var r,a=t[0],l=gr.definitions[a];if(!l)return e.error('Unknown expression "'+a+'". If you wanted a literal array, use ["literal", [...]].',0);for(var c=Array.isArray(l)?l[0]:l.type,h=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,m=h.filter(function(Ut){var Tt=Ut[0];return!Array.isArray(Tt)||Tt.length===t.length-1}),g=null,v=0,x=m;v<x.length;v+=1){var b=x[v],T=b[0],A=b[1];g=new pn(e.registry,e.path,null,e.scope);for(var L=[],R=!1,W=1;W<t.length;W++){var q=t[W],Y=Array.isArray(T)?T[W-1]:T.type,$=g.parse(q,1+L.length,Y);if(!$){R=!0;break}L.push($)}if(!R)if(Array.isArray(T)&&T.length!==L.length)g.error("Expected "+T.length+" arguments, but found "+L.length+" instead.");else{for(var rt=0;rt<L.length;rt++){var it=Array.isArray(T)?T[rt]:T.type,ut=L[rt];g.concat(rt+1).checkSubtype(it,ut.type)}if(g.errors.length===0)return new gr(a,c,A,L)}}if(m.length===1)(r=e.errors).push.apply(r,g.errors);else{for(var gt=(m.length?m:h).map(function(Ut){var Tt;return Tt=Ut[0],Array.isArray(Tt)?"("+Tt.map(ce).join(", ")+")":"("+ce(Tt.type)+"...)"}).join(" | "),bt=[],Bt=1;Bt<t.length;Bt++){var St=e.parse(t[Bt],1+bt.length);if(!St)return null;bt.push(ce(St.type))}e.error("Expected arguments of type "+gt+", but found ("+bt.join(", ")+") instead.")}return null},gr.register=function(t,e){for(var r in gr.definitions=e,e)t[r]=gr};var or=function(t,e,r){this.type=Te,this.locale=r,this.caseSensitive=t,this.diacriticSensitive=e};function wo(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Ma(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Zu(t,e){var r=(180+t[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(r*l*8192),Math.round(a*l*8192)]}function Gu(t,e,r){return e[1]>t[1]!=r[1]>t[1]&&t[0]<(r[0]-e[0])*(t[1]-e[1])/(r[1]-e[1])+e[0]}function Os(t,e){for(var r,a,l,c,h,m,g,v=!1,x=0,b=e.length;x<b;x++)for(var T=e[x],A=0,L=T.length;A<L-1;A++){if((c=(r=t)[0]-(a=T[A])[0])*(g=r[1]-(l=T[A+1])[1])-(m=r[0]-l[0])*(h=r[1]-a[1])==0&&c*m<=0&&h*g<=0)return!1;Gu(t,T[A],T[A+1])&&(v=!v)}return v}function Xu(t,e){for(var r=0;r<e.length;r++)if(Os(t,e[r]))return!0;return!1}function Fl(t,e,r,a){var l=a[0]-r[0],c=a[1]-r[1],h=(t[0]-r[0])*c-l*(t[1]-r[1]),m=(e[0]-r[0])*c-l*(e[1]-r[1]);return h>0&&m<0||h<0&&m>0}function Wu(t,e,r){for(var a=0,l=r;a<l.length;a+=1)for(var c=l[a],h=0;h<c.length-1;++h)if((b=[(x=c[h+1])[0]-(v=c[h])[0],x[1]-v[1]])[0]*(T=[(g=e)[0]-(m=t)[0],g[1]-m[1]])[1]-b[1]*T[0]!=0&&Fl(m,g,v,x)&&Fl(v,x,m,g))return!0;var m,g,v,x,b,T;return!1}function Fs(t,e){for(var r=0;r<t.length;++r)if(!Os(t[r],e))return!1;for(var a=0;a<t.length-1;++a)if(Wu(t[a],t[a+1],e))return!1;return!0}function Da(t,e){for(var r=0;r<e.length;r++)if(Fs(t,e[r]))return!0;return!1}function La(t,e,r){for(var a=[],l=0;l<t.length;l++){for(var c=[],h=0;h<t[l].length;h++){var m=Zu(t[l][h],r);wo(e,m),c.push(m)}a.push(c)}return a}function Xo(t,e,r){for(var a=[],l=0;l<t.length;l++){var c=La(t[l],e,r);a.push(c)}return a}function Ul(t,e,r,a){if(t[0]<r[0]||t[0]>r[2]){var l=.5*a,c=t[0]-r[0]>l?-a:r[0]-t[0]>l?a:0;c===0&&(c=t[0]-r[2]>l?-a:r[2]-t[0]>l?a:0),t[0]+=c}wo(e,t)}function Ra(t,e,r,a){for(var l=8192*Math.pow(2,a.z),c=[8192*a.x,8192*a.y],h=[],m=0,g=t;m<g.length;m+=1)for(var v=0,x=g[m];v<x.length;v+=1){var b=x[v],T=[b.x+c[0],b.y+c[1]];Ul(T,e,r,l),h.push(T)}return h}function Us(t,e,r,a){for(var l,c=8192*Math.pow(2,a.z),h=[8192*a.x,8192*a.y],m=[],g=0,v=t;g<v.length;g+=1){for(var x=[],b=0,T=v[g];b<T.length;b+=1){var A=T[b],L=[A.x+h[0],A.y+h[1]];wo(e,L),x.push(L)}m.push(x)}if(e[2]-e[0]<=c/2){(l=e)[0]=l[1]=1/0,l[2]=l[3]=-1/0;for(var R=0,W=m;R<W.length;R+=1)for(var q=0,Y=W[R];q<Y.length;q+=1)Ul(Y[q],e,r,c)}return m}or.parse=function(t,e){if(t.length!==2)return e.error("Expected one argument.");var r=t[1];if(typeof r!="object"||Array.isArray(r))return e.error("Collator options argument must be an object.");var a=e.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,ft);if(!a)return null;var l=e.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,ft);if(!l)return null;var c=null;return r.locale&&!(c=e.parse(r.locale,1,wt))?null:new or(a,l,c)},or.prototype.evaluate=function(t){return new Un(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},or.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},or.prototype.outputDefined=function(){return!1},or.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var jr=function(t,e){this.type=ft,this.geojson=t,this.geometries=e};function Nn(t){if(t instanceof gr&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof jr)return!1;var e=!0;return t.eachChild(function(r){e&&!Nn(r)&&(e=!1)}),e}function un(t){if(t instanceof gr&&t.name==="feature-state")return!1;var e=!0;return t.eachChild(function(r){e&&!un(r)&&(e=!1)}),e}function Ba(t,e){if(t instanceof gr&&e.indexOf(t.name)>=0)return!1;var r=!0;return t.eachChild(function(a){r&&!Ba(a,e)&&(r=!1)}),r}jr.parse=function(t,e){if(t.length!==2)return e.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(Vn(t[1])){var r=t[1];if(r.type==="FeatureCollection")for(var a=0;a<r.features.length;++a){var l=r.features[a].geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new jr(r,r.features[a].geometry)}else if(r.type==="Feature"){var c=r.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new jr(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new jr(r,r)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")},jr.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(e,r){var a=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],c=e.canonicalID();if(r.type==="Polygon"){var h=La(r.coordinates,l,c),m=Ra(e.geometry(),a,l,c);if(!Ma(a,l))return!1;for(var g=0,v=m;g<v.length;g+=1)if(!Os(v[g],h))return!1}if(r.type==="MultiPolygon"){var x=Xo(r.coordinates,l,c),b=Ra(e.geometry(),a,l,c);if(!Ma(a,l))return!1;for(var T=0,A=b;T<A.length;T+=1)if(!Xu(A[T],x))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(e,r){var a=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],c=e.canonicalID();if(r.type==="Polygon"){var h=La(r.coordinates,l,c),m=Us(e.geometry(),a,l,c);if(!Ma(a,l))return!1;for(var g=0,v=m;g<v.length;g+=1)if(!Fs(v[g],h))return!1}if(r.type==="MultiPolygon"){var x=Xo(r.coordinates,l,c),b=Us(e.geometry(),a,l,c);if(!Ma(a,l))return!1;for(var T=0,A=b;T<A.length;T+=1)if(!Da(A[T],x))return!1}return!0}(t,this.geometries)}return!1},jr.prototype.eachChild=function(){},jr.prototype.outputDefined=function(){return!0},jr.prototype.serialize=function(){return["within",this.geojson]};var cn=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};cn.parse=function(t,e){if(t.length!==2||typeof t[1]!="string")return e.error("'var' expression requires exactly one string literal argument.");var r=t[1];return e.scope.has(r)?new cn(r,e.scope.get(r)):e.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},cn.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},cn.prototype.eachChild=function(){},cn.prototype.outputDefined=function(){return!1},cn.prototype.serialize=function(){return["var",this.name]};var pn=function(t,e,r,a,l){e===void 0&&(e=[]),a===void 0&&(a=new zt),l===void 0&&(l=[]),this.registry=t,this.path=e,this.key=e.map(function(c){return"["+c+"]"}).join(""),this.scope=a,this.errors=l,this.expectedType=r};function Ki(t,e){for(var r,a=t.length-1,l=0,c=a,h=0;l<=c;)if((r=t[h=Math.floor((l+c)/2)])<=e){if(h===a||e<t[h+1])return h;l=h+1}else{if(!(r>e))throw new Le("Input is not a number.");c=h-1}return 0}pn.prototype.parse=function(t,e,r,a,l){return l===void 0&&(l={}),e?this.concat(e,r,a)._parse(t,l):this._parse(t,l)},pn.prototype._parse=function(t,e){function r(v,x,b){return b==="assert"?new Ir(x,[v]):b==="coerce"?new yi(x,[v]):v}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var a=t[0];if(typeof a!="string")return this.error("Expression name must be a string, but found "+typeof a+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var l=this.registry[a];if(l){var c=l.parse(t,this);if(!c)return null;if(this.expectedType){var h=this.expectedType,m=c.type;if(h.kind!=="string"&&h.kind!=="number"&&h.kind!=="boolean"&&h.kind!=="object"&&h.kind!=="array"||m.kind!=="value")if(h.kind!=="color"&&h.kind!=="formatted"&&h.kind!=="resolvedImage"||m.kind!=="value"&&m.kind!=="string"){if(this.checkSubtype(h,m))return null}else c=r(c,h,e.typeAnnotation||"coerce");else c=r(c,h,e.typeAnnotation||"assert")}if(!(c instanceof mi)&&c.type.kind!=="resolvedImage"&&function v(x){if(x instanceof cn)return v(x.boundExpression);if(x instanceof gr&&x.name==="error"||x instanceof or||x instanceof jr)return!1;var b=x instanceof yi||x instanceof Ir,T=!0;return x.eachChild(function(A){T=b?T&&v(A):T&&A instanceof mi}),!!T&&Nn(x)&&Ba(x,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(c)){var g=new Wi;try{c=new mi(c.type,c.evaluate(g))}catch(v){return this.error(v.message),null}}return c}return this.error('Unknown expression "'+a+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},pn.prototype.concat=function(t,e,r){var a=typeof t=="number"?this.path.concat(t):this.path,l=r?this.scope.concat(r):this.scope;return new pn(this.registry,a,e||null,l,this.errors)},pn.prototype.error=function(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];var a=""+this.key+e.map(function(l){return"["+l+"]"}).join("");this.errors.push(new At(a,t))},pn.prototype.checkSubtype=function(t,e){var r=Ne(t,e);return r&&this.error(r),r};var ki=function(t,e,r){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var a=0,l=r;a<l.length;a+=1){var c=l[a],h=c[1];this.labels.push(c[0]),this.outputs.push(h)}};function ir(t,e,r){return t*(1-r)+e*r}ki.parse=function(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");var r=e.parse(t[1],1,pt);if(!r)return null;var a=[],l=null;e.expectedType&&e.expectedType.kind!=="value"&&(l=e.expectedType);for(var c=1;c<t.length;c+=2){var h=c===1?-1/0:t[c],m=t[c+1],g=c,v=c+1;if(typeof h!="number")return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',g);if(a.length&&a[a.length-1][0]>=h)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',g);var x=e.parse(m,v,l);if(!x)return null;l=l||x.type,a.push([h,x])}return new ki(l,r,a)},ki.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(e.length===1)return r[0].evaluate(t);var a=this.input.evaluate(t);if(a<=e[0])return r[0].evaluate(t);var l=e.length;return a>=e[l-1]?r[l-1].evaluate(t):r[Ki(e,a)].evaluate(t)},ki.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e])},ki.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},ki.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var Oa=Object.freeze({__proto__:null,number:ir,color:function(t,e,r){return new se(ir(t.r,e.r,r),ir(t.g,e.g,r),ir(t.b,e.b,r),ir(t.a,e.a,r))},array:function(t,e,r){return t.map(function(a,l){return ir(a,e[l],r)})}}),Vl=6/29*3*(6/29),Ku=Math.PI/180,Hu=180/Math.PI;function Vs(t){return t>.008856451679035631?Math.pow(t,1/3):t/Vl+4/29}function Ns(t){return t>6/29?t*t*t:Vl*(t-4/29)}function js(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function qs(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Nl(t){var e=qs(t.r),r=qs(t.g),a=qs(t.b),l=Vs((.4124564*e+.3575761*r+.1804375*a)/.95047),c=Vs((.2126729*e+.7151522*r+.072175*a)/1);return{l:116*c-16,a:500*(l-c),b:200*(c-Vs((.0193339*e+.119192*r+.9503041*a)/1.08883)),alpha:t.a}}function jl(t){var e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,a=isNaN(t.b)?e:e-t.b/200;return e=1*Ns(e),r=.95047*Ns(r),a=1.08883*Ns(a),new se(js(3.2404542*r-1.5371385*e-.4985314*a),js(-.969266*r+1.8760108*e+.041556*a),js(.0556434*r-.2040259*e+1.0572252*a),t.alpha)}function Ju(t,e,r){var a=e-t;return t+r*(a>180||a<-180?a-360*Math.round(a/360):a)}var Wo={forward:Nl,reverse:jl,interpolate:function(t,e,r){return{l:ir(t.l,e.l,r),a:ir(t.a,e.a,r),b:ir(t.b,e.b,r),alpha:ir(t.alpha,e.alpha,r)}}},Ko={forward:function(t){var e=Nl(t),r=e.l,a=e.a,l=e.b,c=Math.atan2(l,a)*Hu;return{h:c<0?c+360:c,c:Math.sqrt(a*a+l*l),l:r,alpha:t.a}},reverse:function(t){var e=t.h*Ku,r=t.c;return jl({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:Ju(t.h,e.h,r),c:ir(t.c,e.c,r),l:ir(t.l,e.l,r),alpha:ir(t.alpha,e.alpha,r)}}},ql=Object.freeze({__proto__:null,lab:Wo,hcl:Ko}),Sr=function(t,e,r,a,l){this.type=t,this.operator=e,this.interpolation=r,this.input=a,this.labels=[],this.outputs=[];for(var c=0,h=l;c<h.length;c+=1){var m=h[c],g=m[1];this.labels.push(m[0]),this.outputs.push(g)}};function Zs(t,e,r,a){var l=a-r,c=t-r;return l===0?0:e===1?c/l:(Math.pow(e,c)-1)/(Math.pow(e,l)-1)}Sr.interpolationFactor=function(t,e,r,a){var l=0;if(t.name==="exponential")l=Zs(e,t.base,r,a);else if(t.name==="linear")l=Zs(e,1,r,a);else if(t.name==="cubic-bezier"){var c=t.controlPoints;l=new st(c[0],c[1],c[2],c[3]).solve(Zs(e,1,r,a))}return l},Sr.parse=function(t,e){var r=t[0],a=t[1],l=t[2],c=t.slice(3);if(!Array.isArray(a)||a.length===0)return e.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){var h=a[1];if(typeof h!="number")return e.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:h}}else{if(a[0]!=="cubic-bezier")return e.error("Unknown interpolation type "+String(a[0]),1,0);var m=a.slice(1);if(m.length!==4||m.some(function(W){return typeof W!="number"||W<0||W>1}))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:m}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(l=e.parse(l,2,pt)))return null;var g=[],v=null;r==="interpolate-hcl"||r==="interpolate-lab"?v=Qt:e.expectedType&&e.expectedType.kind!=="value"&&(v=e.expectedType);for(var x=0;x<c.length;x+=2){var b=c[x],T=c[x+1],A=x+3,L=x+4;if(typeof b!="number")return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(g.length&&g[g.length-1][0]>=b)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);var R=e.parse(T,L,v);if(!R)return null;v=v||R.type,g.push([b,R])}return v.kind==="number"||v.kind==="color"||v.kind==="array"&&v.itemType.kind==="number"&&typeof v.N=="number"?new Sr(v,r,a,l,g):e.error("Type "+ce(v)+" is not interpolatable.")},Sr.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(e.length===1)return r[0].evaluate(t);var a=this.input.evaluate(t);if(a<=e[0])return r[0].evaluate(t);var l=e.length;if(a>=e[l-1])return r[l-1].evaluate(t);var c=Ki(e,a),h=Sr.interpolationFactor(this.interpolation,a,e[c],e[c+1]),m=r[c].evaluate(t),g=r[c+1].evaluate(t);return this.operator==="interpolate"?Oa[this.type.kind.toLowerCase()](m,g,h):this.operator==="interpolate-hcl"?Ko.reverse(Ko.interpolate(Ko.forward(m),Ko.forward(g),h)):Wo.reverse(Wo.interpolate(Wo.forward(m),Wo.forward(g),h))},Sr.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e])},Sr.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},Sr.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],r=0;r<this.labels.length;r++)e.push(this.labels[r],this.outputs[r].serialize());return e};var hn=function(t,e){this.type=t,this.args=e};hn.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var r=null,a=e.expectedType;a&&a.kind!=="value"&&(r=a);for(var l=[],c=0,h=t.slice(1);c<h.length;c+=1){var m=e.parse(h[c],1+l.length,r,void 0,{typeAnnotation:"omit"});if(!m)return null;r=r||m.type,l.push(m)}var g=a&&l.some(function(v){return Ne(a,v.type)});return new hn(g?Lt:r,l)},hn.prototype.evaluate=function(t){for(var e,r=null,a=0,l=0,c=this.args;l<c.length&&(a++,(r=c[l].evaluate(t))&&r instanceof Vr&&!r.available&&(e||(e=r.name),r=null,a===this.args.length&&(r=e)),r===null);l+=1);return r},hn.prototype.eachChild=function(t){this.args.forEach(t)},hn.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},hn.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(e){t.push(e.serialize())}),t};var fn=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};fn.prototype.evaluate=function(t){return this.result.evaluate(t)},fn.prototype.eachChild=function(t){for(var e=0,r=this.bindings;e<r.length;e+=1)t(r[e][1]);t(this.result)},fn.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var r=[],a=1;a<t.length-1;a+=2){var l=t[a];if(typeof l!="string")return e.error("Expected string, but found "+typeof l+" instead.",a);if(/[^a-zA-Z0-9_]/.test(l))return e.error("Variable names must contain only alphanumeric characters or '_'.",a);var c=e.parse(t[a+1],a+1);if(!c)return null;r.push([l,c])}var h=e.parse(t[t.length-1],t.length-1,e.expectedType,r);return h?new fn(r,h):null},fn.prototype.outputDefined=function(){return this.result.outputDefined()},fn.prototype.serialize=function(){for(var t=["let"],e=0,r=this.bindings;e<r.length;e+=1){var a=r[e];t.push(a[0],a[1].serialize())}return t.push(this.result.serialize()),t};var jn=function(t,e,r){this.type=t,this.index=e,this.input=r};jn.parse=function(t,e){if(t.length!==3)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,pt),a=e.parse(t[2],2,Ce(e.expectedType||Lt));return r&&a?new jn(a.type.itemType,r,a):null},jn.prototype.evaluate=function(t){var e=this.index.evaluate(t),r=this.input.evaluate(t);if(e<0)throw new Le("Array index out of bounds: "+e+" < 0.");if(e>=r.length)throw new Le("Array index out of bounds: "+e+" > "+(r.length-1)+".");if(e!==Math.floor(e))throw new Le("Array index must be an integer, but found "+e+" instead.");return r[e]},jn.prototype.eachChild=function(t){t(this.index),t(this.input)},jn.prototype.outputDefined=function(){return!1},jn.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var qn=function(t,e){this.type=ft,this.needle=t,this.haystack=e};qn.parse=function(t,e){if(t.length!==3)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,Lt),a=e.parse(t[2],2,Lt);return r&&a?Ee(r.type,[ft,wt,pt,Ft,Lt])?new qn(r,a):e.error("Expected first argument to be of type boolean, string, number or null, but found "+ce(r.type)+" instead"):null},qn.prototype.evaluate=function(t){var e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!r)return!1;if(!ie(e,["boolean","string","number","null"]))throw new Le("Expected first argument to be of type boolean, string, number or null, but found "+ce(cr(e))+" instead.");if(!ie(r,["string","array"]))throw new Le("Expected second argument to be of type array or string, but found "+ce(cr(r))+" instead.");return r.indexOf(e)>=0},qn.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},qn.prototype.outputDefined=function(){return!0},qn.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var dn=function(t,e,r){this.type=pt,this.needle=t,this.haystack=e,this.fromIndex=r};dn.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,Lt),a=e.parse(t[2],2,Lt);if(!r||!a)return null;if(!Ee(r.type,[ft,wt,pt,Ft,Lt]))return e.error("Expected first argument to be of type boolean, string, number or null, but found "+ce(r.type)+" instead");if(t.length===4){var l=e.parse(t[3],3,pt);return l?new dn(r,a,l):null}return new dn(r,a)},dn.prototype.evaluate=function(t){var e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!ie(e,["boolean","string","number","null"]))throw new Le("Expected first argument to be of type boolean, string, number or null, but found "+ce(cr(e))+" instead.");if(!ie(r,["string","array"]))throw new Le("Expected second argument to be of type array or string, but found "+ce(cr(r))+" instead.");if(this.fromIndex){var a=this.fromIndex.evaluate(t);return r.indexOf(e,a)}return r.indexOf(e)},dn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},dn.prototype.outputDefined=function(){return!1},dn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Zn=function(t,e,r,a,l,c){this.inputType=t,this.type=e,this.input=r,this.cases=a,this.outputs=l,this.otherwise=c};Zn.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var r,a;e.expectedType&&e.expectedType.kind!=="value"&&(a=e.expectedType);for(var l={},c=[],h=2;h<t.length-1;h+=2){var m=t[h],g=t[h+1];Array.isArray(m)||(m=[m]);var v=e.concat(h);if(m.length===0)return v.error("Expected at least one branch label.");for(var x=0,b=m;x<b.length;x+=1){var T=b[x];if(typeof T!="number"&&typeof T!="string")return v.error("Branch labels must be numbers or strings.");if(typeof T=="number"&&Math.abs(T)>Number.MAX_SAFE_INTEGER)return v.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof T=="number"&&Math.floor(T)!==T)return v.error("Numeric branch labels must be integer values.");if(r){if(v.checkSubtype(r,cr(T)))return null}else r=cr(T);if(l[String(T)]!==void 0)return v.error("Branch labels must be unique.");l[String(T)]=c.length}var A=e.parse(g,h,a);if(!A)return null;a=a||A.type,c.push(A)}var L=e.parse(t[1],1,Lt);if(!L)return null;var R=e.parse(t[t.length-1],t.length-1,a);return R?L.type.kind!=="value"&&e.concat(1).checkSubtype(r,L.type)?null:new Zn(r,a,L,l,c,R):null},Zn.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(cr(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},Zn.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},Zn.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},Zn.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],r=[],a={},l=0,c=Object.keys(this.cases).sort();l<c.length;l+=1){var h=c[l];(b=a[this.cases[h]])===void 0?(a[this.cases[h]]=r.length,r.push([this.cases[h],[h]])):r[b][1].push(h)}for(var m=function(A){return t.inputType.kind==="number"?Number(A):A},g=0,v=r;g<v.length;g+=1){var x=v[g],b=x[0],T=x[1];e.push(T.length===1?m(T[0]):T.map(m)),e.push(this.outputs[outputIndex$1].serialize())}return e.push(this.otherwise.serialize()),e};var Gn=function(t,e,r){this.type=t,this.branches=e,this.otherwise=r};Gn.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var r;e.expectedType&&e.expectedType.kind!=="value"&&(r=e.expectedType);for(var a=[],l=1;l<t.length-1;l+=2){var c=e.parse(t[l],l,ft);if(!c)return null;var h=e.parse(t[l+1],l+1,r);if(!h)return null;a.push([c,h]),r=r||h.type}var m=e.parse(t[t.length-1],t.length-1,r);return m?new Gn(r,a,m):null},Gn.prototype.evaluate=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var a=r[e],l=a[1];if(a[0].evaluate(t))return l.evaluate(t)}return this.otherwise.evaluate(t)},Gn.prototype.eachChild=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var a=r[e],l=a[1];t(a[0]),t(l)}t(this.otherwise)},Gn.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},Gn.prototype.serialize=function(){var t=["case"];return this.eachChild(function(e){t.push(e.serialize())}),t};var mn=function(t,e,r,a){this.type=t,this.input=e,this.beginIndex=r,this.endIndex=a};function Zl(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Re(t,e,r,a){return a.compare(e,r)===0}function So(t,e,r){var a=t!=="=="&&t!=="!=";return function(){function l(c,h,m){this.type=ft,this.lhs=c,this.rhs=h,this.collator=m,this.hasUntypedArgument=c.type.kind==="value"||h.type.kind==="value"}return l.parse=function(c,h){if(c.length!==3&&c.length!==4)return h.error("Expected two or three arguments.");var m=c[0],g=h.parse(c[1],1,Lt);if(!g)return null;if(!Zl(m,g.type))return h.concat(1).error('"'+m+`" comparisons are not supported for type '`+ce(g.type)+"'.");var v=h.parse(c[2],2,Lt);if(!v)return null;if(!Zl(m,v.type))return h.concat(2).error('"'+m+`" comparisons are not supported for type '`+ce(v.type)+"'.");if(g.type.kind!==v.type.kind&&g.type.kind!=="value"&&v.type.kind!=="value")return h.error("Cannot compare types '"+ce(g.type)+"' and '"+ce(v.type)+"'.");a&&(g.type.kind==="value"&&v.type.kind!=="value"?g=new Ir(v.type,[g]):g.type.kind!=="value"&&v.type.kind==="value"&&(v=new Ir(g.type,[v])));var x=null;if(c.length===4){if(g.type.kind!=="string"&&v.type.kind!=="string"&&g.type.kind!=="value"&&v.type.kind!=="value")return h.error("Cannot use collator to compare non-string types.");if(!(x=h.parse(c[3],3,Te)))return null}return new l(g,v,x)},l.prototype.evaluate=function(c){var h=this.lhs.evaluate(c),m=this.rhs.evaluate(c);if(a&&this.hasUntypedArgument){var g=cr(h),v=cr(m);if(g.kind!==v.kind||g.kind!=="string"&&g.kind!=="number")throw new Le('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+g.kind+", "+v.kind+") instead.")}if(this.collator&&!a&&this.hasUntypedArgument){var x=cr(h),b=cr(m);if(x.kind!=="string"||b.kind!=="string")return e(c,h,m)}return this.collator?r(c,h,m,this.collator.evaluate(c)):e(c,h,m)},l.prototype.eachChild=function(c){c(this.lhs),c(this.rhs),this.collator&&c(this.collator)},l.prototype.outputDefined=function(){return!0},l.prototype.serialize=function(){var c=[t];return this.eachChild(function(h){c.push(h.serialize())}),c},l}()}mn.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,Lt),a=e.parse(t[2],2,pt);if(!r||!a)return null;if(!Ee(r.type,[Ce(Lt),wt,Lt]))return e.error("Expected first argument to be of type array or string, but found "+ce(r.type)+" instead");if(t.length===4){var l=e.parse(t[3],3,pt);return l?new mn(r.type,r,a,l):null}return new mn(r.type,r,a)},mn.prototype.evaluate=function(t){var e=this.input.evaluate(t),r=this.beginIndex.evaluate(t);if(!ie(e,["string","array"]))throw new Le("Expected first argument to be of type array or string, but found "+ce(cr(e))+" instead.");if(this.endIndex){var a=this.endIndex.evaluate(t);return e.slice(r,a)}return e.slice(r)},mn.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},mn.prototype.outputDefined=function(){return!1},mn.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Fa=So("==",function(t,e,r){return e===r},Re),Gl=So("!=",function(t,e,r){return e!==r},function(t,e,r,a){return!Re(0,e,r,a)}),Xl=So("<",function(t,e,r){return e<r},function(t,e,r,a){return a.compare(e,r)<0}),Wl=So(">",function(t,e,r){return e>r},function(t,e,r,a){return a.compare(e,r)>0}),Kl=So("<=",function(t,e,r){return e<=r},function(t,e,r,a){return a.compare(e,r)<=0}),Yu=So(">=",function(t,e,r){return e>=r},function(t,e,r,a){return a.compare(e,r)>=0}),yn=function(t,e,r,a,l){this.type=wt,this.number=t,this.locale=e,this.currency=r,this.minFractionDigits=a,this.maxFractionDigits=l};yn.parse=function(t,e){if(t.length!==3)return e.error("Expected two arguments.");var r=e.parse(t[1],1,pt);if(!r)return null;var a=t[2];if(typeof a!="object"||Array.isArray(a))return e.error("NumberFormat options argument must be an object.");var l=null;if(a.locale&&!(l=e.parse(a.locale,1,wt)))return null;var c=null;if(a.currency&&!(c=e.parse(a.currency,1,wt)))return null;var h=null;if(a["min-fraction-digits"]&&!(h=e.parse(a["min-fraction-digits"],1,pt)))return null;var m=null;return a["max-fraction-digits"]&&!(m=e.parse(a["max-fraction-digits"],1,pt))?null:new yn(r,l,c,h,m)},yn.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},yn.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},yn.prototype.outputDefined=function(){return!1},yn.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var gn=function(t){this.type=pt,this.input=t};gn.parse=function(t,e){if(t.length!==2)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?e.error("Expected argument of type string or array, but found "+ce(r.type)+" instead."):new gn(r):null},gn.prototype.evaluate=function(t){var e=this.input.evaluate(t);if(typeof e=="string"||Array.isArray(e))return e.length;throw new Le("Expected value to be of type string or array, but found "+ce(cr(e))+" instead.")},gn.prototype.eachChild=function(t){t(this.input)},gn.prototype.outputDefined=function(){return!1},gn.prototype.serialize=function(){var t=["length"];return this.eachChild(function(e){t.push(e.serialize())}),t};var To={"==":Fa,"!=":Gl,">":Wl,"<":Xl,">=":Yu,"<=":Kl,array:Ir,at:jn,boolean:Ir,case:Gn,coalesce:hn,collator:or,format:Hr,image:Xi,in:qn,"index-of":dn,interpolate:Sr,"interpolate-hcl":Sr,"interpolate-lab":Sr,length:gn,let:fn,literal:mi,match:Zn,number:Ir,"number-format":yn,object:Ir,slice:mn,step:ki,string:Ir,"to-boolean":yi,"to-color":yi,"to-number":yi,"to-string":yi,var:cn,within:jr};function Hl(t,e){var r=e[0],a=e[1],l=e[2],c=e[3];r=r.evaluate(t),a=a.evaluate(t),l=l.evaluate(t);var h=c?c.evaluate(t):1,m=Bs(r,a,l,h);if(m)throw new Le(m);return new se(r/255*h,a/255*h,l/255*h,h)}function Jl(t,e){return t in e}function Gs(t,e){var r=e[t];return r===void 0?null:r}function Xn(t){return{type:t}}function Xs(t){return{result:"success",value:t}}function Wn(t){return{result:"error",value:t}}function Io(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function Ua(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Ws(t){return!!t.expression&&t.expression.interpolated}function Pe(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Va(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Yl(t){return t}function Eo(t,e,r){return t!==void 0?t:e!==void 0?e:r!==void 0?r:void 0}function Qu(t,e,r,a,l){return Eo(typeof r===l?a[r]:void 0,t.default,e.default)}function $u(t,e,r){if(Pe(r)!=="number")return Eo(t.default,e.default);var a=t.stops.length;if(a===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[a-1][0])return t.stops[a-1][1];var l=Ki(t.stops.map(function(c){return c[0]}),r);return t.stops[l][1]}function Ho(t,e,r){var a=t.base!==void 0?t.base:1;if(Pe(r)!=="number")return Eo(t.default,e.default);var l=t.stops.length;if(l===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[l-1][0])return t.stops[l-1][1];var c=Ki(t.stops.map(function(b){return b[0]}),r),h=function(b,T,A,L){var R=L-A,W=b-A;return R===0?0:T===1?W/R:(Math.pow(T,W)-1)/(Math.pow(T,R)-1)}(r,a,t.stops[c][0],t.stops[c+1][0]),m=t.stops[c][1],g=t.stops[c+1][1],v=Oa[e.type]||Yl;if(t.colorSpace&&t.colorSpace!=="rgb"){var x=ql[t.colorSpace];v=function(b,T){return x.reverse(x.interpolate(x.forward(b),x.forward(T),h))}}return typeof m.evaluate=="function"?{evaluate:function(){for(var b=[],T=arguments.length;T--;)b[T]=arguments[T];var A=m.evaluate.apply(void 0,b),L=g.evaluate.apply(void 0,b);if(A!==void 0&&L!==void 0)return v(A,L,h)}}:v(m,g,h)}function Ql(t,e,r){return e.type==="color"?r=se.parse(r):e.type==="formatted"?r=yr.fromString(r.toString()):e.type==="resolvedImage"?r=Vr.fromString(r.toString()):Pe(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),Eo(r,t.default,e.default)}gr.register(To,{error:[{kind:"error"},[wt],function(t,e){throw new Le(e[0].evaluate(t))}],typeof:[wt,[Lt],function(t,e){return ce(cr(e[0].evaluate(t)))}],"to-rgba":[Ce(pt,4),[Qt],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[Qt,[pt,pt,pt],Hl],rgba:[Qt,[pt,pt,pt,pt],Hl],has:{type:ft,overloads:[[[wt],function(t,e){return Jl(e[0].evaluate(t),t.properties())}],[[wt,$t],function(t,e){var r=e[1];return Jl(e[0].evaluate(t),r.evaluate(t))}]]},get:{type:Lt,overloads:[[[wt],function(t,e){return Gs(e[0].evaluate(t),t.properties())}],[[wt,$t],function(t,e){var r=e[1];return Gs(e[0].evaluate(t),r.evaluate(t))}]]},"feature-state":[Lt,[wt],function(t,e){return Gs(e[0].evaluate(t),t.featureState||{})}],properties:[$t,[],function(t){return t.properties()}],"geometry-type":[wt,[],function(t){return t.geometryType()}],id:[Lt,[],function(t){return t.id()}],zoom:[pt,[],function(t){return t.globals.zoom}],"heatmap-density":[pt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[pt,[],function(t){return t.globals.lineProgress||0}],accumulated:[Lt,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[pt,Xn(pt),function(t,e){for(var r=0,a=0,l=e;a<l.length;a+=1)r+=l[a].evaluate(t);return r}],"*":[pt,Xn(pt),function(t,e){for(var r=1,a=0,l=e;a<l.length;a+=1)r*=l[a].evaluate(t);return r}],"-":{type:pt,overloads:[[[pt,pt],function(t,e){var r=e[1];return e[0].evaluate(t)-r.evaluate(t)}],[[pt],function(t,e){return-e[0].evaluate(t)}]]},"/":[pt,[pt,pt],function(t,e){var r=e[1];return e[0].evaluate(t)/r.evaluate(t)}],"%":[pt,[pt,pt],function(t,e){var r=e[1];return e[0].evaluate(t)%r.evaluate(t)}],ln2:[pt,[],function(){return Math.LN2}],pi:[pt,[],function(){return Math.PI}],e:[pt,[],function(){return Math.E}],"^":[pt,[pt,pt],function(t,e){var r=e[1];return Math.pow(e[0].evaluate(t),r.evaluate(t))}],sqrt:[pt,[pt],function(t,e){return Math.sqrt(e[0].evaluate(t))}],log10:[pt,[pt],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN10}],ln:[pt,[pt],function(t,e){return Math.log(e[0].evaluate(t))}],log2:[pt,[pt],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN2}],sin:[pt,[pt],function(t,e){return Math.sin(e[0].evaluate(t))}],cos:[pt,[pt],function(t,e){return Math.cos(e[0].evaluate(t))}],tan:[pt,[pt],function(t,e){return Math.tan(e[0].evaluate(t))}],asin:[pt,[pt],function(t,e){return Math.asin(e[0].evaluate(t))}],acos:[pt,[pt],function(t,e){return Math.acos(e[0].evaluate(t))}],atan:[pt,[pt],function(t,e){return Math.atan(e[0].evaluate(t))}],min:[pt,Xn(pt),function(t,e){return Math.min.apply(Math,e.map(function(r){return r.evaluate(t)}))}],max:[pt,Xn(pt),function(t,e){return Math.max.apply(Math,e.map(function(r){return r.evaluate(t)}))}],abs:[pt,[pt],function(t,e){return Math.abs(e[0].evaluate(t))}],round:[pt,[pt],function(t,e){var r=e[0].evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[pt,[pt],function(t,e){return Math.floor(e[0].evaluate(t))}],ceil:[pt,[pt],function(t,e){return Math.ceil(e[0].evaluate(t))}],"filter-==":[ft,[wt,Lt],function(t,e){var r=e[0],a=e[1];return t.properties()[r.value]===a.value}],"filter-id-==":[ft,[Lt],function(t,e){var r=e[0];return t.id()===r.value}],"filter-type-==":[ft,[wt],function(t,e){var r=e[0];return t.geometryType()===r.value}],"filter-<":[ft,[wt,Lt],function(t,e){var r=e[0],a=e[1],l=t.properties()[r.value],c=a.value;return typeof l==typeof c&&l<c}],"filter-id-<":[ft,[Lt],function(t,e){var r=e[0],a=t.id(),l=r.value;return typeof a==typeof l&&a<l}],"filter->":[ft,[wt,Lt],function(t,e){var r=e[0],a=e[1],l=t.properties()[r.value],c=a.value;return typeof l==typeof c&&l>c}],"filter-id->":[ft,[Lt],function(t,e){var r=e[0],a=t.id(),l=r.value;return typeof a==typeof l&&a>l}],"filter-<=":[ft,[wt,Lt],function(t,e){var r=e[0],a=e[1],l=t.properties()[r.value],c=a.value;return typeof l==typeof c&&l<=c}],"filter-id-<=":[ft,[Lt],function(t,e){var r=e[0],a=t.id(),l=r.value;return typeof a==typeof l&&a<=l}],"filter->=":[ft,[wt,Lt],function(t,e){var r=e[0],a=e[1],l=t.properties()[r.value],c=a.value;return typeof l==typeof c&&l>=c}],"filter-id->=":[ft,[Lt],function(t,e){var r=e[0],a=t.id(),l=r.value;return typeof a==typeof l&&a>=l}],"filter-has":[ft,[Lt],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[ft,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[ft,[Ce(wt)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[ft,[Ce(Lt)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[ft,[wt,Ce(Lt)],function(t,e){var r=e[0];return e[1].value.indexOf(t.properties()[r.value])>=0}],"filter-in-large":[ft,[wt,Ce(Lt)],function(t,e){var r=e[0],a=e[1];return function(l,c,h,m){for(;h<=m;){var g=h+m>>1;if(c[g]===l)return!0;c[g]>l?m=g-1:h=g+1}return!1}(t.properties()[r.value],a.value,0,a.value.length-1)}],all:{type:ft,overloads:[[[ft,ft],function(t,e){var r=e[1];return e[0].evaluate(t)&&r.evaluate(t)}],[Xn(ft),function(t,e){for(var r=0,a=e;r<a.length;r+=1)if(!a[r].evaluate(t))return!1;return!0}]]},any:{type:ft,overloads:[[[ft,ft],function(t,e){var r=e[1];return e[0].evaluate(t)||r.evaluate(t)}],[Xn(ft),function(t,e){for(var r=0,a=e;r<a.length;r+=1)if(a[r].evaluate(t))return!0;return!1}]]},"!":[ft,[ft],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[ft,[wt],function(t,e){var r=t.globals&&t.globals.isSupportedScript;return!r||r(e[0].evaluate(t))}],upcase:[wt,[wt],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[wt,[wt],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[wt,Xn(Lt),function(t,e){return e.map(function(r){return Bi(r.evaluate(t))}).join("")}],"resolved-locale":[wt,[Te],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var Ao=function(t,e){this.expression=t,this._warningHistory={},this._evaluator=new Wi,this._defaultValue=e?function(r){return r.type==="color"&&Va(r.default)?new se(0,0,0,0):r.type==="color"?se.parse(r.default)||null:r.default===void 0?null:r.default}(e):null,this._enumValues=e&&e.type==="enum"?e.values:null};function Na(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in To}function ja(t,e){var r=new pn(To,[],e?function(l){var c={color:Qt,string:wt,number:pt,enum:wt,boolean:ft,formatted:oe,resolvedImage:Ae};return l.type==="array"?Ce(c[l.value]||Lt,l.length):c[l.type]}(e):void 0),a=r.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?Xs(new Ao(a,e)):Wn(r.errors)}Ao.prototype.evaluateWithoutErrorHandling=function(t,e,r,a,l,c){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=r,this._evaluator.canonical=a,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=c,this.expression.evaluate(this._evaluator)},Ao.prototype.evaluate=function(t,e,r,a,l,c){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=r||null,this._evaluator.canonical=a,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=c||null;try{var h=this.expression.evaluate(this._evaluator);if(h==null||typeof h=="number"&&h!=h)return this._defaultValue;if(this._enumValues&&!(h in this._enumValues))throw new Le("Expected value to be one of "+Object.keys(this._enumValues).map(function(m){return JSON.stringify(m)}).join(", ")+", but found "+JSON.stringify(h)+" instead.");return h}catch(m){return this._warningHistory[m.message]||(this._warningHistory[m.message]=!0,typeof console!="undefined"&&console.warn(m.message)),this._defaultValue}};var Jo=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent=t!=="constant"&&!un(e.expression)};Jo.prototype.evaluateWithoutErrorHandling=function(t,e,r,a,l,c){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,a,l,c)},Jo.prototype.evaluate=function(t,e,r,a,l,c){return this._styleExpression.evaluate(t,e,r,a,l,c)};var Po=function(t,e,r,a){this.kind=t,this.zoomStops=r,this._styleExpression=e,this.isStateDependent=t!=="camera"&&!un(e.expression),this.interpolationType=a};function Ks(t,e){if((t=ja(t,e)).result==="error")return t;var r=t.value.expression,a=Nn(r);if(!a&&!Io(e))return Wn([new At("","data expressions not supported")]);var l=Ba(r,["zoom"]);if(!l&&!Ua(e))return Wn([new At("","zoom expressions not supported")]);var c=function h(m){var g=null;if(m instanceof fn)g=h(m.result);else if(m instanceof hn)for(var v=0,x=m.args;v<x.length&&!(g=h(x[v]));v+=1);else(m instanceof ki||m instanceof Sr)&&m.input instanceof gr&&m.input.name==="zoom"&&(g=m);return g instanceof At||m.eachChild(function(b){var T=h(b);T instanceof At?g=T:!g&&T?g=new At("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):g&&T&&g!==T&&(g=new At("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),g}(r);return c||l?c instanceof At?Wn([c]):c instanceof Sr&&!Ws(e)?Wn([new At("",'"interpolate" expressions cannot be used with this property')]):Xs(c?new Po(a?"camera":"composite",t.value,c.labels,c instanceof Sr?c.interpolation:void 0):new Jo(a?"constant":"source",t.value)):Wn([new At("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Po.prototype.evaluateWithoutErrorHandling=function(t,e,r,a,l,c){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,a,l,c)},Po.prototype.evaluate=function(t,e,r,a,l,c){return this._styleExpression.evaluate(t,e,r,a,l,c)},Po.prototype.interpolationFactor=function(t,e,r){return this.interpolationType?Sr.interpolationFactor(this.interpolationType,t,e,r):0};var Yo=function(t,e){this._parameters=t,this._specification=e,xt(this,function r(a,l){var c,h,m,g=l.type==="color",v=a.stops&&typeof a.stops[0][0]=="object",x=v||!(v||a.property!==void 0),b=a.type||(Ws(l)?"exponential":"interval");if(g&&((a=xt({},a)).stops&&(a.stops=a.stops.map(function(St){return[St[0],se.parse(St[1])]})),a.default=se.parse(a.default?a.default:l.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!ql[a.colorSpace])throw new Error("Unknown color space: "+a.colorSpace);if(b==="exponential")c=Ho;else if(b==="interval")c=$u;else if(b==="categorical"){c=Qu,h=Object.create(null);for(var T=0,A=a.stops;T<A.length;T+=1){var L=A[T];h[L[0]]=L[1]}m=typeof a.stops[0][0]}else{if(b!=="identity")throw new Error('Unknown function type "'+b+'"');c=Ql}if(v){for(var R={},W=[],q=0;q<a.stops.length;q++){var Y=a.stops[q],$=Y[0].zoom;R[$]===void 0&&(R[$]={zoom:$,type:a.type,property:a.property,default:a.default,stops:[]},W.push($)),R[$].stops.push([Y[0].value,Y[1]])}for(var rt=[],it=0,ut=W;it<ut.length;it+=1){var gt=ut[it];rt.push([R[gt].zoom,r(R[gt],l)])}var bt={name:"linear"};return{kind:"composite",interpolationType:bt,interpolationFactor:Sr.interpolationFactor.bind(void 0,bt),zoomStops:rt.map(function(St){return St[0]}),evaluate:function(St,Ut){var Tt=St.zoom;return Ho({stops:rt,base:a.base},l,Tt).evaluate(Tt,Ut)}}}if(x){var Bt=b==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:Bt,interpolationFactor:Sr.interpolationFactor.bind(void 0,Bt),zoomStops:a.stops.map(function(St){return St[0]}),evaluate:function(St){return c(a,l,St.zoom,h,m)}}}return{kind:"source",evaluate:function(St,Ut){var Tt=Ut&&Ut.properties?Ut.properties[a.property]:void 0;return Tt===void 0?Eo(a.default,l.default):c(a,l,Tt,h,m)}}}(this._parameters,this._specification))};function Ci(t){var e=t.key,r=t.value,a=t.valueSpec||{},l=t.objectElementValidators||{},c=t.style,h=t.styleSpec,m=[],g=Pe(r);if(g!=="object")return[new j(e,r,"object expected, "+g+" found")];for(var v in r){var x=v.split(".")[0],b=a[x]||a["*"],T=void 0;if(l[x])T=l[x];else if(a[x])T=pe;else if(l["*"])T=l["*"];else{if(!a["*"]){m.push(new j(e,r[v],'unknown property "'+v+'"'));continue}T=pe}m=m.concat(T({key:(e&&e+".")+v,value:r[v],valueSpec:b,style:c,styleSpec:h,object:r,objectKey:v},r))}for(var A in a)l[A]||a[A].required&&a[A].default===void 0&&r[A]===void 0&&m.push(new j(e,r,'missing required property "'+A+'"'));return m}function $l(t){var e=t.value,r=t.valueSpec,a=t.style,l=t.styleSpec,c=t.key,h=t.arrayElementValidator||pe;if(Pe(e)!=="array")return[new j(c,e,"array expected, "+Pe(e)+" found")];if(r.length&&e.length!==r.length)return[new j(c,e,"array length "+r.length+" expected, length "+e.length+" found")];if(r["min-length"]&&e.length<r["min-length"])return[new j(c,e,"array length at least "+r["min-length"]+" expected, length "+e.length+" found")];var m={type:r.value,values:r.values};l.$version<7&&(m.function=r.function),Pe(r.value)==="object"&&(m=r.value);for(var g=[],v=0;v<e.length;v++)g=g.concat(h({array:e,arrayIndex:v,value:e[v],valueSpec:m,style:a,styleSpec:l,key:c+"["+v+"]"}));return g}function tu(t){var e=t.key,r=t.value,a=t.valueSpec,l=Pe(r);return l==="number"&&r!=r&&(l="NaN"),l!=="number"?[new j(e,r,"number expected, "+l+" found")]:"minimum"in a&&r<a.minimum?[new j(e,r,r+" is less than the minimum value "+a.minimum)]:"maximum"in a&&r>a.maximum?[new j(e,r,r+" is greater than the maximum value "+a.maximum)]:[]}function Hs(t){var e,r,a,l=t.valueSpec,c=et(t.value.type),h={},m=c!=="categorical"&&t.value.property===void 0,g=!m,v=Pe(t.value.stops)==="array"&&Pe(t.value.stops[0])==="array"&&Pe(t.value.stops[0][0])==="object",x=Ci({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(A){if(c==="identity")return[new j(A.key,A.value,'identity function may not have a "stops" property')];var L=[],R=A.value;return L=L.concat($l({key:A.key,value:R,valueSpec:A.valueSpec,style:A.style,styleSpec:A.styleSpec,arrayElementValidator:b})),Pe(R)==="array"&&R.length===0&&L.push(new j(A.key,R,"array must have at least one stop")),L},default:function(A){return pe({key:A.key,value:A.value,valueSpec:l,style:A.style,styleSpec:A.styleSpec})}}});return c==="identity"&&m&&x.push(new j(t.key,t.value,'missing required property "property"')),c==="identity"||t.value.stops||x.push(new j(t.key,t.value,'missing required property "stops"')),c==="exponential"&&t.valueSpec.expression&&!Ws(t.valueSpec)&&x.push(new j(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(g&&!Io(t.valueSpec)?x.push(new j(t.key,t.value,"property functions not supported")):m&&!Ua(t.valueSpec)&&x.push(new j(t.key,t.value,"zoom functions not supported"))),c!=="categorical"&&!v||t.value.property!==void 0||x.push(new j(t.key,t.value,'"property" property is required')),x;function b(A){var L=[],R=A.value,W=A.key;if(Pe(R)!=="array")return[new j(W,R,"array expected, "+Pe(R)+" found")];if(R.length!==2)return[new j(W,R,"array length 2 expected, length "+R.length+" found")];if(v){if(Pe(R[0])!=="object")return[new j(W,R,"object expected, "+Pe(R[0])+" found")];if(R[0].zoom===void 0)return[new j(W,R,"object stop key must have zoom")];if(R[0].value===void 0)return[new j(W,R,"object stop key must have value")];if(a&&a>et(R[0].zoom))return[new j(W,R[0].zoom,"stop zoom values must appear in ascending order")];et(R[0].zoom)!==a&&(a=et(R[0].zoom),r=void 0,h={}),L=L.concat(Ci({key:W+"[0]",value:R[0],valueSpec:{zoom:{}},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{zoom:tu,value:T}}))}else L=L.concat(T({key:W+"[0]",value:R[0],valueSpec:{},style:A.style,styleSpec:A.styleSpec},R));return Na(mt(R[1]))?L.concat([new j(W+"[1]",R[1],"expressions are not allowed in function stops.")]):L.concat(pe({key:W+"[1]",value:R[1],valueSpec:l,style:A.style,styleSpec:A.styleSpec}))}function T(A,L){var R=Pe(A.value),W=et(A.value),q=A.value!==null?A.value:L;if(e){if(R!==e)return[new j(A.key,q,R+" stop domain type must match previous stop domain type "+e)]}else e=R;if(R!=="number"&&R!=="string"&&R!=="boolean")return[new j(A.key,q,"stop domain value must be a number, string, or boolean")];if(R!=="number"&&c!=="categorical"){var Y="number expected, "+R+" found";return Io(l)&&c===void 0&&(Y+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new j(A.key,q,Y)]}return c!=="categorical"||R!=="number"||isFinite(W)&&Math.floor(W)===W?c!=="categorical"&&R==="number"&&r!==void 0&&W<r?[new j(A.key,q,"stop domain values must appear in ascending order")]:(r=W,c==="categorical"&&W in h?[new j(A.key,q,"stop domain values must be unique")]:(h[W]=!0,[])):[new j(A.key,q,"integer expected, found "+W)]}}function Kn(t){var e=(t.expressionContext==="property"?Ks:ja)(mt(t.value),t.valueSpec);if(e.result==="error")return e.value.map(function(a){return new j(""+t.key+a.key,t.value,a.message)});var r=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!r.outputDefined())return[new j(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!un(r))return[new j(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!un(r))return[new j(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!Ba(r,["zoom","feature-state"]))return[new j(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Nn(r))return[new j(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Qo(t){var e=t.key,r=t.value,a=t.valueSpec,l=[];return Array.isArray(a.values)?a.values.indexOf(et(r))===-1&&l.push(new j(e,r,"expected one of ["+a.values.join(", ")+"], "+JSON.stringify(r)+" found")):Object.keys(a.values).indexOf(et(r))===-1&&l.push(new j(e,r,"expected one of ["+Object.keys(a.values).join(", ")+"], "+JSON.stringify(r)+" found")),l}function $o(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,r=t.slice(1);e<r.length;e+=1){var a=r[e];if(!$o(a)&&typeof a!="boolean")return!1}return!0;default:return!0}}Yo.deserialize=function(t){return new Yo(t._parameters,t._specification)},Yo.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var tc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function qa(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};$o(t)||(t=Za(t));var e=ja(t,tc);if(e.result==="error")throw new Error(e.value.map(function(r){return r.key+": "+r.message}).join(", "));return{filter:function(r,a,l){return e.value.evaluate(r,a,{},l)},needGeometry:function r(a){if(!Array.isArray(a))return!1;if(a[0]==="within")return!0;for(var l=1;l<a.length;l++)if(r(a[l]))return!0;return!1}(t)}}function ec(t,e){return t<e?-1:t>e?1:0}function Za(t){if(!t)return!0;var e,r=t[0];return t.length<=1?r!=="any":r==="=="?Js(t[1],t[2],"=="):r==="!="?Ga(Js(t[1],t[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Js(t[1],t[2],r):r==="any"?(e=t.slice(1),["any"].concat(e.map(Za))):r==="all"?["all"].concat(t.slice(1).map(Za)):r==="none"?["all"].concat(t.slice(1).map(Za).map(Ga)):r==="in"?eu(t[1],t.slice(2)):r==="!in"?Ga(eu(t[1],t.slice(2))):r==="has"?ru(t[1]):r==="!has"?Ga(ru(t[1])):r!=="within"||t}function Js(t,e,r){switch(t){case"$type":return["filter-type-"+r,e];case"$id":return["filter-id-"+r,e];default:return["filter-"+r,t,e]}}function eu(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(function(r){return typeof r!=typeof e[0]})?["filter-in-large",t,["literal",e.sort(ec)]]:["filter-in-small",t,["literal",e]]}}function ru(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Ga(t){return["!",t]}function Xa(t){return $o(mt(t.value))?Kn(xt({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function e(r){var a=r.value,l=r.key;if(Pe(a)!=="array")return[new j(l,a,"array expected, "+Pe(a)+" found")];var c,h=r.styleSpec,m=[];if(a.length<1)return[new j(l,a,"filter array must have at least 1 element")];switch(m=m.concat(Qo({key:l+"[0]",value:a[0],valueSpec:h.filter_operator,style:r.style,styleSpec:r.styleSpec})),et(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&et(a[1])==="$type"&&m.push(new j(l,a,'"$type" cannot be use with operator "'+a[0]+'"'));case"==":case"!=":a.length!==3&&m.push(new j(l,a,'filter array for operator "'+a[0]+'" must have 3 elements'));case"in":case"!in":a.length>=2&&(c=Pe(a[1]))!=="string"&&m.push(new j(l+"[1]",a[1],"string expected, "+c+" found"));for(var g=2;g<a.length;g++)c=Pe(a[g]),et(a[1])==="$type"?m=m.concat(Qo({key:l+"["+g+"]",value:a[g],valueSpec:h.geometry_type,style:r.style,styleSpec:r.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&m.push(new j(l+"["+g+"]",a[g],"string, number, or boolean expected, "+c+" found"));break;case"any":case"all":case"none":for(var v=1;v<a.length;v++)m=m.concat(e({key:l+"["+v+"]",value:a[v],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":c=Pe(a[1]),a.length!==2?m.push(new j(l,a,'filter array for "'+a[0]+'" operator must have 2 elements')):c!=="string"&&m.push(new j(l+"[1]",a[1],"string expected, "+c+" found"));break;case"within":c=Pe(a[1]),a.length!==2?m.push(new j(l,a,'filter array for "'+a[0]+'" operator must have 2 elements')):c!=="object"&&m.push(new j(l+"[1]",a[1],"object expected, "+c+" found"))}return m}(t)}function Ys(t,e){var r=t.key,a=t.style,l=t.styleSpec,c=t.value,h=t.objectKey,m=l[e+"_"+t.layerType];if(!m)return[];var g=h.match(/^(.*)-transition$/);if(e==="paint"&&g&&m[g[1]]&&m[g[1]].transition)return pe({key:r,value:c,valueSpec:l.transition,style:a,styleSpec:l});var v,x=t.valueSpec||m[h];if(!x)return[new j(r,c,'unknown property "'+h+'"')];if(Pe(c)==="string"&&Io(x)&&!x.tokens&&(v=/^{([^}]+)}$/.exec(c)))return[new j(r,c,'"'+h+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(v[1])+" }`.")];var b=[];return t.layerType==="symbol"&&(h==="text-field"&&a&&!a.glyphs&&b.push(new j(r,c,'use of "text-field" requires a style "glyphs" property')),h==="text-font"&&Va(mt(c))&&et(c.type)==="identity"&&b.push(new j(r,c,'"text-font" does not support identity functions'))),b.concat(pe({key:t.key,value:c,valueSpec:x,style:a,styleSpec:l,expressionContext:"property",propertyType:e,propertyKey:h}))}function ta(t){return Ys(t,"paint")}function iu(t){return Ys(t,"layout")}function Qs(t){var e=[],r=t.value,a=t.key,l=t.style,c=t.styleSpec;r.type||r.ref||e.push(new j(a,r,'either "type" or "ref" is required'));var h,m=et(r.type),g=et(r.ref);if(r.id)for(var v=et(r.id),x=0;x<t.arrayIndex;x++){var b=l.layers[x];et(b.id)===v&&e.push(new j(a,r.id,'duplicate layer id "'+r.id+'", previously used at line '+b.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(L){L in r&&e.push(new j(a,r[L],'"'+L+'" is prohibited for ref layers'))}),l.layers.forEach(function(L){et(L.id)===g&&(h=L)}),h?h.ref?e.push(new j(a,r.ref,"ref cannot reference another ref layer")):m=et(h.type):e.push(new j(a,r.ref,'ref layer "'+g+'" not found'));else if(m!=="background")if(r.source){var T=l.sources&&l.sources[r.source],A=T&&et(T.type);T?A==="vector"&&m==="raster"?e.push(new j(a,r.source,'layer "'+r.id+'" requires a raster source')):A==="raster"&&m!=="raster"?e.push(new j(a,r.source,'layer "'+r.id+'" requires a vector source')):A!=="vector"||r["source-layer"]?A==="raster-dem"&&m!=="hillshade"?e.push(new j(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!r.paint||!r.paint["line-gradient"]||A==="geojson"&&T.lineMetrics||e.push(new j(a,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new j(a,r,'layer "'+r.id+'" must specify a "source-layer"')):e.push(new j(a,r.source,'source "'+r.source+'" not found'))}else e.push(new j(a,r,'missing required property "source"'));return e=e.concat(Ci({key:a,value:r,valueSpec:c.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return pe({key:a+".type",value:r.type,valueSpec:c.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"})},filter:Xa,layout:function(L){return Ci({layer:r,key:L.key,value:L.value,style:L.style,styleSpec:L.styleSpec,objectElementValidators:{"*":function(R){return iu(xt({layerType:m},R))}}})},paint:function(L){return Ci({layer:r,key:L.key,value:L.value,style:L.style,styleSpec:L.styleSpec,objectElementValidators:{"*":function(R){return ta(xt({layerType:m},R))}}})}}}))}function be(t){var e=t.value,r=t.key,a=Pe(e);return a!=="string"?[new j(r,e,"string expected, "+a+" found")]:[]}var Wa={promoteId:function(t){var e=t.key,r=t.value;if(Pe(r)==="string")return be({key:e,value:r});var a=[];for(var l in r)a.push.apply(a,be({key:e+"."+l,value:r[l]}));return a}};function Hn(t){var e=t.value,r=t.key,a=t.styleSpec,l=t.style;if(!e.type)return[new j(r,e,'"type" is required')];var c,h=et(e.type);switch(h){case"vector":case"raster":case"raster-dem":return Ci({key:r,value:e,valueSpec:a["source_"+h.replace("-","_")],style:t.style,styleSpec:a,objectElementValidators:Wa});case"geojson":if(c=Ci({key:r,value:e,valueSpec:a.source_geojson,style:l,styleSpec:a,objectElementValidators:Wa}),e.cluster)for(var m in e.clusterProperties){var g=e.clusterProperties[m],v=g[0],x=typeof v=="string"?[v,["accumulated"],["get",m]]:v;c.push.apply(c,Kn({key:r+"."+m+".map",value:g[1],expressionContext:"cluster-map"})),c.push.apply(c,Kn({key:r+"."+m+".reduce",value:x,expressionContext:"cluster-reduce"}))}return c;case"video":return Ci({key:r,value:e,valueSpec:a.source_video,style:l,styleSpec:a});case"image":return Ci({key:r,value:e,valueSpec:a.source_image,style:l,styleSpec:a});case"canvas":return[new j(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Qo({key:r+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:l,styleSpec:a})}}function vn(t){var e=t.value,r=t.styleSpec,a=r.light,l=t.style,c=[],h=Pe(e);if(e===void 0)return c;if(h!=="object")return c.concat([new j("light",e,"object expected, "+h+" found")]);for(var m in e){var g=m.match(/^(.*)-transition$/);c=c.concat(g&&a[g[1]]&&a[g[1]].transition?pe({key:m,value:e[m],valueSpec:r.transition,style:l,styleSpec:r}):a[m]?pe({key:m,value:e[m],valueSpec:a[m],style:l,styleSpec:r}):[new j(m,e[m],'unknown property "'+m+'"')])}return c}var _e={"*":function(){return[]},array:$l,boolean:function(t){var e=t.value,r=t.key,a=Pe(e);return a!=="boolean"?[new j(r,e,"boolean expected, "+a+" found")]:[]},number:tu,color:function(t){var e=t.key,r=t.value,a=Pe(r);return a!=="string"?[new j(e,r,"color expected, "+a+" found")]:bo(r)===null?[new j(e,r,'color expected, "'+r+'" found')]:[]},constants:dt,enum:Qo,filter:Xa,function:Hs,layer:Qs,object:Ci,source:Hn,light:vn,string:be,formatted:function(t){return be(t).length===0?[]:Kn(t)},resolvedImage:function(t){return be(t).length===0?[]:Kn(t)}};function pe(t){var e=t.value,r=t.valueSpec,a=t.styleSpec;return r.expression&&Va(et(e))?Hs(t):r.expression&&Na(mt(e))?Kn(t):r.type&&_e[r.type]?_e[r.type](t):Ci(xt({},t,{valueSpec:r.type?a[r.type]:r}))}function Jn(t){var e=t.value,r=t.key,a=be(t);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new j(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new j(r,e,'"glyphs" url must include a "{range}" token'))),a}function Oi(t,e){e===void 0&&(e=D);var r=[];return r=r.concat(pe({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Jn,"*":function(){return[]}}})),t.constants&&(r=r.concat(dt({key:"constants",value:t.constants,style:t,styleSpec:e}))),nu(r)}function nu(t){return[].concat(t).sort(function(e,r){return e.line-r.line})}function zo(t){return function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return nu(t.apply(this,e))}}Oi.source=zo(Hn),Oi.light=zo(vn),Oi.layer=zo(Qs),Oi.filter=zo(Xa),Oi.paintProperty=zo(ta),Oi.layoutProperty=zo(iu);var ea=Oi,rc=ea.light,ra=ea.paintProperty,Ka=ea.layoutProperty;function ia(t,e){var r=!1;if(e&&e.length)for(var a=0,l=e;a<l.length;a+=1)t.fire(new J(new Error(l[a].message))),r=!0;return r}var Er=ni;function ni(t,e,r){var a=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var l=new Int32Array(this.arrayBuffer);t=l[0],this.d=(e=l[1])+2*(r=l[2]);for(var c=0;c<this.d*this.d;c++){var h=l[3+c],m=l[3+c+1];a.push(h===m?null:l.subarray(h,m))}var g=l[3+a.length+1];this.keys=l.subarray(l[3+a.length],g),this.bboxes=l.subarray(g),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var v=0;v<this.d*this.d;v++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var x=r/e*t;this.min=-x,this.max=t+x}ni.prototype.insert=function(t,e,r,a,l){this._forEachCell(e,r,a,l,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(l)},ni.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ni.prototype._insertCell=function(t,e,r,a,l,c){this.cells[l].push(c)},ni.prototype.query=function(t,e,r,a,l){var c=this.min,h=this.max;if(t<=c&&e<=c&&h<=r&&h<=a&&!l)return Array.prototype.slice.call(this.keys);var m=[];return this._forEachCell(t,e,r,a,this._queryCell,m,{},l),m},ni.prototype._queryCell=function(t,e,r,a,l,c,h,m){var g=this.cells[l];if(g!==null)for(var v=this.keys,x=this.bboxes,b=0;b<g.length;b++){var T=g[b];if(h[T]===void 0){var A=4*T;(m?m(x[A+0],x[A+1],x[A+2],x[A+3]):t<=x[A+2]&&e<=x[A+3]&&r>=x[A+0]&&a>=x[A+1])?(h[T]=!0,c.push(v[T])):h[T]=!1}}},ni.prototype._forEachCell=function(t,e,r,a,l,c,h,m){for(var g=this._convertToCellCoord(t),v=this._convertToCellCoord(e),x=this._convertToCellCoord(r),b=this._convertToCellCoord(a),T=g;T<=x;T++)for(var A=v;A<=b;A++){var L=this.d*A+T;if((!m||m(this._convertFromCellCoord(T),this._convertFromCellCoord(A),this._convertFromCellCoord(T+1),this._convertFromCellCoord(A+1)))&&l.call(this,t,e,r,a,L,c,h,m))return}},ni.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ni.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ni.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,r=0,a=0;a<this.cells.length;a++)r+=this.cells[a].length;var l=new Int32Array(e+r+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var c=e,h=0;h<t.length;h++){var m=t[h];l[3+h]=c,l.set(m,c),c+=m.length}return l[3+t.length]=c,l.set(this.keys,c),l[3+t.length+1]=c+=this.keys.length,l.set(this.bboxes,c),c+=this.bboxes.length,l.buffer};var ou=vt.ImageData,vr=vt.ImageBitmap,Jr={};function Pt(t,e,r){r===void 0&&(r={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Jr[t]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}for(var na in Pt("Object",Object),Er.serialize=function(t,e){var r=t.toArrayBuffer();return e&&e.push(r),{buffer:r}},Er.deserialize=function(t){return new Er(t.buffer)},Pt("Grid",Er),Pt("Color",se),Pt("Error",Error),Pt("ResolvedImage",Vr),Pt("StylePropertyFunction",Yo),Pt("StyleExpression",Ao,{omit:["_evaluator"]}),Pt("ZoomDependentExpression",Po),Pt("ZoomConstantExpression",Jo),Pt("CompoundExpression",gr,{omit:["_evaluate"]}),To)To[na]._classRegistryKey||Pt("Expression_"+na,To[na]);function ko(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function _n(t){return vr&&t instanceof vr}function Yr(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(ko(t)||_n(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var r=t;return e&&e.push(r.buffer),r}if(t instanceof ou)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var a=[],l=0,c=t;l<c.length;l+=1)a.push(Yr(c[l],e));return a}if(typeof t=="object"){var h=t.constructor,m=h._classRegistryKey;if(!m)throw new Error("can't serialize object of unregistered class");var g=h.serialize?h.serialize(t,e):{};if(!h.serialize){for(var v in t)if(t.hasOwnProperty(v)&&!(Jr[m].omit.indexOf(v)>=0)){var x=t[v];g[v]=Jr[m].shallow.indexOf(v)>=0?x:Yr(x,e)}t instanceof Error&&(g.message=t.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return m!=="Object"&&(g.$name=m),g}throw new Error("can't serialize object of type "+typeof t)}function oa(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||ko(t)||_n(t)||ArrayBuffer.isView(t)||t instanceof ou)return t;if(Array.isArray(t))return t.map(oa);if(typeof t=="object"){var e=t.$name||"Object",r=Jr[e].klass;if(!r)throw new Error("can't deserialize unregistered class "+e);if(r.deserialize)return r.deserialize(t);for(var a=Object.create(r.prototype),l=0,c=Object.keys(t);l<c.length;l+=1){var h=c[l];if(h!=="$name"){var m=t[h];a[h]=Jr[e].shallow.indexOf(h)>=0?m:oa(m)}}return a}throw new Error("can't deserialize object of type "+typeof t)}var qr=function(){this.first=!0};qr.prototype.update=function(t,e){var r=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=r,!0))};var kt={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function Ha(t){for(var e=0,r=t;e<r.length;e+=1)if(Ja(r[e].charCodeAt(0)))return!0;return!1}function Ja(t){return!(t!==746&&t!==747&&(t<4352||!(kt["Bopomofo Extended"](t)||kt.Bopomofo(t)||kt["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||kt["CJK Compatibility Ideographs"](t)||kt["CJK Compatibility"](t)||kt["CJK Radicals Supplement"](t)||kt["CJK Strokes"](t)||!(!kt["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||kt["CJK Unified Ideographs Extension A"](t)||kt["CJK Unified Ideographs"](t)||kt["Enclosed CJK Letters and Months"](t)||kt["Hangul Compatibility Jamo"](t)||kt["Hangul Jamo Extended-A"](t)||kt["Hangul Jamo Extended-B"](t)||kt["Hangul Jamo"](t)||kt["Hangul Syllables"](t)||kt.Hiragana(t)||kt["Ideographic Description Characters"](t)||kt.Kanbun(t)||kt["Kangxi Radicals"](t)||kt["Katakana Phonetic Extensions"](t)||kt.Katakana(t)&&t!==12540||!(!kt["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!kt["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||kt["Unified Canadian Aboriginal Syllabics"](t)||kt["Unified Canadian Aboriginal Syllabics Extended"](t)||kt["Vertical Forms"](t)||kt["Yijing Hexagram Symbols"](t)||kt["Yi Syllables"](t)||kt["Yi Radicals"](t))))}function gi(t){return!(Ja(t)||function(e){return!!(kt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||kt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||kt["Letterlike Symbols"](e)||kt["Number Forms"](e)||kt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||kt["Control Pictures"](e)&&e!==9251||kt["Optical Character Recognition"](e)||kt["Enclosed Alphanumerics"](e)||kt["Geometric Shapes"](e)||kt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||kt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||kt["CJK Symbols and Punctuation"](e)||kt.Katakana(e)||kt["Private Use Area"](e)||kt["CJK Compatibility Forms"](e)||kt["Small Form Variants"](e)||kt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function Zr(t){return t>=1424&&t<=2303||kt["Arabic Presentation Forms-A"](t)||kt["Arabic Presentation Forms-B"](t)}function Ya(t,e){return!(!e&&Zr(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||kt.Khmer(t))}function au(t){for(var e=0,r=t;e<r.length;e+=1)if(Zr(r[e].charCodeAt(0)))return!0;return!1}var $s=null,Gr="unavailable",xn=null,Qa=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Gr="error"),$s&&$s(t)};function tl(){el.fire(new K("pluginStateChange",{pluginStatus:Gr,pluginURL:xn}))}var el=new X,Mi=function(){return Gr},su=function(){if(Gr!=="deferred"||!xn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Gr="loading",tl(),xn&&Ve({url:xn},function(t){t?Qa(t):(Gr="loaded",tl())})},Ue={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Gr==="loaded"||Ue.applyArabicShaping!=null},isLoading:function(){return Gr==="loading"},setState:function(t){Gr=t.pluginStatus,xn=t.pluginURL},isParsed:function(){return Ue.applyArabicShaping!=null&&Ue.processBidirectionalText!=null&&Ue.processStyledBidirectionalText!=null},getPluginURL:function(){return xn}},ye=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new qr,this.transition={})};ye.prototype.isSupportedScript=function(t){return function(e,r){for(var a=0,l=e;a<l.length;a+=1)if(!Ya(l[a].charCodeAt(0),r))return!1;return!0}(t,Ue.isLoaded())},ye.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},ye.prototype.getCrossfadeParameters=function(){var t=this.zoom,e=t-Math.floor(t),r=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*e}};var vi=function(t,e){this.property=t,this.value=e,this.expression=function(r,a){if(Va(r))return new Yo(r,a);if(Na(r)){var l=Ks(r,a);if(l.result==="error")throw new Error(l.value.map(function(h){return h.key+": "+h.message}).join(", "));return l.value}var c=r;return typeof r=="string"&&a.type==="color"&&(c=se.parse(r)),{kind:"constant",evaluate:function(){return c}}}(e===void 0?t.specification.default:e,t.specification)};vi.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},vi.prototype.possiblyEvaluate=function(t,e,r){return this.property.possiblyEvaluate(this,t,e,r)};var Qr=function(t){this.property=t,this.value=new vi(t,void 0)};Qr.prototype.transitioned=function(t,e){return new Yn(this.property,this.value,e,He({},t.transition,this.transition),t.now)},Qr.prototype.untransitioned=function(){return new Yn(this.property,this.value,null,{},0)};var oi=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};oi.prototype.getValue=function(t){return Ii(this._values[t].value.value)},oi.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new Qr(this._values[t].property)),this._values[t].value=new vi(this._values[t].property,e===null?void 0:Ii(e))},oi.prototype.getTransition=function(t){return Ii(this._values[t].transition)},oi.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new Qr(this._values[t].property)),this._values[t].transition=Ii(e)||void 0},oi.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var a=r[e],l=this.getValue(a);l!==void 0&&(t[a]=l);var c=this.getTransition(a);c!==void 0&&(t[a+"-transition"]=c)}return t},oi.prototype.transitioned=function(t,e){for(var r=new Fi(this._properties),a=0,l=Object.keys(this._values);a<l.length;a+=1){var c=l[a];r._values[c]=this._values[c].transitioned(t,e._values[c])}return r},oi.prototype.untransitioned=function(){for(var t=new Fi(this._properties),e=0,r=Object.keys(this._values);e<r.length;e+=1){var a=r[e];t._values[a]=this._values[a].untransitioned()}return t};var Yn=function(t,e,r,a,l){this.property=t,this.value=e,this.begin=l+a.delay||0,this.end=this.begin+a.duration||0,t.specification.transition&&(a.delay||a.duration)&&(this.prior=r)};Yn.prototype.possiblyEvaluate=function(t,e,r){var a=t.now||0,l=this.value.possiblyEvaluate(t,e,r),c=this.prior;if(c){if(a>this.end)return this.prior=null,l;if(this.value.isDataDriven())return this.prior=null,l;if(a<this.begin)return c.possiblyEvaluate(t,e,r);var h=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(c.possiblyEvaluate(t,e,r),l,function(m){if(m<=0)return 0;if(m>=1)return 1;var g=m*m,v=g*m;return 4*(m<.5?v:3*(m-g)+v-.75)}(h))}return l};var Fi=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};Fi.prototype.possiblyEvaluate=function(t,e,r){for(var a=new Qn(this._properties),l=0,c=Object.keys(this._values);l<c.length;l+=1){var h=c[l];a._values[h]=this._values[h].possiblyEvaluate(t,e,r)}return a},Fi.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1)if(this._values[e[t]].prior)return!0;return!1};var bn=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};bn.prototype.getValue=function(t){return Ii(this._values[t].value)},bn.prototype.setValue=function(t,e){this._values[t]=new vi(this._values[t].property,e===null?void 0:Ii(e))},bn.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var a=r[e],l=this.getValue(a);l!==void 0&&(t[a]=l)}return t},bn.prototype.possiblyEvaluate=function(t,e,r){for(var a=new Qn(this._properties),l=0,c=Object.keys(this._values);l<c.length;l+=1){var h=c[l];a._values[h]=this._values[h].possiblyEvaluate(t,e,r)}return a};var ai=function(t,e,r){this.property=t,this.value=e,this.parameters=r};ai.prototype.isConstant=function(){return this.value.kind==="constant"},ai.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},ai.prototype.evaluate=function(t,e,r,a){return this.property.evaluate(this.value,this.parameters,t,e,r,a)};var Qn=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};Qn.prototype.get=function(t){return this._values[t]};var It=function(t){this.specification=t};It.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},It.prototype.interpolate=function(t,e,r){var a=Oa[this.specification.type];return a?a(t,e,r):t};var Xt=function(t,e){this.specification=t,this.overrides=e};Xt.prototype.possiblyEvaluate=function(t,e,r,a){return new ai(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(e,null,{},r,a)}:t.expression,e)},Xt.prototype.interpolate=function(t,e,r){if(t.value.kind!=="constant"||e.value.kind!=="constant")return t;if(t.value.value===void 0||e.value.value===void 0)return new ai(this,{kind:"constant",value:void 0},t.parameters);var a=Oa[this.specification.type];return a?new ai(this,{kind:"constant",value:a(t.value.value,e.value.value,r)},t.parameters):t},Xt.prototype.evaluate=function(t,e,r,a,l,c){return t.kind==="constant"?t.value:t.evaluate(e,r,a,l,c)};var $r=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(r,a,l,c){if(r.value===void 0)return new ai(this,{kind:"constant",value:void 0},a);if(r.expression.kind==="constant"){var h=r.expression.evaluate(a,null,{},l,c),m=r.property.specification.type==="resolvedImage"&&typeof h!="string"?h.name:h,g=this._calculate(m,m,m,a);return new ai(this,{kind:"constant",value:g},a)}if(r.expression.kind==="camera"){var v=this._calculate(r.expression.evaluate({zoom:a.zoom-1}),r.expression.evaluate({zoom:a.zoom}),r.expression.evaluate({zoom:a.zoom+1}),a);return new ai(this,{kind:"constant",value:v},a)}return new ai(this,r.expression,a)},e.prototype.evaluate=function(r,a,l,c,h,m){if(r.kind==="source"){var g=r.evaluate(a,l,c,h,m);return this._calculate(g,g,g,a)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(a.zoom)-1},l,c),r.evaluate({zoom:Math.floor(a.zoom)},l,c),r.evaluate({zoom:Math.floor(a.zoom)+1},l,c),a):r.value},e.prototype._calculate=function(r,a,l,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:r,to:a}:{from:l,to:a}},e.prototype.interpolate=function(r){return r},e}(Xt),_i=function(t){this.specification=t};_i.prototype.possiblyEvaluate=function(t,e,r,a){if(t.value!==void 0){if(t.expression.kind==="constant"){var l=t.expression.evaluate(e,null,{},r,a);return this._calculate(l,l,l,e)}return this._calculate(t.expression.evaluate(new ye(Math.floor(e.zoom-1),e)),t.expression.evaluate(new ye(Math.floor(e.zoom),e)),t.expression.evaluate(new ye(Math.floor(e.zoom+1),e)),e)}},_i.prototype._calculate=function(t,e,r,a){return a.zoom>a.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:r,to:e}},_i.prototype.interpolate=function(t){return t};var Hi=function(t){this.specification=t};Hi.prototype.possiblyEvaluate=function(t,e,r,a){return!!t.expression.evaluate(e,null,{},r,a)},Hi.prototype.interpolate=function(){return!1};var ti=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var r=t[e];r.specification.overridable&&this.overridableProperties.push(e);var a=this.defaultPropertyValues[e]=new vi(r,void 0),l=this.defaultTransitionablePropertyValues[e]=new Qr(r);this.defaultTransitioningPropertyValues[e]=l.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=a.possiblyEvaluate({})}};Pt("DataDrivenProperty",Xt),Pt("DataConstantProperty",It),Pt("CrossFadedDataDrivenProperty",$r),Pt("CrossFadedProperty",_i),Pt("ColorRampProperty",Hi);var xi=function(t){function e(r,a){if(t.call(this),this.id=r.id,this.type=r.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},r.type!=="custom"&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),a.layout&&(this._unevaluatedLayout=new bn(a.layout)),a.paint)){for(var l in this._transitionablePaint=new oi(a.paint),r.paint)this.setPaintProperty(l,r.paint[l],{validate:!1});for(var c in r.layout)this.setLayoutProperty(c,r.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Qn(a.paint)}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},e.prototype.getLayoutProperty=function(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)},e.prototype.setLayoutProperty=function(r,a,l){l===void 0&&(l={}),a!=null&&this._validate(Ka,"layers."+this.id+".layout."+r,r,a,l)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,a):this.visibility=a)},e.prototype.getPaintProperty=function(r){return kn(r,"-transition")?this._transitionablePaint.getTransition(r.slice(0,-"-transition".length)):this._transitionablePaint.getValue(r)},e.prototype.setPaintProperty=function(r,a,l){if(l===void 0&&(l={}),a!=null&&this._validate(ra,"layers."+this.id+".paint."+r,r,a,l))return!1;if(kn(r,"-transition"))return this._transitionablePaint.setTransition(r.slice(0,-"-transition".length),a||void 0),!1;var c=this._transitionablePaint._values[r],h=c.property.specification["property-type"]==="cross-faded-data-driven",m=c.value.isDataDriven(),g=c.value;this._transitionablePaint.setValue(r,a),this._handleSpecialPaintPropertyUpdate(r);var v=this._transitionablePaint._values[r].value;return v.isDataDriven()||m||h||this._handleOverridablePaintPropertyUpdate(r,g,v)},e.prototype._handleSpecialPaintPropertyUpdate=function(r){},e.prototype._handleOverridablePaintPropertyUpdate=function(r,a,l){return!1},e.prototype.isHidden=function(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"},e.prototype.updateTransitions=function(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(r,a){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,a)},e.prototype.serialize=function(){var r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Zi(r,function(a,l){return!(a===void 0||l==="layout"&&!Object.keys(a).length||l==="paint"&&!Object.keys(a).length)})},e.prototype._validate=function(r,a,l,c,h){return h===void 0&&(h={}),(!h||h.validate!==!1)&&ia(this,r.call(ea,{key:a,layerType:this.type,objectKey:l,value:c,styleSpec:D,style:{glyphs:!0,sprite:!0}}))},e.prototype.is3D=function(){return!1},e.prototype.isTileClipped=function(){return!1},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e.prototype.isStateDependent=function(){for(var r in this.paint._values){var a=this.paint.get(r);if(a instanceof ai&&Io(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1},e}(X),ic={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Ji=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ze=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function _r(t,e){e===void 0&&(e=1);var r=0,a=0;return{members:t.map(function(l){var c=ic[l.type].BYTES_PER_ELEMENT,h=r=rl(r,Math.max(e,c)),m=l.components||1;return a=Math.max(a,c),r+=c*m,{name:l.name,type:l.type,components:m,offset:h}}),size:rl(r,Math.max(a,e)),alignment:e}}function rl(t,e){return Math.ceil(t/e)*e}ze.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},ze.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},ze.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ze.prototype.clear=function(){this.length=0},ze.prototype.resize=function(t){this.reserve(t),this.length=t},ze.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},ze.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var aa=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a){var l=this.length;return this.resize(l+1),this.emplace(l,r,a)},e.prototype.emplace=function(r,a,l){var c=2*r;return this.int16[c+0]=a,this.int16[c+1]=l,r},e}(ze);aa.prototype.bytesPerElement=4,Pt("StructArrayLayout2i4",aa);var Yi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,l,c){var h=this.length;return this.resize(h+1),this.emplace(h,r,a,l,c)},e.prototype.emplace=function(r,a,l,c,h){var m=4*r;return this.int16[m+0]=a,this.int16[m+1]=l,this.int16[m+2]=c,this.int16[m+3]=h,r},e}(ze);Yi.prototype.bytesPerElement=8,Pt("StructArrayLayout4i8",Yi);var ei=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,l,c,h,m){var g=this.length;return this.resize(g+1),this.emplace(g,r,a,l,c,h,m)},e.prototype.emplace=function(r,a,l,c,h,m,g){var v=6*r;return this.int16[v+0]=a,this.int16[v+1]=l,this.int16[v+2]=c,this.int16[v+3]=h,this.int16[v+4]=m,this.int16[v+5]=g,r},e}(ze);ei.prototype.bytesPerElement=12,Pt("StructArrayLayout2i4i12",ei);var $a=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,l,c,h,m){var g=this.length;return this.resize(g+1),this.emplace(g,r,a,l,c,h,m)},e.prototype.emplace=function(r,a,l,c,h,m,g){var v=4*r,x=8*r;return this.int16[v+0]=a,this.int16[v+1]=l,this.uint8[x+4]=c,this.uint8[x+5]=h,this.uint8[x+6]=m,this.uint8[x+7]=g,r},e}(ze);$a.prototype.bytesPerElement=8,Pt("StructArrayLayout2i4ub8",$a);var $n=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a){var l=this.length;return this.resize(l+1),this.emplace(l,r,a)},e.prototype.emplace=function(r,a,l){var c=2*r;return this.float32[c+0]=a,this.float32[c+1]=l,r},e}(ze);$n.prototype.bytesPerElement=8,Pt("StructArrayLayout2f8",$n);var Qi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,l,c,h,m,g,v,x,b){var T=this.length;return this.resize(T+1),this.emplace(T,r,a,l,c,h,m,g,v,x,b)},e.prototype.emplace=function(r,a,l,c,h,m,g,v,x,b,T){var A=10*r;return this.uint16[A+0]=a,this.uint16[A+1]=l,this.uint16[A+2]=c,this.uint16[A+3]=h,this.uint16[A+4]=m,this.uint16[A+5]=g,this.uint16[A+6]=v,this.uint16[A+7]=x,this.uint16[A+8]=b,this.uint16[A+9]=T,r},e}(ze);Qi.prototype.bytesPerElement=20,Pt("StructArrayLayout10ui20",Qi);var Co=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,l,c,h,m,g,v,x,b,T,A){var L=this.length;return this.resize(L+1),this.emplace(L,r,a,l,c,h,m,g,v,x,b,T,A)},e.prototype.emplace=function(r,a,l,c,h,m,g,v,x,b,T,A,L){var R=12*r;return this.int16[R+0]=a,this.int16[R+1]=l,this.int16[R+2]=c,this.int16[R+3]=h,this.uint16[R+4]=m,this.uint16[R+5]=g,this.uint16[R+6]=v,this.uint16[R+7]=x,this.int16[R+8]=b,this.int16[R+9]=T,this.int16[R+10]=A,this.int16[R+11]=L,r},e}(ze);Co.prototype.bytesPerElement=24,Pt("StructArrayLayout4i4ui4i24",Co);var sa=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,l){var c=this.length;return this.resize(c+1),this.emplace(c,r,a,l)},e.prototype.emplace=function(r,a,l,c){var h=3*r;return this.float32[h+0]=a,this.float32[h+1]=l,this.float32[h+2]=c,r},e}(ze);sa.prototype.bytesPerElement=12,Pt("StructArrayLayout3f12",sa);var il=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r){var a=this.length;return this.resize(a+1),this.emplace(a,r)},e.prototype.emplace=function(r,a){return this.uint32[1*r+0]=a,r},e}(ze);il.prototype.bytesPerElement=4,Pt("StructArrayLayout1ul4",il);var la=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,l,c,h,m,g,v,x){var b=this.length;return this.resize(b+1),this.emplace(b,r,a,l,c,h,m,g,v,x)},e.prototype.emplace=function(r,a,l,c,h,m,g,v,x,b){var T=10*r,A=5*r;return this.int16[T+0]=a,this.int16[T+1]=l,this.int16[T+2]=c,this.int16[T+3]=h,this.int16[T+4]=m,this.int16[T+5]=g,this.uint32[A+3]=v,this.uint16[T+8]=x,this.uint16[T+9]=b,r},e}(ze);la.prototype.bytesPerElement=20,Pt("StructArrayLayout6i1ul2ui20",la);var wn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,l,c,h,m){var g=this.length;return this.resize(g+1),this.emplace(g,r,a,l,c,h,m)},e.prototype.emplace=function(r,a,l,c,h,m,g){var v=6*r;return this.int16[v+0]=a,this.int16[v+1]=l,this.int16[v+2]=c,this.int16[v+3]=h,this.int16[v+4]=m,this.int16[v+5]=g,r},e}(ze);wn.prototype.bytesPerElement=12,Pt("StructArrayLayout2i2i2i12",wn);var nl=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,l,c,h){var m=this.length;return this.resize(m+1),this.emplace(m,r,a,l,c,h)},e.prototype.emplace=function(r,a,l,c,h,m){var g=4*r,v=8*r;return this.float32[g+0]=a,this.float32[g+1]=l,this.float32[g+2]=c,this.int16[v+6]=h,this.int16[v+7]=m,r},e}(ze);nl.prototype.bytesPerElement=16,Pt("StructArrayLayout2f1f2i16",nl);var ol=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,l,c){var h=this.length;return this.resize(h+1),this.emplace(h,r,a,l,c)},e.prototype.emplace=function(r,a,l,c,h){var m=12*r,g=3*r;return this.uint8[m+0]=a,this.uint8[m+1]=l,this.float32[g+1]=c,this.float32[g+2]=h,r},e}(ze);ol.prototype.bytesPerElement=12,Pt("StructArrayLayout2ub2f12",ol);var si=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,l){var c=this.length;return this.resize(c+1),this.emplace(c,r,a,l)},e.prototype.emplace=function(r,a,l,c){var h=3*r;return this.uint16[h+0]=a,this.uint16[h+1]=l,this.uint16[h+2]=c,r},e}(ze);si.prototype.bytesPerElement=6,Pt("StructArrayLayout3ui6",si);var ts=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,l,c,h,m,g,v,x,b,T,A,L,R,W,q,Y){var $=this.length;return this.resize($+1),this.emplace($,r,a,l,c,h,m,g,v,x,b,T,A,L,R,W,q,Y)},e.prototype.emplace=function(r,a,l,c,h,m,g,v,x,b,T,A,L,R,W,q,Y,$){var rt=24*r,it=12*r,ut=48*r;return this.int16[rt+0]=a,this.int16[rt+1]=l,this.uint16[rt+2]=c,this.uint16[rt+3]=h,this.uint32[it+2]=m,this.uint32[it+3]=g,this.uint32[it+4]=v,this.uint16[rt+10]=x,this.uint16[rt+11]=b,this.uint16[rt+12]=T,this.float32[it+7]=A,this.float32[it+8]=L,this.uint8[ut+36]=R,this.uint8[ut+37]=W,this.uint8[ut+38]=q,this.uint32[it+10]=Y,this.int16[rt+22]=$,r},e}(ze);ts.prototype.bytesPerElement=48,Pt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ts);var to=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,l,c,h,m,g,v,x,b,T,A,L,R,W,q,Y,$,rt,it,ut,gt,bt,Bt,St,Ut,Tt,ee){var Gt=this.length;return this.resize(Gt+1),this.emplace(Gt,r,a,l,c,h,m,g,v,x,b,T,A,L,R,W,q,Y,$,rt,it,ut,gt,bt,Bt,St,Ut,Tt,ee)},e.prototype.emplace=function(r,a,l,c,h,m,g,v,x,b,T,A,L,R,W,q,Y,$,rt,it,ut,gt,bt,Bt,St,Ut,Tt,ee,Gt){var Rt=34*r,ne=17*r;return this.int16[Rt+0]=a,this.int16[Rt+1]=l,this.int16[Rt+2]=c,this.int16[Rt+3]=h,this.int16[Rt+4]=m,this.int16[Rt+5]=g,this.int16[Rt+6]=v,this.int16[Rt+7]=x,this.uint16[Rt+8]=b,this.uint16[Rt+9]=T,this.uint16[Rt+10]=A,this.uint16[Rt+11]=L,this.uint16[Rt+12]=R,this.uint16[Rt+13]=W,this.uint16[Rt+14]=q,this.uint16[Rt+15]=Y,this.uint16[Rt+16]=$,this.uint16[Rt+17]=rt,this.uint16[Rt+18]=it,this.uint16[Rt+19]=ut,this.uint16[Rt+20]=gt,this.uint16[Rt+21]=bt,this.uint16[Rt+22]=Bt,this.uint32[ne+12]=St,this.float32[ne+13]=Ut,this.float32[ne+14]=Tt,this.float32[ne+15]=ee,this.float32[ne+16]=Gt,r},e}(ze);to.prototype.bytesPerElement=68,Pt("StructArrayLayout8i15ui1ul4f68",to);var li=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r){var a=this.length;return this.resize(a+1),this.emplace(a,r)},e.prototype.emplace=function(r,a){return this.float32[1*r+0]=a,r},e}(ze);li.prototype.bytesPerElement=4,Pt("StructArrayLayout1f4",li);var al=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,l){var c=this.length;return this.resize(c+1),this.emplace(c,r,a,l)},e.prototype.emplace=function(r,a,l,c){var h=3*r;return this.int16[h+0]=a,this.int16[h+1]=l,this.int16[h+2]=c,r},e}(ze);al.prototype.bytesPerElement=6,Pt("StructArrayLayout3i6",al);var sl=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,l){var c=this.length;return this.resize(c+1),this.emplace(c,r,a,l)},e.prototype.emplace=function(r,a,l,c){var h=4*r;return this.uint32[2*r+0]=a,this.uint16[h+2]=l,this.uint16[h+3]=c,r},e}(ze);sl.prototype.bytesPerElement=8,Pt("StructArrayLayout1ul2ui8",sl);var ua=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a){var l=this.length;return this.resize(l+1),this.emplace(l,r,a)},e.prototype.emplace=function(r,a,l){var c=2*r;return this.uint16[c+0]=a,this.uint16[c+1]=l,r},e}(ze);ua.prototype.bytesPerElement=4,Pt("StructArrayLayout2ui4",ua);var es=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r){var a=this.length;return this.resize(a+1),this.emplace(a,r)},e.prototype.emplace=function(r,a){return this.uint16[1*r+0]=a,r},e}(ze);es.prototype.bytesPerElement=2,Pt("StructArrayLayout1ui2",es);var i=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,l,c){var h=this.length;return this.resize(h+1),this.emplace(h,r,a,l,c)},e.prototype.emplace=function(r,a,l,c,h){var m=4*r;return this.float32[m+0]=a,this.float32[m+1]=l,this.float32[m+2]=c,this.float32[m+3]=h,r},e}(ze);i.prototype.bytesPerElement=16,Pt("StructArrayLayout4f16",i);var o=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.anchorPoint.get=function(){return new Dt(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,r),e}(Ji);o.prototype.size=20;var n=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(r){return new o(this,r)},e}(la);Pt("CollisionBoxArray",n);var s=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(a){this._structArray.uint8[this._pos1+37]=a},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(a){this._structArray.uint8[this._pos1+38]=a},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(a){this._structArray.uint32[this._pos4+10]=a},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(e.prototype,r),e}(Ji);s.prototype.size=48;var p=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(r){return new s(this,r)},e}(ts);Pt("PlacedSymbolArray",p);var f=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},r.crossTileID.set=function(a){this._structArray.uint32[this._pos4+12]=a},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},r.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(e.prototype,r),e}(Ji);f.prototype.size=68;var d=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(r){return new f(this,r)},e}(to);Pt("SymbolInstanceArray",d);var y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getoffsetX=function(r){return this.float32[1*r+0]},e}(li);Pt("GlyphOffsetArray",y);var _=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getx=function(r){return this.int16[3*r+0]},e.prototype.gety=function(r){return this.int16[3*r+1]},e.prototype.gettileUnitDistanceFromAnchor=function(r){return this.int16[3*r+2]},e}(al);Pt("SymbolLineVertexArray",_);var S=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(e.prototype,r),e}(Ji);S.prototype.size=8;var P=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(r){return new S(this,r)},e}(sl);Pt("FeatureIndexArray",P);var k=_r([{name:"a_pos",components:2,type:"Int16"}],4).members,z=function(t){t===void 0&&(t=[]),this.segments=t};function U(t,e){return 256*(t=Tr(Math.floor(t),0,255))+Tr(Math.floor(e),0,255)}z.prototype.prepareSegment=function(t,e,r,a){var l=this.segments[this.segments.length-1];return t>z.MAX_VERTEX_ARRAY_LENGTH&&qe("Max vertices per segment is "+z.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!l||l.vertexLength+t>z.MAX_VERTEX_ARRAY_LENGTH||l.sortKey!==a)&&(l={vertexOffset:e.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},a!==void 0&&(l.sortKey=a),this.segments.push(l)),l},z.prototype.get=function(){return this.segments},z.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var r=e[t];for(var a in r.vaos)r.vaos[a].destroy()}},z.simpleSegment=function(t,e,r,a){return new z([{vertexOffset:t,primitiveOffset:e,vertexLength:r,primitiveLength:a,vaos:{},sortKey:0}])},z.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Pt("SegmentVector",z);var O=_r([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),G=Ot(function(t){t.exports=function(e,r){var a,l,c,h,m,g,v,x;for(l=e.length-(a=3&e.length),c=r,m=3432918353,g=461845907,x=0;x<l;)v=255&e.charCodeAt(x)|(255&e.charCodeAt(++x))<<8|(255&e.charCodeAt(++x))<<16|(255&e.charCodeAt(++x))<<24,++x,c=27492+(65535&(h=5*(65535&(c=(c^=v=(65535&(v=(v=(65535&v)*m+(((v>>>16)*m&65535)<<16)&4294967295)<<15|v>>>17))*g+(((v>>>16)*g&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(v=0,a){case 3:v^=(255&e.charCodeAt(x+2))<<16;case 2:v^=(255&e.charCodeAt(x+1))<<8;case 1:c^=v=(65535&(v=(v=(65535&(v^=255&e.charCodeAt(x)))*m+(((v>>>16)*m&65535)<<16)&4294967295)<<15|v>>>17))*g+(((v>>>16)*g&65535)<<16)&4294967295}return c^=e.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0}}),B=Ot(function(t){t.exports=function(e,r){for(var a,l=e.length,c=r^l,h=0;l>=4;)a=1540483477*(65535&(a=255&e.charCodeAt(h)|(255&e.charCodeAt(++h))<<8|(255&e.charCodeAt(++h))<<16|(255&e.charCodeAt(++h))<<24))+((1540483477*(a>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),l-=4,++h;switch(l){case 3:c^=(255&e.charCodeAt(h+2))<<16;case 2:c^=(255&e.charCodeAt(h+1))<<8;case 1:c=1540483477*(65535&(c^=255&e.charCodeAt(h)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0}}),Z=G,H=B;Z.murmur3=G,Z.murmur2=H;var Q=function(){this.ids=[],this.positions=[],this.indexed=!1};Q.prototype.add=function(t,e,r,a){this.ids.push(nt(t)),this.positions.push(e,r,a)},Q.prototype.getPositions=function(t){for(var e=nt(t),r=0,a=this.ids.length-1;r<a;){var l=r+a>>1;this.ids[l]>=e?a=l:r=l+1}for(var c=[];this.ids[r]===e;)c.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return c},Q.serialize=function(t,e){var r=new Float64Array(t.ids),a=new Uint32Array(t.positions);return function l(c,h,m,g){for(;m<g;){for(var v=c[m+g>>1],x=m-1,b=g+1;;){do x++;while(c[x]<v);do b--;while(c[b]>v);if(x>=b)break;lt(c,x,b),lt(h,3*x,3*b),lt(h,3*x+1,3*b+1),lt(h,3*x+2,3*b+2)}b-m<g-b?(l(c,h,m,b),m=b+1):(l(c,h,b+1,g),g=b)}}(r,a,0,r.length-1),e&&e.push(r.buffer,a.buffer),{ids:r,positions:a}},Q.deserialize=function(t){var e=new Q;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e};var at=Math.pow(2,53)-1;function nt(t){var e=+t;return!isNaN(e)&&e<=at?e:Z(String(t))}function lt(t,e,r){var a=t[e];t[e]=t[r],t[r]=a}Pt("FeaturePositionMap",Q);var ct=function(t,e){this.gl=t.gl,this.location=e},_t=function(t){function e(r,a){t.call(this,r,a),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))},e}(ct),yt=function(t){function e(r,a){t.call(this,r,a),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))},e}(ct),Et=function(t){function e(r,a){t.call(this,r,a),this.current=[0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))},e}(ct),Vt=function(t){function e(r,a){t.call(this,r,a),this.current=[0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))},e}(ct),qt=function(t){function e(r,a){t.call(this,r,a),this.current=[0,0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))},e}(ct),Nt=function(t){function e(r,a){t.call(this,r,a),this.current=se.transparent}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))},e}(ct),he=new Float32Array(16),Ct=function(t){function e(r,a){t.call(this,r,a),this.current=he}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(var a=1;a<16;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}},e}(ct);function Jt(t){return[U(255*t.r,255*t.g),U(255*t.b,255*t.a)]}var re=function(t,e,r){this.value=t,this.uniformNames=e.map(function(a){return"u_"+a}),this.type=r};re.prototype.setUniform=function(t,e,r){t.set(r.constantOr(this.value))},re.prototype.getBinding=function(t,e,r){return this.type==="color"?new Nt(t,e):new yt(t,e)};var Yt=function(t,e){this.uniformNames=e.map(function(r){return"u_"+r}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Yt.prototype.setConstantPatternPositions=function(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr},Yt.prototype.setUniform=function(t,e,r,a){var l=a==="u_pattern_to"?this.patternTo:a==="u_pattern_from"?this.patternFrom:a==="u_pixel_ratio_to"?this.pixelRatioTo:a==="u_pixel_ratio_from"?this.pixelRatioFrom:null;l&&t.set(l)},Yt.prototype.getBinding=function(t,e,r){return r.substr(0,9)==="u_pattern"?new qt(t,e):new yt(t,e)};var Ht=function(t,e,r,a){this.expression=t,this.type=r,this.maxValue=0,this.paintVertexAttributes=e.map(function(l){return{name:"a_"+l,type:"Float32",components:r==="color"?2:1,offset:0}}),this.paintVertexArray=new a};Ht.prototype.populatePaintArray=function(t,e,r,a,l){var c=this.paintVertexArray.length,h=this.expression.evaluate(new ye(0),e,{},a,[],l);this.paintVertexArray.resize(t),this._setPaintValue(c,t,h)},Ht.prototype.updatePaintArray=function(t,e,r,a){var l=this.expression.evaluate({zoom:0},r,a);this._setPaintValue(t,e,l)},Ht.prototype._setPaintValue=function(t,e,r){if(this.type==="color")for(var a=Jt(r),l=t;l<e;l++)this.paintVertexArray.emplace(l,a[0],a[1]);else{for(var c=t;c<e;c++)this.paintVertexArray.emplace(c,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},Ht.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Ht.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Kt=function(t,e,r,a,l,c){this.expression=t,this.uniformNames=e.map(function(h){return"u_"+h+"_t"}),this.type=r,this.useIntegerZoom=a,this.zoom=l,this.maxValue=0,this.paintVertexAttributes=e.map(function(h){return{name:"a_"+h,type:"Float32",components:r==="color"?4:2,offset:0}}),this.paintVertexArray=new c};Kt.prototype.populatePaintArray=function(t,e,r,a,l){var c=this.expression.evaluate(new ye(this.zoom),e,{},a,[],l),h=this.expression.evaluate(new ye(this.zoom+1),e,{},a,[],l),m=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(m,t,c,h)},Kt.prototype.updatePaintArray=function(t,e,r,a){var l=this.expression.evaluate({zoom:this.zoom},r,a),c=this.expression.evaluate({zoom:this.zoom+1},r,a);this._setPaintValue(t,e,l,c)},Kt.prototype._setPaintValue=function(t,e,r,a){if(this.type==="color")for(var l=Jt(r),c=Jt(a),h=t;h<e;h++)this.paintVertexArray.emplace(h,l[0],l[1],c[0],c[1]);else{for(var m=t;m<e;m++)this.paintVertexArray.emplace(m,r,a);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(a))}},Kt.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Kt.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Kt.prototype.setUniform=function(t,e){var r=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,a=Tr(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);t.set(a)},Kt.prototype.getBinding=function(t,e,r){return new yt(t,e)};var Wt=function(t,e,r,a,l,c){this.expression=t,this.type=e,this.useIntegerZoom=r,this.zoom=a,this.layerId=c,this.zoomInPaintVertexArray=new l,this.zoomOutPaintVertexArray=new l};Wt.prototype.populatePaintArray=function(t,e,r){var a=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(a,t,e.patterns&&e.patterns[this.layerId],r)},Wt.prototype.updatePaintArray=function(t,e,r,a,l){this._setPaintValues(t,e,r.patterns&&r.patterns[this.layerId],l)},Wt.prototype._setPaintValues=function(t,e,r,a){if(a&&r){var l=a[r.min],c=a[r.mid],h=a[r.max];if(l&&c&&h)for(var m=t;m<e;m++)this.zoomInPaintVertexArray.emplace(m,c.tl[0],c.tl[1],c.br[0],c.br[1],l.tl[0],l.tl[1],l.br[0],l.br[1],c.pixelRatio,l.pixelRatio),this.zoomOutPaintVertexArray.emplace(m,c.tl[0],c.tl[1],c.br[0],c.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],c.pixelRatio,h.pixelRatio)}},Wt.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,O.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,O.members,this.expression.isStateDependent))},Wt.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Zt=function(t,e,r){this.binders={},this._buffers=[];var a=[];for(var l in t.paint._values)if(r(l)){var c=t.paint.get(l);if(c instanceof ai&&Io(c.property.specification)){var h=Je(l,t.type),m=c.value,g=c.property.specification.type,v=c.property.useIntegerZoom,x=c.property.specification["property-type"],b=x==="cross-faded"||x==="cross-faded-data-driven";if(m.kind==="constant")this.binders[l]=b?new Yt(m.value,h):new re(m.value,h,g),a.push("/u_"+l);else if(m.kind==="source"||b){var T=Dr(l,g,"source");this.binders[l]=b?new Wt(m,g,v,e,T,t.id):new Ht(m,h,g,T),a.push("/a_"+l)}else{var A=Dr(l,g,"composite");this.binders[l]=new Kt(m,h,g,v,e,A),a.push("/z_"+l)}}}this.cacheKey=a.sort().join("")};Zt.prototype.getMaxValue=function(t){var e=this.binders[t];return e instanceof Ht||e instanceof Kt?e.maxValue:0},Zt.prototype.populatePaintArrays=function(t,e,r,a,l){for(var c in this.binders){var h=this.binders[c];(h instanceof Ht||h instanceof Kt||h instanceof Wt)&&h.populatePaintArray(t,e,r,a,l)}},Zt.prototype.setConstantPatternPositions=function(t,e){for(var r in this.binders){var a=this.binders[r];a instanceof Yt&&a.setConstantPatternPositions(t,e)}},Zt.prototype.updatePaintArrays=function(t,e,r,a,l){var c=!1;for(var h in t)for(var m=0,g=e.getPositions(h);m<g.length;m+=1){var v=g[m],x=r.feature(v.index);for(var b in this.binders){var T=this.binders[b];if((T instanceof Ht||T instanceof Kt||T instanceof Wt)&&T.expression.isStateDependent===!0){var A=a.paint.get(b);T.expression=A.value,T.updatePaintArray(v.start,v.end,x,t[h],l),c=!0}}}return c},Zt.prototype.defines=function(){var t=[];for(var e in this.binders){var r=this.binders[e];(r instanceof re||r instanceof Yt)&&t.push.apply(t,r.uniformNames.map(function(a){return"#define HAS_UNIFORM_"+a}))}return t},Zt.prototype.getBinderAttributes=function(){var t=[];for(var e in this.binders){var r=this.binders[e];if(r instanceof Ht||r instanceof Kt)for(var a=0;a<r.paintVertexAttributes.length;a++)t.push(r.paintVertexAttributes[a].name);else if(r instanceof Wt)for(var l=0;l<O.members.length;l++)t.push(O.members[l].name)}return t},Zt.prototype.getBinderUniforms=function(){var t=[];for(var e in this.binders){var r=this.binders[e];if(r instanceof re||r instanceof Yt||r instanceof Kt)for(var a=0,l=r.uniformNames;a<l.length;a+=1)t.push(l[a])}return t},Zt.prototype.getPaintVertexBuffers=function(){return this._buffers},Zt.prototype.getUniforms=function(t,e){var r=[];for(var a in this.binders){var l=this.binders[a];if(l instanceof re||l instanceof Yt||l instanceof Kt)for(var c=0,h=l.uniformNames;c<h.length;c+=1){var m=h[c];if(e[m]){var g=l.getBinding(t,e[m],m);r.push({name:m,property:a,binding:g})}}}return r},Zt.prototype.setUniforms=function(t,e,r,a){for(var l=0,c=e;l<c.length;l+=1){var h=c[l],m=h.name,g=h.property;this.binders[g].setUniform(h.binding,a,r.get(g),m)}},Zt.prototype.updatePaintBuffers=function(t){for(var e in this._buffers=[],this.binders){var r=this.binders[e];if(t&&r instanceof Wt){var a=t.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;a&&this._buffers.push(a)}else(r instanceof Ht||r instanceof Kt)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},Zt.prototype.upload=function(t){for(var e in this.binders){var r=this.binders[e];(r instanceof Ht||r instanceof Kt||r instanceof Wt)&&r.upload(t)}this.updatePaintBuffers()},Zt.prototype.destroy=function(){for(var t in this.binders){var e=this.binders[t];(e instanceof Ht||e instanceof Kt||e instanceof Wt)&&e.destroy()}};var we=function(t,e,r){r===void 0&&(r=function(){return!0}),this.programConfigurations={};for(var a=0,l=t;a<l.length;a+=1){var c=l[a];this.programConfigurations[c.id]=new Zt(c,e,r)}this.needsUpload=!1,this._featureMap=new Q,this._bufferOffset=0};function Je(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(e+"-","").replace(/-/g,"_")]}function Dr(t,e,r){var a={color:{source:$n,composite:i},number:{source:li,composite:$n}},l=function(c){return{"line-pattern":{source:Qi,composite:Qi},"fill-pattern":{source:Qi,composite:Qi},"fill-extrusion-pattern":{source:Qi,composite:Qi}}[c]}(t);return l&&l[r]||a[e][r]}we.prototype.populatePaintArrays=function(t,e,r,a,l,c){for(var h in this.programConfigurations)this.programConfigurations[h].populatePaintArrays(t,e,a,l,c);e.id!==void 0&&this._featureMap.add(e.id,r,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},we.prototype.updatePaintArrays=function(t,e,r,a){for(var l=0,c=r;l<c.length;l+=1){var h=c[l];this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(t,this._featureMap,e,h,a)||this.needsUpload}},we.prototype.get=function(t){return this.programConfigurations[t]},we.prototype.upload=function(t){if(this.needsUpload){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}},we.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},Pt("ConstantBinder",re),Pt("CrossFadedConstantBinder",Yt),Pt("SourceExpressionBinder",Ht),Pt("CrossFadedCompositeBinder",Wt),Pt("CompositeExpressionBinder",Kt),Pt("ProgramConfiguration",Zt,{omit:["_buffers"]}),Pt("ProgramConfigurationSet",we);var pr=Math.pow(2,14)-1,hr=-pr-1;function Ye(t){for(var e=8192/t.extent,r=t.loadGeometry(),a=0;a<r.length;a++)for(var l=r[a],c=0;c<l.length;c++){var h=l[c],m=Math.round(h.x*e),g=Math.round(h.y*e);h.x=Tr(m,hr,pr),h.y=Tr(g,hr,pr),(m<h.x||m>h.x+1||g<h.y||g>h.y+1)&&qe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function Ar(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Ye(t):[]}}function Ui(t,e,r,a,l){t.emplaceBack(2*e+(a+1)/2,2*r+(l+1)/2)}var Lr=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(e){return e.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new aa,this.indexArray=new si,this.segments=new z,this.programConfigurations=new we(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(e){return e.isStateDependent()}).map(function(e){return e.id})};function Rr(t,e){for(var r=0;r<t.length;r++)if(Ni(e,t[r]))return!0;for(var a=0;a<e.length;a++)if(Ni(t,e[a]))return!0;return!!Sn(t,e)}function Vi(t,e,r){return!!Ni(t,e)||!!eo(e,t,r)}function ui(t,e){if(t.length===1)return Do(e,t[0]);for(var r=0;r<e.length;r++)for(var a=e[r],l=0;l<a.length;l++)if(Ni(t,a[l]))return!0;for(var c=0;c<t.length;c++)if(Do(e,t[c]))return!0;for(var h=0;h<e.length;h++)if(Sn(t,e[h]))return!0;return!1}function ll(t,e,r){if(t.length>1){if(Sn(t,e))return!0;for(var a=0;a<e.length;a++)if(eo(e[a],t,r))return!0}for(var l=0;l<t.length;l++)if(eo(t[l],e,r))return!0;return!1}function Sn(t,e){if(t.length===0||e.length===0)return!1;for(var r=0;r<t.length-1;r++)for(var a=t[r],l=t[r+1],c=0;c<e.length-1;c++)if(Mo(a,l,e[c],e[c+1]))return!0;return!1}function Mo(t,e,r,a){return Kr(t,r,a)!==Kr(e,r,a)&&Kr(t,e,r)!==Kr(t,e,a)}function eo(t,e,r){var a=r*r;if(e.length===1)return t.distSqr(e[0])<a;for(var l=1;l<e.length;l++)if(ca(t,e[l-1],e[l])<a)return!0;return!1}function ca(t,e,r){var a=e.distSqr(r);if(a===0)return t.distSqr(e);var l=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/a;return t.distSqr(l<0?e:l>1?r:r.sub(e)._mult(l)._add(e))}function Do(t,e){for(var r,a,l,c=!1,h=0;h<t.length;h++)for(var m=0,g=(r=t[h]).length-1;m<r.length;g=m++)(a=r[m]).y>e.y!=(l=r[g]).y>e.y&&e.x<(l.x-a.x)*(e.y-a.y)/(l.y-a.y)+a.x&&(c=!c);return c}function Ni(t,e){for(var r=!1,a=0,l=t.length-1;a<t.length;l=a++){var c=t[a],h=t[l];c.y>e.y!=h.y>e.y&&e.x<(h.x-c.x)*(e.y-c.y)/(h.y-c.y)+c.x&&(r=!r)}return r}function Lo(t,e,r){var a=r[0],l=r[2];if(t.x<a.x&&e.x<a.x||t.x>l.x&&e.x>l.x||t.y<a.y&&e.y<a.y||t.y>l.y&&e.y>l.y)return!1;var c=Kr(t,e,r[0]);return c!==Kr(t,e,r[1])||c!==Kr(t,e,r[2])||c!==Kr(t,e,r[3])}function ar(t,e,r){var a=e.paint.get(t).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(t)}function $i(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Di(t,e,r,a,l){if(!e[0]&&!e[1])return t;var c=Dt.convert(e)._mult(l);r==="viewport"&&c._rotate(-a);for(var h=[],m=0;m<t.length;m++)h.push(t[m].sub(c));return h}Lr.prototype.populate=function(t,e,r){var a=this.layers[0],l=[],c=null,h=!1;a.type==="circle"&&(h=!(c=a.layout.get("circle-sort-key")).isConstant());for(var m=0,g=t;m<g.length;m+=1){var v=g[m],x=v.feature,b=v.id,T=v.index,A=v.sourceLayerIndex,L=this.layers[0]._featureFilter.needGeometry,R=Ar(x,L);if(this.layers[0]._featureFilter.filter(new ye(this.zoom),R,r)){var W=h?c.evaluate(R,{},r):void 0,q={id:b,properties:x.properties,type:x.type,sourceLayerIndex:A,index:T,geometry:L?R.geometry:Ye(x),patterns:{},sortKey:W};l.push(q)}}h&&l.sort(function(Bt,St){return Bt.sortKey-St.sortKey});for(var Y=0,$=l;Y<$.length;Y+=1){var rt=$[Y],it=rt.geometry,ut=rt.index,gt=rt.sourceLayerIndex,bt=t[ut].feature;this.addFeature(rt,it,ut,r),e.featureIndex.insert(bt,it,ut,gt,this.index)}},Lr.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},Lr.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Lr.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Lr.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,k),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Lr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Lr.prototype.addFeature=function(t,e,r,a){for(var l=0,c=e;l<c.length;l+=1)for(var h=0,m=c[l];h<m.length;h+=1){var g=m[h],v=g.x,x=g.y;if(!(v<0||v>=8192||x<0||x>=8192)){var b=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),T=b.vertexLength;Ui(this.layoutVertexArray,v,x,-1,-1),Ui(this.layoutVertexArray,v,x,1,-1),Ui(this.layoutVertexArray,v,x,1,1),Ui(this.layoutVertexArray,v,x,-1,1),this.indexArray.emplaceBack(T,T+1,T+2),this.indexArray.emplaceBack(T,T+3,T+2),b.vertexLength+=4,b.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,{},a)},Pt("CircleBucket",Lr,{omit:["layers"]});var ro=new ti({"circle-sort-key":new Xt(D.layout_circle["circle-sort-key"])}),Qe={paint:new ti({"circle-radius":new Xt(D.paint_circle["circle-radius"]),"circle-color":new Xt(D.paint_circle["circle-color"]),"circle-blur":new Xt(D.paint_circle["circle-blur"]),"circle-opacity":new Xt(D.paint_circle["circle-opacity"]),"circle-translate":new It(D.paint_circle["circle-translate"]),"circle-translate-anchor":new It(D.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new It(D.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new It(D.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Xt(D.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Xt(D.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Xt(D.paint_circle["circle-stroke-opacity"])}),layout:ro},Ze=typeof Float32Array!="undefined"?Float32Array:Array;function Br(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function pa(t,e,r){var a=e[0],l=e[1],c=e[2],h=e[3],m=e[4],g=e[5],v=e[6],x=e[7],b=e[8],T=e[9],A=e[10],L=e[11],R=e[12],W=e[13],q=e[14],Y=e[15],$=r[0],rt=r[1],it=r[2],ut=r[3];return t[0]=$*a+rt*m+it*b+ut*R,t[1]=$*l+rt*g+it*T+ut*W,t[2]=$*c+rt*v+it*A+ut*q,t[3]=$*h+rt*x+it*L+ut*Y,t[4]=($=r[4])*a+(rt=r[5])*m+(it=r[6])*b+(ut=r[7])*R,t[5]=$*l+rt*g+it*T+ut*W,t[6]=$*c+rt*v+it*A+ut*q,t[7]=$*h+rt*x+it*L+ut*Y,t[8]=($=r[8])*a+(rt=r[9])*m+(it=r[10])*b+(ut=r[11])*R,t[9]=$*l+rt*g+it*T+ut*W,t[10]=$*c+rt*v+it*A+ut*q,t[11]=$*h+rt*x+it*L+ut*Y,t[12]=($=r[12])*a+(rt=r[13])*m+(it=r[14])*b+(ut=r[15])*R,t[13]=$*l+rt*g+it*T+ut*W,t[14]=$*c+rt*v+it*A+ut*q,t[15]=$*h+rt*x+it*L+ut*Y,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,e=0,r=arguments.length;r--;)e+=t[r]*t[r];return Math.sqrt(e)});var rs,nc=pa;function is(t,e,r){var a=e[0],l=e[1],c=e[2],h=e[3];return t[0]=r[0]*a+r[4]*l+r[8]*c+r[12]*h,t[1]=r[1]*a+r[5]*l+r[9]*c+r[13]*h,t[2]=r[2]*a+r[6]*l+r[10]*c+r[14]*h,t[3]=r[3]*a+r[7]*l+r[11]*c+r[15]*h,t}rs=new Ze(3),Ze!=Float32Array&&(rs[0]=0,rs[1]=0,rs[2]=0),function(){var t=new Ze(4);Ze!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var ns=(function(){var t=new Ze(2);Ze!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function e(r){t.call(this,r,Qe)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(r){return new Lr(r)},e.prototype.queryRadius=function(r){var a=r;return ar("circle-radius",this,a)+ar("circle-stroke-width",this,a)+$i(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(r,a,l,c,h,m,g,v){for(var x=Di(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,g),b=this.paint.get("circle-radius").evaluate(a,l)+this.paint.get("circle-stroke-width").evaluate(a,l),T=this.paint.get("circle-pitch-alignment")==="map",A=T?x:function(gt,bt){return gt.map(function(Bt){return lu(Bt,bt)})}(x,v),L=T?b*g:b,R=0,W=c;R<W.length;R+=1)for(var q=0,Y=W[R];q<Y.length;q+=1){var $=Y[q],rt=T?$:lu($,v),it=L,ut=is([],[$.x,$.y,0,1],v);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?it*=ut[3]/m.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(it*=m.cameraToCenterDistance/ut[3]),Vi(A,rt,it))return!0}return!1},e}(xi));function lu(t,e){var r=is([],[t.x,t.y,0,1],e);return new Dt(r[0]/r[3],r[1]/r[3])}var ha=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Lr);function fa(t,e,r,a){var l=e.width,c=e.height;if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==l*c*r)throw new RangeError("mismatched image size")}else a=new Uint8Array(l*c*r);return t.width=l,t.height=c,t.data=a,t}function Xc(t,e,r){var a=e.width,l=e.height;if(a!==t.width||l!==t.height){var c=fa({},{width:a,height:l},r);oc(t,c,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,a),height:Math.min(t.height,l)},r),t.width=a,t.height=l,t.data=c.data}}function oc(t,e,r,a,l,c){if(l.width===0||l.height===0)return e;if(l.width>t.width||l.height>t.height||r.x>t.width-l.width||r.y>t.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||a.x>e.width-l.width||a.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");for(var h=t.data,m=e.data,g=0;g<l.height;g++)for(var v=((r.y+g)*t.width+r.x)*c,x=((a.y+g)*e.width+a.x)*c,b=0;b<l.width*c;b++)m[x+b]=h[v+b];return e}Pt("HeatmapBucket",ha,{omit:["layers"]});var da=function(t,e){fa(this,t,1,e)};da.prototype.resize=function(t){Xc(this,t,1)},da.prototype.clone=function(){return new da({width:this.width,height:this.height},new Uint8Array(this.data))},da.copy=function(t,e,r,a,l){oc(t,e,r,a,l,1)};var ri=function(t,e){fa(this,t,4,e)};ri.prototype.resize=function(t){Xc(this,t,4)},ri.prototype.replace=function(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},ri.prototype.clone=function(){return new ri({width:this.width,height:this.height},new Uint8Array(this.data))},ri.copy=function(t,e,r,a,l){oc(t,e,r,a,l,4)},Pt("AlphaImage",da),Pt("RGBAImage",ri);var Vh={paint:new ti({"heatmap-radius":new Xt(D.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Xt(D.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new It(D.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Hi(D.paint_heatmap["heatmap-color"]),"heatmap-opacity":new It(D.paint_heatmap["heatmap-opacity"])})};function Wc(t){var e={},r=t.resolution||256,a=t.clips?t.clips.length:1,l=t.image||new ri({width:r,height:a}),c=function(L,R,W){e[t.evaluationKey]=W;var q=t.expression.evaluate(e);l.data[L+R+0]=Math.floor(255*q.r/q.a),l.data[L+R+1]=Math.floor(255*q.g/q.a),l.data[L+R+2]=Math.floor(255*q.b/q.a),l.data[L+R+3]=Math.floor(255*q.a)};if(t.clips)for(var h=0,m=0;h<a;++h,m+=4*r)for(var g=0,v=0;g<r;g++,v+=4){var x=g/(r-1),b=t.clips[h];c(m,v,b.start*(1-x)+b.end*x)}else for(var T=0,A=0;T<r;T++,A+=4)c(0,A,T/(r-1));return l}var Nh=function(t){function e(r){t.call(this,r,Vh),this._updateColorRamp()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(r){return new ha(r)},e.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="heatmap-color"&&this._updateColorRamp()},e.prototype._updateColorRamp=function(){this.colorRamp=Wc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},e}(xi),jh={paint:new ti({"hillshade-illumination-direction":new It(D.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new It(D.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new It(D.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new It(D.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new It(D.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new It(D.paint_hillshade["hillshade-accent-color"])})},qh=function(t){function e(r){t.call(this,r,jh)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},e}(xi),Zh=_r([{name:"a_pos",components:2,type:"Int16"}],4).members,ac=uu,Gh=uu;function uu(t,e,r){r=r||2;var a,l,c,h,m,g,v,x=e&&e.length,b=x?e[0]*r:t.length,T=Kc(t,0,b,r,!0),A=[];if(!T||T.next===T.prev)return A;if(x&&(T=function(R,W,q,Y){var $,rt,it,ut=[];for($=0,rt=W.length;$<rt;$++)(it=Kc(R,W[$]*Y,$<rt-1?W[$+1]*Y:R.length,Y,!1))===it.next&&(it.steiner=!0),ut.push($h(it));for(ut.sort(Jh),$=0;$<ut.length;$++)Yh(ut[$],q),q=Ro(q,q.next);return q}(t,e,T,r)),t.length>80*r){a=c=t[0],l=h=t[1];for(var L=r;L<b;L+=r)(m=t[L])<a&&(a=m),(g=t[L+1])<l&&(l=g),m>c&&(c=m),g>h&&(h=g);v=(v=Math.max(c-a,h-l))!==0?1/v:0}return ul(T,A,r,a,l,v),A}function Kc(t,e,r,a,l){var c,h;if(l===uc(t,e,r,a)>0)for(c=e;c<r;c+=a)h=Yc(c,t[c],t[c+1],h);else for(c=r-a;c>=e;c-=a)h=Yc(c,t[c],t[c+1],h);return h&&cu(h,h.next)&&(pl(h),h=h.next),h}function Ro(t,e){if(!t)return t;e||(e=t);var r,a=t;do if(r=!1,a.steiner||!cu(a,a.next)&&sr(a.prev,a,a.next)!==0)a=a.next;else{if(pl(a),(a=e=a.prev)===a.next)break;r=!0}while(r||a!==e);return e}function ul(t,e,r,a,l,c,h){if(t){!h&&c&&function(x,b,T,A){var L=x;do L.z===null&&(L.z=sc(L.x,L.y,b,T,A)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==x);L.prevZ.nextZ=null,L.prevZ=null,function(R){var W,q,Y,$,rt,it,ut,gt,bt=1;do{for(q=R,R=null,rt=null,it=0;q;){for(it++,Y=q,ut=0,W=0;W<bt&&(ut++,Y=Y.nextZ);W++);for(gt=bt;ut>0||gt>0&&Y;)ut!==0&&(gt===0||!Y||q.z<=Y.z)?($=q,q=q.nextZ,ut--):($=Y,Y=Y.nextZ,gt--),rt?rt.nextZ=$:R=$,$.prevZ=rt,rt=$;q=Y}rt.nextZ=null,bt*=2}while(it>1)}(L)}(t,a,l,c);for(var m,g,v=t;t.prev!==t.next;)if(m=t.prev,g=t.next,c?Wh(t,a,l,c):Xh(t))e.push(m.i/r),e.push(t.i/r),e.push(g.i/r),pl(t),t=g.next,v=g.next;else if((t=g)===v){h?h===1?ul(t=Kh(Ro(t),e,r),e,r,a,l,c,2):h===2&&Hh(t,e,r,a,l,c):ul(Ro(t),e,r,a,l,c,1);break}}}function Xh(t){var e=t.prev,r=t,a=t.next;if(sr(e,r,a)>=0)return!1;for(var l=t.next.next;l!==t.prev;){if(os(e.x,e.y,r.x,r.y,a.x,a.y,l.x,l.y)&&sr(l.prev,l,l.next)>=0)return!1;l=l.next}return!0}function Wh(t,e,r,a){var l=t.prev,c=t,h=t.next;if(sr(l,c,h)>=0)return!1;for(var m=l.x>c.x?l.x>h.x?l.x:h.x:c.x>h.x?c.x:h.x,g=l.y>c.y?l.y>h.y?l.y:h.y:c.y>h.y?c.y:h.y,v=sc(l.x<c.x?l.x<h.x?l.x:h.x:c.x<h.x?c.x:h.x,l.y<c.y?l.y<h.y?l.y:h.y:c.y<h.y?c.y:h.y,e,r,a),x=sc(m,g,e,r,a),b=t.prevZ,T=t.nextZ;b&&b.z>=v&&T&&T.z<=x;){if(b!==t.prev&&b!==t.next&&os(l.x,l.y,c.x,c.y,h.x,h.y,b.x,b.y)&&sr(b.prev,b,b.next)>=0||(b=b.prevZ,T!==t.prev&&T!==t.next&&os(l.x,l.y,c.x,c.y,h.x,h.y,T.x,T.y)&&sr(T.prev,T,T.next)>=0))return!1;T=T.nextZ}for(;b&&b.z>=v;){if(b!==t.prev&&b!==t.next&&os(l.x,l.y,c.x,c.y,h.x,h.y,b.x,b.y)&&sr(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;T&&T.z<=x;){if(T!==t.prev&&T!==t.next&&os(l.x,l.y,c.x,c.y,h.x,h.y,T.x,T.y)&&sr(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function Kh(t,e,r){var a=t;do{var l=a.prev,c=a.next.next;!cu(l,c)&&Hc(l,a,a.next,c)&&cl(l,c)&&cl(c,l)&&(e.push(l.i/r),e.push(a.i/r),e.push(c.i/r),pl(a),pl(a.next),a=t=c),a=a.next}while(a!==t);return Ro(a)}function Hh(t,e,r,a,l,c){var h=t;do{for(var m=h.next.next;m!==h.prev;){if(h.i!==m.i&&tf(h,m)){var g=Jc(h,m);return h=Ro(h,h.next),g=Ro(g,g.next),ul(h,e,r,a,l,c),void ul(g,e,r,a,l,c)}m=m.next}h=h.next}while(h!==t)}function Jh(t,e){return t.x-e.x}function Yh(t,e){if(e=function(a,l){var c,h=l,m=a.x,g=a.y,v=-1/0;do{if(g<=h.y&&g>=h.next.y&&h.next.y!==h.y){var x=h.x+(g-h.y)*(h.next.x-h.x)/(h.next.y-h.y);if(x<=m&&x>v){if(v=x,x===m){if(g===h.y)return h;if(g===h.next.y)return h.next}c=h.x<h.next.x?h:h.next}}h=h.next}while(h!==l);if(!c)return null;if(m===v)return c;var b,T=c,A=c.x,L=c.y,R=1/0;h=c;do m>=h.x&&h.x>=A&&m!==h.x&&os(g<L?m:v,g,A,L,g<L?v:m,g,h.x,h.y)&&(b=Math.abs(g-h.y)/(m-h.x),cl(h,a)&&(b<R||b===R&&(h.x>c.x||h.x===c.x&&Qh(c,h)))&&(c=h,R=b)),h=h.next;while(h!==T);return c}(t,e)){var r=Jc(e,t);Ro(e,e.next),Ro(r,r.next)}}function Qh(t,e){return sr(t.prev,t,e.prev)<0&&sr(e.next,t,t.next)<0}function sc(t,e,r,a,l){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*l)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-a)*l)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function $h(t){var e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function os(t,e,r,a,l,c,h,m){return(l-h)*(e-m)-(t-h)*(c-m)>=0&&(t-h)*(a-m)-(r-h)*(e-m)>=0&&(r-h)*(c-m)-(l-h)*(a-m)>=0}function tf(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(r,a){var l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==a.i&&l.next.i!==a.i&&Hc(l,l.next,r,a))return!0;l=l.next}while(l!==r);return!1}(t,e)&&(cl(t,e)&&cl(e,t)&&function(r,a){var l=r,c=!1,h=(r.x+a.x)/2,m=(r.y+a.y)/2;do l.y>m!=l.next.y>m&&l.next.y!==l.y&&h<(l.next.x-l.x)*(m-l.y)/(l.next.y-l.y)+l.x&&(c=!c),l=l.next;while(l!==r);return c}(t,e)&&(sr(t.prev,t,e.prev)||sr(t,e.prev,e))||cu(t,e)&&sr(t.prev,t,t.next)>0&&sr(e.prev,e,e.next)>0)}function sr(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function cu(t,e){return t.x===e.x&&t.y===e.y}function Hc(t,e,r,a){var l=hu(sr(t,e,r)),c=hu(sr(t,e,a)),h=hu(sr(r,a,t)),m=hu(sr(r,a,e));return l!==c&&h!==m||!(l!==0||!pu(t,r,e))||!(c!==0||!pu(t,a,e))||!(h!==0||!pu(r,t,a))||!(m!==0||!pu(r,e,a))}function pu(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function hu(t){return t>0?1:t<0?-1:0}function cl(t,e){return sr(t.prev,t,t.next)<0?sr(t,e,t.next)>=0&&sr(t,t.prev,e)>=0:sr(t,e,t.prev)<0||sr(t,t.next,e)<0}function Jc(t,e){var r=new lc(t.i,t.x,t.y),a=new lc(e.i,e.x,e.y),l=t.next,c=e.prev;return t.next=e,e.prev=t,r.next=l,l.prev=r,a.next=r,r.prev=a,c.next=a,a.prev=c,a}function Yc(t,e,r,a){var l=new lc(t,e,r);return a?(l.next=a.next,l.prev=a,a.next.prev=l,a.next=l):(l.prev=l,l.next=l),l}function pl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function lc(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function uc(t,e,r,a){for(var l=0,c=e,h=r-a;c<r;c+=a)l+=(t[h]-t[c])*(t[c+1]+t[h+1]),h=c;return l}function ef(t,e,r,a,l){(function c(h,m,g,v,x){for(;v>g;){if(v-g>600){var b=v-g+1,T=m-g+1,A=Math.log(b),L=.5*Math.exp(2*A/3),R=.5*Math.sqrt(A*L*(b-L)/b)*(T-b/2<0?-1:1);c(h,m,Math.max(g,Math.floor(m-T*L/b+R)),Math.min(v,Math.floor(m+(b-T)*L/b+R)),x)}var W=h[m],q=g,Y=v;for(hl(h,g,m),x(h[v],W)>0&&hl(h,g,v);q<Y;){for(hl(h,q,Y),q++,Y--;x(h[q],W)<0;)q++;for(;x(h[Y],W)>0;)Y--}x(h[g],W)===0?hl(h,g,Y):hl(h,++Y,v),Y<=m&&(g=Y+1),m<=Y&&(v=Y-1)}})(t,e,r||0,a||t.length-1,l||rf)}function hl(t,e,r){var a=t[e];t[e]=t[r],t[r]=a}function rf(t,e){return t<e?-1:t>e?1:0}function cc(t,e){var r=t.length;if(r<=1)return[t];for(var a,l,c=[],h=0;h<r;h++){var m=Ta(t[h]);m!==0&&(t[h].area=Math.abs(m),l===void 0&&(l=m<0),l===m<0?(a&&c.push(a),a=[t[h]]):a.push(t[h]))}if(a&&c.push(a),e>1)for(var g=0;g<c.length;g++)c[g].length<=e||(ef(c[g],e,1,c[g].length-1,nf),c[g]=c[g].slice(0,e));return c}function nf(t,e){return e.area-t.area}function pc(t,e,r){for(var a=r.patternDependencies,l=!1,c=0,h=e;c<h.length;c+=1){var m=h[c].paint.get(t+"-pattern");m.isConstant()||(l=!0);var g=m.constantOr(null);g&&(l=!0,a[g.to]=!0,a[g.from]=!0)}return l}function hc(t,e,r,a,l){for(var c=l.patternDependencies,h=0,m=e;h<m.length;h+=1){var g=m[h],v=g.paint.get(t+"-pattern").value;if(v.kind!=="constant"){var x=v.evaluate({zoom:a-1},r,{},l.availableImages),b=v.evaluate({zoom:a},r,{},l.availableImages),T=v.evaluate({zoom:a+1},r,{},l.availableImages);b=b&&b.name?b.name:b,T=T&&T.name?T.name:T,c[x=x&&x.name?x.name:x]=!0,c[b]=!0,c[T]=!0,r.patterns[g.id]={min:x,mid:b,max:T}}}return r}uu.deviation=function(t,e,r,a){var l=e&&e.length,c=Math.abs(uc(t,0,l?e[0]*r:t.length,r));if(l)for(var h=0,m=e.length;h<m;h++)c-=Math.abs(uc(t,e[h]*r,h<m-1?e[h+1]*r:t.length,r));var g=0;for(h=0;h<a.length;h+=3){var v=a[h]*r,x=a[h+1]*r,b=a[h+2]*r;g+=Math.abs((t[v]-t[b])*(t[x+1]-t[v+1])-(t[v]-t[x])*(t[b+1]-t[v+1]))}return c===0&&g===0?0:Math.abs((g-c)/c)},uu.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},a=0,l=0;l<t.length;l++){for(var c=0;c<t[l].length;c++)for(var h=0;h<e;h++)r.vertices.push(t[l][c][h]);l>0&&r.holes.push(a+=t[l-1].length)}return r},ac.default=Gh;var tn=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(e){return e.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new aa,this.indexArray=new si,this.indexArray2=new ua,this.programConfigurations=new we(t.layers,t.zoom),this.segments=new z,this.segments2=new z,this.stateDependentLayerIds=this.layers.filter(function(e){return e.isStateDependent()}).map(function(e){return e.id})};tn.prototype.populate=function(t,e,r){this.hasPattern=pc("fill",this.layers,e);for(var a=this.layers[0].layout.get("fill-sort-key"),l=!a.isConstant(),c=[],h=0,m=t;h<m.length;h+=1){var g=m[h],v=g.feature,x=g.id,b=g.index,T=g.sourceLayerIndex,A=this.layers[0]._featureFilter.needGeometry,L=Ar(v,A);if(this.layers[0]._featureFilter.filter(new ye(this.zoom),L,r)){var R=l?a.evaluate(L,{},r,e.availableImages):void 0,W={id:x,properties:v.properties,type:v.type,sourceLayerIndex:T,index:b,geometry:A?L.geometry:Ye(v),patterns:{},sortKey:R};c.push(W)}}l&&c.sort(function(bt,Bt){return bt.sortKey-Bt.sortKey});for(var q=0,Y=c;q<Y.length;q+=1){var $=Y[q],rt=$.geometry,it=$.index,ut=$.sourceLayerIndex;if(this.hasPattern){var gt=hc("fill",this.layers,$,this.zoom,e);this.patternFeatures.push(gt)}else this.addFeature($,rt,it,r,{});e.featureIndex.insert(t[it].feature,rt,it,ut,this.index)}},tn.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},tn.prototype.addFeatures=function(t,e,r){for(var a=0,l=this.patternFeatures;a<l.length;a+=1){var c=l[a];this.addFeature(c,c.geometry,c.index,e,r)}},tn.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},tn.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},tn.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Zh),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},tn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},tn.prototype.addFeature=function(t,e,r,a,l){for(var c=0,h=cc(e,500);c<h.length;c+=1){for(var m=h[c],g=0,v=0,x=m;v<x.length;v+=1)g+=x[v].length;for(var b=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray),T=b.vertexLength,A=[],L=[],R=0,W=m;R<W.length;R+=1){var q=W[R];if(q.length!==0){q!==m[0]&&L.push(A.length/2);var Y=this.segments2.prepareSegment(q.length,this.layoutVertexArray,this.indexArray2),$=Y.vertexLength;this.layoutVertexArray.emplaceBack(q[0].x,q[0].y),this.indexArray2.emplaceBack($+q.length-1,$),A.push(q[0].x),A.push(q[0].y);for(var rt=1;rt<q.length;rt++)this.layoutVertexArray.emplaceBack(q[rt].x,q[rt].y),this.indexArray2.emplaceBack($+rt-1,$+rt),A.push(q[rt].x),A.push(q[rt].y);Y.vertexLength+=q.length,Y.primitiveLength+=q.length}}for(var it=ac(A,L),ut=0;ut<it.length;ut+=3)this.indexArray.emplaceBack(T+it[ut],T+it[ut+1],T+it[ut+2]);b.vertexLength+=g,b.primitiveLength+=it.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,l,a)},Pt("FillBucket",tn,{omit:["layers","patternFeatures"]});var of=new ti({"fill-sort-key":new Xt(D.layout_fill["fill-sort-key"])}),af={paint:new ti({"fill-antialias":new It(D.paint_fill["fill-antialias"]),"fill-opacity":new Xt(D.paint_fill["fill-opacity"]),"fill-color":new Xt(D.paint_fill["fill-color"]),"fill-outline-color":new Xt(D.paint_fill["fill-outline-color"]),"fill-translate":new It(D.paint_fill["fill-translate"]),"fill-translate-anchor":new It(D.paint_fill["fill-translate-anchor"]),"fill-pattern":new $r(D.paint_fill["fill-pattern"])}),layout:of},sf=function(t){function e(r){t.call(this,r,af)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(r,a){t.prototype.recalculate.call(this,r,a);var l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},e.prototype.createBucket=function(r){return new tn(r)},e.prototype.queryRadius=function(){return $i(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(r,a,l,c,h,m,g){return ui(Di(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,g),c)},e.prototype.isTileClipped=function(){return!0},e}(xi),lf=_r([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Qc=as;function as(t,e,r,a,l){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=a,this._values=l,t.readFields(uf,this,e)}function uf(t,e,r){t==1?e.id=r.readVarint():t==2?function(a,l){for(var c=a.readVarint()+a.pos;a.pos<c;){var h=l._keys[a.readVarint()],m=l._values[a.readVarint()];l.properties[h]=m}}(r,e):t==3?e.type=r.readVarint():t==4&&(e._geometry=r.pos)}function cf(t){for(var e,r,a=0,l=0,c=t.length,h=c-1;l<c;h=l++)a+=((r=t[h]).x-(e=t[l]).x)*(e.y+r.y);return a}as.types=["Unknown","Point","LineString","Polygon"],as.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,a=1,l=0,c=0,h=0,m=[];t.pos<r;){if(l<=0){var g=t.readVarint();a=7&g,l=g>>3}if(l--,a===1||a===2)c+=t.readSVarint(),h+=t.readSVarint(),a===1&&(e&&m.push(e),e=[]),e.push(new Dt(c,h));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&m.push(e),m},as.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,a=0,l=0,c=0,h=1/0,m=-1/0,g=1/0,v=-1/0;t.pos<e;){if(a<=0){var x=t.readVarint();r=7&x,a=x>>3}if(a--,r===1||r===2)(l+=t.readSVarint())<h&&(h=l),l>m&&(m=l),(c+=t.readSVarint())<g&&(g=c),c>v&&(v=c);else if(r!==7)throw new Error("unknown command "+r)}return[h,g,m,v]},as.prototype.toGeoJSON=function(t,e,r){var a,l,c=this.extent*Math.pow(2,r),h=this.extent*t,m=this.extent*e,g=this.loadGeometry(),v=as.types[this.type];function x(A){for(var L=0;L<A.length;L++){var R=A[L];A[L]=[360*(R.x+h)/c-180,360/Math.PI*Math.atan(Math.exp((180-360*(R.y+m)/c)*Math.PI/180))-90]}}switch(this.type){case 1:var b=[];for(a=0;a<g.length;a++)b[a]=g[a][0];x(g=b);break;case 2:for(a=0;a<g.length;a++)x(g[a]);break;case 3:for(g=function(A){var L=A.length;if(L<=1)return[A];for(var R,W,q=[],Y=0;Y<L;Y++){var $=cf(A[Y]);$!==0&&(W===void 0&&(W=$<0),W===$<0?(R&&q.push(R),R=[A[Y]]):R.push(A[Y]))}return R&&q.push(R),q}(g),a=0;a<g.length;a++)for(l=0;l<g[a].length;l++)x(g[a][l])}g.length===1?g=g[0]:v="Multi"+v;var T={type:"Feature",geometry:{type:v,coordinates:g},properties:this.properties};return"id"in this&&(T.id=this.id),T};var $c=tp;function tp(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(pf,this,e),this.length=this._features.length}function pf(t,e,r){t===15?e.version=r.readVarint():t===1?e.name=r.readString():t===5?e.extent=r.readVarint():t===2?e._features.push(r.pos):t===3?e._keys.push(r.readString()):t===4&&e._values.push(function(a){for(var l=null,c=a.readVarint()+a.pos;a.pos<c;){var h=a.readVarint()>>3;l=h===1?a.readString():h===2?a.readFloat():h===3?a.readDouble():h===4?a.readVarint64():h===5?a.readVarint():h===6?a.readSVarint():h===7?a.readBoolean():null}return l}(r))}function hf(t,e,r){if(t===3){var a=new $c(r,r.readVarint()+r.pos);a.length&&(e[a.name]=a)}}tp.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Qc(this._pbf,e,this.extent,this._keys,this._values)};var ss={VectorTile:function(t,e){this.layers=t.readFields(hf,{},e)},VectorTileFeature:Qc,VectorTileLayer:$c},ff=ss.VectorTileFeature.types,fc=Math.pow(2,13);function fl(t,e,r,a,l,c,h,m){t.emplaceBack(e,r,2*Math.floor(a*fc)+h,l*fc*2,c*fc*2,Math.round(m))}var en=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(e){return e.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ei,this.indexArray=new si,this.programConfigurations=new we(t.layers,t.zoom),this.segments=new z,this.stateDependentLayerIds=this.layers.filter(function(e){return e.isStateDependent()}).map(function(e){return e.id})};function df(t,e){return t.x===e.x&&(t.x<0||t.x>8192)||t.y===e.y&&(t.y<0||t.y>8192)}en.prototype.populate=function(t,e,r){this.features=[],this.hasPattern=pc("fill-extrusion",this.layers,e);for(var a=0,l=t;a<l.length;a+=1){var c=l[a],h=c.feature,m=c.id,g=c.index,v=c.sourceLayerIndex,x=this.layers[0]._featureFilter.needGeometry,b=Ar(h,x);if(this.layers[0]._featureFilter.filter(new ye(this.zoom),b,r)){var T={id:m,sourceLayerIndex:v,index:g,geometry:x?b.geometry:Ye(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(hc("fill-extrusion",this.layers,T,this.zoom,e)):this.addFeature(T,T.geometry,g,r,{}),e.featureIndex.insert(h,T.geometry,g,v,this.index,!0)}}},en.prototype.addFeatures=function(t,e,r){for(var a=0,l=this.features;a<l.length;a+=1){var c=l[a];this.addFeature(c,c.geometry,c.index,e,r)}},en.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},en.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},en.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},en.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,lf),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},en.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},en.prototype.addFeature=function(t,e,r,a,l){for(var c=0,h=cc(e,500);c<h.length;c+=1){for(var m=h[c],g=0,v=0,x=m;v<x.length;v+=1)g+=x[v].length;for(var b=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),T=0,A=m;T<A.length;T+=1){var L=A[T];if(L.length!==0&&!((ne=L).every(function(te){return te.x<0})||ne.every(function(te){return te.x>8192})||ne.every(function(te){return te.y<0})||ne.every(function(te){return te.y>8192})))for(var R=0,W=0;W<L.length;W++){var q=L[W];if(W>=1){var Y=L[W-1];if(!df(q,Y)){b.vertexLength+4>z.MAX_VERTEX_ARRAY_LENGTH&&(b=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var $=q.sub(Y)._perp()._unit(),rt=Y.dist(q);R+rt>32768&&(R=0),fl(this.layoutVertexArray,q.x,q.y,$.x,$.y,0,0,R),fl(this.layoutVertexArray,q.x,q.y,$.x,$.y,0,1,R),fl(this.layoutVertexArray,Y.x,Y.y,$.x,$.y,0,0,R+=rt),fl(this.layoutVertexArray,Y.x,Y.y,$.x,$.y,0,1,R);var it=b.vertexLength;this.indexArray.emplaceBack(it,it+2,it+1),this.indexArray.emplaceBack(it+1,it+2,it+3),b.vertexLength+=4,b.primitiveLength+=2}}}}if(b.vertexLength+g>z.MAX_VERTEX_ARRAY_LENGTH&&(b=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray)),ff[t.type]==="Polygon"){for(var ut=[],gt=[],bt=b.vertexLength,Bt=0,St=m;Bt<St.length;Bt+=1){var Ut=St[Bt];if(Ut.length!==0){Ut!==m[0]&&gt.push(ut.length/2);for(var Tt=0;Tt<Ut.length;Tt++){var ee=Ut[Tt];fl(this.layoutVertexArray,ee.x,ee.y,0,0,1,1,0),ut.push(ee.x),ut.push(ee.y)}}}for(var Gt=ac(ut,gt),Rt=0;Rt<Gt.length;Rt+=3)this.indexArray.emplaceBack(bt+Gt[Rt],bt+Gt[Rt+2],bt+Gt[Rt+1]);b.primitiveLength+=Gt.length/3,b.vertexLength+=g}}var ne;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,l,a)},Pt("FillExtrusionBucket",en,{omit:["layers","features"]});var mf={paint:new ti({"fill-extrusion-opacity":new It(D["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Xt(D["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new It(D["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new It(D["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $r(D["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Xt(D["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Xt(D["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new It(D["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},yf=function(t){function e(r){t.call(this,r,mf)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(r){return new en(r)},e.prototype.queryRadius=function(){return $i(this.paint.get("fill-extrusion-translate"))},e.prototype.is3D=function(){return!0},e.prototype.queryIntersectsFeature=function(r,a,l,c,h,m,g,v){var x=Di(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,g),b=this.paint.get("fill-extrusion-height").evaluate(a,l),T=this.paint.get("fill-extrusion-base").evaluate(a,l),A=function(R,W,q,Y){for(var $=[],rt=0,it=R;rt<it.length;rt+=1){var ut=it[rt],gt=[ut.x,ut.y,0,1];is(gt,gt,W),$.push(new Dt(gt[0]/gt[3],gt[1]/gt[3]))}return $}(x,v),L=function(R,W,q,Y){for(var $=[],rt=[],it=Y[8]*W,ut=Y[9]*W,gt=Y[10]*W,bt=Y[11]*W,Bt=Y[8]*q,St=Y[9]*q,Ut=Y[10]*q,Tt=Y[11]*q,ee=0,Gt=R;ee<Gt.length;ee+=1){for(var Rt=[],ne=[],te=0,ue=Gt[ee];te<ue.length;te+=1){var jt=ue[te],de=jt.x,Oe=jt.y,Ge=Y[0]*de+Y[4]*Oe+Y[12],je=Y[1]*de+Y[5]*Oe+Y[13],Fe=Y[2]*de+Y[6]*Oe+Y[14],Xe=Y[3]*de+Y[7]*Oe+Y[15],fr=Fe+gt,dr=Xe+bt,Fr=Ge+Bt,br=je+St,Ur=Fe+Ut,$e=Xe+Tt,wr=new Dt((Ge+it)/dr,(je+ut)/dr);wr.z=fr/dr,Rt.push(wr);var ae=new Dt(Fr/$e,br/$e);ae.z=Ur/$e,ne.push(ae)}$.push(Rt),rt.push(ne)}return[$,rt]}(c,T,b,v);return function(R,W,q){var Y=1/0;ui(q,W)&&(Y=ep(q,W[0]));for(var $=0;$<W.length;$++)for(var rt=W[$],it=R[$],ut=0;ut<rt.length-1;ut++){var gt=rt[ut],bt=[gt,rt[ut+1],it[ut+1],it[ut],gt];Rr(q,bt)&&(Y=Math.min(Y,ep(q,bt)))}return Y!==1/0&&Y}(L[0],L[1],A)},e}(xi);function dl(t,e){return t.x*e.x+t.y*e.y}function ep(t,e){if(t.length===1){for(var r,a=0,l=e[a++];!r||l.equals(r);)if(!(r=e[a++]))return 1/0;for(;a<e.length;a++){var c=e[a],h=t[0],m=r.sub(l),g=c.sub(l),v=h.sub(l),x=dl(m,m),b=dl(m,g),T=dl(g,g),A=dl(v,m),L=dl(v,g),R=x*T-b*b,W=(T*A-b*L)/R,q=(x*L-b*A)/R,Y=l.z*(1-W-q)+r.z*W+c.z*q;if(isFinite(Y))return Y}return 1/0}for(var $=1/0,rt=0,it=e;rt<it.length;rt+=1)$=Math.min($,it[rt].z);return $}var gf=_r([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,vf=_r([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,_f=ss.VectorTileFeature.types,xf=Math.cos(Math.PI/180*37.5),rp=Math.pow(2,14)/.5,Xr=function(t){var e=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(r){e.gradients[r.id]={}}),this.layoutVertexArray=new $a,this.layoutVertexArray2=new $n,this.indexArray=new si,this.programConfigurations=new we(t.layers,t.zoom),this.segments=new z,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};Xr.prototype.populate=function(t,e,r){this.hasPattern=pc("line",this.layers,e);for(var a=this.layers[0].layout.get("line-sort-key"),l=!a.isConstant(),c=[],h=0,m=t;h<m.length;h+=1){var g=m[h],v=g.feature,x=g.id,b=g.index,T=g.sourceLayerIndex,A=this.layers[0]._featureFilter.needGeometry,L=Ar(v,A);if(this.layers[0]._featureFilter.filter(new ye(this.zoom),L,r)){var R=l?a.evaluate(L,{},r):void 0,W={id:x,properties:v.properties,type:v.type,sourceLayerIndex:T,index:b,geometry:A?L.geometry:Ye(v),patterns:{},sortKey:R};c.push(W)}}l&&c.sort(function(bt,Bt){return bt.sortKey-Bt.sortKey});for(var q=0,Y=c;q<Y.length;q+=1){var $=Y[q],rt=$.geometry,it=$.index,ut=$.sourceLayerIndex;if(this.hasPattern){var gt=hc("line",this.layers,$,this.zoom,e);this.patternFeatures.push(gt)}else this.addFeature($,rt,it,r,{});e.featureIndex.insert(t[it].feature,rt,it,ut,this.index)}},Xr.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},Xr.prototype.addFeatures=function(t,e,r){for(var a=0,l=this.patternFeatures;a<l.length;a+=1){var c=l[a];this.addFeature(c,c.geometry,c.index,e,r)}},Xr.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Xr.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Xr.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,vf)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,gf),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Xr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Xr.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},Xr.prototype.addFeature=function(t,e,r,a,l){var c=this.layers[0].layout,h=c.get("line-join").evaluate(t,{}),m=c.get("line-cap"),g=c.get("line-miter-limit"),v=c.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var x=0,b=e;x<b.length;x+=1)this.addLine(b[x],t,h,m,g,v);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,l,a)},Xr.prototype.addLine=function(t,e,r,a,l,c){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var h=0;h<t.length-1;h++)this.totalDistance+=t[h].dist(t[h+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var m=_f[e.type]==="Polygon",g=t.length;g>=2&&t[g-1].equals(t[g-2]);)g--;for(var v=0;v<g-1&&t[v].equals(t[v+1]);)v++;if(!(g<(m?3:2))){r==="bevel"&&(l=1.05);var x,b=this.overscaling<=16?122880/(512*this.overscaling):0,T=this.segments.prepareSegment(10*g,this.layoutVertexArray,this.indexArray),A=void 0,L=void 0,R=void 0,W=void 0;this.e1=this.e2=-1,m&&(W=t[v].sub(x=t[g-2])._unit()._perp());for(var q=v;q<g;q++)if(!(L=q===g-1?m?t[v+1]:void 0:t[q+1])||!t[q].equals(L)){W&&(R=W),x&&(A=x),x=t[q],W=L?L.sub(x)._unit()._perp():R;var Y=(R=R||W).add(W);Y.x===0&&Y.y===0||Y._unit();var $=R.x*W.x+R.y*W.y,rt=Y.x*W.x+Y.y*W.y,it=rt!==0?1/rt:1/0,ut=2*Math.sqrt(2-2*rt),gt=rt<xf&&A&&L,bt=R.x*W.y-R.y*W.x>0;if(gt&&q>v){var Bt=x.dist(A);if(Bt>2*b){var St=x.sub(x.sub(A)._mult(b/Bt)._round());this.updateDistance(A,St),this.addCurrentVertex(St,R,0,0,T),A=St}}var Ut=A&&L,Tt=Ut?r:m?"butt":a;if(Ut&&Tt==="round"&&(it<c?Tt="miter":it<=2&&(Tt="fakeround")),Tt==="miter"&&it>l&&(Tt="bevel"),Tt==="bevel"&&(it>2&&(Tt="flipbevel"),it<l&&(Tt="miter")),A&&this.updateDistance(A,x),Tt==="miter")Y._mult(it),this.addCurrentVertex(x,Y,0,0,T);else if(Tt==="flipbevel"){if(it>100)Y=W.mult(-1);else{var ee=it*R.add(W).mag()/R.sub(W).mag();Y._perp()._mult(ee*(bt?-1:1))}this.addCurrentVertex(x,Y,0,0,T),this.addCurrentVertex(x,Y.mult(-1),0,0,T)}else if(Tt==="bevel"||Tt==="fakeround"){var Gt=-Math.sqrt(it*it-1),Rt=bt?Gt:0,ne=bt?0:Gt;if(A&&this.addCurrentVertex(x,R,Rt,ne,T),Tt==="fakeround")for(var te=Math.round(180*ut/Math.PI/20),ue=1;ue<te;ue++){var jt=ue/te;if(jt!==.5){var de=jt-.5;jt+=jt*de*(jt-1)*((1.0904+$*($*(3.55645-1.43519*$)-3.2452))*de*de+(.848013+$*(.215638*$-1.06021)))}var Oe=W.sub(R)._mult(jt)._add(R)._unit()._mult(bt?-1:1);this.addHalfVertex(x,Oe.x,Oe.y,!1,bt,0,T)}L&&this.addCurrentVertex(x,W,-Rt,-ne,T)}else if(Tt==="butt")this.addCurrentVertex(x,Y,0,0,T);else if(Tt==="square"){var Ge=A?1:-1;this.addCurrentVertex(x,Y,Ge,Ge,T)}else Tt==="round"&&(A&&(this.addCurrentVertex(x,R,0,0,T),this.addCurrentVertex(x,R,1,1,T,!0)),L&&(this.addCurrentVertex(x,W,-1,-1,T,!0),this.addCurrentVertex(x,W,0,0,T)));if(gt&&q<g-1){var je=x.dist(L);if(je>2*b){var Fe=x.add(L.sub(x)._mult(b/je)._round());this.updateDistance(x,Fe),this.addCurrentVertex(Fe,W,0,0,T),x=Fe}}}}},Xr.prototype.addCurrentVertex=function(t,e,r,a,l,c){c===void 0&&(c=!1);var h=e.y*a-e.x,m=-e.y-e.x*a;this.addHalfVertex(t,e.x+e.y*r,e.y-e.x*r,c,!1,r,l),this.addHalfVertex(t,h,m,c,!0,-a,l),this.distance>rp/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,e,r,a,l,c))},Xr.prototype.addHalfVertex=function(t,e,r,a,l,c,h){var m=.5*(this.lineClips?this.scaledDistance*(rp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(a?1:0),(t.y<<1)+(l?1:0),Math.round(63*e)+128,Math.round(63*r)+128,1+(c===0?0:c<0?-1:1)|(63&m)<<2,m>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var g=h.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,g),h.primitiveLength++),l?this.e2=g:this.e1=g},Xr.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Xr.prototype.updateDistance=function(t,e){this.distance+=t.dist(e),this.updateScaledDistance()},Pt("LineBucket",Xr,{omit:["layers","patternFeatures"]});var bf=new ti({"line-cap":new It(D.layout_line["line-cap"]),"line-join":new Xt(D.layout_line["line-join"]),"line-miter-limit":new It(D.layout_line["line-miter-limit"]),"line-round-limit":new It(D.layout_line["line-round-limit"]),"line-sort-key":new Xt(D.layout_line["line-sort-key"])}),ip={paint:new ti({"line-opacity":new Xt(D.paint_line["line-opacity"]),"line-color":new Xt(D.paint_line["line-color"]),"line-translate":new It(D.paint_line["line-translate"]),"line-translate-anchor":new It(D.paint_line["line-translate-anchor"]),"line-width":new Xt(D.paint_line["line-width"]),"line-gap-width":new Xt(D.paint_line["line-gap-width"]),"line-offset":new Xt(D.paint_line["line-offset"]),"line-blur":new Xt(D.paint_line["line-blur"]),"line-dasharray":new _i(D.paint_line["line-dasharray"]),"line-pattern":new $r(D.paint_line["line-pattern"]),"line-gradient":new Hi(D.paint_line["line-gradient"])}),layout:bf},np=new(function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(r,a){return a=new ye(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,zoomHistory:a.zoomHistory,transition:a.transition}),t.prototype.possiblyEvaluate.call(this,r,a)},e.prototype.evaluate=function(r,a,l,c){return a=He({},a,{zoom:Math.floor(a.zoom)}),t.prototype.evaluate.call(this,r,a,l,c)},e}(Xt))(ip.paint.properties["line-width"].specification);np.useIntegerZoom=!0;var wf=function(t){function e(r){t.call(this,r,ip),this.gradientVersion=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ki,this.gradientVersion=(this.gradientVersion+1)%mr)},e.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},e.prototype.recalculate=function(r,a){t.prototype.recalculate.call(this,r,a),this.paint._values["line-floorwidth"]=np.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)},e.prototype.createBucket=function(r){return new Xr(r)},e.prototype.queryRadius=function(r){var a=r,l=op(ar("line-width",this,a),ar("line-gap-width",this,a)),c=ar("line-offset",this,a);return l/2+Math.abs(c)+$i(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(r,a,l,c,h,m,g){var v=Di(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,g),x=g/2*op(this.paint.get("line-width").evaluate(a,l),this.paint.get("line-gap-width").evaluate(a,l)),b=this.paint.get("line-offset").evaluate(a,l);return b&&(c=function(T,A){for(var L=[],R=new Dt(0,0),W=0;W<T.length;W++){for(var q=T[W],Y=[],$=0;$<q.length;$++){var rt=q[$],it=q[$+1],ut=$===0?R:rt.sub(q[$-1])._unit()._perp(),gt=$===q.length-1?R:it.sub(rt)._unit()._perp(),bt=ut._add(gt)._unit();bt._mult(1/(bt.x*gt.x+bt.y*gt.y)),Y.push(bt._mult(A)._add(rt))}L.push(Y)}return L}(c,b*g)),function(T,A,L){for(var R=0;R<A.length;R++){var W=A[R];if(T.length>=3){for(var q=0;q<W.length;q++)if(Ni(T,W[q]))return!0}if(ll(T,W,L))return!0}return!1}(v,c,x)},e.prototype.isTileClipped=function(){return!0},e}(xi);function op(t,e){return e>0?e+2*t:t}var Sf=_r([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Tf=_r([{name:"a_projected_pos",components:3,type:"Float32"}],4),If=(_r([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),_r([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),ap=(_r([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),_r([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Ef=_r([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Af(t,e,r){return t.sections.forEach(function(a){a.text=function(l,c,h){var m=c.layout.get("text-transform").evaluate(h,{});return m==="uppercase"?l=l.toLocaleUpperCase():m==="lowercase"&&(l=l.toLocaleLowerCase()),Ue.applyArabicShaping&&(l=Ue.applyArabicShaping(l)),l}(a.text,e,r)}),t}_r([{name:"triangle",components:3,type:"Uint16"}]),_r([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),_r([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),_r([{type:"Float32",name:"offsetX"}]),_r([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var ml={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},sp=function(t,e,r,a,l){var c,h,m=8*l-a-1,g=(1<<m)-1,v=g>>1,x=-7,b=r?l-1:0,T=r?-1:1,A=t[e+b];for(b+=T,c=A&(1<<-x)-1,A>>=-x,x+=m;x>0;c=256*c+t[e+b],b+=T,x-=8);for(h=c&(1<<-x)-1,c>>=-x,x+=a;x>0;h=256*h+t[e+b],b+=T,x-=8);if(c===0)c=1-v;else{if(c===g)return h?NaN:1/0*(A?-1:1);h+=Math.pow(2,a),c-=v}return(A?-1:1)*h*Math.pow(2,c-a)},lp=function(t,e,r,a,l,c){var h,m,g,v=8*c-l-1,x=(1<<v)-1,b=x>>1,T=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,A=a?0:c-1,L=a?1:-1,R=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(m=isNaN(e)?1:0,h=x):(h=Math.floor(Math.log(e)/Math.LN2),e*(g=Math.pow(2,-h))<1&&(h--,g*=2),(e+=h+b>=1?T/g:T*Math.pow(2,1-b))*g>=2&&(h++,g/=2),h+b>=x?(m=0,h=x):h+b>=1?(m=(e*g-1)*Math.pow(2,l),h+=b):(m=e*Math.pow(2,b-1)*Math.pow(2,l),h=0));l>=8;t[r+A]=255&m,A+=L,m/=256,l-=8);for(h=h<<l|m,v+=l;v>0;t[r+A]=255&h,A+=L,h/=256,v-=8);t[r+A-L]|=128*R},fu=ke;function ke(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}ke.Varint=0,ke.Fixed64=1,ke.Bytes=2,ke.Fixed32=5;var up=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function io(t){return t.type===ke.Bytes?t.readVarint()+t.pos:t.pos+1}function ls(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function cp(t,e,r){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(a);for(var l=r.pos-1;l>=t;l--)r.buf[l+a]=r.buf[l]}function Pf(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function zf(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function kf(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function Cf(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function Mf(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function Df(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function Lf(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function Rf(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function Bf(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function du(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function us(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function pp(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function Of(t,e,r){t===1&&r.readMessage(Ff,e)}function Ff(t,e,r){if(t===3){var a=r.readMessage(Uf,{}),l=a.width,c=a.height,h=a.left,m=a.top,g=a.advance;e.push({id:a.id,bitmap:new da({width:l+6,height:c+6},a.bitmap),metrics:{width:l,height:c,left:h,top:m,advance:g}})}}function Uf(t,e,r){t===1?e.id=r.readVarint():t===2?e.bitmap=r.readBytes():t===3?e.width=r.readVarint():t===4?e.height=r.readVarint():t===5?e.left=r.readSVarint():t===6?e.top=r.readSVarint():t===7&&(e.advance=r.readVarint())}function hp(t){for(var e=0,r=0,a=0,l=t;a<l.length;a+=1){var c=l[a];e+=c.w*c.h,r=Math.max(r,c.w)}t.sort(function(R,W){return W.h-R.h});for(var h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}],m=0,g=0,v=0,x=t;v<x.length;v+=1)for(var b=x[v],T=h.length-1;T>=0;T--){var A=h[T];if(!(b.w>A.w||b.h>A.h)){if(b.x=A.x,b.y=A.y,g=Math.max(g,b.y+b.h),m=Math.max(m,b.x+b.w),b.w===A.w&&b.h===A.h){var L=h.pop();T<h.length&&(h[T]=L)}else b.h===A.h?(A.x+=b.w,A.w-=b.w):b.w===A.w?(A.y+=b.h,A.h-=b.h):(h.push({x:A.x+b.w,y:A.y,w:A.w-b.w,h:b.h}),A.y+=b.h,A.h-=b.h);break}}return{w:m,h:g,fill:e/(m*g)||0}}ke.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),l=a>>3,c=this.pos;this.type=7&a,t(l,e,this),this.pos===c&&this.skip(a)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=du(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=pp(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=du(this.buf,this.pos)+4294967296*du(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=du(this.buf,this.pos)+4294967296*pp(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=sp(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=sp(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,a=this.buf;return e=127&(r=a[this.pos++]),r<128?e:(e|=(127&(r=a[this.pos++]))<<7,r<128?e:(e|=(127&(r=a[this.pos++]))<<14,r<128?e:(e|=(127&(r=a[this.pos++]))<<21,r<128?e:function(l,c,h){var m,g,v=h.buf;if(m=(112&(g=v[h.pos++]))>>4,g<128||(m|=(127&(g=v[h.pos++]))<<3,g<128)||(m|=(127&(g=v[h.pos++]))<<10,g<128)||(m|=(127&(g=v[h.pos++]))<<17,g<128)||(m|=(127&(g=v[h.pos++]))<<24,g<128)||(m|=(1&(g=v[h.pos++]))<<31,g<128))return ls(l,m,c);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=a[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&up?function(r,a,l){return up.decode(r.subarray(a,l))}(this.buf,e,t):function(r,a,l){for(var c="",h=a;h<l;){var m,g,v,x=r[h],b=null,T=x>239?4:x>223?3:x>191?2:1;if(h+T>l)break;T===1?x<128&&(b=x):T===2?(192&(m=r[h+1]))==128&&(b=(31&x)<<6|63&m)<=127&&(b=null):T===3?(g=r[h+2],(192&(m=r[h+1]))==128&&(192&g)==128&&((b=(15&x)<<12|(63&m)<<6|63&g)<=2047||b>=55296&&b<=57343)&&(b=null)):T===4&&(g=r[h+2],v=r[h+3],(192&(m=r[h+1]))==128&&(192&g)==128&&(192&v)==128&&((b=(15&x)<<18|(63&m)<<12|(63&g)<<6|63&v)<=65535||b>=1114112)&&(b=null)),b===null?(b=65533,T=1):b>65535&&(b-=65536,c+=String.fromCharCode(b>>>10&1023|55296),b=56320|1023&b),c+=String.fromCharCode(b),h+=T}return c}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==ke.Bytes)return t.push(this.readVarint(e));var r=io(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==ke.Bytes)return t.push(this.readSVarint());var e=io(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==ke.Bytes)return t.push(this.readBoolean());var e=io(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==ke.Bytes)return t.push(this.readFloat());var e=io(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==ke.Bytes)return t.push(this.readDouble());var e=io(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==ke.Bytes)return t.push(this.readFixed32());var e=io(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==ke.Bytes)return t.push(this.readSFixed32());var e=io(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==ke.Bytes)return t.push(this.readFixed64());var e=io(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==ke.Bytes)return t.push(this.readSFixed64());var e=io(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===ke.Varint)for(;this.buf[this.pos++]>127;);else if(e===ke.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ke.Fixed32)this.pos+=4;else{if(e!==ke.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),us(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),us(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),us(this.buf,-1&t,this.pos),us(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),us(this.buf,-1&t,this.pos),us(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,r){var a,l;if(e>=0?(a=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(c,h,m){m.buf[m.pos++]=127&c|128,c>>>=7,m.buf[m.pos++]=127&c|128,c>>>=7,m.buf[m.pos++]=127&c|128,c>>>=7,m.buf[m.pos++]=127&c|128,m.buf[m.pos]=127&(c>>>=7)}(a,0,r),function(c,h){var m=(7&c)<<4;h.buf[h.pos++]|=m|((c>>>=3)?128:0),c&&(h.buf[h.pos++]=127&c|((c>>>=7)?128:0),c&&(h.buf[h.pos++]=127&c|((c>>>=7)?128:0),c&&(h.buf[h.pos++]=127&c|((c>>>=7)?128:0),c&&(h.buf[h.pos++]=127&c|((c>>>=7)?128:0),c&&(h.buf[h.pos++]=127&c)))))}(l,r)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(a,l,c){for(var h,m,g=0;g<l.length;g++){if((h=l.charCodeAt(g))>55295&&h<57344){if(!m){h>56319||g+1===l.length?(a[c++]=239,a[c++]=191,a[c++]=189):m=h;continue}if(h<56320){a[c++]=239,a[c++]=191,a[c++]=189,m=h;continue}h=m-55296<<10|h-56320|65536,m=null}else m&&(a[c++]=239,a[c++]=191,a[c++]=189,m=null);h<128?a[c++]=h:(h<2048?a[c++]=h>>6|192:(h<65536?a[c++]=h>>12|224:(a[c++]=h>>18|240,a[c++]=h>>12&63|128),a[c++]=h>>6&63|128),a[c++]=63&h|128)}return c}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&cp(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),lp(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),lp(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var a=this.pos-r;a>=128&&cp(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(t,e,r){this.writeTag(t,ke.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Pf,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,zf,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Mf,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,kf,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Cf,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Df,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Lf,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Rf,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Bf,e)},writeBytesField:function(t,e){this.writeTag(t,ke.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,ke.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,ke.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,ke.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,ke.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,ke.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,ke.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,ke.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,ke.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,ke.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var mu=function(t,e){var r=e.pixelRatio,a=e.version,l=e.stretchX,c=e.stretchY,h=e.content;this.paddedRect=t,this.pixelRatio=r,this.stretchX=l,this.stretchY=c,this.content=h,this.version=a},yl={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};yl.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},yl.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},yl.tlbr.get=function(){return this.tl.concat(this.br)},yl.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(mu.prototype,yl);var gl=function(t,e){var r={},a={};this.haveRenderCallbacks=[];var l=[];this.addImages(t,r,l),this.addImages(e,a,l);var c=hp(l),h=new ri({width:c.w||1,height:c.h||1});for(var m in t){var g=t[m],v=r[m].paddedRect;ri.copy(g.data,h,{x:0,y:0},{x:v.x+1,y:v.y+1},g.data)}for(var x in e){var b=e[x],T=a[x].paddedRect,A=T.x+1,L=T.y+1,R=b.data.width,W=b.data.height;ri.copy(b.data,h,{x:0,y:0},{x:A,y:L},b.data),ri.copy(b.data,h,{x:0,y:W-1},{x:A,y:L-1},{width:R,height:1}),ri.copy(b.data,h,{x:0,y:0},{x:A,y:L+W},{width:R,height:1}),ri.copy(b.data,h,{x:R-1,y:0},{x:A-1,y:L},{width:1,height:W}),ri.copy(b.data,h,{x:0,y:0},{x:A+R,y:L},{width:1,height:W})}this.image=h,this.iconPositions=r,this.patternPositions=a};gl.prototype.addImages=function(t,e,r){for(var a in t){var l=t[a],c={x:0,y:0,w:l.data.width+2,h:l.data.height+2};r.push(c),e[a]=new mu(c,l),l.hasRenderCallback&&this.haveRenderCallbacks.push(a)}},gl.prototype.patchUpdatedImages=function(t,e){for(var r in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[r],t.getImage(r),e),this.patchUpdatedImage(this.patternPositions[r],t.getImage(r),e)},gl.prototype.patchUpdatedImage=function(t,e,r){if(t&&e&&t.version!==e.version){t.version=e.version;var a=t.tl;r.update(e.data,void 0,{x:a[0],y:a[1]})}},Pt("ImagePosition",mu),Pt("ImageAtlas",gl);var bi={horizontal:1,vertical:2,horizontalOnly:3},cs=function(){this.scale=1,this.fontStack="",this.imageName=null};cs.forText=function(t,e){var r=new cs;return r.scale=t||1,r.fontStack=e,r},cs.forImage=function(t){var e=new cs;return e.imageName=t,e};var Or=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function yu(t,e,r,a,l,c,h,m,g,v,x,b,T,A,L,R){var W,q=Or.fromFeature(t,l);b===bi.vertical&&q.verticalizePunctuation();var Y=Ue.processBidirectionalText,$=Ue.processStyledBidirectionalText;if(Y&&q.sections.length===1){W=[];for(var rt=0,it=Y(q.toString(),dc(q,v,c,e,a,A,L));rt<it.length;rt+=1){var ut=it[rt],gt=new Or;gt.text=ut,gt.sections=q.sections;for(var bt=0;bt<ut.length;bt++)gt.sectionIndex.push(0);W.push(gt)}}else if($){W=[];for(var Bt=0,St=$(q.text,q.sectionIndex,dc(q,v,c,e,a,A,L));Bt<St.length;Bt+=1){var Ut=St[Bt],Tt=new Or;Tt.text=Ut[0],Tt.sectionIndex=Ut[1],Tt.sections=q.sections,W.push(Tt)}}else W=function(Rt,ne){for(var te=[],ue=Rt.text,jt=0,de=0,Oe=ne;de<Oe.length;de+=1){var Ge=Oe[de];te.push(Rt.substring(jt,Ge)),jt=Ge}return jt<ue.length&&te.push(Rt.substring(jt,ue.length)),te}(q,dc(q,v,c,e,a,A,L));var ee=[],Gt={positionedLines:ee,text:q.toString(),top:x[1],bottom:x[1],left:x[0],right:x[0],writingMode:b,iconsInText:!1,verticalizable:!1};return function(Rt,ne,te,ue,jt,de,Oe,Ge,je,Fe,Xe,fr){for(var dr=0,Fr=-17,br=0,Ur=0,$e=Ge==="right"?1:Ge==="left"?0:.5,wr=0,ae=0,Se=jt;ae<Se.length;ae+=1){var ge=Se[ae];ge.trim();var fe=ge.getMaxScale(),Wr=24*(fe-1),Pr={positionedGlyphs:[],lineOffset:0};Rt.positionedLines[wr]=Pr;var Me=Pr.positionedGlyphs,nr=0;if(ge.length()){for(var zr=0;zr<ge.length();zr++){var me=ge.getSection(zr),Tn=ge.getSectionIndex(zr),wi=ge.getCharCode(zr),In=0,tr=null,En=null,ji=null,vs=24,va=!(je===bi.horizontal||!Xe&&!Ja(wi)||Xe&&(gu[wi]||(so=wi,kt.Arabic(so)||kt["Arabic Supplement"](so)||kt["Arabic Extended-A"](so)||kt["Arabic Presentation Forms-A"](so)||kt["Arabic Presentation Forms-B"](so))));if(me.imageName){var _s=ue[me.imageName];if(!_s)continue;ji=me.imageName,Rt.iconsInText=Rt.iconsInText||!0,En=_s.paddedRect;var ao=_s.displaySize;me.scale=24*me.scale/fr,In=Wr+(24-ao[1]*me.scale),vs=(tr={width:ao[0],height:ao[1],left:1,top:-3,advance:va?ao[1]:ao[0]}).advance;var xs=va?ao[0]*me.scale-24*fe:ao[1]*me.scale-24*fe;xs>0&&xs>nr&&(nr=xs)}else{var Eu=te[me.fontStack],bs=Eu&&Eu[wi];if(bs&&bs.rect)En=bs.rect,tr=bs.metrics;else{var xl=ne[me.fontStack],Au=xl&&xl[wi];if(!Au)continue;tr=Au.metrics}In=24*(fe-me.scale)}va?(Rt.verticalizable=!0,Me.push({glyph:wi,imageName:ji,x:dr,y:Fr+In,vertical:va,scale:me.scale,fontStack:me.fontStack,sectionIndex:Tn,metrics:tr,rect:En}),dr+=vs*me.scale+Fe):(Me.push({glyph:wi,imageName:ji,x:dr,y:Fr+In,vertical:va,scale:me.scale,fontStack:me.fontStack,sectionIndex:Tn,metrics:tr,rect:En}),dr+=tr.advance*me.scale+Fe)}Me.length!==0&&(br=Math.max(dr-Fe,br),Nf(Me,0,Me.length-1,$e,nr)),dr=0;var Pu=de*fe+nr;Pr.lineOffset=Math.max(nr,Wr),Fr+=Pu,Ur=Math.max(Pu,Ur),++wr}else Fr+=de,++wr}var so,bl=Fr- -17,ws=mc(Oe),Oo=ws.horizontalAlign,Ss=ws.verticalAlign;(function(zu,ku,wl,Sl,Cu,Tl,Il,El,Mu){var Ts,Du=(ku-wl)*Cu;Ts=Tl!==Il?-El*Sl- -17:(-Sl*Mu+.5)*Il;for(var Is=0,Al=zu;Is<Al.length;Is+=1)for(var _a=0,Pl=Al[Is].positionedGlyphs;_a<Pl.length;_a+=1){var Es=Pl[_a];Es.x+=Du,Es.y+=Ts}})(Rt.positionedLines,$e,Oo,Ss,br,Ur,de,bl,jt.length),Rt.top+=-Ss*bl,Rt.bottom=Rt.top+bl,Rt.left+=-Oo*br,Rt.right=Rt.left+br}(Gt,e,r,a,W,h,m,g,b,v,T,R),!function(Rt){for(var ne=0,te=Rt;ne<te.length;ne+=1)if(te[ne].positionedGlyphs.length!==0)return!1;return!0}(ee)&&Gt}Or.fromFeature=function(t,e){for(var r=new Or,a=0;a<t.sections.length;a++){var l=t.sections[a];l.image?r.addImageSection(l):r.addTextSection(l,e)}return r},Or.prototype.length=function(){return this.text.length},Or.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Or.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Or.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Or.prototype.verticalizePunctuation=function(){this.text=function(t){for(var e="",r=0;r<t.length;r++){var a=t.charCodeAt(r+1)||null,l=t.charCodeAt(r-1)||null;e+=a&&gi(a)&&!ml[t[r+1]]||l&&gi(l)&&!ml[t[r-1]]||!ml[t[r]]?t[r]:ml[t[r]]}return e}(this.text)},Or.prototype.trim=function(){for(var t=0,e=0;e<this.text.length&&gu[this.text.charCodeAt(e)];e++)t++;for(var r=this.text.length,a=this.text.length-1;a>=0&&a>=t&&gu[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)},Or.prototype.substring=function(t,e){var r=new Or;return r.text=this.text.substring(t,e),r.sectionIndex=this.sectionIndex.slice(t,e),r.sections=this.sections,r},Or.prototype.toString=function(){return this.text},Or.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(e,r){return Math.max(e,t.sections[r].scale)},0)},Or.prototype.addTextSection=function(t,e){this.text+=t.text,this.sections.push(cs.forText(t.scale,t.fontStack||e));for(var r=this.sections.length-1,a=0;a<t.text.length;++a)this.sectionIndex.push(r)},Or.prototype.addImageSection=function(t){var e=t.image?t.image.name:"";if(e.length!==0){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(cs.forImage(e)),this.sectionIndex.push(this.sections.length-1)):qe("Reached maximum number of images 6401")}else qe("Can't add FormattedSection with an empty image.")},Or.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var gu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ci={};function fp(t,e,r,a,l,c){if(e.imageName){var h=a[e.imageName];return h?h.displaySize[0]*e.scale*24/c+l:0}var m=r[e.fontStack],g=m&&m[t];return g?g.metrics.advance*e.scale+l:0}function dp(t,e,r,a){var l=Math.pow(t-e,2);return a?t<e?l/2:2*l:l+Math.abs(r)*r}function Vf(t,e,r){var a=0;return t===10&&(a-=1e4),r&&(a+=150),t!==40&&t!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function mp(t,e,r,a,l,c){for(var h=null,m=dp(e,r,l,c),g=0,v=a;g<v.length;g+=1){var x=v[g],b=dp(e-x.x,r,l,c)+x.badness;b<=m&&(h=x,m=b)}return{index:t,x:e,priorBreak:h,badness:m}}function dc(t,e,r,a,l,c,h){if(c!=="point")return[];if(!t)return[];for(var m,g=[],v=function(W,q,Y,$,rt,it){for(var ut=0,gt=0;gt<W.length();gt++){var bt=W.getSection(gt);ut+=fp(W.getCharCode(gt),bt,$,rt,q,it)}return ut/Math.max(1,Math.ceil(ut/Y))}(t,e,r,a,l,h),x=t.text.indexOf("\u200B")>=0,b=0,T=0;T<t.length();T++){var A=t.getSection(T),L=t.getCharCode(T);if(gu[L]||(b+=fp(L,A,a,l,e,h)),T<t.length()-1){var R=!((m=L)<11904||!(kt["Bopomofo Extended"](m)||kt.Bopomofo(m)||kt["CJK Compatibility Forms"](m)||kt["CJK Compatibility Ideographs"](m)||kt["CJK Compatibility"](m)||kt["CJK Radicals Supplement"](m)||kt["CJK Strokes"](m)||kt["CJK Symbols and Punctuation"](m)||kt["CJK Unified Ideographs Extension A"](m)||kt["CJK Unified Ideographs"](m)||kt["Enclosed CJK Letters and Months"](m)||kt["Halfwidth and Fullwidth Forms"](m)||kt.Hiragana(m)||kt["Ideographic Description Characters"](m)||kt["Kangxi Radicals"](m)||kt["Katakana Phonetic Extensions"](m)||kt.Katakana(m)||kt["Vertical Forms"](m)||kt["Yi Radicals"](m)||kt["Yi Syllables"](m)));(ci[L]||R||A.imageName)&&g.push(mp(T+1,b,v,g,Vf(L,t.getCharCode(T+1),R&&x),!1))}}return function W(q){return q?W(q.priorBreak).concat(q.index):[]}(mp(t.length(),b,v,g,0,!0))}function mc(t){var e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Nf(t,e,r,a,l){if(a||l)for(var c=t[r],h=(t[r].x+c.metrics.advance*c.scale)*a,m=e;m<=r;m++)t[m].x-=h,t[m].y+=l}function yp(t,e,r,a,l,c){var h,m=t.image;if(m.content){var g=m.content,v=m.pixelRatio||1;h=[g[0]/v,g[1]/v,m.displaySize[0]-g[2]/v,m.displaySize[1]-g[3]/v]}var x,b,T,A,L=e.left*c,R=e.right*c;r==="width"||r==="both"?(A=l[0]+L-a[3],b=l[0]+R+a[1]):b=(A=l[0]+(L+R-m.displaySize[0])/2)+m.displaySize[0];var W=e.top*c,q=e.bottom*c;return r==="height"||r==="both"?(x=l[1]+W-a[0],T=l[1]+q+a[2]):T=(x=l[1]+(W+q-m.displaySize[1])/2)+m.displaySize[1],{image:m,top:x,right:b,bottom:T,left:A,collisionPadding:h}}ci[10]=!0,ci[32]=!0,ci[38]=!0,ci[40]=!0,ci[41]=!0,ci[43]=!0,ci[45]=!0,ci[47]=!0,ci[173]=!0,ci[183]=!0,ci[8203]=!0,ci[8208]=!0,ci[8211]=!0,ci[8231]=!0;var ps=function(t){function e(r,a,l,c){t.call(this,r,a),this.angle=l,c!==void 0&&(this.segment=c)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(Dt);function yc(t,e){var r=e.expression;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new ye(t+1))};if(r.kind==="source")return{kind:"source"};for(var a=r.zoomStops,l=r.interpolationType,c=0;c<a.length&&a[c]<=t;)c++;for(var h=c=Math.max(0,c-1);h<a.length&&a[h]<t+1;)h++;h=Math.min(a.length-1,h);var m=a[c],g=a[h];return r.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:g,interpolationType:l}:{kind:"camera",minZoom:m,maxZoom:g,minSize:r.evaluate(new ye(m)),maxSize:r.evaluate(new ye(g)),interpolationType:l}}function gp(t,e,r){var a=e.uSize,l=r.lowerSize;return t.kind==="source"?l/128:t.kind==="composite"?ir(l/128,r.upperSize/128,e.uSizeT):a}function vp(t,e){var r=0,a=0;if(t.kind==="constant")a=t.layoutSize;else if(t.kind!=="source"){var l=t.interpolationType,c=l?Tr(Sr.interpolationFactor(l,e,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?a=ir(t.minSize,t.maxSize,c):r=c}return{uSizeT:r,uSize:a}}Pt("Anchor",ps);var jf=Object.freeze({__proto__:null,getSizeData:yc,evaluateSizeForFeature:gp,evaluateSizeForZoom:vp,SIZE_PACK_FACTOR:128});function _p(t,e,r,a,l){if(e.segment===void 0)return!0;for(var c=e,h=e.segment+1,m=0;m>-r/2;){if(--h<0)return!1;m-=t[h].dist(c),c=t[h]}m+=t[h].dist(t[h+1]),h++;for(var g=[],v=0;m<r/2;){var x=t[h],b=t[h+1];if(!b)return!1;var T=t[h-1].angleTo(x)-x.angleTo(b);for(T=Math.abs((T+3*Math.PI)%(2*Math.PI)-Math.PI),g.push({distance:m,angleDelta:T}),v+=T;m-g[0].distance>a;)v-=g.shift().angleDelta;if(v>l)return!1;h++,m+=x.dist(b)}return!0}function xp(t){for(var e=0,r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function bp(t,e,r){return t?.6*e*r:0}function wp(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function qf(t,e,r,a,l,c){for(var h=bp(r,l,c),m=wp(r,a)*c,g=0,v=xp(t)/2,x=0;x<t.length-1;x++){var b=t[x],T=t[x+1],A=b.dist(T);if(g+A>v){var L=(v-g)/A,R=ir(b.x,T.x,L),W=ir(b.y,T.y,L),q=new ps(R,W,T.angleTo(b),x);return q._round(),!h||_p(t,q,m,h,e)?q:void 0}g+=A}}function Zf(t,e,r,a,l,c,h,m,g){var v=bp(a,c,h),x=wp(a,l),b=x*h,T=t[0].x===0||t[0].x===g||t[0].y===0||t[0].y===g;return e-b<e/4&&(e=b+e/4),function A(L,R,W,q,Y,$,rt,it,ut){for(var gt=$/2,bt=xp(L),Bt=0,St=R-W,Ut=[],Tt=0;Tt<L.length-1;Tt++){for(var ee=L[Tt],Gt=L[Tt+1],Rt=ee.dist(Gt),ne=Gt.angleTo(ee);St+W<Bt+Rt;){var te=((St+=W)-Bt)/Rt,ue=ir(ee.x,Gt.x,te),jt=ir(ee.y,Gt.y,te);if(ue>=0&&ue<ut&&jt>=0&&jt<ut&&St-gt>=0&&St+gt<=bt){var de=new ps(ue,jt,ne,Tt);de._round(),q&&!_p(L,de,$,q,Y)||Ut.push(de)}}Bt+=Rt}return it||Ut.length||rt||(Ut=A(L,Bt/2,W,q,Y,$,rt,!0,ut)),Ut}(t,T?e/2*m%e:(x/2+2*c)*h*m%e,e,v,r,b,T,!1,g)}function Sp(t,e,r,a,l){for(var c=[],h=0;h<t.length;h++)for(var m=t[h],g=void 0,v=0;v<m.length-1;v++){var x=m[v],b=m[v+1];x.x<e&&b.x<e||(x.x<e?x=new Dt(e,x.y+(e-x.x)/(b.x-x.x)*(b.y-x.y))._round():b.x<e&&(b=new Dt(e,x.y+(e-x.x)/(b.x-x.x)*(b.y-x.y))._round()),x.y<r&&b.y<r||(x.y<r?x=new Dt(x.x+(r-x.y)/(b.y-x.y)*(b.x-x.x),r)._round():b.y<r&&(b=new Dt(x.x+(r-x.y)/(b.y-x.y)*(b.x-x.x),r)._round()),x.x>=a&&b.x>=a||(x.x>=a?x=new Dt(a,x.y+(a-x.x)/(b.x-x.x)*(b.y-x.y))._round():b.x>=a&&(b=new Dt(a,x.y+(a-x.x)/(b.x-x.x)*(b.y-x.y))._round()),x.y>=l&&b.y>=l||(x.y>=l?x=new Dt(x.x+(l-x.y)/(b.y-x.y)*(b.x-x.x),l)._round():b.y>=l&&(b=new Dt(x.x+(l-x.y)/(b.y-x.y)*(b.x-x.x),l)._round()),g&&x.equals(g[g.length-1])||c.push(g=[x]),g.push(b)))))}return c}function Tp(t,e,r,a){var l=[],c=t.image,h=c.pixelRatio,m=c.paddedRect.w-2,g=c.paddedRect.h-2,v=t.right-t.left,x=t.bottom-t.top,b=c.stretchX||[[0,m]],T=c.stretchY||[[0,g]],A=function(ue,jt){return ue+jt[1]-jt[0]},L=b.reduce(A,0),R=T.reduce(A,0),W=m-L,q=g-R,Y=0,$=L,rt=0,it=R,ut=0,gt=W,bt=0,Bt=q;if(c.content&&a){var St=c.content;Y=vu(b,0,St[0]),rt=vu(T,0,St[1]),$=vu(b,St[0],St[2]),it=vu(T,St[1],St[3]),ut=St[0]-Y,bt=St[1]-rt,gt=St[2]-St[0]-$,Bt=St[3]-St[1]-it}var Ut=function(ue,jt,de,Oe){var Ge=_u(ue.stretch-Y,$,v,t.left),je=xu(ue.fixed-ut,gt,ue.stretch,L),Fe=_u(jt.stretch-rt,it,x,t.top),Xe=xu(jt.fixed-bt,Bt,jt.stretch,R),fr=_u(de.stretch-Y,$,v,t.left),dr=xu(de.fixed-ut,gt,de.stretch,L),Fr=_u(Oe.stretch-rt,it,x,t.top),br=xu(Oe.fixed-bt,Bt,Oe.stretch,R),Ur=new Dt(Ge,Fe),$e=new Dt(fr,Fe),wr=new Dt(fr,Fr),ae=new Dt(Ge,Fr),Se=new Dt(je/h,Xe/h),ge=new Dt(dr/h,br/h),fe=e*Math.PI/180;if(fe){var Wr=Math.sin(fe),Pr=Math.cos(fe),Me=[Pr,-Wr,Wr,Pr];Ur._matMult(Me),$e._matMult(Me),ae._matMult(Me),wr._matMult(Me)}var nr=ue.stretch+ue.fixed,zr=jt.stretch+jt.fixed;return{tl:Ur,tr:$e,bl:ae,br:wr,tex:{x:c.paddedRect.x+1+nr,y:c.paddedRect.y+1+zr,w:de.stretch+de.fixed-nr,h:Oe.stretch+Oe.fixed-zr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Se,pixelOffsetBR:ge,minFontScaleX:gt/h/v,minFontScaleY:Bt/h/x,isSDF:r}};if(a&&(c.stretchX||c.stretchY))for(var Tt=Ip(b,W,L),ee=Ip(T,q,R),Gt=0;Gt<Tt.length-1;Gt++)for(var Rt=Tt[Gt],ne=Tt[Gt+1],te=0;te<ee.length-1;te++)l.push(Ut(Rt,ee[te],ne,ee[te+1]));else l.push(Ut({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:g+1}));return l}function vu(t,e,r){for(var a=0,l=0,c=t;l<c.length;l+=1){var h=c[l];a+=Math.max(e,Math.min(r,h[1]))-Math.max(e,Math.min(r,h[0]))}return a}function Ip(t,e,r){for(var a=[{fixed:-1,stretch:0}],l=0,c=t;l<c.length;l+=1){var h=c[l],m=h[0],g=h[1],v=a[a.length-1];a.push({fixed:m-v.stretch,stretch:v.stretch}),a.push({fixed:m-v.stretch,stretch:v.stretch+(g-m)})}return a.push({fixed:e+1,stretch:r}),a}function _u(t,e,r,a){return t/e*r+a}function xu(t,e,r,a){return t-e*r/a}var bu=function(t,e,r,a,l,c,h,m,g,v){if(this.boxStartIndex=t.length,g){var x=c.top,b=c.bottom,T=c.collisionPadding;T&&(x-=T[1],b+=T[3]);var A=b-x;A>0&&(A=Math.max(10,A),this.circleDiameter=A)}else{var L=c.top*h-m,R=c.bottom*h+m,W=c.left*h-m,q=c.right*h+m,Y=c.collisionPadding;if(Y&&(W-=Y[0]*h,L-=Y[1]*h,q+=Y[2]*h,R+=Y[3]*h),v){var $=new Dt(W,L),rt=new Dt(q,L),it=new Dt(W,R),ut=new Dt(q,R),gt=v*Math.PI/180;$._rotate(gt),rt._rotate(gt),it._rotate(gt),ut._rotate(gt),W=Math.min($.x,rt.x,it.x,ut.x),q=Math.max($.x,rt.x,it.x,ut.x),L=Math.min($.y,rt.y,it.y,ut.y),R=Math.max($.y,rt.y,it.y,ut.y)}t.emplaceBack(e.x,e.y,W,L,q,R,r,a,l)}this.boxEndIndex=t.length},hs=function(t,e){if(t===void 0&&(t=[]),e===void 0&&(e=Gf),this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function Gf(t,e){return t<e?-1:t>e?1:0}function Xf(t,e,r){e===void 0&&(e=1),r===void 0&&(r=!1);for(var a=1/0,l=1/0,c=-1/0,h=-1/0,m=t[0],g=0;g<m.length;g++){var v=m[g];(!g||v.x<a)&&(a=v.x),(!g||v.y<l)&&(l=v.y),(!g||v.x>c)&&(c=v.x),(!g||v.y>h)&&(h=v.y)}var x=Math.min(c-a,h-l),b=x/2,T=new hs([],Wf);if(x===0)return new Dt(a,l);for(var A=a;A<c;A+=x)for(var L=l;L<h;L+=x)T.push(new fs(A+b,L+b,b,t));for(var R=function(Y){for(var $=0,rt=0,it=0,ut=Y[0],gt=0,bt=ut.length,Bt=bt-1;gt<bt;Bt=gt++){var St=ut[gt],Ut=ut[Bt],Tt=St.x*Ut.y-Ut.x*St.y;rt+=(St.x+Ut.x)*Tt,it+=(St.y+Ut.y)*Tt,$+=3*Tt}return new fs(rt/$,it/$,0,Y)}(t),W=T.length;T.length;){var q=T.pop();(q.d>R.d||!R.d)&&(R=q,r&&console.log("found best %d after %d probes",Math.round(1e4*q.d)/1e4,W)),q.max-R.d<=e||(T.push(new fs(q.p.x-(b=q.h/2),q.p.y-b,b,t)),T.push(new fs(q.p.x+b,q.p.y-b,b,t)),T.push(new fs(q.p.x-b,q.p.y+b,b,t)),T.push(new fs(q.p.x+b,q.p.y+b,b,t)),W+=4)}return r&&(console.log("num probes: "+W),console.log("best distance: "+R.d)),R.p}function Wf(t,e){return e.max-t.max}function fs(t,e,r,a){this.p=new Dt(t,e),this.h=r,this.d=function(l,c){for(var h=!1,m=1/0,g=0;g<c.length;g++)for(var v=c[g],x=0,b=v.length,T=b-1;x<b;T=x++){var A=v[x],L=v[T];A.y>l.y!=L.y>l.y&&l.x<(L.x-A.x)*(l.y-A.y)/(L.y-A.y)+A.x&&(h=!h),m=Math.min(m,ca(l,A,L))}return(h?1:-1)*Math.sqrt(m)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}hs.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},hs.prototype.pop=function(){if(this.length!==0){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}},hs.prototype.peek=function(){return this.data[0]},hs.prototype._up=function(t){for(var e=this.data,r=this.compare,a=e[t];t>0;){var l=t-1>>1,c=e[l];if(r(a,c)>=0)break;e[t]=c,t=l}e[t]=a},hs.prototype._down=function(t){for(var e=this.data,r=this.compare,a=this.length>>1,l=e[t];t<a;){var c=1+(t<<1),h=e[c],m=c+1;if(m<this.length&&r(e[m],h)<0&&(c=m,h=e[m]),r(h,l)>=0)break;e[t]=h,t=c}e[t]=l};var gc=Number.POSITIVE_INFINITY;function Ep(t,e){return e[1]!==gc?function(r,a,l){var c=0,h=0;switch(a=Math.abs(a),l=Math.abs(l),r){case"top-right":case"top-left":case"top":h=l-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-l}switch(r){case"top-right":case"bottom-right":case"right":c=-a;break;case"top-left":case"bottom-left":case"left":c=a}return[c,h]}(t,e[0],e[1]):function(r,a){var l=0,c=0;a<0&&(a=0);var h=a/Math.sqrt(2);switch(r){case"top-right":case"top-left":c=h-7;break;case"bottom-right":case"bottom-left":c=7-h;break;case"bottom":c=7-a;break;case"top":c=a-7}switch(r){case"top-right":case"bottom-right":l=-h;break;case"top-left":case"bottom-left":l=h;break;case"left":l=a;break;case"right":l=-a}return[l,c]}(t,e[0])}function vc(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ap(t,e,r,a,l,c,h,m,g,v,x,b,T,A,L){var R=function(rt,it,ut,gt,bt,Bt,St,Ut){for(var Tt=gt.layout.get("text-rotate").evaluate(Bt,{})*Math.PI/180,ee=[],Gt=0,Rt=it.positionedLines;Gt<Rt.length;Gt+=1)for(var ne=Rt[Gt],te=0,ue=ne.positionedGlyphs;te<ue.length;te+=1){var jt=ue[te];if(jt.rect){var de=jt.rect||{},Oe=4,Ge=!0,je=1,Fe=0,Xe=(bt||Ut)&&jt.vertical,fr=jt.metrics.advance*jt.scale/2;if(Ut&&it.verticalizable&&(Fe=ne.lineOffset/2-(jt.imageName?-(24-jt.metrics.width*jt.scale)/2:24*(jt.scale-1))),jt.imageName){var dr=St[jt.imageName];Ge=dr.sdf,Oe=1/(je=dr.pixelRatio)}var Fr=bt?[jt.x+fr,jt.y]:[0,0],br=bt?[0,0]:[jt.x+fr+ut[0],jt.y+ut[1]-Fe],Ur=[0,0];Xe&&(Ur=br,br=[0,0]);var $e=(jt.metrics.left-Oe)*jt.scale-fr+br[0],wr=(-jt.metrics.top-Oe)*jt.scale+br[1],ae=$e+de.w*jt.scale/je,Se=wr+de.h*jt.scale/je,ge=new Dt($e,wr),fe=new Dt(ae,wr),Wr=new Dt($e,Se),Pr=new Dt(ae,Se);if(Xe){var Me=new Dt(-fr,fr- -17),nr=-Math.PI/2,zr=12-fr,me=new Dt(22-zr,-(jt.imageName?zr:0)),Tn=new(Function.prototype.bind.apply(Dt,[null].concat(Ur)));ge._rotateAround(nr,Me)._add(me)._add(Tn),fe._rotateAround(nr,Me)._add(me)._add(Tn),Wr._rotateAround(nr,Me)._add(me)._add(Tn),Pr._rotateAround(nr,Me)._add(me)._add(Tn)}if(Tt){var wi=Math.sin(Tt),In=Math.cos(Tt),tr=[In,-wi,wi,In];ge._matMult(tr),fe._matMult(tr),Wr._matMult(tr),Pr._matMult(tr)}var En=new Dt(0,0),ji=new Dt(0,0);ee.push({tl:ge,tr:fe,bl:Wr,br:Pr,tex:de,writingMode:it.writingMode,glyphOffset:Fr,sectionIndex:jt.sectionIndex,isSDF:Ge,pixelOffsetTL:En,pixelOffsetBR:ji,minFontScaleX:0,minFontScaleY:0})}}return ee}(0,r,m,l,c,h,a,t.allowVerticalPlacement),W=t.textSizeData,q=null;W.kind==="source"?(q=[128*l.layout.get("text-size").evaluate(h,{})])[0]>32640&&qe(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):W.kind==="composite"&&((q=[128*A.compositeTextSizes[0].evaluate(h,{},L),128*A.compositeTextSizes[1].evaluate(h,{},L)])[0]>32640||q[1]>32640)&&qe(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,R,q,m,c,h,v,e,g.lineStartIndex,g.lineLength,T,L);for(var Y=0,$=x;Y<$.length;Y+=1)b[$[Y]]=t.text.placedSymbolArray.length-1;return 4*R.length}function Pp(t){for(var e in t)return t[e];return null}function Kf(t,e,r,a){var l=t.compareText;if(e in l){for(var c=l[e],h=c.length-1;h>=0;h--)if(a.dist(c[h])<r)return!0}else l[e]=[];return l[e].push(a),!1}var Hf=ss.VectorTileFeature.types,Jf=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function wu(t,e,r,a,l,c,h,m,g,v,x,b,T){var A=m?Math.min(32640,Math.round(m[0])):0,L=m?Math.min(32640,Math.round(m[1])):0;t.emplaceBack(e,r,Math.round(32*a),Math.round(32*l),c,h,(A<<1)+(g?1:0),L,16*v,16*x,256*b,256*T)}function _c(t,e,r){t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r)}function Yf(t){for(var e=0,r=t.sections;e<r.length;e+=1)if(au(r[e].text))return!0;return!1}var ds=function(t){this.layoutVertexArray=new Co,this.indexArray=new si,this.programConfigurations=t,this.segments=new z,this.dynamicLayoutVertexArray=new sa,this.opacityVertexArray=new il,this.placedSymbolArray=new p};ds.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},ds.prototype.upload=function(t,e,r,a){this.isEmpty()||(r&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Sf.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Tf.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Jf,!0),this.opacityVertexBuffer.itemSize=1),(r||a)&&this.programConfigurations.upload(t))},ds.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Pt("SymbolBuffers",ds);var vl=function(t,e,r){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new r,this.segments=new z,this.collisionVertexArray=new ol};vl.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,If.members,!0)},vl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Pt("CollisionBuffers",vl);var xe=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(c){return c.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Br([]),this.placementViewportMatrix=Br([]);var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=yc(this.zoom,e["text-size"]),this.iconSizeData=yc(this.zoom,e["icon-size"]);var r=this.layers[0].layout,a=r.get("symbol-sort-key"),l=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=l!=="viewport-y"&&!a.isConstant(),this.sortFeaturesByY=(l==="viewport-y"||l==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,r.get("symbol-placement")==="point"&&(this.writingModes=r.get("text-writing-mode").map(function(c){return bi[c]})),this.stateDependentLayerIds=this.layers.filter(function(c){return c.isStateDependent()}).map(function(c){return c.id}),this.sourceID=t.sourceID};xe.prototype.createArrays=function(){this.text=new ds(new we(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new ds(new we(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new y,this.lineVertexArray=new _,this.symbolInstances=new d},xe.prototype.calculateGlyphDependencies=function(t,e,r,a,l){for(var c=0;c<t.length;c++)if(e[t.charCodeAt(c)]=!0,(r||a)&&l){var h=ml[t.charAt(c)];h&&(e[h.charCodeAt(0)]=!0)}},xe.prototype.populate=function(t,e,r){var a=this.layers[0],l=a.layout,c=l.get("text-font"),h=l.get("text-field"),m=l.get("icon-image"),g=(h.value.kind!=="constant"||h.value.value instanceof yr&&!h.value.value.isEmpty()||h.value.value.toString().length>0)&&(c.value.kind!=="constant"||c.value.value.length>0),v=m.value.kind!=="constant"||!!m.value.value||Object.keys(m.parameters).length>0,x=l.get("symbol-sort-key");if(this.features=[],g||v){for(var b=e.iconDependencies,T=e.glyphDependencies,A=e.availableImages,L=new ye(this.zoom),R=0,W=t;R<W.length;R+=1){var q=W[R],Y=q.feature,$=q.id,rt=q.index,it=q.sourceLayerIndex,ut=a._featureFilter.needGeometry,gt=Ar(Y,ut);if(a._featureFilter.filter(L,gt,r)){ut||(gt.geometry=Ye(Y));var bt=void 0;if(g){var Bt=a.getValueAndResolveTokens("text-field",gt,r,A),St=yr.factory(Bt);Yf(St)&&(this.hasRTLText=!0),(!this.hasRTLText||Mi()==="unavailable"||this.hasRTLText&&Ue.isParsed())&&(bt=Af(St,a,gt))}var Ut=void 0;if(v){var Tt=a.getValueAndResolveTokens("icon-image",gt,r,A);Ut=Tt instanceof Vr?Tt:Vr.fromString(Tt)}if(bt||Ut){var ee=this.sortFeaturesByKey?x.evaluate(gt,{},r):void 0;if(this.features.push({id:$,text:bt,icon:Ut,index:rt,sourceLayerIndex:it,geometry:gt.geometry,properties:Y.properties,type:Hf[Y.type],sortKey:ee}),Ut&&(b[Ut.name]=!0),bt){var Gt=c.evaluate(gt,{},r).join(","),Rt=l.get("text-rotation-alignment")==="map"&&l.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(bi.vertical)>=0;for(var ne=0,te=bt.sections;ne<te.length;ne+=1){var ue=te[ne];if(ue.image)b[ue.image.name]=!0;else{var jt=Ha(bt.toString()),de=ue.fontStack||Gt,Oe=T[de]=T[de]||{};this.calculateGlyphDependencies(ue.text,Oe,Rt,this.allowVerticalPlacement,jt)}}}}}}l.get("symbol-placement")==="line"&&(this.features=function(Ge){var je={},Fe={},Xe=[],fr=0;function dr(Me){Xe.push(Ge[Me]),fr++}function Fr(Me,nr,zr){var me=Fe[Me];return delete Fe[Me],Fe[nr]=me,Xe[me].geometry[0].pop(),Xe[me].geometry[0]=Xe[me].geometry[0].concat(zr[0]),me}function br(Me,nr,zr){var me=je[nr];return delete je[nr],je[Me]=me,Xe[me].geometry[0].shift(),Xe[me].geometry[0]=zr[0].concat(Xe[me].geometry[0]),me}function Ur(Me,nr,zr){var me=zr?nr[0][nr[0].length-1]:nr[0][0];return Me+":"+me.x+":"+me.y}for(var $e=0;$e<Ge.length;$e++){var wr=Ge[$e],ae=wr.geometry,Se=wr.text?wr.text.toString():null;if(Se){var ge=Ur(Se,ae),fe=Ur(Se,ae,!0);if(ge in Fe&&fe in je&&Fe[ge]!==je[fe]){var Wr=br(ge,fe,ae),Pr=Fr(ge,fe,Xe[Wr].geometry);delete je[ge],delete Fe[fe],Fe[Ur(Se,Xe[Pr].geometry,!0)]=Pr,Xe[Wr].geometry=null}else ge in Fe?Fr(ge,fe,ae):fe in je?br(ge,fe,ae):(dr($e),je[ge]=fr-1,Fe[fe]=fr-1)}else dr($e)}return Xe.filter(function(Me){return Me.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Ge,je){return Ge.sortKey-je.sortKey})}},xe.prototype.update=function(t,e,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,r),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,r))},xe.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},xe.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},xe.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},xe.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},xe.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},xe.prototype.addToLineVertexArray=function(t,e){var r=this.lineVertexArray.length;if(t.segment!==void 0){for(var a=t.dist(e[t.segment+1]),l=t.dist(e[t.segment]),c={},h=t.segment+1;h<e.length;h++)c[h]={x:e[h].x,y:e[h].y,tileUnitDistanceFromAnchor:a},h<e.length-1&&(a+=e[h+1].dist(e[h]));for(var m=t.segment||0;m>=0;m--)c[m]={x:e[m].x,y:e[m].y,tileUnitDistanceFromAnchor:l},m>0&&(l+=e[m-1].dist(e[m]));for(var g=0;g<e.length;g++){var v=c[g];this.lineVertexArray.emplaceBack(v.x,v.y,v.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},xe.prototype.addSymbols=function(t,e,r,a,l,c,h,m,g,v,x,b){for(var T=t.indexArray,A=t.layoutVertexArray,L=t.segments.prepareSegment(4*e.length,A,T,this.canOverlap?c.sortKey:void 0),R=this.glyphOffsetArray.length,W=L.vertexLength,q=this.allowVerticalPlacement&&h===bi.vertical?Math.PI/2:0,Y=c.text&&c.text.sections,$=0;$<e.length;$++){var rt=e[$],it=rt.tl,ut=rt.tr,gt=rt.bl,bt=rt.br,Bt=rt.tex,St=rt.pixelOffsetTL,Ut=rt.pixelOffsetBR,Tt=rt.minFontScaleX,ee=rt.minFontScaleY,Gt=rt.glyphOffset,Rt=rt.isSDF,ne=rt.sectionIndex,te=L.vertexLength,ue=Gt[1];wu(A,m.x,m.y,it.x,ue+it.y,Bt.x,Bt.y,r,Rt,St.x,St.y,Tt,ee),wu(A,m.x,m.y,ut.x,ue+ut.y,Bt.x+Bt.w,Bt.y,r,Rt,Ut.x,St.y,Tt,ee),wu(A,m.x,m.y,gt.x,ue+gt.y,Bt.x,Bt.y+Bt.h,r,Rt,St.x,Ut.y,Tt,ee),wu(A,m.x,m.y,bt.x,ue+bt.y,Bt.x+Bt.w,Bt.y+Bt.h,r,Rt,Ut.x,Ut.y,Tt,ee),_c(t.dynamicLayoutVertexArray,m,q),T.emplaceBack(te,te+1,te+2),T.emplaceBack(te+1,te+2,te+3),L.vertexLength+=4,L.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Gt[0]),$!==e.length-1&&ne===e[$+1].sectionIndex||t.programConfigurations.populatePaintArrays(A.length,c,c.index,{},b,Y&&Y[ne])}t.placedSymbolArray.emplaceBack(m.x,m.y,R,this.glyphOffsetArray.length-R,W,g,v,m.segment,r?r[0]:0,r?r[1]:0,a[0],a[1],h,0,!1,0,x)},xe.prototype._addCollisionDebugVertex=function(t,e,r,a,l,c){return e.emplaceBack(0,0),t.emplaceBack(r.x,r.y,a,l,Math.round(c.x),Math.round(c.y))},xe.prototype.addCollisionDebugVertices=function(t,e,r,a,l,c,h){var m=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),g=m.vertexLength,v=l.layoutVertexArray,x=l.collisionVertexArray,b=h.anchorX,T=h.anchorY;this._addCollisionDebugVertex(v,x,c,b,T,new Dt(t,e)),this._addCollisionDebugVertex(v,x,c,b,T,new Dt(r,e)),this._addCollisionDebugVertex(v,x,c,b,T,new Dt(r,a)),this._addCollisionDebugVertex(v,x,c,b,T,new Dt(t,a)),m.vertexLength+=4;var A=l.indexArray;A.emplaceBack(g,g+1),A.emplaceBack(g+1,g+2),A.emplaceBack(g+2,g+3),A.emplaceBack(g+3,g),m.primitiveLength+=4},xe.prototype.addDebugCollisionBoxes=function(t,e,r,a){for(var l=t;l<e;l++){var c=this.collisionBoxArray.get(l);this.addCollisionDebugVertices(c.x1,c.y1,c.x2,c.y2,a?this.textCollisionBox:this.iconCollisionBox,c.anchorPoint,r)}},xe.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vl(wn,ap.members,ua),this.iconCollisionBox=new vl(wn,ap.members,ua);for(var t=0;t<this.symbolInstances.length;t++){var e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}},xe.prototype._deserializeCollisionBoxesForSymbol=function(t,e,r,a,l,c,h,m,g){for(var v={},x=e;x<r;x++){var b=t.get(x);v.textBox={x1:b.x1,y1:b.y1,x2:b.x2,y2:b.y2,anchorPointX:b.anchorPointX,anchorPointY:b.anchorPointY},v.textFeatureIndex=b.featureIndex;break}for(var T=a;T<l;T++){var A=t.get(T);v.verticalTextBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},v.verticalTextFeatureIndex=A.featureIndex;break}for(var L=c;L<h;L++){var R=t.get(L);v.iconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},v.iconFeatureIndex=R.featureIndex;break}for(var W=m;W<g;W++){var q=t.get(W);v.verticalIconBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},v.verticalIconFeatureIndex=q.featureIndex;break}return v},xe.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var e=0;e<this.symbolInstances.length;e++){var r=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},xe.prototype.hasTextData=function(){return this.text.segments.get().length>0},xe.prototype.hasIconData=function(){return this.icon.segments.get().length>0},xe.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},xe.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},xe.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},xe.prototype.addIndicesForPlacedSymbol=function(t,e){for(var r=t.placedSymbolArray.get(e),a=r.vertexStartIndex+4*r.numGlyphs,l=r.vertexStartIndex;l<a;l+=4)t.indexArray.emplaceBack(l,l+1,l+2),t.indexArray.emplaceBack(l+1,l+2,l+3)},xe.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var e=Math.sin(t),r=Math.cos(t),a=[],l=[],c=[],h=0;h<this.symbolInstances.length;++h){c.push(h);var m=this.symbolInstances.get(h);a.push(0|Math.round(e*m.anchorX+r*m.anchorY)),l.push(m.featureIndex)}return c.sort(function(g,v){return a[g]-a[v]||l[v]-l[g]}),c},xe.prototype.addToSortKeyRanges=function(t,e){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===e?r.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})},xe.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,a=this.symbolInstanceIndexes;r<a.length;r+=1){var l=this.symbolInstances.get(a[r]);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach(function(c,h,m){c>=0&&m.indexOf(c)===h&&e.addIndicesForPlacedSymbol(e.text,c)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Pt("SymbolBucket",xe,{omit:["layers","collisionBoxArray","features","compareText"]}),xe.MAX_GLYPHS=65535,xe.addDynamicAttributes=_c;var Qf=new ti({"symbol-placement":new It(D.layout_symbol["symbol-placement"]),"symbol-spacing":new It(D.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new It(D.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Xt(D.layout_symbol["symbol-sort-key"]),"symbol-z-order":new It(D.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new It(D.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new It(D.layout_symbol["icon-ignore-placement"]),"icon-optional":new It(D.layout_symbol["icon-optional"]),"icon-rotation-alignment":new It(D.layout_symbol["icon-rotation-alignment"]),"icon-size":new Xt(D.layout_symbol["icon-size"]),"icon-text-fit":new It(D.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new It(D.layout_symbol["icon-text-fit-padding"]),"icon-image":new Xt(D.layout_symbol["icon-image"]),"icon-rotate":new Xt(D.layout_symbol["icon-rotate"]),"icon-padding":new It(D.layout_symbol["icon-padding"]),"icon-keep-upright":new It(D.layout_symbol["icon-keep-upright"]),"icon-offset":new Xt(D.layout_symbol["icon-offset"]),"icon-anchor":new Xt(D.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new It(D.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new It(D.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new It(D.layout_symbol["text-rotation-alignment"]),"text-field":new Xt(D.layout_symbol["text-field"]),"text-font":new Xt(D.layout_symbol["text-font"]),"text-size":new Xt(D.layout_symbol["text-size"]),"text-max-width":new Xt(D.layout_symbol["text-max-width"]),"text-line-height":new It(D.layout_symbol["text-line-height"]),"text-letter-spacing":new Xt(D.layout_symbol["text-letter-spacing"]),"text-justify":new Xt(D.layout_symbol["text-justify"]),"text-radial-offset":new Xt(D.layout_symbol["text-radial-offset"]),"text-variable-anchor":new It(D.layout_symbol["text-variable-anchor"]),"text-anchor":new Xt(D.layout_symbol["text-anchor"]),"text-max-angle":new It(D.layout_symbol["text-max-angle"]),"text-writing-mode":new It(D.layout_symbol["text-writing-mode"]),"text-rotate":new Xt(D.layout_symbol["text-rotate"]),"text-padding":new It(D.layout_symbol["text-padding"]),"text-keep-upright":new It(D.layout_symbol["text-keep-upright"]),"text-transform":new Xt(D.layout_symbol["text-transform"]),"text-offset":new Xt(D.layout_symbol["text-offset"]),"text-allow-overlap":new It(D.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new It(D.layout_symbol["text-ignore-placement"]),"text-optional":new It(D.layout_symbol["text-optional"])}),xc={paint:new ti({"icon-opacity":new Xt(D.paint_symbol["icon-opacity"]),"icon-color":new Xt(D.paint_symbol["icon-color"]),"icon-halo-color":new Xt(D.paint_symbol["icon-halo-color"]),"icon-halo-width":new Xt(D.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Xt(D.paint_symbol["icon-halo-blur"]),"icon-translate":new It(D.paint_symbol["icon-translate"]),"icon-translate-anchor":new It(D.paint_symbol["icon-translate-anchor"]),"text-opacity":new Xt(D.paint_symbol["text-opacity"]),"text-color":new Xt(D.paint_symbol["text-color"],{runtimeType:Qt,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new Xt(D.paint_symbol["text-halo-color"]),"text-halo-width":new Xt(D.paint_symbol["text-halo-width"]),"text-halo-blur":new Xt(D.paint_symbol["text-halo-blur"]),"text-translate":new It(D.paint_symbol["text-translate"]),"text-translate-anchor":new It(D.paint_symbol["text-translate-anchor"])}),layout:Qf},ms=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Ft,this.defaultValue=t};ms.prototype.evaluate=function(t){if(t.formattedSection){var e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},ms.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},ms.prototype.outputDefined=function(){return!1},ms.prototype.serialize=function(){return null},Pt("FormatSectionOverride",ms,{omit:["defaultValue"]});var $f=function(t){function e(r){t.call(this,r,xc)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(r,a){if(t.prototype.recalculate.call(this,r,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var l=this.layout.get("text-writing-mode");if(l){for(var c=[],h=0,m=l;h<m.length;h+=1){var g=m[h];c.indexOf(g)<0&&c.push(g)}this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},e.prototype.getValueAndResolveTokens=function(r,a,l,c){var h=this.layout.get(r).evaluate(a,{},l,c),m=this._unevaluatedLayout._values[r];return m.isDataDriven()||Na(m.value)||!h?h:function(g,v){return v.replace(/{([^{}]+)}/g,function(x,b){return b in g?String(g[b]):""})}(a.properties,h)},e.prototype.createBucket=function(r){return new xe(r)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype._setPaintOverrides=function(){for(var r=0,a=xc.paint.overridableProperties;r<a.length;r+=1){var l=a[r];if(e.hasPaintOverride(this.layout,l)){var c,h=this.paint.get(l),m=new ms(h),g=new Ao(m,h.property.specification);c=h.value.kind==="constant"||h.value.kind==="source"?new Jo("source",g):new Po("composite",g,h.value.zoomStops,h.value._interpolationType),this.paint._values[l]=new ai(h.property,c,h.parameters)}}},e.prototype._handleOverridablePaintPropertyUpdate=function(r,a,l){return!(!this.layout||a.isDataDriven()||l.isDataDriven())&&e.hasPaintOverride(this.layout,r)},e.hasPaintOverride=function(r,a){var l=r.get("text-field"),c=xc.paint.properties[a],h=!1,m=function(x){for(var b=0,T=x;b<T.length;b+=1)if(c.overrides&&c.overrides.hasOverride(T[b]))return void(h=!0)};if(l.value.kind==="constant"&&l.value.value instanceof yr)m(l.value.value.sections);else if(l.value.kind==="source"){var g=function(x){h||(x instanceof mi&&cr(x.value)===oe?m(x.value.sections):x instanceof Hr?m(x.sections):x.eachChild(g))},v=l.value;v._styleExpression&&g(v._styleExpression.expression)}return h},e}(xi),td={paint:new ti({"background-color":new It(D.paint_background["background-color"]),"background-pattern":new _i(D.paint_background["background-pattern"]),"background-opacity":new It(D.paint_background["background-opacity"])})},ed=function(t){function e(r){t.call(this,r,td)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(xi),rd={paint:new ti({"raster-opacity":new It(D.paint_raster["raster-opacity"]),"raster-hue-rotate":new It(D.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new It(D.paint_raster["raster-brightness-min"]),"raster-brightness-max":new It(D.paint_raster["raster-brightness-max"]),"raster-saturation":new It(D.paint_raster["raster-saturation"]),"raster-contrast":new It(D.paint_raster["raster-contrast"]),"raster-resampling":new It(D.paint_raster["raster-resampling"]),"raster-fade-duration":new It(D.paint_raster["raster-fade-duration"])})},id=function(t){function e(r){t.call(this,r,rd)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(xi),nd=function(t){function e(r){t.call(this,r,{}),this.implementation=r}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},e.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},e.prototype.recalculate=function(){},e.prototype.updateTransitions=function(){},e.prototype.hasTransition=function(){},e.prototype.serialize=function(){},e.prototype.onAdd=function(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},e.prototype.onRemove=function(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},e}(xi),od={circle:ns,heatmap:Nh,hillshade:qh,fill:sf,"fill-extrusion":yf,line:wf,symbol:$f,background:ed,raster:id},zp=vt.HTMLImageElement,kp=vt.HTMLCanvasElement,Cp=vt.HTMLVideoElement,Mp=vt.ImageData,Su=vt.ImageBitmap,ma=function(t,e,r,a){this.context=t,this.format=r,this.texture=t.gl.createTexture(),this.update(e,a)};ma.prototype.update=function(t,e,r){var a=t.width,l=t.height,c=!(this.size&&this.size[0]===a&&this.size[1]===l||r),h=this.context,m=h.gl;if(this.useMipmap=Boolean(e&&e.useMipmap),m.bindTexture(m.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA&&(!e||e.premultiply!==!1)),c)this.size=[a,l],t instanceof zp||t instanceof kp||t instanceof Cp||t instanceof Mp||Su&&t instanceof Su?m.texImage2D(m.TEXTURE_2D,0,this.format,this.format,m.UNSIGNED_BYTE,t):m.texImage2D(m.TEXTURE_2D,0,this.format,a,l,0,this.format,m.UNSIGNED_BYTE,t.data);else{var g=r||{x:0,y:0},v=g.x,x=g.y;t instanceof zp||t instanceof kp||t instanceof Cp||t instanceof Mp||Su&&t instanceof Su?m.texSubImage2D(m.TEXTURE_2D,0,v,x,m.RGBA,m.UNSIGNED_BYTE,t):m.texSubImage2D(m.TEXTURE_2D,0,v,x,a,l,m.RGBA,m.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&m.generateMipmap(m.TEXTURE_2D)},ma.prototype.bind=function(t,e,r){var a=this.context.gl;a.bindTexture(a.TEXTURE_2D,this.texture),r!==a.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=a.LINEAR),t!==this.filter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,t),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,r||t),this.filter=t),e!==this.wrap&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,e),this.wrap=e)},ma.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},ma.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var bc=function(t){var e=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){e._triggered=!1,e._callback()})};bc.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},bc.prototype.remove=function(){delete this._channel,this._callback=function(){}};var ys=function(t,e,r){this.target=t,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},po(["receive","process"],this),this.invoker=new bc(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ii()?t:vt};function Dp(t,e,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[t*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}ys.prototype.send=function(t,e,r,a,l){var c=this;l===void 0&&(l=!1);var h=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[h]=r);var m=Ia(this.globalScope)?void 0:[];return this.target.postMessage({id:h,type:t,hasCallback:!!r,targetMapId:a,mustQueue:l,sourceMapId:this.mapId,data:Yr(e,m)},m),{cancel:function(){r&&delete c.callbacks[h],c.target.postMessage({id:h,type:"<cancel>",targetMapId:a,sourceMapId:c.mapId})}}},ys.prototype.receive=function(t){var e=t.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){delete this.tasks[r];var a=this.cancelCallbacks[r];delete this.cancelCallbacks[r],a&&a()}else ii()||e.mustQueue?(this.tasks[r]=e,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,e)},ys.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(t,e)}},ys.prototype.processTask=function(t,e){var r=this;if(e.type==="<response>"){var a=this.callbacks[t];delete this.callbacks[t],a&&(e.error?a(oa(e.error)):a(null,oa(e.data)))}else{var l=!1,c=Ia(this.globalScope)?void 0:[],h=e.hasCallback?function(x,b){l=!0,delete r.cancelCallbacks[t],r.target.postMessage({id:t,type:"<response>",sourceMapId:r.mapId,error:x?Yr(x):null,data:Yr(b,c)},c)}:function(x){l=!0},m=null,g=oa(e.data);if(this.parent[e.type])m=this.parent[e.type](e.sourceMapId,g,h);else if(this.parent.getWorkerSource){var v=e.type.split(".");m=this.parent.getWorkerSource(e.sourceMapId,v[0],g.source)[v[1]](g,h)}else h(new Error("Could not find function "+e.type));!l&&m&&m.cancel&&(this.cancelCallbacks[t]=m.cancel)}},ys.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var lr=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};lr.prototype.setNorthEast=function(t){return this._ne=t instanceof Be?new Be(t.lng,t.lat):Be.convert(t),this},lr.prototype.setSouthWest=function(t){return this._sw=t instanceof Be?new Be(t.lng,t.lat):Be.convert(t),this},lr.prototype.extend=function(t){var e,r,a=this._sw,l=this._ne;if(t instanceof Be)e=t,r=t;else{if(!(t instanceof lr))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(lr.convert(t)):this.extend(Be.convert(t)):this;if(r=t._ne,!(e=t._sw)||!r)return this}return a||l?(a.lng=Math.min(e.lng,a.lng),a.lat=Math.min(e.lat,a.lat),l.lng=Math.max(r.lng,l.lng),l.lat=Math.max(r.lat,l.lat)):(this._sw=new Be(e.lng,e.lat),this._ne=new Be(r.lng,r.lat)),this},lr.prototype.getCenter=function(){return new Be((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},lr.prototype.getSouthWest=function(){return this._sw},lr.prototype.getNorthEast=function(){return this._ne},lr.prototype.getNorthWest=function(){return new Be(this.getWest(),this.getNorth())},lr.prototype.getSouthEast=function(){return new Be(this.getEast(),this.getSouth())},lr.prototype.getWest=function(){return this._sw.lng},lr.prototype.getSouth=function(){return this._sw.lat},lr.prototype.getEast=function(){return this._ne.lng},lr.prototype.getNorth=function(){return this._ne.lat},lr.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},lr.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},lr.prototype.isEmpty=function(){return!(this._sw&&this._ne)},lr.prototype.contains=function(t){var e=Be.convert(t),r=e.lng,a=e.lat,l=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&l},lr.convert=function(t){return!t||t instanceof lr?t:new lr(t)};var Be=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Be.prototype.wrap=function(){return new Be(Ti(this.lng,-180,180),this.lat)},Be.prototype.toArray=function(){return[this.lng,this.lat]},Be.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Be.prototype.distanceTo=function(t){var e=Math.PI/180,r=this.lat*e,a=t.lat*e,l=Math.sin(r)*Math.sin(a)+Math.cos(r)*Math.cos(a)*Math.cos((t.lng-this.lng)*e);return 63710088e-1*Math.acos(Math.min(l,1))},Be.prototype.toBounds=function(t){t===void 0&&(t=0);var e=360*t/40075017,r=e/Math.cos(Math.PI/180*this.lat);return new lr(new Be(this.lng-r,this.lat-e),new Be(this.lng+r,this.lat+e))},Be.convert=function(t){if(t instanceof Be)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Be(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Be(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Lp=2*Math.PI*63710088e-1;function Rp(t){return Lp*Math.cos(t*Math.PI/180)}function Bp(t){return(180+t)/360}function Op(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Fp(t,e){return t/Rp(e)}function wc(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var ya=function(t,e,r){r===void 0&&(r=0),this.x=+t,this.y=+e,this.z=+r};ya.fromLngLat=function(t,e){e===void 0&&(e=0);var r=Be.convert(t);return new ya(Bp(r.lng),Op(r.lat),Fp(e,r.lat))},ya.prototype.toLngLat=function(){return new Be(360*this.x-180,wc(this.y))},ya.prototype.toAltitude=function(){return this.z*Rp(wc(this.y))},ya.prototype.meterInMercatorCoordinateUnits=function(){return 1/Lp*(t=wc(this.y),1/Math.cos(t*Math.PI/180));var t};var ga=function(t,e,r){this.z=t,this.x=e,this.y=r,this.key=_l(0,t,t,e,r)};ga.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},ga.prototype.url=function(t,e){var r,a,l,c,h,m=(a=this.y,l=this.z,c=Dp(256*(r=this.x),256*(a=Math.pow(2,l)-a-1),l),h=Dp(256*(r+1),256*(a+1),l),c[0]+","+c[1]+","+h[0]+","+h[1]),g=function(v,x,b){for(var T,A="",L=v;L>0;L--)A+=(x&(T=1<<L-1)?1:0)+(b&T?2:0);return A}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(e==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",g).replace("{bbox-epsg-3857}",m)},ga.prototype.getTilePoint=function(t){var e=Math.pow(2,this.z);return new Dt(8192*(t.x*e-this.x),8192*(t.y*e-this.y))},ga.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Up=function(t,e){this.wrap=t,this.canonical=e,this.key=_l(t,e.z,e.z,e.x,e.y)},ur=function(t,e,r,a,l){this.overscaledZ=t,this.wrap=e,this.canonical=new ga(r,+a,+l),this.key=_l(e,t,r,a,l)};function _l(t,e,r,a,l){(t*=2)<0&&(t=-1*t-1);var c=1<<r;return(c*c*t+c*l+a).toString(36)+r.toString(36)+e.toString(36)}ur.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},ur.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new ur(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ur(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},ur.prototype.calculateScaledKey=function(t,e){var r=this.canonical.z-t;return t>this.canonical.z?_l(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):_l(this.wrap*+e,t,t,this.canonical.x>>r,this.canonical.y>>r)},ur.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var e=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},ur.prototype.children=function(t){if(this.overscaledZ>=t)return[new ur(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,r=2*this.canonical.x,a=2*this.canonical.y;return[new ur(e,this.wrap,e,r,a),new ur(e,this.wrap,e,r+1,a),new ur(e,this.wrap,e,r,a+1),new ur(e,this.wrap,e,r+1,a+1)]},ur.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},ur.prototype.wrapped=function(){return new ur(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},ur.prototype.unwrapTo=function(t){return new ur(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},ur.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},ur.prototype.toUnwrapped=function(){return new Up(this.wrap,this.canonical)},ur.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},ur.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new ya(t.x-this.wrap,t.y))},Pt("CanonicalTileID",ga),Pt("OverscaledTileID",ur,{omit:["posMatrix"]});var no=function(t,e,r){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return qe('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=e.height;var a=this.dim=e.height-2;this.data=new Uint32Array(e.data.buffer),this.encoding=r||"mapbox";for(var l=0;l<a;l++)this.data[this._idx(-1,l)]=this.data[this._idx(0,l)],this.data[this._idx(a,l)]=this.data[this._idx(a-1,l)],this.data[this._idx(l,-1)]=this.data[this._idx(l,0)],this.data[this._idx(l,a)]=this.data[this._idx(l,a-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(a,-1)]=this.data[this._idx(a-1,0)],this.data[this._idx(-1,a)]=this.data[this._idx(0,a-1)],this.data[this._idx(a,a)]=this.data[this._idx(a-1,a-1)]};no.prototype.get=function(t,e){var r=new Uint8Array(this.data.buffer),a=4*this._idx(t,e);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(r[a],r[a+1],r[a+2])},no.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},no.prototype._idx=function(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)},no.prototype._unpackMapbox=function(t,e,r){return(256*t*256+256*e+r)/10-1e4},no.prototype._unpackTerrarium=function(t,e,r){return 256*t+e+r/256-32768},no.prototype.getPixels=function(){return new ri({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},no.prototype.backfillBorder=function(t,e,r){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var a=e*this.dim,l=e*this.dim+this.dim,c=r*this.dim,h=r*this.dim+this.dim;switch(e){case-1:a=l-1;break;case 1:l=a+1}switch(r){case-1:c=h-1;break;case 1:h=c+1}for(var m=-e*this.dim,g=-r*this.dim,v=c;v<h;v++)for(var x=a;x<l;x++)this.data[this._idx(x,v)]=t.data[this._idx(x+m,v+g)]},Pt("DEMData",no);var Tu=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var r=t[e];this._stringToNumber[r]=e,this._numberToString[e]=r}};Tu.prototype.encode=function(t){return this._stringToNumber[t]},Tu.prototype.decode=function(t){return this._numberToString[t]};var Iu=function(t,e,r,a,l){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=r,t._y=a,this.properties=t.properties,this.id=l},Sc={geometry:{configurable:!0}};Sc.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Sc.geometry.set=function(t){this._geometry=t},Iu.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)e!=="_geometry"&&e!=="_vectorTileFeature"&&(t[e]=this[e]);return t},Object.defineProperties(Iu.prototype,Sc);var gs=function(){this.state={},this.stateChanges={},this.deletedStates={}};gs.prototype.updateState=function(t,e,r){var a=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][a]=this.stateChanges[t][a]||{},He(this.stateChanges[t][a],r),this.deletedStates[t]===null)for(var l in this.deletedStates[t]={},this.state[t])l!==a&&(this.deletedStates[t][l]=null);else if(this.deletedStates[t]&&this.deletedStates[t][a]===null)for(var c in this.deletedStates[t][a]={},this.state[t][a])r[c]||(this.deletedStates[t][a][c]=null);else for(var h in r)this.deletedStates[t]&&this.deletedStates[t][a]&&this.deletedStates[t][a][h]===null&&delete this.deletedStates[t][a][h]},gs.prototype.removeFeatureState=function(t,e,r){if(this.deletedStates[t]!==null){var a=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},r&&e!==void 0)this.deletedStates[t][a]!==null&&(this.deletedStates[t][a]=this.deletedStates[t][a]||{},this.deletedStates[t][a][r]=null);else if(e!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][a])for(r in this.deletedStates[t][a]={},this.stateChanges[t][a])this.deletedStates[t][a][r]=null;else this.deletedStates[t][a]=null;else this.deletedStates[t]=null}},gs.prototype.getState=function(t,e){var r=String(e),a=He({},(this.state[t]||{})[r],(this.stateChanges[t]||{})[r]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var l=this.deletedStates[t][e];if(l===null)return{};for(var c in l)delete a[c]}return a},gs.prototype.initializeTileState=function(t,e){t.setFeatureState(this.state,e)},gs.prototype.coalesceChanges=function(t,e){var r={};for(var a in this.stateChanges){this.state[a]=this.state[a]||{};var l={};for(var c in this.stateChanges[a])this.state[a][c]||(this.state[a][c]={}),He(this.state[a][c],this.stateChanges[a][c]),l[c]=this.state[a][c];r[a]=l}for(var h in this.deletedStates){this.state[h]=this.state[h]||{};var m={};if(this.deletedStates[h]===null)for(var g in this.state[h])m[g]={},this.state[h][g]={};else for(var v in this.deletedStates[h]){if(this.deletedStates[h][v]===null)this.state[h][v]={};else for(var x=0,b=Object.keys(this.deletedStates[h][v]);x<b.length;x+=1)delete this.state[h][v][b[x]];m[v]=this.state[h][v]}r[h]=r[h]||{},He(r[h],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(var T in t)t[T].setFeatureState(r,e)};var oo=function(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Er(8192,16,0),this.grid3D=new Er(8192,16,0),this.featureIndexArray=new P,this.promoteId=e};function Vp(t,e,r,a,l){return kr(t,function(c,h){var m=e instanceof Qn?e.get(h):null;return m&&m.evaluate?m.evaluate(r,a,l):m})}function Np(t){for(var e=1/0,r=1/0,a=-1/0,l=-1/0,c=0,h=t;c<h.length;c+=1){var m=h[c];e=Math.min(e,m.x),r=Math.min(r,m.y),a=Math.max(a,m.x),l=Math.max(l,m.y)}return{minX:e,minY:r,maxX:a,maxY:l}}function ad(t,e){return e-t}oo.prototype.insert=function(t,e,r,a,l,c){var h=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,a,l);for(var m=c?this.grid3D:this.grid,g=0;g<e.length;g++){for(var v=e[g],x=[1/0,1/0,-1/0,-1/0],b=0;b<v.length;b++){var T=v[b];x[0]=Math.min(x[0],T.x),x[1]=Math.min(x[1],T.y),x[2]=Math.max(x[2],T.x),x[3]=Math.max(x[3],T.y)}x[0]<8192&&x[1]<8192&&x[2]>=0&&x[3]>=0&&m.insert(h,x[0],x[1],x[2],x[3])}},oo.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new ss.VectorTile(new fu(this.rawTileData)).layers,this.sourceLayerCoder=new Tu(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},oo.prototype.query=function(t,e,r,a){var l=this;this.loadVTLayers();for(var c=t.params||{},h=8192/t.tileSize/t.scale,m=qa(c.filter),g=t.queryGeometry,v=t.queryPadding*h,x=Np(g),b=this.grid.query(x.minX-v,x.minY-v,x.maxX+v,x.maxY+v),T=Np(t.cameraQueryGeometry),A=this.grid3D.query(T.minX-v,T.minY-v,T.maxX+v,T.maxY+v,function(rt,it,ut,gt){return function(bt,Bt,St,Ut,Tt){for(var ee=0,Gt=bt;ee<Gt.length;ee+=1){var Rt=Gt[ee];if(Bt<=Rt.x&&St<=Rt.y&&Ut>=Rt.x&&Tt>=Rt.y)return!0}var ne=[new Dt(Bt,St),new Dt(Bt,Tt),new Dt(Ut,Tt),new Dt(Ut,St)];if(bt.length>2){for(var te=0,ue=ne;te<ue.length;te+=1)if(Ni(bt,ue[te]))return!0}for(var jt=0;jt<bt.length-1;jt++)if(Lo(bt[jt],bt[jt+1],ne))return!0;return!1}(t.cameraQueryGeometry,rt-v,it-v,ut+v,gt+v)}),L=0,R=A;L<R.length;L+=1)b.push(R[L]);b.sort(ad);for(var W,q={},Y=function(rt){var it=b[rt];if(it!==W){W=it;var ut=l.featureIndexArray.get(it),gt=null;l.loadMatchingFeature(q,ut.bucketIndex,ut.sourceLayerIndex,ut.featureIndex,m,c.layers,c.availableImages,e,r,a,function(bt,Bt,St){return gt||(gt=Ye(bt)),Bt.queryIntersectsFeature(g,bt,St,gt,l.z,t.transform,h,t.pixelPosMatrix)})}},$=0;$<b.length;$++)Y($);return q},oo.prototype.loadMatchingFeature=function(t,e,r,a,l,c,h,m,g,v,x){var b=this.bucketLayerIDs[e];if(!c||function(bt,Bt){for(var St=0;St<bt.length;St++)if(Bt.indexOf(bt[St])>=0)return!0;return!1}(c,b)){var T=this.sourceLayerCoder.decode(r),A=this.vtLayers[T].feature(a);if(l.needGeometry){var L=Ar(A,!0);if(!l.filter(new ye(this.tileID.overscaledZ),L,this.tileID.canonical))return}else if(!l.filter(new ye(this.tileID.overscaledZ),A))return;for(var R=this.getId(A,T),W=0;W<b.length;W++){var q=b[W];if(!(c&&c.indexOf(q)<0)){var Y=m[q];if(Y){var $={};R!==void 0&&v&&($=v.getState(Y.sourceLayer||"_geojsonTileLayer",R));var rt=He({},g[q]);rt.paint=Vp(rt.paint,Y.paint,A,$,h),rt.layout=Vp(rt.layout,Y.layout,A,$,h);var it=!x||x(A,Y,$);if(it){var ut=new Iu(A,this.z,this.x,this.y,R);ut.layer=rt;var gt=t[q];gt===void 0&&(gt=t[q]=[]),gt.push({featureIndex:a,feature:ut,intersectionZ:it})}}}}}},oo.prototype.lookupSymbolFeatures=function(t,e,r,a,l,c,h,m){var g={};this.loadVTLayers();for(var v=qa(l),x=0,b=t;x<b.length;x+=1)this.loadMatchingFeature(g,r,a,b[x],v,c,h,m,e);return g},oo.prototype.hasLayer=function(t){for(var e=0,r=this.bucketLayerIDs;e<r.length;e+=1)for(var a=0,l=r[e];a<l.length;a+=1)if(t===l[a])return!0;return!1},oo.prototype.getId=function(t,e){var r=t.id;return this.promoteId&&typeof(r=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[e]])=="boolean"&&(r=Number(r)),r},Pt("FeatureIndex",oo,{omit:["rawTileData","sourceLayerCoder"]});var xr=function(t,e){this.tileID=t,this.uid=uo(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};xr.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<Gi.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},xr.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},xr.prototype.loadVectorData=function(t,e,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var a in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(v,x){var b={};if(!x)return b;for(var T=function(){var R=L[A],W=R.layerIds.map(function($){return x.getLayer($)}).filter(Boolean);if(W.length!==0){R.layers=W,R.stateDependentLayerIds&&(R.stateDependentLayers=R.stateDependentLayerIds.map(function($){return W.filter(function(rt){return rt.id===$})[0]}));for(var q=0,Y=W;q<Y.length;q+=1)b[Y[q].id]=R}},A=0,L=v;A<L.length;A+=1)T();return b}(t.buckets,e.style),this.hasSymbolBuckets=!1,this.buckets){var l=this.buckets[a];if(l instanceof xe){if(this.hasSymbolBuckets=!0,!r)break;l.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var c in this.buckets){var h=this.buckets[c];if(h instanceof xe&&h.hasRTLText){this.hasRTLText=!0,Ue.isLoading()||Ue.isLoaded()||Mi()!=="deferred"||su();break}}for(var m in this.queryPadding=0,this.buckets){var g=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(m).queryRadius(g))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new n},xr.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},xr.prototype.getBucket=function(t){return this.buckets[t.id]},xr.prototype.upload=function(t){for(var e in this.buckets){var r=this.buckets[e];r.uploadPending()&&r.upload(t)}var a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ma(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ma(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)},xr.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},xr.prototype.queryRenderedFeatures=function(t,e,r,a,l,c,h,m,g,v){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:a,cameraQueryGeometry:l,scale:c,tileSize:this.tileSize,pixelPosMatrix:v,transform:m,params:h,queryPadding:this.queryPadding*g},t,e,r):{}},xr.prototype.querySourceFeatures=function(t,e){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var a=r.loadVTLayers(),l=e?e.sourceLayer:"",c=a._geojsonTileLayer||a[l];if(c)for(var h=qa(e&&e.filter),m=this.tileID.canonical,g=m.z,v=m.x,x=m.y,b={z:g,x:v,y:x},T=0;T<c.length;T++){var A=c.feature(T);if(h.needGeometry){var L=Ar(A,!0);if(!h.filter(new ye(this.tileID.overscaledZ),L,this.tileID.canonical))continue}else if(!h.filter(new ye(this.tileID.overscaledZ),A))continue;var R=r.getId(A,l),W=new Iu(A,g,v,x,R);W.tile=b,t.push(W)}}},xr.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},xr.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},xr.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var r=fo(t.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var a=Date.now(),l=!1;if(this.expirationTime>a)l=!1;else if(e)if(this.expirationTime<e)l=!0;else{var c=this.expirationTime-e;c?this.expirationTime=a+Math.max(c,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},xr.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},xr.prototype.setFeatureState=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var r=this.latestFeatureIndex.loadVTLayers();for(var a in this.buckets)if(e.style.hasLayer(a)){var l=this.buckets[a],c=l.layers[0].sourceLayer||"_geojsonTileLayer",h=r[c],m=t[c];if(h&&m&&Object.keys(m).length!==0){l.update(m,h,this.imageAtlas&&this.imageAtlas.patternPositions||{});var g=e&&e.style&&e.style.getLayer(a);g&&(this.queryPadding=Math.max(this.queryPadding,g.queryRadius(l)))}}}},xr.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},xr.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Gi.now()},xr.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},xr.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=Gi.now()+t},xr.prototype.setDependencies=function(t,e){for(var r={},a=0,l=e;a<l.length;a+=1)r[l[a]]=!0;this.dependencies[t]=r},xr.prototype.hasDependency=function(t,e){for(var r=0,a=t;r<a.length;r+=1){var l=this.dependencies[a[r]];if(l){for(var c=0,h=e;c<h.length;c+=1)if(l[h[c]])return!0}}return!1};var Bo=vt.performance,jp=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},Bo.mark(this._marks.start)};jp.prototype.finish=function(){Bo.mark(this._marks.end);var t=Bo.getEntriesByName(this._marks.measure);return t.length===0&&(Bo.measure(this._marks.measure,this._marks.start,this._marks.end),t=Bo.getEntriesByName(this._marks.measure),Bo.clearMarks(this._marks.start),Bo.clearMarks(this._marks.end),Bo.clearMeasures(this._marks.measure)),t},u.Actor=ys,u.AlphaImage=da,u.CanonicalTileID=ga,u.CollisionBoxArray=n,u.Color=se,u.DEMData=no,u.DataConstantProperty=It,u.DictionaryCoder=Tu,u.EXTENT=8192,u.ErrorEvent=J,u.EvaluationParameters=ye,u.Event=K,u.Evented=X,u.FeatureIndex=oo,u.FillBucket=tn,u.FillExtrusionBucket=en,u.ImageAtlas=gl,u.ImagePosition=mu,u.LineBucket=Xr,u.LngLat=Be,u.LngLatBounds=lr,u.MercatorCoordinate=ya,u.ONE_EM=24,u.OverscaledTileID=ur,u.Point=Dt,u.Point$1=Dt,u.Properties=ti,u.Protobuf=fu,u.RGBAImage=ri,u.RequestManager=Mr,u.RequestPerformance=jp,u.ResourceType=za,u.SegmentVector=z,u.SourceFeatureState=gs,u.StructArrayLayout1ui2=es,u.StructArrayLayout2f1f2i16=nl,u.StructArrayLayout2i4=aa,u.StructArrayLayout3ui6=si,u.StructArrayLayout4i8=Yi,u.SymbolBucket=xe,u.Texture=ma,u.Tile=xr,u.Transitionable=oi,u.Uniform1f=yt,u.Uniform1i=_t,u.Uniform2f=Et,u.Uniform3f=Vt,u.Uniform4f=qt,u.UniformColor=Nt,u.UniformMatrix4f=Ct,u.UnwrappedTileID=Up,u.ValidationError=j,u.WritingMode=bi,u.ZoomHistory=qr,u.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},u.addDynamicAttributes=_c,u.asyncAll=function(t,e,r){if(!t.length)return r(null,[]);var a=t.length,l=new Array(t.length),c=null;t.forEach(function(h,m){e(h,function(g,v){g&&(c=g),l[m]=v,--a==0&&r(c,l)})})},u.bezier=rr,u.bindAll=po,u.browser=Gi,u.cacheEntryPossiblyAdded=function(t){++Zo>Pa&&(t.getActor().send("enforceCacheSizeLimit",vo),Zo=0)},u.clamp=Tr,u.clearTileCache=function(t){var e=vt.caches.delete("mapbox-tiles");t&&e.catch(t).then(function(){return t()})},u.clipLine=Sp,u.clone=function(t){var e=new Ze(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},u.clone$1=Ii,u.clone$2=function(t){var e=new Ze(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},u.collisionCircleLayout=Ef,u.config=ve,u.create=function(){var t=new Ze(16);return Ze!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},u.create$1=function(){var t=new Ze(9);return Ze!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},u.create$2=function(){var t=new Ze(4);return Ze!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},u.createCommonjsModule=Ot,u.createExpression=ja,u.createLayout=_r,u.createStyleLayer=function(t){return t.type==="custom"?new nd(t):new od[t.type](t)},u.cross=function(t,e,r){var a=e[0],l=e[1],c=e[2],h=r[0],m=r[1],g=r[2];return t[0]=l*g-c*m,t[1]=c*h-a*g,t[2]=a*m-l*h,t},u.deepEqual=function t(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(var a=0;a<e.length;a++)if(!t(e[a],r[a]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(var l in e)if(!t(e[l],r[l]))return!1;return!0}return e===r},u.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},u.dot$1=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},u.ease=De,u.emitValidationErrors=ia,u.endsWith=kn,u.enforceCacheSizeLimit=function(t){_o(),di&&di.then(function(e){e.keys().then(function(r){for(var a=0;a<r.length-t;a++)e.delete(r[a])})})},u.evaluateSizeForFeature=gp,u.evaluateSizeForZoom=vp,u.evaluateVariableOffset=Ep,u.evented=el,u.extend=He,u.featureFilter=qa,u.filterObject=Zi,u.fromRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=r,t[2]=0,t[3]=-r,t[4]=a,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},u.getAnchorAlignment=mc,u.getAnchorJustification=vc,u.getArrayBuffer=Ve,u.getImage=E,u.getJSON=function(t,e){return xo(He(t,{type:"json"}),e)},u.getRTLTextPluginStatus=Mi,u.getReferrer=Bn,u.getVideo=function(t,e){var r,a,l=vt.document.createElement("video");l.muted=!0,l.onloadstart=function(){e(null,l)};for(var c=0;c<t.length;c++){var h=vt.document.createElement("source");r=t[c],a=void 0,(a=vt.document.createElement("a")).href=r,(a.protocol!==vt.document.location.protocol||a.host!==vt.document.location.host)&&(l.crossOrigin="Anonymous"),h.src=t[c],l.appendChild(h)}return{cancel:function(){}}},u.identity=Br,u.invert=function(t,e){var r=e[0],a=e[1],l=e[2],c=e[3],h=e[4],m=e[5],g=e[6],v=e[7],x=e[8],b=e[9],T=e[10],A=e[11],L=e[12],R=e[13],W=e[14],q=e[15],Y=r*m-a*h,$=r*g-l*h,rt=r*v-c*h,it=a*g-l*m,ut=a*v-c*m,gt=l*v-c*g,bt=x*R-b*L,Bt=x*W-T*L,St=x*q-A*L,Ut=b*W-T*R,Tt=b*q-A*R,ee=T*q-A*W,Gt=Y*ee-$*Tt+rt*Ut+it*St-ut*Bt+gt*bt;return Gt?(t[0]=(m*ee-g*Tt+v*Ut)*(Gt=1/Gt),t[1]=(l*Tt-a*ee-c*Ut)*Gt,t[2]=(R*gt-W*ut+q*it)*Gt,t[3]=(T*ut-b*gt-A*it)*Gt,t[4]=(g*St-h*ee-v*Bt)*Gt,t[5]=(r*ee-l*St+c*Bt)*Gt,t[6]=(W*rt-L*gt-q*$)*Gt,t[7]=(x*gt-T*rt+A*$)*Gt,t[8]=(h*Tt-m*St+v*bt)*Gt,t[9]=(a*St-r*Tt-c*bt)*Gt,t[10]=(L*ut-R*rt+q*Y)*Gt,t[11]=(b*rt-x*ut-A*Y)*Gt,t[12]=(m*Bt-h*Ut-g*bt)*Gt,t[13]=(r*Ut-a*Bt+l*bt)*Gt,t[14]=(R*$-L*it-W*Y)*Gt,t[15]=(x*it-b*$+T*Y)*Gt,t):null},u.isChar=kt,u.isMapboxURL=pi,u.keysDifference=function(t,e){var r=[];for(var a in t)a in e||r.push(a);return r},u.makeRequest=xo,u.mapObject=kr,u.mercatorXfromLng=Bp,u.mercatorYfromLat=Op,u.mercatorZfromAltitude=Fp,u.mul=nc,u.multiply=pa,u.mvt=ss,u.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},u.normalize=function(t,e){var r=e[0],a=e[1],l=e[2],c=r*r+a*a+l*l;return c>0&&(c=1/Math.sqrt(c)),t[0]=e[0]*c,t[1]=e[1]*c,t[2]=e[2]*c,t},u.number=ir,u.offscreenCanvasSupported=Go,u.ortho=function(t,e,r,a,l,c,h){var m=1/(e-r),g=1/(a-l),v=1/(c-h);return t[0]=-2*m,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*g,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*v,t[11]=0,t[12]=(e+r)*m,t[13]=(l+a)*g,t[14]=(h+c)*v,t[15]=1,t},u.parseGlyphPBF=function(t){return new fu(t).readFields(Of,[])},u.pbf=fu,u.performSymbolLayout=function(t,e,r,a,l,c,h){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var m=t.layers[0].layout,g=t.layers[0]._unevaluatedLayout._values,v={};if(t.textSizeData.kind==="composite"){var x=t.textSizeData,b=x.maxZoom;v.compositeTextSizes=[g["text-size"].possiblyEvaluate(new ye(x.minZoom),h),g["text-size"].possiblyEvaluate(new ye(b),h)]}if(t.iconSizeData.kind==="composite"){var T=t.iconSizeData,A=T.maxZoom;v.compositeIconSizes=[g["icon-size"].possiblyEvaluate(new ye(T.minZoom),h),g["icon-size"].possiblyEvaluate(new ye(A),h)]}v.layoutTextSize=g["text-size"].possiblyEvaluate(new ye(t.zoom+1),h),v.layoutIconSize=g["icon-size"].possiblyEvaluate(new ye(t.zoom+1),h),v.textMaxSize=g["text-size"].possiblyEvaluate(new ye(18));for(var L=24*m.get("text-line-height"),R=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point",W=m.get("text-keep-upright"),q=m.get("text-size"),Y=function(){var it=rt[$],ut=m.get("text-font").evaluate(it,{},h).join(","),gt=q.evaluate(it,{},h),bt=v.layoutTextSize.evaluate(it,{},h),Bt=v.layoutIconSize.evaluate(it,{},h),St={horizontal:{},vertical:void 0},Ut=it.text,Tt=[0,0];if(Ut){var ee=Ut.toString(),Gt=24*m.get("text-letter-spacing").evaluate(it,{},h),Rt=function(ae){for(var Se=0,ge=ae;Se<ge.length;Se+=1)if(fe=ge[Se].charCodeAt(0),kt.Arabic(fe)||kt["Arabic Supplement"](fe)||kt["Arabic Extended-A"](fe)||kt["Arabic Presentation Forms-A"](fe)||kt["Arabic Presentation Forms-B"](fe))return!1;var fe;return!0}(ee)?Gt:0,ne=m.get("text-anchor").evaluate(it,{},h),te=m.get("text-variable-anchor");if(!te){var ue=m.get("text-radial-offset").evaluate(it,{},h);Tt=ue?Ep(ne,[24*ue,gc]):m.get("text-offset").evaluate(it,{},h).map(function(ae){return 24*ae})}var jt=R?"center":m.get("text-justify").evaluate(it,{},h),de=m.get("symbol-placement"),Oe=de==="point"?24*m.get("text-max-width").evaluate(it,{},h):0,Ge=function(){t.allowVerticalPlacement&&Ha(ee)&&(St.vertical=yu(Ut,e,r,l,ut,Oe,L,ne,"left",Rt,Tt,bi.vertical,!0,de,bt,gt))};if(!R&&te){for(var je=jt==="auto"?te.map(function(ae){return vc(ae)}):[jt],Fe=!1,Xe=0;Xe<je.length;Xe++){var fr=je[Xe];if(!St.horizontal[fr])if(Fe)St.horizontal[fr]=St.horizontal[0];else{var dr=yu(Ut,e,r,l,ut,Oe,L,"center",fr,Rt,Tt,bi.horizontal,!1,de,bt,gt);dr&&(St.horizontal[fr]=dr,Fe=dr.positionedLines.length===1)}}Ge()}else{jt==="auto"&&(jt=vc(ne));var Fr=yu(Ut,e,r,l,ut,Oe,L,ne,jt,Rt,Tt,bi.horizontal,!1,de,bt,gt);Fr&&(St.horizontal[jt]=Fr),Ge(),Ha(ee)&&R&&W&&(St.vertical=yu(Ut,e,r,l,ut,Oe,L,ne,jt,Rt,Tt,bi.vertical,!1,de,bt,gt))}}var br=void 0,Ur=!1;if(it.icon&&it.icon.name){var $e=a[it.icon.name];$e&&(br=function(ae,Se,ge){var fe=mc(ge),Wr=Se[0]-ae.displaySize[0]*fe.horizontalAlign,Pr=Se[1]-ae.displaySize[1]*fe.verticalAlign;return{image:ae,top:Pr,bottom:Pr+ae.displaySize[1],left:Wr,right:Wr+ae.displaySize[0]}}(l[it.icon.name],m.get("icon-offset").evaluate(it,{},h),m.get("icon-anchor").evaluate(it,{},h)),Ur=$e.sdf,t.sdfIcons===void 0?t.sdfIcons=$e.sdf:t.sdfIcons!==$e.sdf&&qe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),($e.pixelRatio!==t.pixelRatio||m.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var wr=Pp(St.horizontal)||St.vertical;t.iconsInText=!!wr&&wr.iconsInText,(wr||br)&&function(ae,Se,ge,fe,Wr,Pr,Me,nr,zr,me,Tn){var wi=Pr.textMaxSize.evaluate(Se,{});wi===void 0&&(wi=Me);var In,tr=ae.layers[0].layout,En=tr.get("icon-offset").evaluate(Se,{},Tn),ji=Pp(ge.horizontal),vs=Me/24,va=ae.tilePixelRatio*vs,_s=ae.tilePixelRatio*wi/24,ao=ae.tilePixelRatio*nr,xs=ae.tilePixelRatio*tr.get("symbol-spacing"),Eu=tr.get("text-padding")*ae.tilePixelRatio,bs=tr.get("icon-padding")*ae.tilePixelRatio,xl=tr.get("text-max-angle")/180*Math.PI,Au=tr.get("text-rotation-alignment")==="map"&&tr.get("symbol-placement")!=="point",Pu=tr.get("icon-rotation-alignment")==="map"&&tr.get("symbol-placement")!=="point",so=tr.get("symbol-placement"),bl=xs/2,ws=tr.get("icon-text-fit");fe&&ws!=="none"&&(ae.allowVerticalPlacement&&ge.vertical&&(In=yp(fe,ge.vertical,ws,tr.get("icon-text-fit-padding"),En,vs)),ji&&(fe=yp(fe,ji,ws,tr.get("icon-text-fit-padding"),En,vs)));var Oo=function(sd,zl){zl.x<0||zl.x>=8192||zl.y<0||zl.y>=8192||function(er,rn,ld,Fo,Ac,Gp,Lu,An,Ru,kl,Bu,Ou,Pc,Xp,Cl,Wp,Kp,Hp,Jp,Yp,Si,Fu,Qp,Pn,ud){var $p,xa,As,Ps,zs,ks=er.addToLineVertexArray(rn,ld),th=0,eh=0,rh=0,ih=0,zc=-1,kc=-1,lo={},nh=Z(""),Cc=0,Mc=0;if(An._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Cc=($p=An.layout.get("text-offset").evaluate(Si,{},Pn).map(function(Dl){return 24*Dl}))[0],Mc=$p[1]):(Cc=24*An.layout.get("text-radial-offset").evaluate(Si,{},Pn),Mc=gc),er.allowVerticalPlacement&&Fo.vertical){var oh=An.layout.get("text-rotate").evaluate(Si,{},Pn)+90;Ps=new bu(Ru,rn,kl,Bu,Ou,Fo.vertical,Pc,Xp,Cl,oh),Lu&&(zs=new bu(Ru,rn,kl,Bu,Ou,Lu,Kp,Hp,Cl,oh))}if(Ac){var Dc=An.layout.get("icon-rotate").evaluate(Si,{}),ah=An.layout.get("icon-text-fit")!=="none",sh=Tp(Ac,Dc,Qp,ah),Lc=Lu?Tp(Lu,Dc,Qp,ah):void 0;As=new bu(Ru,rn,kl,Bu,Ou,Ac,Kp,Hp,!1,Dc),th=4*sh.length;var lh=er.iconSizeData,Ml=null;lh.kind==="source"?(Ml=[128*An.layout.get("icon-size").evaluate(Si,{})])[0]>32640&&qe(er.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):lh.kind==="composite"&&((Ml=[128*Fu.compositeIconSizes[0].evaluate(Si,{},Pn),128*Fu.compositeIconSizes[1].evaluate(Si,{},Pn)])[0]>32640||Ml[1]>32640)&&qe(er.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),er.addSymbols(er.icon,sh,Ml,Yp,Jp,Si,!1,rn,ks.lineStartIndex,ks.lineLength,-1,Pn),zc=er.icon.placedSymbolArray.length-1,Lc&&(eh=4*Lc.length,er.addSymbols(er.icon,Lc,Ml,Yp,Jp,Si,bi.vertical,rn,ks.lineStartIndex,ks.lineLength,-1,Pn),kc=er.icon.placedSymbolArray.length-1)}for(var uh in Fo.horizontal){var Uu=Fo.horizontal[uh];if(!xa){nh=Z(Uu.text);var cd=An.layout.get("text-rotate").evaluate(Si,{},Pn);xa=new bu(Ru,rn,kl,Bu,Ou,Uu,Pc,Xp,Cl,cd)}var ch=Uu.positionedLines.length===1;if(rh+=Ap(er,rn,Uu,Gp,An,Cl,Si,Wp,ks,Fo.vertical?bi.horizontal:bi.horizontalOnly,ch?Object.keys(Fo.horizontal):[uh],lo,zc,Fu,Pn),ch)break}Fo.vertical&&(ih+=Ap(er,rn,Fo.vertical,Gp,An,Cl,Si,Wp,ks,bi.vertical,["vertical"],lo,kc,Fu,Pn));var pd=xa?xa.boxStartIndex:er.collisionBoxArray.length,hd=xa?xa.boxEndIndex:er.collisionBoxArray.length,fd=Ps?Ps.boxStartIndex:er.collisionBoxArray.length,dd=Ps?Ps.boxEndIndex:er.collisionBoxArray.length,md=As?As.boxStartIndex:er.collisionBoxArray.length,yd=As?As.boxEndIndex:er.collisionBoxArray.length,gd=zs?zs.boxStartIndex:er.collisionBoxArray.length,vd=zs?zs.boxEndIndex:er.collisionBoxArray.length,zn=-1,Vu=function(Dl,hh){return Dl&&Dl.circleDiameter?Math.max(Dl.circleDiameter,hh):hh};zn=Vu(xa,zn),zn=Vu(Ps,zn),zn=Vu(As,zn);var ph=(zn=Vu(zs,zn))>-1?1:0;ph&&(zn*=ud/24),er.glyphOffsetArray.length>=xe.MAX_GLYPHS&&qe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Si.sortKey!==void 0&&er.addToSortKeyRanges(er.symbolInstances.length,Si.sortKey),er.symbolInstances.emplaceBack(rn.x,rn.y,lo.right>=0?lo.right:-1,lo.center>=0?lo.center:-1,lo.left>=0?lo.left:-1,lo.vertical||-1,zc,kc,nh,pd,hd,fd,dd,md,yd,gd,vd,kl,rh,ih,th,eh,ph,0,Pc,Cc,Mc,zn)}(ae,zl,sd,ge,fe,Wr,In,ae.layers[0],ae.collisionBoxArray,Se.index,Se.sourceLayerIndex,ae.index,va,Eu,Au,zr,ao,bs,Pu,En,Se,Pr,me,Tn,Me)};if(so==="line")for(var Ss=0,zu=Sp(Se.geometry,0,0,8192,8192);Ss<zu.length;Ss+=1)for(var ku=zu[Ss],wl=0,Sl=Zf(ku,xs,xl,ge.vertical||ji,fe,24,_s,ae.overscaling,8192);wl<Sl.length;wl+=1){var Cu=Sl[wl];ji&&Kf(ae,ji.text,bl,Cu)||Oo(ku,Cu)}else if(so==="line-center")for(var Tl=0,Il=Se.geometry;Tl<Il.length;Tl+=1){var El=Il[Tl];if(El.length>1){var Mu=qf(El,xl,ge.vertical||ji,fe,24,_s);Mu&&Oo(El,Mu)}}else if(Se.type==="Polygon")for(var Ts=0,Du=cc(Se.geometry,0);Ts<Du.length;Ts+=1){var Is=Du[Ts],Al=Xf(Is,16);Oo(Is[0],new ps(Al.x,Al.y,0))}else if(Se.type==="LineString")for(var _a=0,Pl=Se.geometry;_a<Pl.length;_a+=1){var Es=Pl[_a];Oo(Es,new ps(Es[0].x,Es[0].y,0))}else if(Se.type==="Point")for(var Tc=0,qp=Se.geometry;Tc<qp.length;Tc+=1)for(var Ic=0,Zp=qp[Tc];Ic<Zp.length;Ic+=1){var Ec=Zp[Ic];Oo([Ec],new ps(Ec.x,Ec.y,0))}}(t,it,St,br,a,v,bt,Bt,Tt,Ur,h)},$=0,rt=t.features;$<rt.length;$+=1)Y();c&&t.generateCollisionDebugBuffers()},u.perspective=function(t,e,r,a,l){var c,h=1/Math.tan(e/2);return t[0]=h/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,l!=null&&l!==1/0?(t[10]=(l+a)*(c=1/(a-l)),t[14]=2*l*a*c):(t[10]=-1,t[14]=-2*a),t},u.pick=function(t,e){for(var r={},a=0;a<e.length;a++){var l=e[a];l in t&&(r[l]=t[l])}return r},u.plugin=Ue,u.polygonIntersectsPolygon=Rr,u.postMapLoadEvent=jo,u.postTurnstileEvent=Aa,u.potpack=hp,u.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],u.register=Pt,u.registerForPluginStateChange=function(t){return t({pluginStatus:Gr,pluginURL:xn}),el.on("pluginStateChange",t),t},u.renderColorRamp=Wc,u.rotate=function(t,e,r){var a=e[0],l=e[1],c=e[2],h=e[3],m=Math.sin(r),g=Math.cos(r);return t[0]=a*g+c*m,t[1]=l*g+h*m,t[2]=a*-m+c*g,t[3]=l*-m+h*g,t},u.rotateX=function(t,e,r){var a=Math.sin(r),l=Math.cos(r),c=e[4],h=e[5],m=e[6],g=e[7],v=e[8],x=e[9],b=e[10],T=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=c*l+v*a,t[5]=h*l+x*a,t[6]=m*l+b*a,t[7]=g*l+T*a,t[8]=v*l-c*a,t[9]=x*l-h*a,t[10]=b*l-m*a,t[11]=T*l-g*a,t},u.rotateZ=function(t,e,r){var a=Math.sin(r),l=Math.cos(r),c=e[0],h=e[1],m=e[2],g=e[3],v=e[4],x=e[5],b=e[6],T=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*l+v*a,t[1]=h*l+x*a,t[2]=m*l+b*a,t[3]=g*l+T*a,t[4]=v*l-c*a,t[5]=x*l-h*a,t[6]=b*l-m*a,t[7]=T*l-g*a,t},u.scale=function(t,e,r){var a=r[0],l=r[1],c=r[2];return t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a,t[4]=e[4]*l,t[5]=e[5]*l,t[6]=e[6]*l,t[7]=e[7]*l,t[8]=e[8]*c,t[9]=e[9]*c,t[10]=e[10]*c,t[11]=e[11]*c,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},u.scale$1=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},u.scale$2=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},u.setCacheLimits=function(t,e){vo=t,Pa=e},u.setRTLTextPlugin=function(t,e,r){if(r===void 0&&(r=!1),Gr==="deferred"||Gr==="loading"||Gr==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");xn=Gi.resolveURL(t),Gr="deferred",$s=e,tl(),r||su()},u.sphericalToCartesian=function(t){var e=t[0],r=t[1],a=t[2];return r+=90,r*=Math.PI/180,a*=Math.PI/180,{x:e*Math.cos(r)*Math.sin(a),y:e*Math.sin(r)*Math.sin(a),z:e*Math.cos(a)}},u.sqrLen=function(t){var e=t[0],r=t[1];return e*e+r*r},u.styleSpec=D,u.sub=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t},u.symbolSize=jf,u.transformMat3=function(t,e,r){var a=e[0],l=e[1],c=e[2];return t[0]=a*r[0]+l*r[3]+c*r[6],t[1]=a*r[1]+l*r[4]+c*r[7],t[2]=a*r[2]+l*r[5]+c*r[8],t},u.transformMat4=is,u.translate=function(t,e,r){var a,l,c,h,m,g,v,x,b,T,A,L,R=r[0],W=r[1],q=r[2];return e===t?(t[12]=e[0]*R+e[4]*W+e[8]*q+e[12],t[13]=e[1]*R+e[5]*W+e[9]*q+e[13],t[14]=e[2]*R+e[6]*W+e[10]*q+e[14],t[15]=e[3]*R+e[7]*W+e[11]*q+e[15]):(l=e[1],c=e[2],h=e[3],m=e[4],g=e[5],v=e[6],x=e[7],b=e[8],T=e[9],A=e[10],L=e[11],t[0]=a=e[0],t[1]=l,t[2]=c,t[3]=h,t[4]=m,t[5]=g,t[6]=v,t[7]=x,t[8]=b,t[9]=T,t[10]=A,t[11]=L,t[12]=a*R+m*W+b*q+e[12],t[13]=l*R+g*W+T*q+e[13],t[14]=c*R+v*W+A*q+e[14],t[15]=h*R+x*W+L*q+e[15]),t},u.triggerPluginCompletionEvent=Qa,u.uniqueId=uo,u.validateCustomStyleLayer=function(t){var e=[],r=t.id;return r===void 0&&e.push({message:"layers."+r+': missing required property "id"'}),t.render===void 0&&e.push({message:"layers."+r+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),e},u.validateLight=rc,u.validateStyle=ea,u.values=function(t){var e=[];for(var r in t)e.push(t[r]);return e},u.vectorTile=ss,u.version="1.15.2",u.warnOnce=qe,u.webpSupported=Ri,u.window=vt,u.wrap=Ti}),ht(["./shared"],function(u){function Ot(w){var I=typeof w;if(I==="number"||I==="boolean"||I==="string"||w==null)return JSON.stringify(w);if(Array.isArray(w)){for(var E="[",C=0,F=w;C<F.length;C+=1)E+=Ot(F[C])+",";return E+"]"}for(var K=Object.keys(w).sort(),J="{",X=0;X<K.length;X++)J+=JSON.stringify(K[X])+":"+Ot(w[K[X]])+",";return J+"}"}function st(w){for(var I="",E=0,C=u.refProperties;E<C.length;E+=1)I+="/"+Ot(w[C[E]]);return I}var Mt=function(w){this.keyCache={},w&&this.replace(w)};Mt.prototype.replace=function(w){this._layerConfigs={},this._layers={},this.update(w,[])},Mt.prototype.update=function(w,I){for(var E=this,C=0,F=w;C<F.length;C+=1){var K=F[C];this._layerConfigs[K.id]=K;var J=this._layers[K.id]=u.createStyleLayer(K);J._featureFilter=u.featureFilter(J.filter),this.keyCache[K.id]&&delete this.keyCache[K.id]}for(var X=0,D=I;X<D.length;X+=1){var j=D[X];delete this.keyCache[j],delete this._layerConfigs[j],delete this._layers[j]}this.familiesBySource={};for(var dt=0,xt=function(wt,ft){for(var Qt={},$t=0;$t<wt.length;$t++){var Lt=ft&&ft[wt[$t].id]||st(wt[$t]);ft&&(ft[wt[$t].id]=Lt);var Te=Qt[Lt];Te||(Te=Qt[Lt]=[]),Te.push(wt[$t])}var oe=[];for(var Ae in Qt)oe.push(Qt[Ae]);return oe}(u.values(this._layerConfigs),this.keyCache);dt<xt.length;dt+=1){var et=xt[dt].map(function(wt){return E._layers[wt.id]}),mt=et[0];if(mt.visibility!=="none"){var At=mt.source||"",zt=this.familiesBySource[At];zt||(zt=this.familiesBySource[At]={});var Ft=mt.sourceLayer||"_geojsonTileLayer",pt=zt[Ft];pt||(pt=zt[Ft]=[]),pt.push(et)}}};var Dt=function(w){var I={},E=[];for(var C in w){var F=w[C],K=I[C]={};for(var J in F){var X=F[+J];if(X&&X.bitmap.width!==0&&X.bitmap.height!==0){var D={x:0,y:0,w:X.bitmap.width+2,h:X.bitmap.height+2};E.push(D),K[J]={rect:D,metrics:X.metrics}}}}var j=u.potpack(E),dt=new u.AlphaImage({width:j.w||1,height:j.h||1});for(var xt in w){var et=w[xt];for(var mt in et){var At=et[+mt];if(At&&At.bitmap.width!==0&&At.bitmap.height!==0){var zt=I[xt][mt].rect;u.AlphaImage.copy(At.bitmap,dt,{x:0,y:0},{x:zt.x+1,y:zt.y+1},At.bitmap)}}}this.image=dt,this.positions=I};u.register("GlyphAtlas",Dt);var Ke=function(w){this.tileID=new u.OverscaledTileID(w.tileID.overscaledZ,w.tileID.wrap,w.tileID.canonical.z,w.tileID.canonical.x,w.tileID.canonical.y),this.uid=w.uid,this.zoom=w.zoom,this.pixelRatio=w.pixelRatio,this.tileSize=w.tileSize,this.source=w.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=w.showCollisionBoxes,this.collectResourceTiming=!!w.collectResourceTiming,this.returnDependencies=!!w.returnDependencies,this.promoteId=w.promoteId};function vt(w,I,E){for(var C=new u.EvaluationParameters(I),F=0,K=w;F<K.length;F+=1)K[F].recalculate(C,E)}function mr(w,I){var E=u.getArrayBuffer(w.request,function(C,F,K,J){C?I(C):F&&I(null,{vectorTile:new u.vectorTile.VectorTile(new u.pbf(F)),rawData:F,cacheControl:K,expires:J})});return function(){E.cancel(),I()}}Ke.prototype.parse=function(w,I,E,C,F){var K=this;this.status="parsing",this.data=w,this.collisionBoxArray=new u.CollisionBoxArray;var J=new u.DictionaryCoder(Object.keys(w.layers).sort()),X=new u.FeatureIndex(this.tileID,this.promoteId);X.bucketLayerIDs=[];var D,j,dt,xt,et={},mt={featureIndex:X,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:E},At=I.familiesBySource[this.source];for(var zt in At){var Ft=w.layers[zt];if(Ft){Ft.version===1&&u.warnOnce('Vector tile source "'+this.source+'" layer "'+zt+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var pt=J.encode(zt),wt=[],ft=0;ft<Ft.length;ft++){var Qt=Ft.feature(ft),$t=X.getId(Qt,zt);wt.push({feature:Qt,id:$t,index:ft,sourceLayerIndex:pt})}for(var Lt=0,Te=At[zt];Lt<Te.length;Lt+=1){var oe=Te[Lt],Ae=oe[0];Ae.minzoom&&this.zoom<Math.floor(Ae.minzoom)||Ae.maxzoom&&this.zoom>=Ae.maxzoom||Ae.visibility!=="none"&&(vt(oe,this.zoom,E),(et[Ae.id]=Ae.createBucket({index:X.bucketLayerIDs.length,layers:oe,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:pt,sourceID:this.source})).populate(wt,mt,this.tileID.canonical),X.bucketLayerIDs.push(oe.map(function(Ee){return Ee.id})))}}}var Ce=u.mapObject(mt.glyphDependencies,function(Ee){return Object.keys(Ee).map(Number)});Object.keys(Ce).length?C.send("getGlyphs",{uid:this.uid,stacks:Ce},function(Ee,ie){D||(D=Ee,j=ie,Ne.call(K))}):j={};var ce=Object.keys(mt.iconDependencies);ce.length?C.send("getImages",{icons:ce,source:this.source,tileID:this.tileID,type:"icons"},function(Ee,ie){D||(D=Ee,dt=ie,Ne.call(K))}):dt={};var Ie=Object.keys(mt.patternDependencies);function Ne(){if(D)return F(D);if(j&&dt&&xt){var Ee=new Dt(j),ie=new u.ImageAtlas(dt,xt);for(var bo in et){var se=et[bo];se instanceof u.SymbolBucket?(vt(se.layers,this.zoom,E),u.performSymbolLayout(se,j,Ee.positions,dt,ie.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):se.hasPattern&&(se instanceof u.LineBucket||se instanceof u.FillBucket||se instanceof u.FillExtrusionBucket)&&(vt(se.layers,this.zoom,E),se.addFeatures(mt,this.tileID.canonical,ie.patternPositions))}this.status="done",F(null,{buckets:u.values(et).filter(function(Un){return!Un.isEmpty()}),featureIndex:X,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ee.image,imageAtlas:ie,glyphMap:this.returnDependencies?j:null,iconMap:this.returnDependencies?dt:null,glyphPositions:this.returnDependencies?Ee.positions:null})}}Ie.length?C.send("getImages",{icons:Ie,source:this.source,tileID:this.tileID,type:"patterns"},function(Ee,ie){D||(D=Ee,xt=ie,Ne.call(K))}):xt={},Ne.call(this)};var rr=function(w,I,E,C){this.actor=w,this.layerIndex=I,this.availableImages=E,this.loadVectorData=C||mr,this.loading={},this.loaded={}};rr.prototype.loadTile=function(w,I){var E=this,C=w.uid;this.loading||(this.loading={});var F=!!(w&&w.request&&w.request.collectResourceTiming)&&new u.RequestPerformance(w.request),K=this.loading[C]=new Ke(w);K.abort=this.loadVectorData(w,function(J,X){if(delete E.loading[C],J||!X)return K.status="done",E.loaded[C]=K,I(J);var D=X.rawData,j={};X.expires&&(j.expires=X.expires),X.cacheControl&&(j.cacheControl=X.cacheControl);var dt={};if(F){var xt=F.finish();xt&&(dt.resourceTiming=JSON.parse(JSON.stringify(xt)))}K.vectorTile=X.vectorTile,K.parse(X.vectorTile,E.layerIndex,E.availableImages,E.actor,function(et,mt){if(et||!mt)return I(et);I(null,u.extend({rawTileData:D.slice(0)},mt,j,dt))}),E.loaded=E.loaded||{},E.loaded[C]=K})},rr.prototype.reloadTile=function(w,I){var E=this,C=this.loaded,F=w.uid,K=this;if(C&&C[F]){var J=C[F];J.showCollisionBoxes=w.showCollisionBoxes;var X=function(D,j){var dt=J.reloadCallback;dt&&(delete J.reloadCallback,J.parse(J.vectorTile,K.layerIndex,E.availableImages,K.actor,dt)),I(D,j)};J.status==="parsing"?J.reloadCallback=X:J.status==="done"&&(J.vectorTile?J.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor,X):X())}},rr.prototype.abortTile=function(w,I){var E=this.loading,C=w.uid;E&&E[C]&&E[C].abort&&(E[C].abort(),delete E[C]),I()},rr.prototype.removeTile=function(w,I){var E=this.loaded,C=w.uid;E&&E[C]&&delete E[C],I()};var De=u.window.ImageBitmap,Tr=function(){this.loaded={}};function Ti(w,I){if(w.length!==0){He(w[0],I);for(var E=1;E<w.length;E++)He(w[E],!I)}}function He(w,I){for(var E=0,C=0,F=w.length,K=F-1;C<F;K=C++)E+=(w[C][0]-w[K][0])*(w[K][1]+w[C][1]);E>=0!=!!I&&w.reverse()}Tr.prototype.loadTile=function(w,I){var E=w.uid,C=w.encoding,F=w.rawImageData,K=De&&F instanceof De?this.getImageData(F):F,J=new u.DEMData(E,K,C);this.loaded=this.loaded||{},this.loaded[E]=J,I(null,J)},Tr.prototype.getImageData=function(w){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(w.width,w.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=w.width,this.offscreenCanvas.height=w.height,this.offscreenCanvasContext.drawImage(w,0,0,w.width,w.height);var I=this.offscreenCanvasContext.getImageData(-1,-1,w.width+2,w.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new u.RGBAImage({width:I.width,height:I.height},I.data)},Tr.prototype.removeTile=function(w){var I=this.loaded,E=w.uid;I&&I[E]&&delete I[E]};var Sa=u.vectorTile.VectorTileFeature.prototype.toGeoJSON,uo=function(w){this._feature=w,this.extent=u.EXTENT,this.type=w.type,this.properties=w.tags,"id"in w&&!isNaN(w.id)&&(this.id=parseInt(w.id,10))};uo.prototype.loadGeometry=function(){if(this._feature.type===1){for(var w=[],I=0,E=this._feature.geometry;I<E.length;I+=1){var C=E[I];w.push([new u.Point$1(C[0],C[1])])}return w}for(var F=[],K=0,J=this._feature.geometry;K<J.length;K+=1){for(var X=[],D=0,j=J[K];D<j.length;D+=1){var dt=j[D];X.push(new u.Point$1(dt[0],dt[1]))}F.push(X)}return F},uo.prototype.toGeoJSON=function(w,I,E){return Sa.call(this,w,I,E)};var qi=function(w){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.EXTENT,this.length=w.length,this._features=w};qi.prototype.feature=function(w){return new uo(this._features[w])};var co=u.vectorTile.VectorTileFeature,po=kn;function kn(w,I){this.options=I||{},this.features=w,this.length=w.length}function kr(w,I){this.id=typeof w.id=="number"?w.id:void 0,this.type=w.type,this.rawGeometry=w.type===1?[w.geometry]:w.geometry,this.properties=w.tags,this.extent=I||4096}kn.prototype.feature=function(w){return new kr(this.features[w],this.options.extent)},kr.prototype.loadGeometry=function(){var w=this.rawGeometry;this.geometry=[];for(var I=0;I<w.length;I++){for(var E=w[I],C=[],F=0;F<E.length;F++)C.push(new u.Point$1(E[F][0],E[F][1]));this.geometry.push(C)}return this.geometry},kr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var w=this.geometry,I=1/0,E=-1/0,C=1/0,F=-1/0,K=0;K<w.length;K++)for(var J=w[K],X=0;X<J.length;X++){var D=J[X];I=Math.min(I,D.x),E=Math.max(E,D.x),C=Math.min(C,D.y),F=Math.max(F,D.y)}return[I,C,E,F]},kr.prototype.toGeoJSON=co.prototype.toGeoJSON;var Zi=ho,Ii=po;function ho(w){var I=new u.pbf;return function(E,C){for(var F in E.layers)C.writeMessage(3,qe,E.layers[F])}(w,I),I.finish()}function qe(w,I){var E;I.writeVarintField(15,w.version||1),I.writeStringField(1,w.name||""),I.writeVarintField(5,w.extent||4096);var C={keys:[],values:[],keycache:{},valuecache:{}};for(E=0;E<w.length;E++)C.feature=w.feature(E),I.writeMessage(2,Kr,C);var F=C.keys;for(E=0;E<F.length;E++)I.writeStringField(3,F[E]);var K=C.values;for(E=0;E<K.length;E++)I.writeMessage(4,Ia,K[E])}function Kr(w,I){var E=w.feature;E.id!==void 0&&I.writeVarintField(1,E.id),I.writeMessage(2,Ta,w),I.writeVarintField(3,E.type),I.writeMessage(4,mo,E)}function Ta(w,I){var E=w.feature,C=w.keys,F=w.values,K=w.keycache,J=w.valuecache;for(var X in E.properties){var D=K[X];D===void 0&&(C.push(X),K[X]=D=C.length-1),I.writeVarint(D);var j=E.properties[X],dt=typeof j;dt!=="string"&&dt!=="boolean"&&dt!=="number"&&(j=JSON.stringify(j));var xt=dt+":"+j,et=J[xt];et===void 0&&(F.push(j),J[xt]=et=F.length-1),I.writeVarint(et)}}function ii(w,I){return(I<<3)+(7&w)}function fo(w){return w<<1^w>>31}function mo(w,I){for(var E=w.loadGeometry(),C=w.type,F=0,K=0,J=E.length,X=0;X<J;X++){var D=E[X],j=1;C===1&&(j=D.length),I.writeVarint(ii(1,j));for(var dt=C===3?D.length-1:D.length,xt=0;xt<dt;xt++){xt===1&&C!==1&&I.writeVarint(ii(2,dt-1));var et=D[xt].x-F,mt=D[xt].y-K;I.writeVarint(fo(et)),I.writeVarint(fo(mt)),F+=et,K+=mt}C===3&&I.writeVarint(ii(7,1))}}function Ia(w,I){var E=typeof w;E==="string"?I.writeStringField(1,w):E==="boolean"?I.writeBooleanField(7,w):E==="number"&&(w%1!=0?I.writeDoubleField(3,w):w<0?I.writeSVarintField(6,w):I.writeVarintField(5,w))}function on(w,I,E,C){Ei(w,E,C),Ei(I,2*E,2*C),Ei(I,2*E+1,2*C+1)}function Ei(w,I,E){var C=w[I];w[I]=w[E],w[E]=C}function Li(w,I,E,C){var F=w-E,K=I-C;return F*F+K*K}Zi.fromVectorTileJs=ho,Zi.fromGeojsonVt=function(w,I){I=I||{};var E={};for(var C in w)E[C]=new po(w[C].features,I),E[C].name=C,E[C].version=I.version,E[C].extent=I.extent;return ho({layers:E})},Zi.GeoJSONWrapper=Ii;var Cn=function(w){return w[0]},Mn=function(w){return w[1]},an=function(w,I,E,C,F){I===void 0&&(I=Cn),E===void 0&&(E=Mn),C===void 0&&(C=64),F===void 0&&(F=Float64Array),this.nodeSize=C,this.points=w;for(var K=w.length<65536?Uint16Array:Uint32Array,J=this.ids=new K(w.length),X=this.coords=new F(2*w.length),D=0;D<w.length;D++)J[D]=D,X[2*D]=I(w[D]),X[2*D+1]=E(w[D]);(function j(dt,xt,et,mt,At,zt){if(!(At-mt<=et)){var Ft=mt+At>>1;(function pt(wt,ft,Qt,$t,Lt,Te){for(;Lt>$t;){if(Lt-$t>600){var oe=Lt-$t+1,Ae=Qt-$t+1,Ce=Math.log(oe),ce=.5*Math.exp(2*Ce/3),Ie=.5*Math.sqrt(Ce*ce*(oe-ce)/oe)*(Ae-oe/2<0?-1:1);pt(wt,ft,Qt,Math.max($t,Math.floor(Qt-Ae*ce/oe+Ie)),Math.min(Lt,Math.floor(Qt+(oe-Ae)*ce/oe+Ie)),Te)}var Ne=ft[2*Qt+Te],Ee=$t,ie=Lt;for(on(wt,ft,$t,Qt),ft[2*Lt+Te]>Ne&&on(wt,ft,$t,Lt);Ee<ie;){for(on(wt,ft,Ee,ie),Ee++,ie--;ft[2*Ee+Te]<Ne;)Ee++;for(;ft[2*ie+Te]>Ne;)ie--}ft[2*$t+Te]===Ne?on(wt,ft,$t,ie):on(wt,ft,++ie,Lt),ie<=Qt&&($t=ie+1),Qt<=ie&&(Lt=ie-1)}})(dt,xt,Ft,mt,At,zt%2),j(dt,xt,et,mt,Ft-1,zt+1),j(dt,xt,et,Ft+1,At,zt+1)}})(J,X,C,0,J.length-1,0)};an.prototype.range=function(w,I,E,C){return function(F,K,J,X,D,j,dt){for(var xt,et,mt=[0,F.length-1,0],At=[];mt.length;){var zt=mt.pop(),Ft=mt.pop(),pt=mt.pop();if(Ft-pt<=dt)for(var wt=pt;wt<=Ft;wt++)et=K[2*wt+1],(xt=K[2*wt])>=J&&xt<=D&&et>=X&&et<=j&&At.push(F[wt]);else{var ft=Math.floor((pt+Ft)/2);et=K[2*ft+1],(xt=K[2*ft])>=J&&xt<=D&&et>=X&&et<=j&&At.push(F[ft]);var Qt=(zt+1)%2;(zt===0?J<=xt:X<=et)&&(mt.push(pt),mt.push(ft-1),mt.push(Qt)),(zt===0?D>=xt:j>=et)&&(mt.push(ft+1),mt.push(Ft),mt.push(Qt))}}return At}(this.ids,this.coords,w,I,E,C,this.nodeSize)},an.prototype.within=function(w,I,E){return function(C,F,K,J,X,D){for(var j=[0,C.length-1,0],dt=[],xt=X*X;j.length;){var et=j.pop(),mt=j.pop(),At=j.pop();if(mt-At<=D)for(var zt=At;zt<=mt;zt++)Li(F[2*zt],F[2*zt+1],K,J)<=xt&&dt.push(C[zt]);else{var Ft=Math.floor((At+mt)/2),pt=F[2*Ft],wt=F[2*Ft+1];Li(pt,wt,K,J)<=xt&&dt.push(C[Ft]);var ft=(et+1)%2;(et===0?K-X<=pt:J-X<=wt)&&(j.push(At),j.push(Ft-1),j.push(ft)),(et===0?K+X>=pt:J+X>=wt)&&(j.push(Ft+1),j.push(mt),j.push(ft))}}return dt}(this.ids,this.coords,w,I,E,this.nodeSize)};var Ls={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(w){return w}},Cr=function(w){this.options=sn(Object.create(Ls),w),this.trees=new Array(this.options.maxZoom+1)};function Gi(w,I,E,C,F){return{x:w,y:I,zoom:1/0,id:E,parentId:-1,numPoints:C,properties:F}}function ve(w,I){var E=w.geometry.coordinates,C=E[1];return{x:Ai(E[0]),y:le(C),zoom:1/0,index:I,parentId:-1}}function Ri(w){return{type:"Feature",id:w.id,properties:yo(w),geometry:{type:"Point",coordinates:[(C=w.x,360*(C-.5)),(I=w.y,E=(180-360*I)*Math.PI/180,360*Math.atan(Math.exp(E))/Math.PI-90)]}};var I,E,C}function yo(w){var I=w.numPoints,E=I>=1e4?Math.round(I/1e3)+"k":I>=1e3?Math.round(I/100)/10+"k":I;return sn(sn({},w.properties),{cluster:!0,cluster_id:w.id,point_count:I,point_count_abbreviated:E})}function Ai(w){return w/360+.5}function le(w){var I=Math.sin(w*Math.PI/180),E=.5-.25*Math.log((1+I)/(1-I))/Math.PI;return E<0?0:E>1?1:E}function sn(w,I){for(var E in I)w[E]=I[E];return w}function Mr(w){return w.x}function pi(w){return w.y}function Rs(w,I,E,C,F,K){var J=F-E,X=K-C;if(J!==0||X!==0){var D=((w-E)*J+(I-C)*X)/(J*J+X*X);D>1?(E=F,C=K):D>0&&(E+=J*D,C+=X*D)}return(J=w-E)*J+(X=I-C)*X}function Pi(w,I,E,C){var F={id:w===void 0?null:w,type:I,geometry:E,tags:C,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(K){var J=K.geometry,X=K.type;if(X==="Point"||X==="MultiPoint"||X==="LineString")Vo(K,J);else if(X==="Polygon"||X==="MultiLineString")for(var D=0;D<J.length;D++)Vo(K,J[D]);else if(X==="MultiPolygon")for(D=0;D<J.length;D++)for(var j=0;j<J[D].length;j++)Vo(K,J[D][j])}(F),F}function Vo(w,I){for(var E=0;E<I.length;E+=3)w.minX=Math.min(w.minX,I[E]),w.minY=Math.min(w.minY,I[E+1]),w.maxX=Math.max(w.maxX,I[E]),w.maxY=Math.max(w.maxY,I[E+1])}function hi(w,I,E,C){if(I.geometry){var F=I.geometry.coordinates,K=I.geometry.type,J=Math.pow(E.tolerance/((1<<E.maxZoom)*E.extent),2),X=[],D=I.id;if(E.promoteId?D=I.properties[E.promoteId]:E.generateId&&(D=C||0),K==="Point")Dn(F,X);else if(K==="MultiPoint")for(var j=0;j<F.length;j++)Dn(F[j],X);else if(K==="LineString")go(F,X,J,!1);else if(K==="MultiLineString"){if(E.lineMetrics){for(j=0;j<F.length;j++)go(F[j],X=[],J,!1),w.push(Pi(D,"LineString",X,I.properties));return}fi(F,X,J,!1)}else if(K==="Polygon")fi(F,X,J,!0);else{if(K!=="MultiPolygon"){if(K==="GeometryCollection"){for(j=0;j<I.geometry.geometries.length;j++)hi(w,{id:D,geometry:I.geometry.geometries[j],properties:I.properties},E,C);return}throw new Error("Input data is not a valid GeoJSON object.")}for(j=0;j<F.length;j++){var dt=[];fi(F[j],dt,J,!0),X.push(dt)}}w.push(Pi(D,K,X,I.properties))}}function Dn(w,I){I.push(di(w[0])),I.push(Ln(w[1])),I.push(0)}function go(w,I,E,C){for(var F,K,J=0,X=0;X<w.length;X++){var D=di(w[X][0]),j=Ln(w[X][1]);I.push(D),I.push(j),I.push(0),X>0&&(J+=C?(F*j-D*K)/2:Math.sqrt(Math.pow(D-F,2)+Math.pow(j-K,2))),F=D,K=j}var dt=I.length-3;I[2]=1,function xt(et,mt,At,zt){for(var Ft,pt=zt,wt=At-mt>>1,ft=At-mt,Qt=et[mt],$t=et[mt+1],Lt=et[At],Te=et[At+1],oe=mt+3;oe<At;oe+=3){var Ae=Rs(et[oe],et[oe+1],Qt,$t,Lt,Te);if(Ae>pt)Ft=oe,pt=Ae;else if(Ae===pt){var Ce=Math.abs(oe-wt);Ce<ft&&(Ft=oe,ft=Ce)}}pt>zt&&(Ft-mt>3&&xt(et,mt,Ft,zt),et[Ft+2]=pt,At-Ft>3&&xt(et,Ft,At,zt))}(I,0,dt,E),I[dt+2]=1,I.size=Math.abs(J),I.start=0,I.end=I.size}function fi(w,I,E,C){for(var F=0;F<w.length;F++){var K=[];go(w[F],K,E,C),I.push(K)}}function di(w){return w/360+.5}function Ln(w){var I=Math.sin(w*Math.PI/180),E=.5-.25*Math.log((1+I)/(1-I))/Math.PI;return E<0?0:E>1?1:E}function zi(w,I,E,C,F,K,J,X){if(C/=I,K>=(E/=I)&&J<C)return w;if(J<E||K>=C)return null;for(var D=[],j=0;j<w.length;j++){var dt=w[j],xt=dt.geometry,et=dt.type,mt=F===0?dt.minX:dt.minY,At=F===0?dt.maxX:dt.maxY;if(mt>=E&&At<C)D.push(dt);else if(!(At<E||mt>=C)){var zt=[];if(et==="Point"||et==="MultiPoint")Ea(xt,zt,E,C,F);else if(et==="LineString")Aa(xt,zt,E,C,F,!1,X.lineMetrics);else if(et==="MultiLineString")jo(xt,zt,E,C,F,!1);else if(et==="Polygon")jo(xt,zt,E,C,F,!0);else if(et==="MultiPolygon")for(var Ft=0;Ft<xt.length;Ft++){var pt=[];jo(xt[Ft],pt,E,C,F,!0),pt.length&&zt.push(pt)}if(zt.length){if(X.lineMetrics&&et==="LineString"){for(Ft=0;Ft<zt.length;Ft++)D.push(Pi(dt.id,et,zt[Ft],dt.tags));continue}et!=="LineString"&&et!=="MultiLineString"||(zt.length===1?(et="LineString",zt=zt[0]):et="MultiLineString"),et!=="Point"&&et!=="MultiPoint"||(et=zt.length===3?"Point":"MultiPoint"),D.push(Pi(dt.id,et,zt,dt.tags))}}}return D.length?D:null}function Ea(w,I,E,C,F){for(var K=0;K<w.length;K+=3){var J=w[K+F];J>=E&&J<=C&&(I.push(w[K]),I.push(w[K+1]),I.push(w[K+2]))}}function Aa(w,I,E,C,F,K,J){for(var X,D,j=No(w),dt=F===0?Pa:_o,xt=w.start,et=0;et<w.length-3;et+=3){var mt=w[et],At=w[et+1],zt=w[et+2],Ft=w[et+3],pt=w[et+4],wt=F===0?mt:At,ft=F===0?Ft:pt,Qt=!1;J&&(X=Math.sqrt(Math.pow(mt-Ft,2)+Math.pow(At-pt,2))),wt<E?ft>E&&(D=dt(j,mt,At,Ft,pt,E),J&&(j.start=xt+X*D)):wt>C?ft<C&&(D=dt(j,mt,At,Ft,pt,C),J&&(j.start=xt+X*D)):vo(j,mt,At,zt),ft<E&&wt>=E&&(D=dt(j,mt,At,Ft,pt,E),Qt=!0),ft>C&&wt<=C&&(D=dt(j,mt,At,Ft,pt,C),Qt=!0),!K&&Qt&&(J&&(j.end=xt+X*D),I.push(j),j=No(w)),J&&(xt+=X)}var $t=w.length-3;mt=w[$t],At=w[$t+1],zt=w[$t+2],(wt=F===0?mt:At)>=E&&wt<=C&&vo(j,mt,At,zt),$t=j.length-3,K&&$t>=3&&(j[$t]!==j[0]||j[$t+1]!==j[1])&&vo(j,j[0],j[1],j[2]),j.length&&I.push(j)}function No(w){var I=[];return I.size=w.size,I.start=w.start,I.end=w.end,I}function jo(w,I,E,C,F,K){for(var J=0;J<w.length;J++)Aa(w[J],I,E,C,F,K,!1)}function vo(w,I,E,C){w.push(I),w.push(E),w.push(C)}function Pa(w,I,E,C,F,K){var J=(K-I)/(C-I);return w.push(K),w.push(E+(F-E)*J),w.push(1),J}function _o(w,I,E,C,F,K){var J=(K-E)/(F-E);return w.push(I+(C-I)*J),w.push(K),w.push(1),J}function qo(w,I){for(var E=[],C=0;C<w.length;C++){var F,K=w[C],J=K.type;if(J==="Point"||J==="MultiPoint"||J==="LineString")F=Rn(K.geometry,I);else if(J==="MultiLineString"||J==="Polygon"){F=[];for(var X=0;X<K.geometry.length;X++)F.push(Rn(K.geometry[X],I))}else if(J==="MultiPolygon")for(F=[],X=0;X<K.geometry.length;X++){for(var D=[],j=0;j<K.geometry[X].length;j++)D.push(Rn(K.geometry[X][j],I));F.push(D)}E.push(Pi(K.id,J,F,K.tags))}return E}function Rn(w,I){var E=[];E.size=w.size,w.start!==void 0&&(E.start=w.start,E.end=w.end);for(var C=0;C<w.length;C+=3)E.push(w[C]+I,w[C+1],w[C+2]);return E}function Zo(w,I){if(w.transformed)return w;var E,C,F,K=1<<w.z,J=w.x,X=w.y;for(E=0;E<w.features.length;E++){var D=w.features[E],j=D.geometry,dt=D.type;if(D.geometry=[],dt===1)for(C=0;C<j.length;C+=2)D.geometry.push(Go(j[C],j[C+1],I,K,J,X));else for(C=0;C<j.length;C++){var xt=[];for(F=0;F<j[C].length;F+=2)xt.push(Go(j[C][F],j[C][F+1],I,K,J,X));D.geometry.push(xt)}}return w.transformed=!0,w}function Go(w,I,E,C,F,K){return[Math.round(E*(w*C-F)),Math.round(E*(I*C-K))]}function za(w,I,E,C,F){for(var K=I===F.maxZoom?0:F.tolerance/((1<<I)*F.extent),J={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:E,y:C,z:I,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},X=0;X<w.length;X++){J.numFeatures++,ka(J,w[X],K,F);var D=w[X].minX,j=w[X].minY,dt=w[X].maxX,xt=w[X].maxY;D<J.minX&&(J.minX=D),j<J.minY&&(J.minY=j),dt>J.maxX&&(J.maxX=dt),xt>J.maxY&&(J.maxY=xt)}return J}function ka(w,I,E,C){var F=I.geometry,K=I.type,J=[];if(K==="Point"||K==="MultiPoint")for(var X=0;X<F.length;X+=3)J.push(F[X]),J.push(F[X+1]),w.numPoints++,w.numSimplified++;else if(K==="LineString")Bn(J,F,w,E,!1,!1);else if(K==="MultiLineString"||K==="Polygon")for(X=0;X<F.length;X++)Bn(J,F[X],w,E,K==="Polygon",X===0);else if(K==="MultiPolygon")for(var D=0;D<F.length;D++){var j=F[D];for(X=0;X<j.length;X++)Bn(J,j[X],w,E,!0,X===0)}if(J.length){var dt=I.tags||null;if(K==="LineString"&&C.lineMetrics){for(var xt in dt={},I.tags)dt[xt]=I.tags[xt];dt.mapbox_clip_start=F.start/F.size,dt.mapbox_clip_end=F.end/F.size}var et={geometry:J,type:K==="Polygon"||K==="MultiPolygon"?3:K==="LineString"||K==="MultiLineString"?2:1,tags:dt};I.id!==null&&(et.id=I.id),w.features.push(et)}}function Bn(w,I,E,C,F,K){var J=C*C;if(C>0&&I.size<(F?J:C))E.numPoints+=I.length/3;else{for(var X=[],D=0;D<I.length;D+=3)(C===0||I[D+2]>J)&&(E.numSimplified++,X.push(I[D]),X.push(I[D+1])),E.numPoints++;F&&function(j,dt){for(var xt=0,et=0,mt=j.length,At=mt-2;et<mt;At=et,et+=2)xt+=(j[et]-j[At])*(j[et+1]+j[At+1]);if(xt>0===dt)for(et=0,mt=j.length;et<mt/2;et+=2){var zt=j[et],Ft=j[et+1];j[et]=j[mt-2-et],j[et+1]=j[mt-1-et],j[mt-2-et]=zt,j[mt-1-et]=Ft}}(X,K),w.push(X)}}function On(w,I){var E=(I=this.options=function(F,K){for(var J in K)F[J]=K[J];return F}(Object.create(this.options),I)).debug;if(E&&console.time("preprocess data"),I.maxZoom<0||I.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(I.promoteId&&I.generateId)throw new Error("promoteId and generateId cannot be used together.");var C=function(F,K){var J=[];if(F.type==="FeatureCollection")for(var X=0;X<F.features.length;X++)hi(J,F.features[X],K,X);else hi(J,F.type==="Feature"?F:{geometry:F},K);return J}(w,I);this.tiles={},this.tileCoords=[],E&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",I.indexMaxZoom,I.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(C=function(F,K){var J=K.buffer/K.extent,X=F,D=zi(F,1,-1-J,J,0,-1,2,K),j=zi(F,1,1-J,2+J,0,-1,2,K);return(D||j)&&(X=zi(F,1,-J,1+J,0,-1,2,K)||[],D&&(X=qo(D,1).concat(X)),j&&(X=X.concat(qo(j,-1)))),X}(C,I)).length&&this.splitTile(C,0,0,0),E&&(C.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ln(w,I,E){return 32*((1<<w)*E+I)+w}function Fn(w,I){var E=w.tileID.canonical;if(!this._geoJSONIndex)return I(null,null);var C=this._geoJSONIndex.getTile(E.z,E.x,E.y);if(!C)return I(null,null);var F=new qi(C.features),K=Zi(F);K.byteOffset===0&&K.byteLength===K.buffer.byteLength||(K=new Uint8Array(K)),I(null,{vectorTile:F,rawData:K.buffer})}Cr.prototype.load=function(w){var I=this.options,E=I.log,C=I.minZoom,F=I.maxZoom,K=I.nodeSize;E&&console.time("total time");var J="prepare "+w.length+" points";E&&console.time(J),this.points=w;for(var X=[],D=0;D<w.length;D++)w[D].geometry&&X.push(ve(w[D],D));this.trees[F+1]=new an(X,Mr,pi,K,Float32Array),E&&console.timeEnd(J);for(var j=F;j>=C;j--){var dt=+Date.now();X=this._cluster(X,j),this.trees[j]=new an(X,Mr,pi,K,Float32Array),E&&console.log("z%d: %d clusters in %dms",j,X.length,+Date.now()-dt)}return E&&console.timeEnd("total time"),this},Cr.prototype.getClusters=function(w,I){var E=((w[0]+180)%360+360)%360-180,C=Math.max(-90,Math.min(90,w[1])),F=w[2]===180?180:((w[2]+180)%360+360)%360-180,K=Math.max(-90,Math.min(90,w[3]));if(w[2]-w[0]>=360)E=-180,F=180;else if(E>F){var J=this.getClusters([E,C,180,K],I),X=this.getClusters([-180,C,F,K],I);return J.concat(X)}for(var D=this.trees[this._limitZoom(I)],j=[],dt=0,xt=D.range(Ai(E),le(K),Ai(F),le(C));dt<xt.length;dt+=1){var et=D.points[xt[dt]];j.push(et.numPoints?Ri(et):this.points[et.index])}return j},Cr.prototype.getChildren=function(w){var I=this._getOriginId(w),E=this._getOriginZoom(w),C="No cluster with the specified id.",F=this.trees[E];if(!F)throw new Error(C);var K=F.points[I];if(!K)throw new Error(C);for(var J=this.options.radius/(this.options.extent*Math.pow(2,E-1)),X=[],D=0,j=F.within(K.x,K.y,J);D<j.length;D+=1){var dt=F.points[j[D]];dt.parentId===w&&X.push(dt.numPoints?Ri(dt):this.points[dt.index])}if(X.length===0)throw new Error(C);return X},Cr.prototype.getLeaves=function(w,I,E){var C=[];return this._appendLeaves(C,w,I=I||10,E=E||0,0),C},Cr.prototype.getTile=function(w,I,E){var C=this.trees[this._limitZoom(w)],F=Math.pow(2,w),K=this.options,J=K.radius/K.extent,X=(E-J)/F,D=(E+1+J)/F,j={features:[]};return this._addTileFeatures(C.range((I-J)/F,X,(I+1+J)/F,D),C.points,I,E,F,j),I===0&&this._addTileFeatures(C.range(1-J/F,X,1,D),C.points,F,E,F,j),I===F-1&&this._addTileFeatures(C.range(0,X,J/F,D),C.points,-1,E,F,j),j.features.length?j:null},Cr.prototype.getClusterExpansionZoom=function(w){for(var I=this._getOriginZoom(w)-1;I<=this.options.maxZoom;){var E=this.getChildren(w);if(I++,E.length!==1)break;w=E[0].properties.cluster_id}return I},Cr.prototype._appendLeaves=function(w,I,E,C,F){for(var K=0,J=this.getChildren(I);K<J.length;K+=1){var X=J[K],D=X.properties;if(D&&D.cluster?F+D.point_count<=C?F+=D.point_count:F=this._appendLeaves(w,D.cluster_id,E,C,F):F<C?F++:w.push(X),w.length===E)break}return F},Cr.prototype._addTileFeatures=function(w,I,E,C,F,K){for(var J=0,X=w;J<X.length;J+=1){var D=I[X[J]],j=D.numPoints,dt={type:1,geometry:[[Math.round(this.options.extent*(D.x*F-E)),Math.round(this.options.extent*(D.y*F-C))]],tags:j?yo(D):this.points[D.index].properties},xt=void 0;j?xt=D.id:this.options.generateId?xt=D.index:this.points[D.index].id&&(xt=this.points[D.index].id),xt!==void 0&&(dt.id=xt),K.features.push(dt)}},Cr.prototype._limitZoom=function(w){return Math.max(this.options.minZoom,Math.min(+w,this.options.maxZoom+1))},Cr.prototype._cluster=function(w,I){for(var E=[],C=this.options,F=C.reduce,K=C.minPoints,J=C.radius/(C.extent*Math.pow(2,I)),X=0;X<w.length;X++){var D=w[X];if(!(D.zoom<=I)){D.zoom=I;for(var j=this.trees[I+1],dt=j.within(D.x,D.y,J),xt=D.numPoints||1,et=xt,mt=0,At=dt;mt<At.length;mt+=1){var zt=j.points[At[mt]];zt.zoom>I&&(et+=zt.numPoints||1)}if(et>=K){for(var Ft=D.x*xt,pt=D.y*xt,wt=F&&xt>1?this._map(D,!0):null,ft=(X<<5)+(I+1)+this.points.length,Qt=0,$t=dt;Qt<$t.length;Qt+=1){var Lt=j.points[$t[Qt]];if(!(Lt.zoom<=I)){Lt.zoom=I;var Te=Lt.numPoints||1;Ft+=Lt.x*Te,pt+=Lt.y*Te,Lt.parentId=ft,F&&(wt||(wt=this._map(D,!0)),F(wt,this._map(Lt)))}}D.parentId=ft,E.push(Gi(Ft/et,pt/et,ft,et,wt))}else if(E.push(D),et>1)for(var oe=0,Ae=dt;oe<Ae.length;oe+=1){var Ce=j.points[Ae[oe]];Ce.zoom<=I||(Ce.zoom=I,E.push(Ce))}}}return E},Cr.prototype._getOriginId=function(w){return w-this.points.length>>5},Cr.prototype._getOriginZoom=function(w){return(w-this.points.length)%32},Cr.prototype._map=function(w,I){if(w.numPoints)return I?sn({},w.properties):w.properties;var E=this.points[w.index].properties,C=this.options.map(E);return I&&C===E?sn({},C):C},On.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},On.prototype.splitTile=function(w,I,E,C,F,K,J){for(var X=[w,I,E,C],D=this.options,j=D.debug;X.length;){C=X.pop(),E=X.pop(),I=X.pop(),w=X.pop();var dt=1<<I,xt=ln(I,E,C),et=this.tiles[xt];if(!et&&(j>1&&console.time("creation"),et=this.tiles[xt]=za(w,I,E,C,D),this.tileCoords.push({z:I,x:E,y:C}),j)){j>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",I,E,C,et.numFeatures,et.numPoints,et.numSimplified),console.timeEnd("creation"));var mt="z"+I;this.stats[mt]=(this.stats[mt]||0)+1,this.total++}if(et.source=w,F){if(I===D.maxZoom||I===F)continue;var At=1<<F-I;if(E!==Math.floor(K/At)||C!==Math.floor(J/At))continue}else if(I===D.indexMaxZoom||et.numPoints<=D.indexMaxPoints)continue;if(et.source=null,w.length!==0){j>1&&console.time("clipping");var zt,Ft,pt,wt,ft,Qt,$t=.5*D.buffer/D.extent,Lt=.5-$t,Te=.5+$t,oe=1+$t;zt=Ft=pt=wt=null,ft=zi(w,dt,E-$t,E+Te,0,et.minX,et.maxX,D),Qt=zi(w,dt,E+Lt,E+oe,0,et.minX,et.maxX,D),w=null,ft&&(zt=zi(ft,dt,C-$t,C+Te,1,et.minY,et.maxY,D),Ft=zi(ft,dt,C+Lt,C+oe,1,et.minY,et.maxY,D),ft=null),Qt&&(pt=zi(Qt,dt,C-$t,C+Te,1,et.minY,et.maxY,D),wt=zi(Qt,dt,C+Lt,C+oe,1,et.minY,et.maxY,D),Qt=null),j>1&&console.timeEnd("clipping"),X.push(zt||[],I+1,2*E,2*C),X.push(Ft||[],I+1,2*E,2*C+1),X.push(pt||[],I+1,2*E+1,2*C),X.push(wt||[],I+1,2*E+1,2*C+1)}}},On.prototype.getTile=function(w,I,E){var C=this.options,F=C.extent,K=C.debug;if(w<0||w>24)return null;var J=1<<w,X=ln(w,I=(I%J+J)%J,E);if(this.tiles[X])return Zo(this.tiles[X],F);K>1&&console.log("drilling down to z%d-%d-%d",w,I,E);for(var D,j=w,dt=I,xt=E;!D&&j>0;)j--,dt=Math.floor(dt/2),xt=Math.floor(xt/2),D=this.tiles[ln(j,dt,xt)];return D&&D.source?(K>1&&console.log("found parent tile z%d-%d-%d",j,dt,xt),K>1&&console.time("drilling down"),this.splitTile(D.source,j,dt,xt,w,I,E),K>1&&console.timeEnd("drilling down"),this.tiles[X]?Zo(this.tiles[X],F):null):null};var xo=function(w){function I(E,C,F,K){w.call(this,E,C,F,Fn),K&&(this.loadGeoJSON=K)}return w&&(I.__proto__=w),(I.prototype=Object.create(w&&w.prototype)).constructor=I,I.prototype.loadData=function(E,C){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=C,this._pendingLoadDataParams=E,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},I.prototype._loadData=function(){var E=this;if(this._pendingCallback&&this._pendingLoadDataParams){var C=this._pendingCallback,F=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var K=!!(F&&F.request&&F.request.collectResourceTiming)&&new u.RequestPerformance(F.request);this.loadGeoJSON(F,function(J,X){if(J||!X)return C(J);if(typeof X!="object")return C(new Error("Input data given to '"+F.source+"' is not a valid GeoJSON object."));(function et(mt,At){var zt,Ft=mt&&mt.type;if(Ft==="FeatureCollection")for(zt=0;zt<mt.features.length;zt++)et(mt.features[zt],At);else if(Ft==="GeometryCollection")for(zt=0;zt<mt.geometries.length;zt++)et(mt.geometries[zt],At);else if(Ft==="Feature")et(mt.geometry,At);else if(Ft==="Polygon")Ti(mt.coordinates,At);else if(Ft==="MultiPolygon")for(zt=0;zt<mt.coordinates.length;zt++)Ti(mt.coordinates[zt],At);return mt})(X,!0);try{if(F.filter){var D=u.createExpression(F.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(D.result==="error")throw new Error(D.value.map(function(et){return et.key+": "+et.message}).join(", "));var j=X.features.filter(function(et){return D.value.evaluate({zoom:0},et)});X={type:"FeatureCollection",features:j}}E._geoJSONIndex=F.cluster?new Cr(function(et){var mt=et.superclusterOptions,At=et.clusterProperties;if(!At||!mt)return mt;for(var zt={},Ft={},pt={accumulated:null,zoom:0},wt={properties:null},ft=Object.keys(At),Qt=0,$t=ft;Qt<$t.length;Qt+=1){var Lt=$t[Qt],Te=At[Lt],oe=Te[0],Ae=u.createExpression(Te[1]),Ce=u.createExpression(typeof oe=="string"?[oe,["accumulated"],["get",Lt]]:oe);zt[Lt]=Ae.value,Ft[Lt]=Ce.value}return mt.map=function(ce){wt.properties=ce;for(var Ie={},Ne=0,Ee=ft;Ne<Ee.length;Ne+=1){var ie=Ee[Ne];Ie[ie]=zt[ie].evaluate(pt,wt)}return Ie},mt.reduce=function(ce,Ie){wt.properties=Ie;for(var Ne=0,Ee=ft;Ne<Ee.length;Ne+=1){var ie=Ee[Ne];pt.accumulated=ce[ie],ce[ie]=Ft[ie].evaluate(pt,wt)}},mt}(F)).load(X.features):function(et,mt){return new On(et,mt)}(X,F.geojsonVtOptions)}catch(et){return C(et)}E.loaded={};var dt={};if(K){var xt=K.finish();xt&&(dt.resourceTiming={},dt.resourceTiming[F.source]=JSON.parse(JSON.stringify(xt)))}C(null,dt)})}},I.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},I.prototype.reloadTile=function(E,C){var F=this.loaded;return F&&F[E.uid]?w.prototype.reloadTile.call(this,E,C):this.loadTile(E,C)},I.prototype.loadGeoJSON=function(E,C){if(E.request)u.getJSON(E.request,C);else{if(typeof E.data!="string")return C(new Error("Input data given to '"+E.source+"' is not a valid GeoJSON object."));try{return C(null,JSON.parse(E.data))}catch{return C(new Error("Input data given to '"+E.source+"' is not a valid GeoJSON object."))}}},I.prototype.removeSource=function(E,C){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),C()},I.prototype.getClusterExpansionZoom=function(E,C){try{C(null,this._geoJSONIndex.getClusterExpansionZoom(E.clusterId))}catch(F){C(F)}},I.prototype.getClusterChildren=function(E,C){try{C(null,this._geoJSONIndex.getChildren(E.clusterId))}catch(F){C(F)}},I.prototype.getClusterLeaves=function(E,C){try{C(null,this._geoJSONIndex.getLeaves(E.clusterId,E.limit,E.offset))}catch(F){C(F)}},I}(rr),Ve=function(w){var I=this;this.self=w,this.actor=new u.Actor(w,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:rr,geojson:xo},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(E,C){if(I.workerSourceTypes[E])throw new Error('Worker source with name "'+E+'" already registered.');I.workerSourceTypes[E]=C},this.self.registerRTLTextPlugin=function(E){if(u.plugin.isParsed())throw new Error("RTL text plugin already registered.");u.plugin.applyArabicShaping=E.applyArabicShaping,u.plugin.processBidirectionalText=E.processBidirectionalText,u.plugin.processStyledBidirectionalText=E.processStyledBidirectionalText}};return Ve.prototype.setReferrer=function(w,I){this.referrer=I},Ve.prototype.setImages=function(w,I,E){for(var C in this.availableImages[w]=I,this.workerSources[w]){var F=this.workerSources[w][C];for(var K in F)F[K].availableImages=I}E()},Ve.prototype.setLayers=function(w,I,E){this.getLayerIndex(w).replace(I),E()},Ve.prototype.updateLayers=function(w,I,E){this.getLayerIndex(w).update(I.layers,I.removedIds),E()},Ve.prototype.loadTile=function(w,I,E){this.getWorkerSource(w,I.type,I.source).loadTile(I,E)},Ve.prototype.loadDEMTile=function(w,I,E){this.getDEMWorkerSource(w,I.source).loadTile(I,E)},Ve.prototype.reloadTile=function(w,I,E){this.getWorkerSource(w,I.type,I.source).reloadTile(I,E)},Ve.prototype.abortTile=function(w,I,E){this.getWorkerSource(w,I.type,I.source).abortTile(I,E)},Ve.prototype.removeTile=function(w,I,E){this.getWorkerSource(w,I.type,I.source).removeTile(I,E)},Ve.prototype.removeDEMTile=function(w,I){this.getDEMWorkerSource(w,I.source).removeTile(I)},Ve.prototype.removeSource=function(w,I,E){if(this.workerSources[w]&&this.workerSources[w][I.type]&&this.workerSources[w][I.type][I.source]){var C=this.workerSources[w][I.type][I.source];delete this.workerSources[w][I.type][I.source],C.removeSource!==void 0?C.removeSource(I,E):E()}},Ve.prototype.loadWorkerSource=function(w,I,E){try{this.self.importScripts(I.url),E()}catch(C){E(C.toString())}},Ve.prototype.syncRTLPluginState=function(w,I,E){try{u.plugin.setState(I);var C=u.plugin.getPluginURL();if(u.plugin.isLoaded()&&!u.plugin.isParsed()&&C!=null){this.self.importScripts(C);var F=u.plugin.isParsed();E(F?void 0:new Error("RTL Text Plugin failed to import scripts from "+C),F)}}catch(K){E(K.toString())}},Ve.prototype.getAvailableImages=function(w){var I=this.availableImages[w];return I||(I=[]),I},Ve.prototype.getLayerIndex=function(w){var I=this.layerIndexes[w];return I||(I=this.layerIndexes[w]=new Mt),I},Ve.prototype.getWorkerSource=function(w,I,E){var C=this;return this.workerSources[w]||(this.workerSources[w]={}),this.workerSources[w][I]||(this.workerSources[w][I]={}),this.workerSources[w][I][E]||(this.workerSources[w][I][E]=new this.workerSourceTypes[I]({send:function(F,K,J){C.actor.send(F,K,J,w)}},this.getLayerIndex(w),this.getAvailableImages(w))),this.workerSources[w][I][E]},Ve.prototype.getDEMWorkerSource=function(w,I){return this.demWorkerSources[w]||(this.demWorkerSources[w]={}),this.demWorkerSources[w][I]||(this.demWorkerSources[w][I]=new Tr),this.demWorkerSources[w][I]},Ve.prototype.enforceCacheSizeLimit=function(w,I){u.enforceCacheSizeLimit(I)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Ve(self)),Ve}),ht(["./shared"],function(u){var Ot=u.createCommonjsModule(function(i){function o(p){return!n(p)}function n(p){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var d,y,_=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(_);try{y=new Worker(S),d=!0}catch{d=!1}return y&&y.terminate(),URL.revokeObjectURL(S),d}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var d=document.createElement("canvas");d.width=d.height=1;var y=d.getContext("2d");if(!y)return!1;var _=y.getImageData(0,0,1,1);return _&&_.width===d.width}()?(s[f=p&&p.failIfMajorPerformanceCaveat]===void 0&&(s[f]=function(d){var y=function(S){var P=document.createElement("canvas"),k=Object.create(o.webGLContextAttributes);return k.failIfMajorPerformanceCaveat=S,P.probablySupportsContext?P.probablySupportsContext("webgl",k)||P.probablySupportsContext("experimental-webgl",k):P.supportsContext?P.supportsContext("webgl",k)||P.supportsContext("experimental-webgl",k):P.getContext("webgl",k)||P.getContext("experimental-webgl",k)}(d);if(!y)return!1;var _=y.createShader(y.VERTEX_SHADER);return!(!_||y.isContextLost())&&(y.shaderSource(_,"void main() {}"),y.compileShader(_),y.getShaderParameter(_,y.COMPILE_STATUS)===!0)}(f)),s[f]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var f}i.exports?i.exports=o:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=o,window.mapboxgl.notSupportedReason=n);var s={};o.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),st={create:function(i,o,n){var s=u.window.document.createElement(i);return o!==void 0&&(s.className=o),n&&n.appendChild(s),s},createNS:function(i,o){return u.window.document.createElementNS(i,o)}},Mt=u.window.document&&u.window.document.documentElement.style;function Dt(i){if(!Mt)return i[0];for(var o=0;o<i.length;o++)if(i[o]in Mt)return i[o];return i[0]}var Ke,vt=Dt(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);st.disableDrag=function(){Mt&&vt&&(Ke=Mt[vt],Mt[vt]="none")},st.enableDrag=function(){Mt&&vt&&(Mt[vt]=Ke)};var mr=Dt(["transform","WebkitTransform"]);st.setTransform=function(i,o){i.style[mr]=o};var rr=!1;try{var De=Object.defineProperty({},"passive",{get:function(){rr=!0}});u.window.addEventListener("test",De,De),u.window.removeEventListener("test",De,De)}catch{rr=!1}st.addEventListener=function(i,o,n,s){s===void 0&&(s={}),i.addEventListener(o,n,"passive"in s&&rr?s:s.capture)},st.removeEventListener=function(i,o,n,s){s===void 0&&(s={}),i.removeEventListener(o,n,"passive"in s&&rr?s:s.capture)};var Tr=function(i){i.preventDefault(),i.stopPropagation(),u.window.removeEventListener("click",Tr,!0)};function Ti(i){var o=i.userImage;return!!(o&&o.render&&o.render())&&(i.data.replace(new Uint8Array(o.data.buffer)),!0)}st.suppressClick=function(){u.window.addEventListener("click",Tr,!0),u.window.setTimeout(function(){u.window.removeEventListener("click",Tr,!0)},0)},st.mousePos=function(i,o){var n=i.getBoundingClientRect();return new u.Point(o.clientX-n.left-i.clientLeft,o.clientY-n.top-i.clientTop)},st.touchPos=function(i,o){for(var n=i.getBoundingClientRect(),s=[],p=0;p<o.length;p++)s.push(new u.Point(o[p].clientX-n.left-i.clientLeft,o[p].clientY-n.top-i.clientTop));return s},st.mouseButton=function(i){return u.window.InstallTrigger!==void 0&&i.button===2&&i.ctrlKey&&u.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:i.button},st.remove=function(i){i.parentNode&&i.parentNode.removeChild(i)};var He=function(i){function o(){i.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.RGBAImage({width:1,height:1}),this.dirty=!0}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.isLoaded=function(){return this.loaded},o.prototype.setLoaded=function(n){if(this.loaded!==n&&(this.loaded=n,n)){for(var s=0,p=this.requestors;s<p.length;s+=1){var f=p[s];this._notify(f.ids,f.callback)}this.requestors=[]}},o.prototype.getImage=function(n){return this.images[n]},o.prototype.addImage=function(n,s){this._validate(n,s)&&(this.images[n]=s)},o.prototype._validate=function(n,s){var p=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new u.ErrorEvent(new Error('Image "'+n+'" has invalid "stretchX" value'))),p=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new u.ErrorEvent(new Error('Image "'+n+'" has invalid "stretchY" value'))),p=!1),this._validateContent(s.content,s)||(this.fire(new u.ErrorEvent(new Error('Image "'+n+'" has invalid "content" value'))),p=!1),p},o.prototype._validateStretch=function(n,s){if(!n)return!0;for(var p=0,f=0,d=n;f<d.length;f+=1){var y=d[f];if(y[0]<p||y[1]<y[0]||s<y[1])return!1;p=y[1]}return!0},o.prototype._validateContent=function(n,s){return!(n&&(n.length!==4||n[0]<0||s.data.width<n[0]||n[1]<0||s.data.height<n[1]||n[2]<0||s.data.width<n[2]||n[3]<0||s.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))},o.prototype.updateImage=function(n,s){s.version=this.images[n].version+1,this.images[n]=s,this.updatedImages[n]=!0},o.prototype.removeImage=function(n){var s=this.images[n];delete this.images[n],delete this.patterns[n],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()},o.prototype.listImages=function(){return Object.keys(this.images)},o.prototype.getImages=function(n,s){var p=!0;if(!this.isLoaded())for(var f=0,d=n;f<d.length;f+=1)this.images[d[f]]||(p=!1);this.isLoaded()||p?this._notify(n,s):this.requestors.push({ids:n,callback:s})},o.prototype._notify=function(n,s){for(var p={},f=0,d=n;f<d.length;f+=1){var y=d[f];this.images[y]||this.fire(new u.Event("styleimagemissing",{id:y}));var _=this.images[y];_?p[y]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,hasRenderCallback:Boolean(_.userImage&&_.userImage.render)}:u.warnOnce('Image "'+y+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}s(null,p)},o.prototype.getPixelSize=function(){var n=this.atlasImage;return{width:n.width,height:n.height}},o.prototype.getPattern=function(n){var s=this.patterns[n],p=this.getImage(n);if(!p)return null;if(s&&s.position.version===p.version)return s.position;if(s)s.position.version=p.version;else{var f={w:p.data.width+2,h:p.data.height+2,x:0,y:0},d=new u.ImagePosition(f,p);this.patterns[n]={bin:f,position:d}}return this._updatePatternAtlas(),this.patterns[n].position},o.prototype.bind=function(n){var s=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new u.Texture(n,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)},o.prototype._updatePatternAtlas=function(){var n=[];for(var s in this.patterns)n.push(this.patterns[s].bin);var p=u.potpack(n),f=p.w,d=p.h,y=this.atlasImage;for(var _ in y.resize({width:f||1,height:d||1}),this.patterns){var S=this.patterns[_].bin,P=S.x+1,k=S.y+1,z=this.images[_].data,U=z.width,O=z.height;u.RGBAImage.copy(z,y,{x:0,y:0},{x:P,y:k},{width:U,height:O}),u.RGBAImage.copy(z,y,{x:0,y:O-1},{x:P,y:k-1},{width:U,height:1}),u.RGBAImage.copy(z,y,{x:0,y:0},{x:P,y:k+O},{width:U,height:1}),u.RGBAImage.copy(z,y,{x:U-1,y:0},{x:P-1,y:k},{width:1,height:O}),u.RGBAImage.copy(z,y,{x:0,y:0},{x:P+U,y:k},{width:1,height:O})}this.dirty=!0},o.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},o.prototype.dispatchRenderCallbacks=function(n){for(var s=0,p=n;s<p.length;s+=1){var f=p[s];if(!this.callbackDispatchedThisFrame[f]){this.callbackDispatchedThisFrame[f]=!0;var d=this.images[f];Ti(d)&&this.updateImage(f,d)}}},o}(u.Evented),Sa=co,uo=co,qi=1e20;function co(i,o,n,s,p,f){this.fontSize=i||24,this.buffer=o===void 0?3:o,this.cutoff=s||.25,this.fontFamily=p||"sans-serif",this.fontWeight=f||"normal",this.radius=n||8;var d=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=d,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(d*d),this.gridInner=new Float64Array(d*d),this.f=new Float64Array(d),this.d=new Float64Array(d),this.z=new Float64Array(d+1),this.v=new Int16Array(d),this.middle=Math.round(d/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function po(i,o,n,s,p,f,d){for(var y=0;y<o;y++){for(var _=0;_<n;_++)s[_]=i[_*o+y];for(kn(s,p,f,d,n),_=0;_<n;_++)i[_*o+y]=p[_]}for(_=0;_<n;_++){for(y=0;y<o;y++)s[y]=i[_*o+y];for(kn(s,p,f,d,o),y=0;y<o;y++)i[_*o+y]=Math.sqrt(p[y])}}function kn(i,o,n,s,p){n[0]=0,s[0]=-qi,s[1]=+qi;for(var f=1,d=0;f<p;f++){for(var y=(i[f]+f*f-(i[n[d]]+n[d]*n[d]))/(2*f-2*n[d]);y<=s[d];)d--,y=(i[f]+f*f-(i[n[d]]+n[d]*n[d]))/(2*f-2*n[d]);n[++d]=f,s[d]=y,s[d+1]=+qi}for(f=0,d=0;f<p;f++){for(;s[d+1]<f;)d++;o[f]=(f-n[d])*(f-n[d])+i[n[d]]}}co.prototype.draw=function(i){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(i,this.buffer,this.middle);for(var o=this.ctx.getImageData(0,0,this.size,this.size),n=new Uint8ClampedArray(this.size*this.size),s=0;s<this.size*this.size;s++){var p=o.data[4*s+3]/255;this.gridOuter[s]=p===1?0:p===0?qi:Math.pow(Math.max(0,.5-p),2),this.gridInner[s]=p===1?qi:p===0?0:Math.pow(Math.max(0,p-.5),2)}for(po(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),po(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),s=0;s<this.size*this.size;s++)n[s]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[s]-this.gridInner[s])/this.radius+this.cutoff))));return n},Sa.default=uo;var kr=function(i,o){this.requestManager=i,this.localIdeographFontFamily=o,this.entries={}};kr.prototype.setURL=function(i){this.url=i},kr.prototype.getGlyphs=function(i,o){var n=this,s=[];for(var p in i)for(var f=0,d=i[p];f<d.length;f+=1)s.push({stack:p,id:d[f]});u.asyncAll(s,function(y,_){var S=y.stack,P=y.id,k=n.entries[S];k||(k=n.entries[S]={glyphs:{},requests:{},ranges:{}});var z=k.glyphs[P];if(z===void 0){if(z=n._tinySDF(k,S,P))return k.glyphs[P]=z,void _(null,{stack:S,id:P,glyph:z});var U=Math.floor(P/256);if(256*U>65535)_(new Error("glyphs > 65535 not supported"));else if(k.ranges[U])_(null,{stack:S,id:P,glyph:z});else{var O=k.requests[U];O||(O=k.requests[U]=[],kr.loadGlyphRange(S,U,n.url,n.requestManager,function(G,B){if(B){for(var Z in B)n._doesCharSupportLocalGlyph(+Z)||(k.glyphs[+Z]=B[+Z]);k.ranges[U]=!0}for(var H=0,Q=O;H<Q.length;H+=1)(0,Q[H])(G,B);delete k.requests[U]})),O.push(function(G,B){G?_(G):B&&_(null,{stack:S,id:P,glyph:B[P]||null})})}}else _(null,{stack:S,id:P,glyph:z})},function(y,_){if(y)o(y);else if(_){for(var S={},P=0,k=_;P<k.length;P+=1){var z=k[P],U=z.stack,O=z.id,G=z.glyph;(S[U]||(S[U]={}))[O]=G&&{id:G.id,bitmap:G.bitmap.clone(),metrics:G.metrics}}o(null,S)}})},kr.prototype._doesCharSupportLocalGlyph=function(i){return!!this.localIdeographFontFamily&&(u.isChar["CJK Unified Ideographs"](i)||u.isChar["Hangul Syllables"](i)||u.isChar.Hiragana(i)||u.isChar.Katakana(i))},kr.prototype._tinySDF=function(i,o,n){var s=this.localIdeographFontFamily;if(s&&this._doesCharSupportLocalGlyph(n)){var p=i.tinySDF;if(!p){var f="400";/bold/i.test(o)?f="900":/medium/i.test(o)?f="500":/light/i.test(o)&&(f="200"),p=i.tinySDF=new kr.TinySDF(24,3,8,.25,s,f)}return{id:n,bitmap:new u.AlphaImage({width:30,height:30},p.draw(String.fromCharCode(n))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},kr.loadGlyphRange=function(i,o,n,s,p){var f=256*o,d=f+255,y=s.transformRequest(s.normalizeGlyphsURL(n).replace("{fontstack}",i).replace("{range}",f+"-"+d),u.ResourceType.Glyphs);u.getArrayBuffer(y,function(_,S){if(_)p(_);else if(S){for(var P={},k=0,z=u.parseGlyphPBF(S);k<z.length;k+=1){var U=z[k];P[U.id]=U}p(null,P)}})},kr.TinySDF=Sa;var Zi=function(){this.specification=u.styleSpec.light.position};Zi.prototype.possiblyEvaluate=function(i,o){return u.sphericalToCartesian(i.expression.evaluate(o))},Zi.prototype.interpolate=function(i,o,n){return{x:u.number(i.x,o.x,n),y:u.number(i.y,o.y,n),z:u.number(i.z,o.z,n)}};var Ii=new u.Properties({anchor:new u.DataConstantProperty(u.styleSpec.light.anchor),position:new Zi,color:new u.DataConstantProperty(u.styleSpec.light.color),intensity:new u.DataConstantProperty(u.styleSpec.light.intensity)}),ho=function(i){function o(n){i.call(this),this._transitionable=new u.Transitionable(Ii),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getLight=function(){return this._transitionable.serialize()},o.prototype.setLight=function(n,s){if(s===void 0&&(s={}),!this._validate(u.validateLight,n,s))for(var p in n){var f=n[p];u.endsWith(p,"-transition")?this._transitionable.setTransition(p.slice(0,-"-transition".length),f):this._transitionable.setValue(p,f)}},o.prototype.updateTransitions=function(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)},o.prototype.hasTransition=function(){return this._transitioning.hasTransition()},o.prototype.recalculate=function(n){this.properties=this._transitioning.possiblyEvaluate(n)},o.prototype._validate=function(n,s,p){return(!p||p.validate!==!1)&&u.emitValidationErrors(this,n.call(u.validateStyle,u.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:u.styleSpec})))},o}(u.Evented),qe=function(i,o){this.width=i,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};qe.prototype.getDash=function(i,o){var n=i.join(",")+String(o);return this.dashEntry[n]||(this.dashEntry[n]=this.addDash(i,o)),this.dashEntry[n]},qe.prototype.getDashRanges=function(i,o,n){var s=[],p=i.length%2==1?-i[i.length-1]*n:0,f=i[0]*n,d=!0;s.push({left:p,right:f,isDash:d,zeroLength:i[0]===0});for(var y=i[0],_=1;_<i.length;_++){var S=i[_];s.push({left:p=y*n,right:f=(y+=S)*n,isDash:d=!d,zeroLength:S===0})}return s},qe.prototype.addRoundDash=function(i,o,n){for(var s=o/2,p=-n;p<=n;p++)for(var f=this.width*(this.nextRow+n+p),d=0,y=i[d],_=0;_<this.width;_++){_/y.right>1&&(y=i[++d]);var S=Math.abs(_-y.left),P=Math.abs(_-y.right),k=Math.min(S,P),z=void 0,U=p/n*(s+1);if(y.isDash){var O=s-Math.abs(U);z=Math.sqrt(k*k+O*O)}else z=s-Math.sqrt(k*k+U*U);this.data[f+_]=Math.max(0,Math.min(255,z+128))}},qe.prototype.addRegularDash=function(i){for(var o=i.length-1;o>=0;--o){var n=i[o],s=i[o+1];n.zeroLength?i.splice(o,1):s&&s.isDash===n.isDash&&(s.left=n.left,i.splice(o,1))}var p=i[0],f=i[i.length-1];p.isDash===f.isDash&&(p.left=f.left-this.width,f.right=p.right+this.width);for(var d=this.width*this.nextRow,y=0,_=i[y],S=0;S<this.width;S++){S/_.right>1&&(_=i[++y]);var P=Math.abs(S-_.left),k=Math.abs(S-_.right),z=Math.min(P,k);this.data[d+S]=Math.max(0,Math.min(255,(_.isDash?z:-z)+128))}},qe.prototype.addDash=function(i,o){var n=o?7:0,s=2*n+1;if(this.nextRow+s>this.height)return u.warnOnce("LineAtlas out of space"),null;for(var p=0,f=0;f<i.length;f++)p+=i[f];if(p!==0){var d=this.width/p,y=this.getDashRanges(i,this.width,d);o?this.addRoundDash(y,d,n):this.addRegularDash(y)}var _={y:(this.nextRow+n+.5)/this.height,height:2*n/this.height,width:p};return this.nextRow+=s,this.dirty=!0,_},qe.prototype.bind=function(i){var o=i.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))};var Kr=function i(o,n){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=u.uniqueId();for(var s=this.workerPool.acquire(this.id),p=0;p<s.length;p++){var f=new i.Actor(s[p],n,this.id);f.name="Worker "+p,this.actors.push(f)}};function Ta(i,o,n){var s=function(p,f){if(p)return n(p);if(f){var d=u.pick(u.extend(f,i),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);f.vector_layers&&(d.vectorLayers=f.vector_layers,d.vectorLayerIds=d.vectorLayers.map(function(y){return y.id})),d.tiles=o.canonicalizeTileset(d,i.url),n(null,d)}};return i.url?u.getJSON(o.transformRequest(o.normalizeSourceURL(i.url),u.ResourceType.Source),s):u.browser.frame(function(){return s(null,i)})}Kr.prototype.broadcast=function(i,o,n){u.asyncAll(this.actors,function(s,p){s.send(i,o,p)},n=n||function(){})},Kr.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Kr.prototype.remove=function(){this.actors.forEach(function(i){i.remove()}),this.actors=[],this.workerPool.release(this.id)},Kr.Actor=u.Actor;var ii=function(i,o,n){this.bounds=u.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=o||0,this.maxzoom=n||24};ii.prototype.validateBounds=function(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]},ii.prototype.contains=function(i){var o=Math.pow(2,i.z),n=Math.floor(u.mercatorXfromLng(this.bounds.getWest())*o),s=Math.floor(u.mercatorYfromLat(this.bounds.getNorth())*o),p=Math.ceil(u.mercatorXfromLng(this.bounds.getEast())*o),f=Math.ceil(u.mercatorYfromLat(this.bounds.getSouth())*o);return i.x>=n&&i.x<p&&i.y>=s&&i.y<f};var fo=function(i){function o(n,s,p,f){if(i.call(this),this.id=n,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.extend(this,u.pick(s,["url","scheme","tileSize","promoteId"])),this._options=u.extend({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.load=function(){var n=this;this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ta(this._options,this.map._requestManager,function(s,p){n._tileJSONRequest=null,n._loaded=!0,s?n.fire(new u.ErrorEvent(s)):p&&(u.extend(n,p),p.bounds&&(n.tileBounds=new ii(p.bounds,n.minzoom,n.maxzoom)),u.postTurnstileEvent(p.tiles,n.map._requestManager._customAccessToken),u.postMapLoadEvent(p.tiles,n.map._getMapId(),n.map._requestManager._skuToken,n.map._requestManager._customAccessToken),n.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),n.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})))})},o.prototype.loaded=function(){return this._loaded},o.prototype.hasTile=function(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)},o.prototype.onAdd=function(n){this.map=n,this.load()},o.prototype.setSourceProperty=function(n){this._tileJSONRequest&&this._tileJSONRequest.cancel(),n(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},o.prototype.setTiles=function(n){var s=this;return this.setSourceProperty(function(){s._options.tiles=n}),this},o.prototype.setUrl=function(n){var s=this;return this.setSourceProperty(function(){s.url=n,s._options.url=n}),this},o.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},o.prototype.serialize=function(){return u.extend({},this._options)},o.prototype.loadTile=function(n,s){var p=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(p,u.ResourceType.Tile),uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:u.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function d(y,_){return delete n.request,n.aborted?s(null):y&&y.status!==404?s(y):(_&&_.resourceTiming&&(n.resourceTiming=_.resourceTiming),this.map._refreshExpiredTiles&&_&&n.setExpiryData(_),n.loadVectorData(_,this.map.painter),u.cacheEntryPossiblyAdded(this.dispatcher),s(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}f.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired"?n.state==="loading"?n.reloadCallback=s:n.request=n.actor.send("reloadTile",f,d.bind(this)):(n.actor=this.dispatcher.getActor(),n.request=n.actor.send("loadTile",f,d.bind(this)))},o.prototype.abortTile=function(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id},void 0)},o.prototype.unloadTile=function(n){n.unloadVectorData(),n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id},void 0)},o.prototype.hasTransition=function(){return!1},o}(u.Evented),mo=function(i){function o(n,s,p,f){i.call(this),this.id=n,this.dispatcher=p,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.extend({type:"raster"},s),u.extend(this,u.pick(s,["url","scheme","tileSize"]))}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.load=function(){var n=this;this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ta(this._options,this.map._requestManager,function(s,p){n._tileJSONRequest=null,n._loaded=!0,s?n.fire(new u.ErrorEvent(s)):p&&(u.extend(n,p),p.bounds&&(n.tileBounds=new ii(p.bounds,n.minzoom,n.maxzoom)),u.postTurnstileEvent(p.tiles),u.postMapLoadEvent(p.tiles,n.map._getMapId(),n.map._requestManager._skuToken),n.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),n.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})))})},o.prototype.loaded=function(){return this._loaded},o.prototype.onAdd=function(n){this.map=n,this.load()},o.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},o.prototype.serialize=function(){return u.extend({},this._options)},o.prototype.hasTile=function(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)},o.prototype.loadTile=function(n,s){var p=this,f=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);n.request=u.getImage(this.map._requestManager.transformRequest(f,u.ResourceType.Tile),function(d,y){if(delete n.request,n.aborted)n.state="unloaded",s(null);else if(d)n.state="errored",s(d);else if(y){p.map._refreshExpiredTiles&&n.setExpiryData(y),delete y.cacheControl,delete y.expires;var _=p.map.painter.context,S=_.gl;n.texture=p.map.painter.getTileTexture(y.width),n.texture?n.texture.update(y,{useMipmap:!0}):(n.texture=new u.Texture(_,y,S.RGBA,{useMipmap:!0}),n.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),_.extTextureFilterAnisotropic&&S.texParameterf(S.TEXTURE_2D,_.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,_.extTextureFilterAnisotropicMax)),n.state="loaded",u.cacheEntryPossiblyAdded(p.dispatcher),s(null)}})},o.prototype.abortTile=function(n,s){n.request&&(n.request.cancel(),delete n.request),s()},o.prototype.unloadTile=function(n,s){n.texture&&this.map.painter.saveTileTexture(n.texture),s()},o.prototype.hasTransition=function(){return!1},o}(u.Evented),Ia=function(i){function o(n,s,p,f){i.call(this,n,s,p,f),this.type="raster-dem",this.maxzoom=22,this._options=u.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},o.prototype.loadTile=function(n,s){var p=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function f(d,y){d&&(n.state="errored",s(d)),y&&(n.dem=y,n.needsHillshadePrepare=!0,n.state="loaded",s(null))}n.request=u.getImage(this.map._requestManager.transformRequest(p,u.ResourceType.Tile),function(d,y){if(delete n.request,n.aborted)n.state="unloaded",s(null);else if(d)n.state="errored",s(d);else if(y){this.map._refreshExpiredTiles&&n.setExpiryData(y),delete y.cacheControl,delete y.expires;var _=u.window.ImageBitmap&&y instanceof u.window.ImageBitmap&&u.offscreenCanvasSupported()?y:u.browser.getImageData(y,1),S={uid:n.uid,coord:n.tileID,source:this.id,rawImageData:_,encoding:this.encoding};n.actor&&n.state!=="expired"||(n.actor=this.dispatcher.getActor(),n.actor.send("loadDEMTile",S,f.bind(this)))}}.bind(this)),n.neighboringTiles=this._getNeighboringTiles(n.tileID)},o.prototype._getNeighboringTiles=function(n){var s=n.canonical,p=Math.pow(2,s.z),f=(s.x-1+p)%p,d=s.x===0?n.wrap-1:n.wrap,y=(s.x+1+p)%p,_=s.x+1===p?n.wrap+1:n.wrap,S={};return S[new u.OverscaledTileID(n.overscaledZ,d,s.z,f,s.y).key]={backfilled:!1},S[new u.OverscaledTileID(n.overscaledZ,_,s.z,y,s.y).key]={backfilled:!1},s.y>0&&(S[new u.OverscaledTileID(n.overscaledZ,d,s.z,f,s.y-1).key]={backfilled:!1},S[new u.OverscaledTileID(n.overscaledZ,n.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},S[new u.OverscaledTileID(n.overscaledZ,_,s.z,y,s.y-1).key]={backfilled:!1}),s.y+1<p&&(S[new u.OverscaledTileID(n.overscaledZ,d,s.z,f,s.y+1).key]={backfilled:!1},S[new u.OverscaledTileID(n.overscaledZ,n.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},S[new u.OverscaledTileID(n.overscaledZ,_,s.z,y,s.y+1).key]={backfilled:!1}),S},o.prototype.unloadTile=function(n){n.demTexture&&this.map.painter.saveTileTexture(n.demTexture),n.fbo&&(n.fbo.destroy(),delete n.fbo),n.dem&&delete n.dem,delete n.neighboringTiles,n.state="unloaded",n.actor&&n.actor.send("removeDEMTile",{uid:n.uid,source:this.id})},o}(mo),on=function(i){function o(n,s,p,f){i.call(this),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=p.getActor(),this.setEventedParent(f),this._data=s.data,this._options=u.extend({},s),this._collectResourceTiming=s.collectResourceTiming,this._resourceTiming=[],s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;var d=u.EXTENT/this.tileSize;this.workerOptions=u.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*d,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*d,extent:u.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?Math.min(s.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:u.EXTENT,radius:(s.clusterRadius||50)*d,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.load=function(){var n=this;this.fire(new u.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(s){if(s)n.fire(new u.ErrorEvent(s));else{var p={dataType:"source",sourceDataType:"metadata"};n._collectResourceTiming&&n._resourceTiming&&n._resourceTiming.length>0&&(p.resourceTiming=n._resourceTiming,n._resourceTiming=[]),n.fire(new u.Event("data",p))}})},o.prototype.onAdd=function(n){this.map=n,this.load()},o.prototype.setData=function(n){var s=this;return this._data=n,this.fire(new u.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(p){if(p)s.fire(new u.ErrorEvent(p));else{var f={dataType:"source",sourceDataType:"content"};s._collectResourceTiming&&s._resourceTiming&&s._resourceTiming.length>0&&(f.resourceTiming=s._resourceTiming,s._resourceTiming=[]),s.fire(new u.Event("data",f))}}),this},o.prototype.getClusterExpansionZoom=function(n,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:n,source:this.id},s),this},o.prototype.getClusterChildren=function(n,s){return this.actor.send("geojson.getClusterChildren",{clusterId:n,source:this.id},s),this},o.prototype.getClusterLeaves=function(n,s,p,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:n,limit:s,offset:p},f),this},o.prototype._updateWorkerData=function(n){var s=this;this._loaded=!1;var p=u.extend({},this.workerOptions),f=this._data;typeof f=="string"?(p.request=this.map._requestManager.transformRequest(u.browser.resolveURL(f),u.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(f),this.actor.send(this.type+".loadData",p,function(d,y){s._removed||y&&y.abandoned||(s._loaded=!0,y&&y.resourceTiming&&y.resourceTiming[s.id]&&(s._resourceTiming=y.resourceTiming[s.id].slice(0)),s.actor.send(s.type+".coalesce",{source:p.source},null),n(d))})},o.prototype.loaded=function(){return this._loaded},o.prototype.loadTile=function(n,s){var p=this,f=n.actor?"reloadTile":"loadTile";n.actor=this.actor,n.request=this.actor.send(f,{type:this.type,uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:u.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(d,y){return delete n.request,n.unloadVectorData(),n.aborted?s(null):d?s(d):(n.loadVectorData(y,p.map.painter,f==="reloadTile"),s(null))})},o.prototype.abortTile=function(n){n.request&&(n.request.cancel(),delete n.request),n.aborted=!0},o.prototype.unloadTile=function(n){n.unloadVectorData(),this.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id})},o.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},o.prototype.serialize=function(){return u.extend({},this._options,{type:this.type,data:this._data})},o.prototype.hasTransition=function(){return!1},o}(u.Evented),Ei=u.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Li=function(i){function o(n,s,p,f){i.call(this),this.id=n,this.dispatcher=p,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=s}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.load=function(n,s){var p=this;this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this.url=this.options.url,u.getImage(this.map._requestManager.transformRequest(this.url,u.ResourceType.Image),function(f,d){p._loaded=!0,f?p.fire(new u.ErrorEvent(f)):d&&(p.image=d,n&&(p.coordinates=n),s&&s(),p._finishLoading())})},o.prototype.loaded=function(){return this._loaded},o.prototype.updateImage=function(n){var s=this;return this.image&&n.url?(this.options.url=n.url,this.load(n.coordinates,function(){s.texture=null}),this):this},o.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})))},o.prototype.onAdd=function(n){this.map=n,this.load()},o.prototype.setCoordinates=function(n){var s=this;this.coordinates=n;var p=n.map(u.MercatorCoordinate.fromLngLat);this.tileID=function(d){for(var y=1/0,_=1/0,S=-1/0,P=-1/0,k=0,z=d;k<z.length;k+=1){var U=z[k];y=Math.min(y,U.x),_=Math.min(_,U.y),S=Math.max(S,U.x),P=Math.max(P,U.y)}var O=Math.max(S-y,P-_),G=Math.max(0,Math.floor(-Math.log(O)/Math.LN2)),B=Math.pow(2,G);return new u.CanonicalTileID(G,Math.floor((y+S)/2*B),Math.floor((_+P)/2*B))}(p),this.minzoom=this.maxzoom=this.tileID.z;var f=p.map(function(d){return s.tileID.getTilePoint(d)._round()});return this._boundsArray=new u.StructArrayLayout4i8,this._boundsArray.emplaceBack(f[0].x,f[0].y,0,0),this._boundsArray.emplaceBack(f[1].x,f[1].y,u.EXTENT,0),this._boundsArray.emplaceBack(f[3].x,f[3].y,0,u.EXTENT),this._boundsArray.emplaceBack(f[2].x,f[2].y,u.EXTENT,u.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})),this},o.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var n=this.map.painter.context,s=n.gl;for(var p in this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,Ei.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new u.Texture(n,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this.tiles){var f=this.tiles[p];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture)}}},o.prototype.loadTile=function(n,s){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},s(null)):(n.state="errored",s(null))},o.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},o.prototype.hasTransition=function(){return!1},o}(u.Evented),Cn=function(i){function o(n,s,p,f){i.call(this,n,s,p,f),this.roundZoom=!0,this.type="video",this.options=s}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.load=function(){var n=this;this._loaded=!1;var s=this.options;this.urls=[];for(var p=0,f=s.urls;p<f.length;p+=1)this.urls.push(this.map._requestManager.transformRequest(f[p],u.ResourceType.Source).url);u.getVideo(this.urls,function(d,y){n._loaded=!0,d?n.fire(new u.ErrorEvent(d)):y&&(n.video=y,n.video.loop=!0,n.video.addEventListener("playing",function(){n.map.triggerRepaint()}),n.map&&n.video.play(),n._finishLoading())})},o.prototype.pause=function(){this.video&&this.video.pause()},o.prototype.play=function(){this.video&&this.video.play()},o.prototype.seek=function(n){if(this.video){var s=this.video.seekable;n<s.start(0)||n>s.end(0)?this.fire(new u.ErrorEvent(new u.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+s.start(0)+" and "+s.end(0)+"-second mark."))):this.video.currentTime=n}},o.prototype.getVideo=function(){return this.video},o.prototype.onAdd=function(n){this.map||(this.map=n,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},o.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var n=this.map.painter.context,s=n.gl;for(var p in this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,Ei.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new u.Texture(n,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this.tiles){var f=this.tiles[p];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture)}}},o.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},o.prototype.hasTransition=function(){return this.video&&!this.video.paused},o}(Li),Mn=function(i){function o(n,s,p,f){i.call(this,n,s,p,f),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(function(d){return!Array.isArray(d)||d.length!==2||d.some(function(y){return typeof y!="number"})})||this.fire(new u.ErrorEvent(new u.ValidationError("sources."+n,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.ErrorEvent(new u.ValidationError("sources."+n,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new u.ErrorEvent(new u.ValidationError("sources."+n,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof u.window.HTMLCanvasElement||this.fire(new u.ErrorEvent(new u.ValidationError("sources."+n,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.ErrorEvent(new u.ValidationError("sources."+n,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof u.window.HTMLCanvasElement?this.options.canvas:u.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},o.prototype.getCanvas=function(){return this.canvas},o.prototype.onAdd=function(n){this.map=n,this.load(),this.canvas&&this.animate&&this.play()},o.prototype.onRemove=function(){this.pause()},o.prototype.prepare=function(){var n=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,n=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,n=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var s=this.map.painter.context,p=s.gl;for(var f in this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Ei.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(n||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new u.Texture(s,this.canvas,p.RGBA,{premultiply:!0}),this.tiles){var d=this.tiles[f];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture)}}},o.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},o.prototype.hasTransition=function(){return this._playing},o.prototype._hasInvalidDimensions=function(){for(var n=0,s=[this.canvas.width,this.canvas.height];n<s.length;n+=1){var p=s[n];if(isNaN(p)||p<=0)return!0}return!1},o}(Li),an={vector:fo,raster:mo,"raster-dem":Ia,geojson:on,video:Cn,image:Li,canvas:Mn};function Ls(i,o){var n=u.identity([]);return u.translate(n,n,[1,1,0]),u.scale(n,n,[.5*i.width,.5*i.height,1]),u.multiply(n,n,i.calculatePosMatrix(o.toUnwrapped()))}function Cr(i,o,n,s,p,f){var d=function(G,B,Z){if(G)for(var H=0,Q=G;H<Q.length;H+=1){var at=B[Q[H]];if(at&&at.source===Z&&at.type==="fill-extrusion")return!0}else for(var nt in B){var lt=B[nt];if(lt.source===Z&&lt.type==="fill-extrusion")return!0}return!1}(p&&p.layers,o,i.id),y=f.maxPitchScaleFactor(),_=i.tilesIn(s,y,d);_.sort(Gi);for(var S=[],P=0,k=_;P<k.length;P+=1){var z=k[P];S.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(o,n,i._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,p,f,y,Ls(i.transform,z.tileID))})}var U=function(G){for(var B={},Z={},H=0,Q=G;H<Q.length;H+=1){var at=Q[H],nt=at.queryResults,lt=at.wrappedTileID,ct=Z[lt]=Z[lt]||{};for(var _t in nt)for(var yt=nt[_t],Et=ct[_t]=ct[_t]||{},Vt=B[_t]=B[_t]||[],qt=0,Nt=yt;qt<Nt.length;qt+=1){var he=Nt[qt];Et[he.featureIndex]||(Et[he.featureIndex]=!0,Vt.push(he))}}return B}(S);for(var O in U)U[O].forEach(function(G){var B=G.feature,Z=i.getFeatureState(B.layer["source-layer"],B.id);B.source=B.layer.source,B.layer["source-layer"]&&(B.sourceLayer=B.layer["source-layer"]),B.state=Z});return U}function Gi(i,o){var n=i.tileID,s=o.tileID;return n.overscaledZ-s.overscaledZ||n.canonical.y-s.canonical.y||n.wrap-s.wrap||n.canonical.x-s.canonical.x}var ve=function(i,o){this.max=i,this.onRemove=o,this.reset()};ve.prototype.reset=function(){for(var i in this.data)for(var o=0,n=this.data[i];o<n.length;o+=1){var s=n[o];s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value)}return this.data={},this.order=[],this},ve.prototype.add=function(i,o,n){var s=this,p=i.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);var f={value:o,timeout:void 0};if(n!==void 0&&(f.timeout=setTimeout(function(){s.remove(i,f)},n)),this.data[p].push(f),this.order.push(p),this.order.length>this.max){var d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this},ve.prototype.has=function(i){return i.wrapped().key in this.data},ve.prototype.getAndRemove=function(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null},ve.prototype._getAndRemoveByKey=function(i){var o=this.data[i].shift();return o.timeout&&clearTimeout(o.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),o.value},ve.prototype.getByKey=function(i){var o=this.data[i];return o?o[0].value:null},ve.prototype.get=function(i){return this.has(i)?this.data[i.wrapped().key][0].value:null},ve.prototype.remove=function(i,o){if(!this.has(i))return this;var n=i.wrapped().key,s=o===void 0?0:this.data[n].indexOf(o),p=this.data[n][s];return this.data[n].splice(s,1),p.timeout&&clearTimeout(p.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(p.value),this.order.splice(this.order.indexOf(n),1),this},ve.prototype.setMaxSize=function(i){for(this.max=i;this.order.length>this.max;){var o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this},ve.prototype.filter=function(i){var o=[];for(var n in this.data)for(var s=0,p=this.data[n];s<p.length;s+=1){var f=p[s];i(f.value)||o.push(f)}for(var d=0,y=o;d<y.length;d+=1){var _=y[d];this.remove(_.value.tileID,_)}};var Ri=function(i,o,n){this.context=i;var s=i.gl;this.buffer=s.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),s.bufferData(s.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer};Ri.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Ri.prototype.updateData=function(i){var o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)},Ri.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var yo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Ai=function(i,o,n,s){this.length=o.length,this.attributes=n,this.itemSize=o.bytesPerElement,this.dynamicDraw=s,this.context=i;var p=i.gl;this.buffer=p.createBuffer(),i.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer};Ai.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Ai.prototype.updateData=function(i){var o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,i.arrayBuffer)},Ai.prototype.enableAttributes=function(i,o){for(var n=0;n<this.attributes.length;n++){var s=o.attributes[this.attributes[n].name];s!==void 0&&i.enableVertexAttribArray(s)}},Ai.prototype.setVertexAttribPointers=function(i,o,n){for(var s=0;s<this.attributes.length;s++){var p=this.attributes[s],f=o.attributes[p.name];f!==void 0&&i.vertexAttribPointer(f,p.components,i[yo[p.type]],!1,this.itemSize,p.offset+this.itemSize*(n||0))}},Ai.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var le=function(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};le.prototype.get=function(){return this.current},le.prototype.set=function(i){},le.prototype.getDefault=function(){return this.default},le.prototype.setDefault=function(){this.set(this.default)};var sn=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return u.Color.transparent},o.prototype.set=function(n){var s=this.current;(n.r!==s.r||n.g!==s.g||n.b!==s.b||n.a!==s.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)},o}(le),Mr=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return 1},o.prototype.set=function(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)},o}(le),pi=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return 0},o.prototype.set=function(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)},o}(le),Rs=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return[!0,!0,!0,!0]},o.prototype.set=function(n){var s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||n[3]!==s[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)},o}(le),Pi=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return!0},o.prototype.set=function(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)},o}(le),Vo=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return 255},o.prototype.set=function(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)},o}(le),hi=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},o.prototype.set=function(n){var s=this.current;(n.func!==s.func||n.ref!==s.ref||n.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)},o}(le),Dn=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){var n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]},o.prototype.set=function(n){var s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)},o}(le),go=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(n){if(n!==this.current||this.dirty){var s=this.gl;n?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=n,this.dirty=!1}},o}(le),fi=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return[0,1]},o.prototype.set=function(n){var s=this.current;(n[0]!==s[0]||n[1]!==s[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)},o}(le),di=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(n){if(n!==this.current||this.dirty){var s=this.gl;n?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=n,this.dirty=!1}},o}(le),Ln=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return this.gl.LESS},o.prototype.set=function(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)},o}(le),zi=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(n){if(n!==this.current||this.dirty){var s=this.gl;n?s.enable(s.BLEND):s.disable(s.BLEND),this.current=n,this.dirty=!1}},o}(le),Ea=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){var n=this.gl;return[n.ONE,n.ZERO]},o.prototype.set=function(n){var s=this.current;(n[0]!==s[0]||n[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)},o}(le),Aa=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return u.Color.transparent},o.prototype.set=function(n){var s=this.current;(n.r!==s.r||n.g!==s.g||n.b!==s.b||n.a!==s.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)},o}(le),No=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return this.gl.FUNC_ADD},o.prototype.set=function(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)},o}(le),jo=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(n){if(n!==this.current||this.dirty){var s=this.gl;n?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=n,this.dirty=!1}},o}(le),vo=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return this.gl.BACK},o.prototype.set=function(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)},o}(le),Pa=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return this.gl.CCW},o.prototype.set=function(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)},o}(le),_o=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)},o}(le),qo=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return this.gl.TEXTURE0},o.prototype.set=function(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)},o}(le),Rn=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){var n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]},o.prototype.set=function(n){var s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||n[3]!==s[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)},o}(le),Zo=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(n){if(n!==this.current||this.dirty){var s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,n),this.current=n,this.dirty=!1}},o}(le),Go=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(n){if(n!==this.current||this.dirty){var s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,n),this.current=n,this.dirty=!1}},o}(le),za=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(n){if(n!==this.current||this.dirty){var s=this.gl;s.bindTexture(s.TEXTURE_2D,n),this.current=n,this.dirty=!1}},o}(le),ka=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(n){if(n!==this.current||this.dirty){var s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}},o}(le),Bn=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(n){var s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1},o}(le),On=function(i){function o(n){i.call(this,n),this.vao=n.extVertexArrayObject}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)},o}(le),ln=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return 4},o.prototype.set=function(n){if(n!==this.current||this.dirty){var s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}},o}(le),Fn=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(n){if(n!==this.current||this.dirty){var s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}},o}(le),xo=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(n){if(n!==this.current||this.dirty){var s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}},o}(le),Ve=function(i){function o(n,s){i.call(this,n),this.context=n,this.parent=s}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o}(le),w=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.setDirty=function(){this.dirty=!0},o.prototype.set=function(n){if(n!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}},o}(Ve),I=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.set=function(n){if(n!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,n),this.current=n,this.dirty=!1}},o}(Ve),E=function(i,o,n,s){this.context=i,this.width=o,this.height=n;var p=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new w(i,p),s&&(this.depthAttachment=new I(i,p))};E.prototype.destroy=function(){var i=this.context.gl,o=this.colorAttachment.get();if(o&&i.deleteTexture(o),this.depthAttachment){var n=this.depthAttachment.get();n&&i.deleteRenderbuffer(n)}i.deleteFramebuffer(this.framebuffer)};var C=function(i,o,n){this.func=i,this.mask=o,this.range=n};C.ReadOnly=!1,C.ReadWrite=!0,C.disabled=new C(519,C.ReadOnly,[0,1]);var F=function(i,o,n,s,p,f){this.test=i,this.ref=o,this.mask=n,this.fail=s,this.depthFail=p,this.pass=f};F.disabled=new F({func:519,mask:0},0,0,7680,7680,7680);var K=function(i,o,n){this.blendFunction=i,this.blendColor=o,this.mask=n};K.disabled=new K(K.Replace=[1,0],u.Color.transparent,[!1,!1,!1,!1]),K.unblended=new K(K.Replace,u.Color.transparent,[!0,!0,!0,!0]),K.alphaBlended=new K([1,771],u.Color.transparent,[!0,!0,!0,!0]);var J=function(i,o,n){this.enable=i,this.mode=o,this.frontFace=n};J.disabled=new J(!1,1029,2305),J.backCCW=new J(!0,1029,2305);var X=function(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new sn(this),this.clearDepth=new Mr(this),this.clearStencil=new pi(this),this.colorMask=new Rs(this),this.depthMask=new Pi(this),this.stencilMask=new Vo(this),this.stencilFunc=new hi(this),this.stencilOp=new Dn(this),this.stencilTest=new go(this),this.depthRange=new fi(this),this.depthTest=new di(this),this.depthFunc=new Ln(this),this.blend=new zi(this),this.blendFunc=new Ea(this),this.blendColor=new Aa(this),this.blendEquation=new No(this),this.cullFace=new jo(this),this.cullFaceSide=new vo(this),this.frontFace=new Pa(this),this.program=new _o(this),this.activeTexture=new qo(this),this.viewport=new Rn(this),this.bindFramebuffer=new Zo(this),this.bindRenderbuffer=new Go(this),this.bindTexture=new za(this),this.bindVertexBuffer=new ka(this),this.bindElementBuffer=new Bn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new On(this),this.pixelStoreUnpack=new ln(this),this.pixelStoreUnpackPremultiplyAlpha=new Fn(this),this.pixelStoreUnpackFlipY=new xo(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)};X.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},X.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},X.prototype.createIndexBuffer=function(i,o){return new Ri(this,i,o)},X.prototype.createVertexBuffer=function(i,o,n){return new Ai(this,i,o,n)},X.prototype.createRenderbuffer=function(i,o,n){var s=this.gl,p=s.createRenderbuffer();return this.bindRenderbuffer.set(p),s.renderbufferStorage(s.RENDERBUFFER,i,o,n),this.bindRenderbuffer.set(null),p},X.prototype.createFramebuffer=function(i,o,n){return new E(this,i,o,n)},X.prototype.clear=function(i){var o=i.color,n=i.depth,s=this.gl,p=0;o&&(p|=s.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(p|=s.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),s.clear(p)},X.prototype.setCullFace=function(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))},X.prototype.setDepthMode=function(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)},X.prototype.setStencilMode=function(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)},X.prototype.setColorMode=function(i){u.deepEqual(i.blendFunction,K.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)},X.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var D=function(i){function o(n,s,p){var f=this;i.call(this),this.id=n,this.dispatcher=p,this.on("data",function(d){d.dataType==="source"&&d.sourceDataType==="metadata"&&(f._sourceLoaded=!0),f._sourceLoaded&&!f._paused&&d.dataType==="source"&&d.sourceDataType==="content"&&(f.reload(),f.transform&&f.update(f.transform))}),this.on("error",function(){f._sourceErrored=!0}),this._source=function(d,y,_,S){var P=new an[y.type](d,y,_,S);if(P.id!==d)throw new Error("Expected Source id to be "+d+" instead of "+P.id);return u.bindAll(["load","abort","unload","serialize","prepare"],P),P}(n,s,p,this),this._tiles={},this._cache=new ve(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new u.SourceFeatureState}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.onAdd=function(n){this.map=n,this._maxTileCacheSize=n?n._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(n)},o.prototype.onRemove=function(n){this._source&&this._source.onRemove&&this._source.onRemove(n)},o.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var n in this._tiles){var s=this._tiles[n];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0},o.prototype.getSource=function(){return this._source},o.prototype.pause=function(){this._paused=!0},o.prototype.resume=function(){if(this._paused){var n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}},o.prototype._loadTile=function(n,s){return this._source.loadTile(n,s)},o.prototype._unloadTile=function(n){if(this._source.unloadTile)return this._source.unloadTile(n,function(){})},o.prototype._abortTile=function(n){if(this._source.abortTile)return this._source.abortTile(n,function(){})},o.prototype.serialize=function(){return this._source.serialize()},o.prototype.prepare=function(n){for(var s in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var p=this._tiles[s];p.upload(n),p.prepare(this.map.style.imageManager)}},o.prototype.getIds=function(){return u.values(this._tiles).map(function(n){return n.tileID}).sort(j).map(function(n){return n.key})},o.prototype.getRenderableIds=function(n){var s=this,p=[];for(var f in this._tiles)this._isIdRenderable(f,n)&&p.push(this._tiles[f]);return n?p.sort(function(d,y){var _=d.tileID,S=y.tileID,P=new u.Point(_.canonical.x,_.canonical.y)._rotate(s.transform.angle),k=new u.Point(S.canonical.x,S.canonical.y)._rotate(s.transform.angle);return _.overscaledZ-S.overscaledZ||k.y-P.y||k.x-P.x}).map(function(d){return d.tileID.key}):p.map(function(d){return d.tileID}).sort(j).map(function(d){return d.key})},o.prototype.hasRenderableParent=function(n){var s=this.findLoadedParent(n,0);return!!s&&this._isIdRenderable(s.tileID.key)},o.prototype._isIdRenderable=function(n,s){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(s||!this._tiles[n].holdingForFade())},o.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var n in this._cache.reset(),this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(n,"reloading")},o.prototype._reloadTile=function(n,s){var p=this._tiles[n];p&&(p.state!=="loading"&&(p.state=s),this._loadTile(p,this._tileLoaded.bind(this,p,n,s)))},o.prototype._tileLoaded=function(n,s,p,f){if(f)return n.state="errored",void(f.status!==404?this._source.fire(new u.ErrorEvent(f,{tile:n})):this.update(this.transform));n.timeAdded=u.browser.now(),p==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(s,n),this.getSource().type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new u.Event("data",{dataType:"source",tile:n,coord:n.tileID}))},o.prototype._backfillDEM=function(n){for(var s=this.getRenderableIds(),p=0;p<s.length;p++){var f=s[p];if(n.neighboringTiles&&n.neighboringTiles[f]){var d=this.getTileByID(f);y(n,d),y(d,n)}}function y(_,S){_.needsHillshadePrepare=!0;var P=S.tileID.canonical.x-_.tileID.canonical.x,k=S.tileID.canonical.y-_.tileID.canonical.y,z=Math.pow(2,_.tileID.canonical.z),U=S.tileID.key;P===0&&k===0||Math.abs(k)>1||(Math.abs(P)>1&&(Math.abs(P+z)===1?P+=z:Math.abs(P-z)===1&&(P-=z)),S.dem&&_.dem&&(_.dem.backfillBorder(S.dem,P,k),_.neighboringTiles&&_.neighboringTiles[U]&&(_.neighboringTiles[U].backfilled=!0)))}},o.prototype.getTile=function(n){return this.getTileByID(n.key)},o.prototype.getTileByID=function(n){return this._tiles[n]},o.prototype._retainLoadedChildren=function(n,s,p,f){for(var d in this._tiles){var y=this._tiles[d];if(!(f[d]||!y.hasData()||y.tileID.overscaledZ<=s||y.tileID.overscaledZ>p)){for(var _=y.tileID;y&&y.tileID.overscaledZ>s+1;){var S=y.tileID.scaledTo(y.tileID.overscaledZ-1);(y=this._tiles[S.key])&&y.hasData()&&(_=S)}for(var P=_;P.overscaledZ>s;)if(n[(P=P.scaledTo(P.overscaledZ-1)).key]){f[_.key]=_;break}}}},o.prototype.findLoadedParent=function(n,s){if(n.key in this._loadedParentTiles){var p=this._loadedParentTiles[n.key];return p&&p.tileID.overscaledZ>=s?p:null}for(var f=n.overscaledZ-1;f>=s;f--){var d=n.scaledTo(f),y=this._getLoadedTile(d);if(y)return y}},o.prototype._getLoadedTile=function(n){var s=this._tiles[n.key];return s&&s.hasData()?s:this._cache.getByKey(n.wrapped().key)},o.prototype.updateCacheSize=function(n){var s=Math.ceil(n.width/this._source.tileSize)+1,p=Math.ceil(n.height/this._source.tileSize)+1,f=Math.floor(s*p*5),d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(d)},o.prototype.handleWrapJump=function(n){var s=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,s){var p={};for(var f in this._tiles){var d=this._tiles[f];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+s),p[d.tileID.key]=d}for(var y in this._tiles=p,this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(var _ in this._tiles)this._setTileReloadTimer(_,this._tiles[_])}},o.prototype.update=function(n){var s=this;if(this.transform=n,this._sourceLoaded&&!this._paused){var p;this.updateCacheSize(n),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?p=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(ct){return new u.OverscaledTileID(ct.canonical.z,ct.wrap,ct.canonical.z,ct.canonical.x,ct.canonical.y)}):(p=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(p=p.filter(function(ct){return s._source.hasTile(ct)}))):p=[];var f=n.coveringZoomLevel(this._source),d=Math.max(f-o.maxOverzooming,this._source.minzoom),y=Math.max(f+o.maxUnderzooming,this._source.minzoom),_=this._updateRetainedTiles(p,f);if(dt(this._source.type)){for(var S={},P={},k=0,z=Object.keys(_);k<z.length;k+=1){var U=z[k],O=_[U],G=this._tiles[U];if(G&&!(G.fadeEndTime&&G.fadeEndTime<=u.browser.now())){var B=this.findLoadedParent(O,d);B&&(this._addTile(B.tileID),S[B.tileID.key]=B.tileID),P[U]=O}}for(var Z in this._retainLoadedChildren(P,f,y,_),S)_[Z]||(this._coveredTiles[Z]=!0,_[Z]=S[Z])}for(var H in _)this._tiles[H].clearFadeHold();for(var Q=0,at=u.keysDifference(this._tiles,_);Q<at.length;Q+=1){var nt=at[Q],lt=this._tiles[nt];lt.hasSymbolBuckets&&!lt.holdingForFade()?lt.setHoldDuration(this.map._fadeDuration):lt.hasSymbolBuckets&&!lt.symbolFadeFinished()||this._removeTile(nt)}this._updateLoadedParentTileCache()}},o.prototype.releaseSymbolFadeTiles=function(){for(var n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(n)},o.prototype._updateRetainedTiles=function(n,s){for(var p={},f={},d=Math.max(s-o.maxOverzooming,this._source.minzoom),y=Math.max(s+o.maxUnderzooming,this._source.minzoom),_={},S=0,P=n;S<P.length;S+=1){var k=P[S],z=this._addTile(k);p[k.key]=k,z.hasData()||s<this._source.maxzoom&&(_[k.key]=k)}this._retainLoadedChildren(_,s,y,p);for(var U=0,O=n;U<O.length;U+=1){var G=O[U],B=this._tiles[G.key];if(!B.hasData()){if(s+1>this._source.maxzoom){var Z=G.children(this._source.maxzoom)[0],H=this.getTile(Z);if(H&&H.hasData()){p[Z.key]=Z;continue}}else{var Q=G.children(this._source.maxzoom);if(p[Q[0].key]&&p[Q[1].key]&&p[Q[2].key]&&p[Q[3].key])continue}for(var at=B.wasRequested(),nt=G.overscaledZ-1;nt>=d;--nt){var lt=G.scaledTo(nt);if(f[lt.key]||(f[lt.key]=!0,!(B=this.getTile(lt))&&at&&(B=this._addTile(lt)),B&&(p[lt.key]=lt,at=B.wasRequested(),B.hasData())))break}}}return p},o.prototype._updateLoadedParentTileCache=function(){for(var n in this._loadedParentTiles={},this._tiles){for(var s=[],p=void 0,f=this._tiles[n].tileID;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){p=this._loadedParentTiles[f.key];break}s.push(f.key);var d=f.scaledTo(f.overscaledZ-1);if(p=this._getLoadedTile(d))break;f=d}for(var y=0,_=s;y<_.length;y+=1)this._loadedParentTiles[_[y]]=p}},o.prototype._addTile=function(n){var s=this._tiles[n.key];if(s)return s;(s=this._cache.getAndRemove(n))&&(this._setTileReloadTimer(n.key,s),s.tileID=n,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,s)));var p=Boolean(s);return p||(s=new u.Tile(n,this._source.tileSize*n.overscaleFactor()),this._loadTile(s,this._tileLoaded.bind(this,s,n.key,s.state))),s?(s.uses++,this._tiles[n.key]=s,p||this._source.fire(new u.Event("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null},o.prototype._setTileReloadTimer=function(n,s){var p=this;n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);var f=s.getExpiryTimeout();f&&(this._timers[n]=setTimeout(function(){p._reloadTile(n,"expired"),delete p._timers[n]},f))},o.prototype._removeTile=function(n){var s=this._tiles[n];s&&(s.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))},o.prototype.clearTiles=function(){for(var n in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(n);this._cache.reset()},o.prototype.tilesIn=function(n,s,p){var f=this,d=[],y=this.transform;if(!y)return d;for(var _=p?y.getCameraQueryGeometry(n):n,S=n.map(function(nt){return y.pointCoordinate(nt)}),P=_.map(function(nt){return y.pointCoordinate(nt)}),k=this.getIds(),z=1/0,U=1/0,O=-1/0,G=-1/0,B=0,Z=P;B<Z.length;B+=1){var H=Z[B];z=Math.min(z,H.x),U=Math.min(U,H.y),O=Math.max(O,H.x),G=Math.max(G,H.y)}for(var Q=function(nt){var lt=f._tiles[k[nt]];if(!lt.holdingForFade()){var ct=lt.tileID,_t=Math.pow(2,y.zoom-lt.tileID.overscaledZ),yt=s*lt.queryPadding*u.EXTENT/lt.tileSize/_t,Et=[ct.getTilePoint(new u.MercatorCoordinate(z,U)),ct.getTilePoint(new u.MercatorCoordinate(O,G))];if(Et[0].x-yt<u.EXTENT&&Et[0].y-yt<u.EXTENT&&Et[1].x+yt>=0&&Et[1].y+yt>=0){var Vt=S.map(function(Nt){return ct.getTilePoint(Nt)}),qt=P.map(function(Nt){return ct.getTilePoint(Nt)});d.push({tile:lt,tileID:ct,queryGeometry:Vt,cameraQueryGeometry:qt,scale:_t})}}},at=0;at<k.length;at++)Q(at);return d},o.prototype.getVisibleCoordinates=function(n){for(var s=this,p=this.getRenderableIds(n).map(function(_){return s._tiles[_].tileID}),f=0,d=p;f<d.length;f+=1){var y=d[f];y.posMatrix=this.transform.calculatePosMatrix(y.toUnwrapped())}return p},o.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(dt(this._source.type))for(var n in this._tiles){var s=this._tiles[n];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=u.browser.now())return!0}return!1},o.prototype.setFeatureState=function(n,s,p){this._state.updateState(n=n||"_geojsonTileLayer",s,p)},o.prototype.removeFeatureState=function(n,s,p){this._state.removeFeatureState(n=n||"_geojsonTileLayer",s,p)},o.prototype.getFeatureState=function(n,s){return this._state.getState(n=n||"_geojsonTileLayer",s)},o.prototype.setDependencies=function(n,s,p){var f=this._tiles[n];f&&f.setDependencies(s,p)},o.prototype.reloadTilesForDependencies=function(n,s){for(var p in this._tiles)this._tiles[p].hasDependency(n,s)&&this._reloadTile(p,"reloading");this._cache.filter(function(f){return!f.hasDependency(n,s)})},o}(u.Evented);function j(i,o){var n=Math.abs(2*i.wrap)-+(i.wrap<0),s=Math.abs(2*o.wrap)-+(o.wrap<0);return i.overscaledZ-o.overscaledZ||s-n||o.canonical.y-i.canonical.y||o.canonical.x-i.canonical.x}function dt(i){return i==="raster"||i==="image"||i==="video"}function xt(){return new u.window.Worker(es.workerUrl)}D.maxOverzooming=10,D.maxUnderzooming=3;var et="mapboxgl_preloaded_worker_pool",mt=function(){this.active={}};mt.prototype.acquire=function(i){if(!this.workers)for(this.workers=[];this.workers.length<mt.workerCount;)this.workers.push(new xt);return this.active[i]=!0,this.workers.slice()},mt.prototype.release=function(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(function(o){o.terminate()}),this.workers=null)},mt.prototype.isPreloaded=function(){return!!this.active[et]},mt.prototype.numActive=function(){return Object.keys(this.active).length};var At,zt=Math.floor(u.browser.hardwareConcurrency/2);function Ft(){return At||(At=new mt),At}function pt(i,o){var n={};for(var s in i)s!=="ref"&&(n[s]=i[s]);return u.refProperties.forEach(function(p){p in o&&(n[p]=o[p])}),n}function wt(i){i=i.slice();for(var o=Object.create(null),n=0;n<i.length;n++)o[i[n].id]=i[n];for(var s=0;s<i.length;s++)"ref"in i[s]&&(i[s]=pt(i[s],o[i[s].ref]));return i}mt.workerCount=Math.max(Math.min(zt,6),1);var ft={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Qt(i,o,n){n.push({command:ft.addSource,args:[i,o[i]]})}function $t(i,o,n){o.push({command:ft.removeSource,args:[i]}),n[i]=!0}function Lt(i,o,n,s){$t(i,n,s),Qt(i,o,n)}function Te(i,o,n){var s;for(s in i[n])if(i[n].hasOwnProperty(s)&&s!=="data"&&!u.deepEqual(i[n][s],o[n][s]))return!1;for(s in o[n])if(o[n].hasOwnProperty(s)&&s!=="data"&&!u.deepEqual(i[n][s],o[n][s]))return!1;return!0}function oe(i,o,n,s,p,f){var d;for(d in o=o||{},i=i||{})i.hasOwnProperty(d)&&(u.deepEqual(i[d],o[d])||n.push({command:f,args:[s,d,o[d],p]}));for(d in o)o.hasOwnProperty(d)&&!i.hasOwnProperty(d)&&(u.deepEqual(i[d],o[d])||n.push({command:f,args:[s,d,o[d],p]}))}function Ae(i){return i.id}function Ce(i,o){return i[o.id]=o,i}var ce=function(i,o){this.reset(i,o)};ce.prototype.reset=function(i,o){this.points=i||[],this._distances=[0];for(var n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding},ce.prototype.lerp=function(i){if(this.points.length===1)return this.points[0];i=u.clamp(i,0,1);for(var o=1,n=this._distances[o],s=i*this.paddedLength+this.padding;n<s&&o<this._distances.length;)n=this._distances[++o];var p=o-1,f=this._distances[p],d=n-f,y=d>0?(s-f)/d:0;return this.points[p].mult(1-y).add(this.points[o].mult(y))};var Ie=function(i,o,n){var s=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(o/n);for(var f=0;f<this.xCellCount*this.yCellCount;f++)s.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=o,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0};function Ne(i,o,n,s,p){var f=u.create();return o?(u.scale(f,f,[1/p,1/p,1]),n||u.rotateZ(f,f,s.angle)):u.multiply(f,s.labelPlaneMatrix,i),f}function Ee(i,o,n,s,p){if(o){var f=u.clone(i);return u.scale(f,f,[p,p,1]),n||u.rotateZ(f,f,-s.angle),f}return s.glCoordMatrix}function ie(i,o){var n=[i.x,i.y,0,1];mi(n,n,o);var s=n[3];return{point:new u.Point(n[0]/s,n[1]/s),signedDistanceFromCamera:s}}function bo(i,o){return .5+i/o*.5}function se(i,o){var n=i[0]/i[3],s=i[1]/i[3];return n>=-o[0]&&n<=o[0]&&s>=-o[1]&&s<=o[1]}function Un(i,o,n,s,p,f,d,y){var _=s?i.textSizeData:i.iconSizeData,S=u.evaluateSizeForZoom(_,n.transform.zoom),P=[256/n.width*2+1,256/n.height*2+1],k=s?i.text.dynamicLayoutVertexArray:i.icon.dynamicLayoutVertexArray;k.clear();for(var z=i.lineVertexArray,U=s?i.text.placedSymbolArray:i.icon.placedSymbolArray,O=n.transform.width/n.transform.height,G=!1,B=0;B<U.length;B++){var Z=U.get(B);if(Z.hidden||Z.writingMode===u.WritingMode.vertical&&!G)Bi(Z.numGlyphs,k);else{G=!1;var H=[Z.anchorX,Z.anchorY,0,1];if(u.transformMat4(H,H,o),se(H,P)){var Q=bo(n.transform.cameraToCenterDistance,H[3]),at=u.evaluateSizeForFeature(_,S,Z),nt=d?at/Q:at*Q,lt=new u.Point(Z.anchorX,Z.anchorY),ct=ie(lt,p).point,_t={},yt=Vr(Z,nt,!1,y,o,p,f,i.glyphOffsetArray,z,k,ct,lt,_t,O);G=yt.useVertical,(yt.notEnoughRoom||G||yt.needsFlipping&&Vr(Z,nt,!0,y,o,p,f,i.glyphOffsetArray,z,k,ct,lt,_t,O).notEnoughRoom)&&Bi(Z.numGlyphs,k)}else Bi(Z.numGlyphs,k)}}s?i.text.dynamicLayoutVertexBuffer.updateData(k):i.icon.dynamicLayoutVertexBuffer.updateData(k)}function Ca(i,o,n,s,p,f,d,y,_,S,P){var k=y.glyphStartIndex+y.numGlyphs,z=y.lineStartIndex,U=y.lineStartIndex+y.lineLength,O=o.getoffsetX(y.glyphStartIndex),G=o.getoffsetX(k-1),B=Vn(i*O,n,s,p,f,d,y.segment,z,U,_,S,P);if(!B)return null;var Z=Vn(i*G,n,s,p,f,d,y.segment,z,U,_,S,P);return Z?{first:B,last:Z}:null}function yr(i,o,n,s){return i===u.WritingMode.horizontal&&Math.abs(n.y-o.y)>Math.abs(n.x-o.x)*s?{useVertical:!0}:(i===u.WritingMode.vertical?o.y<n.y:o.x>n.x)?{needsFlipping:!0}:null}function Vr(i,o,n,s,p,f,d,y,_,S,P,k,z,U){var O,G=o/24,B=i.lineOffsetX*G,Z=i.lineOffsetY*G;if(i.numGlyphs>1){var H=i.glyphStartIndex+i.numGlyphs,Q=i.lineStartIndex,at=i.lineStartIndex+i.lineLength,nt=Ca(G,y,B,Z,n,P,k,i,_,f,z);if(!nt)return{notEnoughRoom:!0};var lt=ie(nt.first.point,d).point,ct=ie(nt.last.point,d).point;if(s&&!n){var _t=yr(i.writingMode,lt,ct,U);if(_t)return _t}O=[nt.first];for(var yt=i.glyphStartIndex+1;yt<H-1;yt++)O.push(Vn(G*y.getoffsetX(yt),B,Z,n,P,k,i.segment,Q,at,_,f,z));O.push(nt.last)}else{if(s&&!n){var Et=ie(k,p).point,Vt=i.lineStartIndex+i.segment+1,qt=new u.Point(_.getx(Vt),_.gety(Vt)),Nt=ie(qt,p),he=Nt.signedDistanceFromCamera>0?Nt.point:Bs(k,qt,Et,1,p),Ct=yr(i.writingMode,Et,he,U);if(Ct)return Ct}var Jt=Vn(G*y.getoffsetX(i.glyphStartIndex),B,Z,n,P,k,i.segment,i.lineStartIndex,i.lineStartIndex+i.lineLength,_,f,z);if(!Jt)return{notEnoughRoom:!0};O=[Jt]}for(var re=0,Yt=O;re<Yt.length;re+=1){var Ht=Yt[re];u.addDynamicAttributes(S,Ht.point,Ht.angle)}return{}}function Bs(i,o,n,s,p){var f=ie(i.add(i.sub(o)._unit()),p).point,d=n.sub(f);return n.add(d._mult(s/d.mag()))}function Vn(i,o,n,s,p,f,d,y,_,S,P,k){var z=s?i-o:i+o,U=z>0?1:-1,O=0;s&&(U*=-1,O=Math.PI),U<0&&(O+=Math.PI);for(var G=U>0?y+d:y+d+1,B=p,Z=p,H=0,Q=0,at=Math.abs(z),nt=[];H+Q<=at;){if((G+=U)<y||G>=_)return null;if(Z=B,nt.push(B),(B=k[G])===void 0){var lt=new u.Point(S.getx(G),S.gety(G)),ct=ie(lt,P);if(ct.signedDistanceFromCamera>0)B=k[G]=ct.point;else{var _t=G-U;B=Bs(H===0?f:new u.Point(S.getx(_t),S.gety(_t)),lt,Z,at-H+1,P)}}H+=Q,Q=Z.dist(B)}var yt=(at-H)/Q,Et=B.sub(Z),Vt=Et.mult(yt)._add(Z);Vt._add(Et._unit()._perp()._mult(n*U));var qt=O+Math.atan2(B.y-Z.y,B.x-Z.x);return nt.push(Vt),{point:Vt,angle:qt,path:nt}}Ie.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Ie.prototype.insert=function(i,o,n,s,p){this._forEachCell(o,n,s,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(o),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(p)},Ie.prototype.insertCircle=function(i,o,n,s){this._forEachCell(o-s,n-s,o+s,n+s,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(o),this.circles.push(n),this.circles.push(s)},Ie.prototype._insertBoxCell=function(i,o,n,s,p,f){this.boxCells[p].push(f)},Ie.prototype._insertCircleCell=function(i,o,n,s,p,f){this.circleCells[p].push(f)},Ie.prototype._query=function(i,o,n,s,p,f){if(n<0||i>this.width||s<0||o>this.height)return!p&&[];var d=[];if(i<=0&&o<=0&&this.width<=n&&this.height<=s){if(p)return!0;for(var y=0;y<this.boxKeys.length;y++)d.push({key:this.boxKeys[y],x1:this.bboxes[4*y],y1:this.bboxes[4*y+1],x2:this.bboxes[4*y+2],y2:this.bboxes[4*y+3]});for(var _=0;_<this.circleKeys.length;_++){var S=this.circles[3*_],P=this.circles[3*_+1],k=this.circles[3*_+2];d.push({key:this.circleKeys[_],x1:S-k,y1:P-k,x2:S+k,y2:P+k})}return f?d.filter(f):d}return this._forEachCell(i,o,n,s,this._queryCell,d,{hitTest:p,seenUids:{box:{},circle:{}}},f),p?d.length>0:d},Ie.prototype._queryCircle=function(i,o,n,s,p){var f=i-n,d=i+n,y=o-n,_=o+n;if(d<0||f>this.width||_<0||y>this.height)return!s&&[];var S=[];return this._forEachCell(f,y,d,_,this._queryCellCircle,S,{hitTest:s,circle:{x:i,y:o,radius:n},seenUids:{box:{},circle:{}}},p),s?S.length>0:S},Ie.prototype.query=function(i,o,n,s,p){return this._query(i,o,n,s,!1,p)},Ie.prototype.hitTest=function(i,o,n,s,p){return this._query(i,o,n,s,!0,p)},Ie.prototype.hitTestCircle=function(i,o,n,s){return this._queryCircle(i,o,n,!0,s)},Ie.prototype._queryCell=function(i,o,n,s,p,f,d,y){var _=d.seenUids,S=this.boxCells[p];if(S!==null)for(var P=this.bboxes,k=0,z=S;k<z.length;k+=1){var U=z[k];if(!_.box[U]){_.box[U]=!0;var O=4*U;if(i<=P[O+2]&&o<=P[O+3]&&n>=P[O+0]&&s>=P[O+1]&&(!y||y(this.boxKeys[U]))){if(d.hitTest)return f.push(!0),!0;f.push({key:this.boxKeys[U],x1:P[O],y1:P[O+1],x2:P[O+2],y2:P[O+3]})}}}var G=this.circleCells[p];if(G!==null)for(var B=this.circles,Z=0,H=G;Z<H.length;Z+=1){var Q=H[Z];if(!_.circle[Q]){_.circle[Q]=!0;var at=3*Q;if(this._circleAndRectCollide(B[at],B[at+1],B[at+2],i,o,n,s)&&(!y||y(this.circleKeys[Q]))){if(d.hitTest)return f.push(!0),!0;var nt=B[at],lt=B[at+1],ct=B[at+2];f.push({key:this.circleKeys[Q],x1:nt-ct,y1:lt-ct,x2:nt+ct,y2:lt+ct})}}}},Ie.prototype._queryCellCircle=function(i,o,n,s,p,f,d,y){var _=d.circle,S=d.seenUids,P=this.boxCells[p];if(P!==null)for(var k=this.bboxes,z=0,U=P;z<U.length;z+=1){var O=U[z];if(!S.box[O]){S.box[O]=!0;var G=4*O;if(this._circleAndRectCollide(_.x,_.y,_.radius,k[G+0],k[G+1],k[G+2],k[G+3])&&(!y||y(this.boxKeys[O])))return f.push(!0),!0}}var B=this.circleCells[p];if(B!==null)for(var Z=this.circles,H=0,Q=B;H<Q.length;H+=1){var at=Q[H];if(!S.circle[at]){S.circle[at]=!0;var nt=3*at;if(this._circlesCollide(Z[nt],Z[nt+1],Z[nt+2],_.x,_.y,_.radius)&&(!y||y(this.circleKeys[at])))return f.push(!0),!0}}},Ie.prototype._forEachCell=function(i,o,n,s,p,f,d,y){for(var _=this._convertToXCellCoord(i),S=this._convertToYCellCoord(o),P=this._convertToXCellCoord(n),k=this._convertToYCellCoord(s),z=_;z<=P;z++)for(var U=S;U<=k;U++)if(p.call(this,i,o,n,s,this.xCellCount*U+z,f,d,y))return},Ie.prototype._convertToXCellCoord=function(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))},Ie.prototype._convertToYCellCoord=function(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))},Ie.prototype._circlesCollide=function(i,o,n,s,p,f){var d=s-i,y=p-o,_=n+f;return _*_>d*d+y*y},Ie.prototype._circleAndRectCollide=function(i,o,n,s,p,f,d){var y=(f-s)/2,_=Math.abs(i-(s+y));if(_>y+n)return!1;var S=(d-p)/2,P=Math.abs(o-(p+S));if(P>S+n)return!1;if(_<=y||P<=S)return!0;var k=_-y,z=P-S;return k*k+z*z<=n*n};var cr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Bi(i,o){for(var n=0;n<i;n++){var s=o.length;o.resize(s+4),o.float32.set(cr,3*s)}}function mi(i,o,n){var s=o[0],p=o[1];return i[0]=n[0]*s+n[4]*p+n[12],i[1]=n[1]*s+n[5]*p+n[13],i[3]=n[3]*s+n[7]*p+n[15],i}var Le=function(i,o,n){o===void 0&&(o=new Ie(i.width+200,i.height+200,25)),n===void 0&&(n=new Ie(i.width+200,i.height+200,25)),this.transform=i,this.grid=o,this.ignoredGrid=n,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+100,this.screenBottomBoundary=i.height+100,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200};function Nr(i,o,n){return o*(u.EXTENT/(i.tileSize*Math.pow(2,n-i.tileID.overscaledZ)))}Le.prototype.placeCollisionBox=function(i,o,n,s,p){var f=this.projectAndGetPerspectiveRatio(s,i.anchorPointX,i.anchorPointY),d=n*f.perspectiveRatio,y=i.x1*d+f.point.x,_=i.y1*d+f.point.y,S=i.x2*d+f.point.x,P=i.y2*d+f.point.y;return!this.isInsideGrid(y,_,S,P)||!o&&this.grid.hitTest(y,_,S,P,p)?{box:[],offscreen:!1}:{box:[y,_,S,P],offscreen:this.isOffscreen(y,_,S,P)}},Le.prototype.placeCollisionCircles=function(i,o,n,s,p,f,d,y,_,S,P,k,z){var U=[],O=new u.Point(o.anchorX,o.anchorY),G=ie(O,f),B=bo(this.transform.cameraToCenterDistance,G.signedDistanceFromCamera),Z=(S?p/B:p*B)/u.ONE_EM,H=ie(O,d).point,Q=Ca(Z,s,o.lineOffsetX*Z,o.lineOffsetY*Z,!1,H,O,o,n,d,{}),at=!1,nt=!1,lt=!0;if(Q){for(var ct=.5*k*B+z,_t=new u.Point(-100,-100),yt=new u.Point(this.screenRightBoundary,this.screenBottomBoundary),Et=new ce,Vt=Q.first,qt=Q.last,Nt=[],he=Vt.path.length-1;he>=1;he--)Nt.push(Vt.path[he]);for(var Ct=1;Ct<qt.path.length;Ct++)Nt.push(qt.path[Ct]);var Jt=2.5*ct;if(y){var re=Nt.map(function(ui){return ie(ui,y)});Nt=re.some(function(ui){return ui.signedDistanceFromCamera<=0})?[]:re.map(function(ui){return ui.point})}var Yt=[];if(Nt.length>0){for(var Ht=Nt[0].clone(),Kt=Nt[0].clone(),Wt=1;Wt<Nt.length;Wt++)Ht.x=Math.min(Ht.x,Nt[Wt].x),Ht.y=Math.min(Ht.y,Nt[Wt].y),Kt.x=Math.max(Kt.x,Nt[Wt].x),Kt.y=Math.max(Kt.y,Nt[Wt].y);Yt=Ht.x>=_t.x&&Kt.x<=yt.x&&Ht.y>=_t.y&&Kt.y<=yt.y?[Nt]:Kt.x<_t.x||Ht.x>yt.x||Kt.y<_t.y||Ht.y>yt.y?[]:u.clipLine([Nt],_t.x,_t.y,yt.x,yt.y)}for(var Zt=0,we=Yt;Zt<we.length;Zt+=1){var Je;Et.reset(we[Zt],.25*ct),Je=Et.length<=.5*ct?1:Math.ceil(Et.paddedLength/Jt)+1;for(var Dr=0;Dr<Je;Dr++){var pr=Dr/Math.max(Je-1,1),hr=Et.lerp(pr),Ye=hr.x+100,Ar=hr.y+100;U.push(Ye,Ar,ct,0);var Ui=Ye-ct,Lr=Ar-ct,Rr=Ye+ct,Vi=Ar+ct;if(lt=lt&&this.isOffscreen(Ui,Lr,Rr,Vi),nt=nt||this.isInsideGrid(Ui,Lr,Rr,Vi),!i&&this.grid.hitTestCircle(Ye,Ar,ct,P)&&(at=!0,!_))return{circles:[],offscreen:!1,collisionDetected:at}}}}return{circles:!_&&at||!nt?[]:U,offscreen:lt,collisionDetected:at}},Le.prototype.queryRenderedSymbols=function(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var o=[],n=1/0,s=1/0,p=-1/0,f=-1/0,d=0,y=i;d<y.length;d+=1){var _=y[d],S=new u.Point(_.x+100,_.y+100);n=Math.min(n,S.x),s=Math.min(s,S.y),p=Math.max(p,S.x),f=Math.max(f,S.y),o.push(S)}for(var P={},k={},z=0,U=this.grid.query(n,s,p,f).concat(this.ignoredGrid.query(n,s,p,f));z<U.length;z+=1){var O=U[z],G=O.key;if(P[G.bucketInstanceId]===void 0&&(P[G.bucketInstanceId]={}),!P[G.bucketInstanceId][G.featureIndex]){var B=[new u.Point(O.x1,O.y1),new u.Point(O.x2,O.y1),new u.Point(O.x2,O.y2),new u.Point(O.x1,O.y2)];u.polygonIntersectsPolygon(o,B)&&(P[G.bucketInstanceId][G.featureIndex]=!0,k[G.bucketInstanceId]===void 0&&(k[G.bucketInstanceId]=[]),k[G.bucketInstanceId].push(G.featureIndex))}}return k},Le.prototype.insertCollisionBox=function(i,o,n,s,p){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:s,collisionGroupID:p},i[0],i[1],i[2],i[3])},Le.prototype.insertCollisionCircles=function(i,o,n,s,p){for(var f=o?this.ignoredGrid:this.grid,d={bucketInstanceId:n,featureIndex:s,collisionGroupID:p},y=0;y<i.length;y+=4)f.insertCircle(d,i[y],i[y+1],i[y+2])},Le.prototype.projectAndGetPerspectiveRatio=function(i,o,n){var s=[o,n,0,1];return mi(s,s,i),{point:new u.Point((s[0]/s[3]+1)/2*this.transform.width+100,(-s[1]/s[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/s[3]*.5}},Le.prototype.isOffscreen=function(i,o,n,s){return n<100||i>=this.screenRightBoundary||s<100||o>this.screenBottomBoundary},Le.prototype.isInsideGrid=function(i,o,n,s){return n>=0&&i<this.gridRightBoundary&&s>=0&&o<this.gridBottomBoundary},Le.prototype.getViewportMatrix=function(){var i=u.identity([]);return u.translate(i,i,[-100,-100,0]),i};var Ir=function(i,o,n,s){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?o:-o))):s&&n?1:0,this.placed=n};Ir.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Hr=function(i,o,n,s,p){this.text=new Ir(i?i.text:null,o,n,p),this.icon=new Ir(i?i.icon:null,o,s,p)};Hr.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Xi=function(i,o,n){this.text=i,this.icon=o,this.skipFade=n},qu=function(){this.invProjMatrix=u.create(),this.viewportMatrix=u.create(),this.circles=[]},yi=function(i,o,n,s,p){this.bucketInstanceId=i,this.featureIndex=o,this.sourceLayerIndex=n,this.bucketIndex=s,this.tileID=p},Ol=function(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}};function Wi(i,o,n,s,p){var f=u.getAnchorAlignment(i),d=-(f.horizontalAlign-.5)*o,y=-(f.verticalAlign-.5)*n,_=u.evaluateVariableOffset(i,s);return new u.Point(d+_[0]*p,y+_[1]*p)}function gr(i,o,n,s,p,f){var d=i.x1,y=i.x2,_=i.y1,S=i.y2,P=i.anchorPointX,k=i.anchorPointY,z=new u.Point(o,n);return s&&z._rotate(p?f:-f),{x1:d+z.x,y1:_+z.y,x2:y+z.x,y2:S+z.y,anchorPointX:P,anchorPointY:k}}Ol.prototype.get=function(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){var o=++this.maxGroupID;this.collisionGroups[i]={ID:o,predicate:function(n){return n.collisionGroupID===o}}}return this.collisionGroups[i]};var or=function(i,o,n,s){this.transform=i.clone(),this.collisionIndex=new Le(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new Ol(n),this.collisionCircleArrays={},this.prevPlacement=s,s&&(s.prevPlacement=void 0),this.placedOrientations={}};function wo(i,o,n,s,p){i.emplaceBack(o?1:0,n?1:0,s||0,p||0),i.emplaceBack(o?1:0,n?1:0,s||0,p||0),i.emplaceBack(o?1:0,n?1:0,s||0,p||0),i.emplaceBack(o?1:0,n?1:0,s||0,p||0)}or.prototype.getBucketParts=function(i,o,n,s){var p=n.getBucket(o),f=n.latestFeatureIndex;if(p&&f&&o.id===p.layerIds[0]){var d=n.collisionBoxArray,y=p.layers[0].layout,_=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),S=n.tileSize/u.EXTENT,P=this.transform.calculatePosMatrix(n.tileID.toUnwrapped()),k=y.get("text-pitch-alignment")==="map",z=y.get("text-rotation-alignment")==="map",U=Nr(n,1,this.transform.zoom),O=Ne(P,k,z,this.transform,U),G=null;if(k){var B=Ee(P,k,z,this.transform,U);G=u.multiply([],this.transform.labelPlaneMatrix,B)}this.retainedQueryData[p.bucketInstanceId]=new yi(p.bucketInstanceId,f,p.sourceLayerIndex,p.index,n.tileID);var Z={bucket:p,layout:y,posMatrix:P,textLabelPlaneMatrix:O,labelToScreenMatrix:G,scale:_,textPixelRatio:S,holdingForFade:n.holdingForFade(),collisionBoxArray:d,partiallyEvaluatedTextSize:u.evaluateSizeForZoom(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(s)for(var H=0,Q=p.sortKeyRanges;H<Q.length;H+=1){var at=Q[H];i.push({sortKey:at.sortKey,symbolInstanceStart:at.symbolInstanceStart,symbolInstanceEnd:at.symbolInstanceEnd,parameters:Z})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:Z})}},or.prototype.attemptAnchorPlacement=function(i,o,n,s,p,f,d,y,_,S,P,k,z,U,O){var G,B=[k.textOffset0,k.textOffset1],Z=Wi(i,n,s,B,p),H=this.collisionIndex.placeCollisionBox(gr(o,Z.x,Z.y,f,d,this.transform.angle),P,y,_,S.predicate);if(!O||this.collisionIndex.placeCollisionBox(gr(O,Z.x,Z.y,f,d,this.transform.angle),P,y,_,S.predicate).box.length!==0)return H.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[k.crossTileID]&&this.prevPlacement.placements[k.crossTileID]&&this.prevPlacement.placements[k.crossTileID].text&&(G=this.prevPlacement.variableOffsets[k.crossTileID].anchor),this.variableOffsets[k.crossTileID]={textOffset:B,width:n,height:s,anchor:i,textBoxScale:p,prevAnchor:G},this.markUsedJustification(z,i,k,U),z.allowVerticalPlacement&&(this.markUsedOrientation(z,U,k),this.placedOrientations[k.crossTileID]=U),{shift:Z,placedGlyphBoxes:H}):void 0},or.prototype.placeLayerBucketPart=function(i,o,n){var s=this,p=i.parameters,f=p.bucket,d=p.layout,y=p.posMatrix,_=p.textLabelPlaneMatrix,S=p.labelToScreenMatrix,P=p.textPixelRatio,k=p.holdingForFade,z=p.collisionBoxArray,U=p.partiallyEvaluatedTextSize,O=p.collisionGroup,G=d.get("text-optional"),B=d.get("icon-optional"),Z=d.get("text-allow-overlap"),H=d.get("icon-allow-overlap"),Q=d.get("text-rotation-alignment")==="map",at=d.get("text-pitch-alignment")==="map",nt=d.get("icon-text-fit")!=="none",lt=d.get("symbol-z-order")==="viewport-y",ct=Z&&(H||!f.hasIconData()||B),_t=H&&(Z||!f.hasTextData()||G);!f.collisionArrays&&z&&f.deserializeCollisionBoxes(z);var yt=function(Ct,Jt){if(!o[Ct.crossTileID])if(k)s.placements[Ct.crossTileID]=new Xi(!1,!1,!1);else{var re,Yt=!1,Ht=!1,Kt=!0,Wt=null,Zt={box:null,offscreen:null},we={box:null,offscreen:null},Je=null,Dr=null,pr=0,hr=0,Ye=0;Jt.textFeatureIndex?pr=Jt.textFeatureIndex:Ct.useRuntimeCollisionCircles&&(pr=Ct.featureIndex),Jt.verticalTextFeatureIndex&&(hr=Jt.verticalTextFeatureIndex);var Ar=Jt.textBox;if(Ar){var Ui=function(Qe){var Ze=u.WritingMode.horizontal;if(f.allowVerticalPlacement&&!Qe&&s.prevPlacement){var Br=s.prevPlacement.placedOrientations[Ct.crossTileID];Br&&(s.placedOrientations[Ct.crossTileID]=Br,s.markUsedOrientation(f,Ze=Br,Ct))}return Ze},Lr=function(Qe,Ze){if(f.allowVerticalPlacement&&Ct.numVerticalGlyphVertices>0&&Jt.verticalTextBox)for(var Br=0,pa=f.writingModes;Br<pa.length&&(pa[Br]===u.WritingMode.vertical?(Zt=Ze(),we=Zt):Zt=Qe(),!(Zt&&Zt.box&&Zt.box.length));Br+=1);else Zt=Qe()};if(d.get("text-variable-anchor")){var Rr=d.get("text-variable-anchor");if(s.prevPlacement&&s.prevPlacement.variableOffsets[Ct.crossTileID]){var Vi=s.prevPlacement.variableOffsets[Ct.crossTileID];Rr.indexOf(Vi.anchor)>0&&(Rr=Rr.filter(function(Qe){return Qe!==Vi.anchor})).unshift(Vi.anchor)}var ui=function(Qe,Ze,Br){for(var pa=Qe.x2-Qe.x1,rs=Qe.y2-Qe.y1,nc=Ct.textBoxScale,is=nt&&!H?Ze:null,ns={box:[],offscreen:!1},lu=Z?2*Rr.length:Rr.length,ha=0;ha<lu;++ha){var fa=s.attemptAnchorPlacement(Rr[ha%Rr.length],Qe,pa,rs,nc,Q,at,P,y,O,ha>=Rr.length,Ct,f,Br,is);if(fa&&(ns=fa.placedGlyphBoxes)&&ns.box&&ns.box.length){Yt=!0,Wt=fa.shift;break}}return ns};Lr(function(){return ui(Ar,Jt.iconBox,u.WritingMode.horizontal)},function(){var Qe=Jt.verticalTextBox;return f.allowVerticalPlacement&&!(Zt&&Zt.box&&Zt.box.length)&&Ct.numVerticalGlyphVertices>0&&Qe?ui(Qe,Jt.verticalIconBox,u.WritingMode.vertical):{box:null,offscreen:null}}),Zt&&(Yt=Zt.box,Kt=Zt.offscreen);var ll=Ui(Zt&&Zt.box);if(!Yt&&s.prevPlacement){var Sn=s.prevPlacement.variableOffsets[Ct.crossTileID];Sn&&(s.variableOffsets[Ct.crossTileID]=Sn,s.markUsedJustification(f,Sn.anchor,Ct,ll))}}else{var Mo=function(Qe,Ze){var Br=s.collisionIndex.placeCollisionBox(Qe,Z,P,y,O.predicate);return Br&&Br.box&&Br.box.length&&(s.markUsedOrientation(f,Ze,Ct),s.placedOrientations[Ct.crossTileID]=Ze),Br};Lr(function(){return Mo(Ar,u.WritingMode.horizontal)},function(){var Qe=Jt.verticalTextBox;return f.allowVerticalPlacement&&Ct.numVerticalGlyphVertices>0&&Qe?Mo(Qe,u.WritingMode.vertical):{box:null,offscreen:null}}),Ui(Zt&&Zt.box&&Zt.box.length)}}if(Yt=(re=Zt)&&re.box&&re.box.length>0,Kt=re&&re.offscreen,Ct.useRuntimeCollisionCircles){var eo=f.text.placedSymbolArray.get(Ct.centerJustifiedTextSymbolIndex),ca=u.evaluateSizeForFeature(f.textSizeData,U,eo),Do=d.get("text-padding");Je=s.collisionIndex.placeCollisionCircles(Z,eo,f.lineVertexArray,f.glyphOffsetArray,ca,y,_,S,n,at,O.predicate,Ct.collisionCircleDiameter,Do),Yt=Z||Je.circles.length>0&&!Je.collisionDetected,Kt=Kt&&Je.offscreen}if(Jt.iconFeatureIndex&&(Ye=Jt.iconFeatureIndex),Jt.iconBox){var Ni=function(Qe){var Ze=nt&&Wt?gr(Qe,Wt.x,Wt.y,Q,at,s.transform.angle):Qe;return s.collisionIndex.placeCollisionBox(Ze,H,P,y,O.predicate)};Ht=we&&we.box&&we.box.length&&Jt.verticalIconBox?(Dr=Ni(Jt.verticalIconBox)).box.length>0:(Dr=Ni(Jt.iconBox)).box.length>0,Kt=Kt&&Dr.offscreen}var Lo=G||Ct.numHorizontalGlyphVertices===0&&Ct.numVerticalGlyphVertices===0,ar=B||Ct.numIconVertices===0;if(Lo||ar?ar?Lo||(Ht=Ht&&Yt):Yt=Ht&&Yt:Ht=Yt=Ht&&Yt,Yt&&re&&re.box&&s.collisionIndex.insertCollisionBox(re.box,d.get("text-ignore-placement"),f.bucketInstanceId,we&&we.box&&hr?hr:pr,O.ID),Ht&&Dr&&s.collisionIndex.insertCollisionBox(Dr.box,d.get("icon-ignore-placement"),f.bucketInstanceId,Ye,O.ID),Je&&(Yt&&s.collisionIndex.insertCollisionCircles(Je.circles,d.get("text-ignore-placement"),f.bucketInstanceId,pr,O.ID),n)){var $i=f.bucketInstanceId,Di=s.collisionCircleArrays[$i];Di===void 0&&(Di=s.collisionCircleArrays[$i]=new qu);for(var ro=0;ro<Je.circles.length;ro+=4)Di.circles.push(Je.circles[ro+0]),Di.circles.push(Je.circles[ro+1]),Di.circles.push(Je.circles[ro+2]),Di.circles.push(Je.collisionDetected?1:0)}s.placements[Ct.crossTileID]=new Xi(Yt||ct,Ht||_t,Kt||f.justReloaded),o[Ct.crossTileID]=!0}};if(lt)for(var Et=f.getSortedSymbolIndexes(this.transform.angle),Vt=Et.length-1;Vt>=0;--Vt){var qt=Et[Vt];yt(f.symbolInstances.get(qt),f.collisionArrays[qt])}else for(var Nt=i.symbolInstanceStart;Nt<i.symbolInstanceEnd;Nt++)yt(f.symbolInstances.get(Nt),f.collisionArrays[Nt]);if(n&&f.bucketInstanceId in this.collisionCircleArrays){var he=this.collisionCircleArrays[f.bucketInstanceId];u.invert(he.invProjMatrix,y),he.viewportMatrix=this.collisionIndex.getViewportMatrix()}f.justReloaded=!1},or.prototype.markUsedJustification=function(i,o,n,s){var p;p=s===u.WritingMode.vertical?n.verticalPlacedTextSymbolIndex:{left:n.leftJustifiedTextSymbolIndex,center:n.centerJustifiedTextSymbolIndex,right:n.rightJustifiedTextSymbolIndex}[u.getAnchorJustification(o)];for(var f=0,d=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex,n.verticalPlacedTextSymbolIndex];f<d.length;f+=1){var y=d[f];y>=0&&(i.text.placedSymbolArray.get(y).crossTileID=p>=0&&y!==p?0:n.crossTileID)}},or.prototype.markUsedOrientation=function(i,o,n){for(var s=o===u.WritingMode.horizontal||o===u.WritingMode.horizontalOnly?o:0,p=o===u.WritingMode.vertical?o:0,f=0,d=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex];f<d.length;f+=1)i.text.placedSymbolArray.get(d[f]).placedOrientation=s;n.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).placedOrientation=p)},or.prototype.commit=function(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;var o=this.prevPlacement,n=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;var s=o?o.symbolFadeChange(i):1,p=o?o.opacities:{},f=o?o.variableOffsets:{},d=o?o.placedOrientations:{};for(var y in this.placements){var _=this.placements[y],S=p[y];S?(this.opacities[y]=new Hr(S,s,_.text,_.icon),n=n||_.text!==S.text.placed||_.icon!==S.icon.placed):(this.opacities[y]=new Hr(null,s,_.text,_.icon,_.skipFade),n=n||_.text||_.icon)}for(var P in p){var k=p[P];if(!this.opacities[P]){var z=new Hr(k,s,!1,!1);z.isHidden()||(this.opacities[P]=z,n=n||k.text.placed||k.icon.placed)}}for(var U in f)this.variableOffsets[U]||!this.opacities[U]||this.opacities[U].isHidden()||(this.variableOffsets[U]=f[U]);for(var O in d)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=d[O]);n?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:i)},or.prototype.updateLayerOpacities=function(i,o){for(var n={},s=0,p=o;s<p.length;s+=1){var f=p[s],d=f.getBucket(i);d&&f.latestFeatureIndex&&i.id===d.layerIds[0]&&this.updateBucketOpacities(d,n,f.collisionBoxArray)}},or.prototype.updateBucketOpacities=function(i,o,n){var s=this;i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();var p=i.layers[0].layout,f=new Hr(null,0,!1,!1,!0),d=p.get("text-allow-overlap"),y=p.get("icon-allow-overlap"),_=p.get("text-variable-anchor"),S=p.get("text-rotation-alignment")==="map",P=p.get("text-pitch-alignment")==="map",k=p.get("icon-text-fit")!=="none",z=new Hr(null,0,d&&(y||!i.hasIconData()||p.get("icon-optional")),y&&(d||!i.hasTextData()||p.get("text-optional")),!0);!i.collisionArrays&&n&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(n);for(var U=function(Z,H,Q){for(var at=0;at<H/4;at++)Z.opacityVertexArray.emplaceBack(Q)},O=function(Z){var H=i.symbolInstances.get(Z),Q=H.numHorizontalGlyphVertices,at=H.numVerticalGlyphVertices,nt=H.crossTileID,lt=s.opacities[nt];o[nt]?lt=f:lt||(s.opacities[nt]=lt=z),o[nt]=!0;var ct=H.numIconVertices>0,_t=s.placedOrientations[H.crossTileID],yt=_t===u.WritingMode.vertical,Et=_t===u.WritingMode.horizontal||_t===u.WritingMode.horizontalOnly;if(Q>0||at>0){var Vt=Fs(lt.text);U(i.text,Q,yt?Da:Vt),U(i.text,at,Et?Da:Vt);var qt=lt.text.isHidden();[H.rightJustifiedTextSymbolIndex,H.centerJustifiedTextSymbolIndex,H.leftJustifiedTextSymbolIndex].forEach(function(Zt){Zt>=0&&(i.text.placedSymbolArray.get(Zt).hidden=qt||yt?1:0)}),H.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(H.verticalPlacedTextSymbolIndex).hidden=qt||Et?1:0);var Nt=s.variableOffsets[H.crossTileID];Nt&&s.markUsedJustification(i,Nt.anchor,H,_t);var he=s.placedOrientations[H.crossTileID];he&&(s.markUsedJustification(i,"left",H,he),s.markUsedOrientation(i,he,H))}if(ct){var Ct=Fs(lt.icon),Jt=!(k&&H.verticalPlacedIconSymbolIndex&&yt);H.placedIconSymbolIndex>=0&&(U(i.icon,H.numIconVertices,Jt?Ct:Da),i.icon.placedSymbolArray.get(H.placedIconSymbolIndex).hidden=lt.icon.isHidden()),H.verticalPlacedIconSymbolIndex>=0&&(U(i.icon,H.numVerticalIconVertices,Jt?Da:Ct),i.icon.placedSymbolArray.get(H.verticalPlacedIconSymbolIndex).hidden=lt.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){var re=i.collisionArrays[Z];if(re){var Yt=new u.Point(0,0);if(re.textBox||re.verticalTextBox){var Ht=!0;if(_){var Kt=s.variableOffsets[nt];Kt?(Yt=Wi(Kt.anchor,Kt.width,Kt.height,Kt.textOffset,Kt.textBoxScale),S&&Yt._rotate(P?s.transform.angle:-s.transform.angle)):Ht=!1}re.textBox&&wo(i.textCollisionBox.collisionVertexArray,lt.text.placed,!Ht||yt,Yt.x,Yt.y),re.verticalTextBox&&wo(i.textCollisionBox.collisionVertexArray,lt.text.placed,!Ht||Et,Yt.x,Yt.y)}var Wt=Boolean(!Et&&re.verticalIconBox);re.iconBox&&wo(i.iconCollisionBox.collisionVertexArray,lt.icon.placed,Wt,k?Yt.x:0,k?Yt.y:0),re.verticalIconBox&&wo(i.iconCollisionBox.collisionVertexArray,lt.icon.placed,!Wt,k?Yt.x:0,k?Yt.y:0)}}},G=0;G<i.symbolInstances.length;G++)O(G);if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){var B=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=B.invProjMatrix,i.placementViewportMatrix=B.viewportMatrix,i.collisionCircleArray=B.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}},or.prototype.symbolFadeChange=function(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},or.prototype.zoomAdjustment=function(i){return Math.max(0,(this.transform.zoom-i)/1.5)},or.prototype.hasTransitions=function(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration},or.prototype.stillRecent=function(i,o){var n=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*n>i},or.prototype.setStale=function(){this.stale=!0};var Ma=Math.pow(2,25),Zu=Math.pow(2,24),Gu=Math.pow(2,17),Os=Math.pow(2,16),Xu=Math.pow(2,9),Fl=Math.pow(2,8),Wu=Math.pow(2,1);function Fs(i){if(i.opacity===0&&!i.placed)return 0;if(i.opacity===1&&i.placed)return 4294967295;var o=i.placed?1:0,n=Math.floor(127*i.opacity);return n*Ma+o*Zu+n*Gu+o*Os+n*Xu+o*Fl+n*Wu+o}var Da=0,La=function(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&!i.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};La.prototype.continuePlacement=function(i,o,n,s,p){for(var f=this._bucketParts;this._currentTileIndex<i.length;)if(o.getBucketParts(f,s,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,f.sort(function(d,y){return d.sortKey-y.sortKey}));this._currentPartIndex<f.length;)if(o.placeLayerBucketPart(f[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,p())return!0;return!1};var Xo=function(i,o,n,s,p,f,d){this.placement=new or(i,p,f,d),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=s,this._done=!1};Xo.prototype.isDone=function(){return this._done},Xo.prototype.continuePlacement=function(i,o,n){for(var s=this,p=u.browser.now(),f=function(){var _=u.browser.now()-p;return!s._forceFullPlacement&&_>2};this._currentPlacementIndex>=0;){var d=o[i[this._currentPlacementIndex]],y=this.placement.collisionIndex.transform.zoom;if(d.type==="symbol"&&(!d.minzoom||d.minzoom<=y)&&(!d.maxzoom||d.maxzoom>y)){if(this._inProgressLayer||(this._inProgressLayer=new La(d)),this._inProgressLayer.continuePlacement(n[d.source],this.placement,this._showCollisionBoxes,d,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Xo.prototype.commit=function(i){return this.placement.commit(i),this.placement};var Ul=512/u.EXTENT/2,Ra=function(i,o,n){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=n;for(var s=0;s<o.length;s++){var p=o.get(s),f=p.key;this.indexedSymbolInstances[f]||(this.indexedSymbolInstances[f]=[]),this.indexedSymbolInstances[f].push({crossTileID:p.crossTileID,coord:this.getScaledCoordinates(p,i)})}};Ra.prototype.getScaledCoordinates=function(i,o){var n=Ul/Math.pow(2,o.canonical.z-this.tileID.canonical.z);return{x:Math.floor((o.canonical.x*u.EXTENT+i.anchorX)*n),y:Math.floor((o.canonical.y*u.EXTENT+i.anchorY)*n)}},Ra.prototype.findMatches=function(i,o,n){for(var s=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),p=0;p<i.length;p++){var f=i.get(p);if(!f.crossTileID){var d=this.indexedSymbolInstances[f.key];if(d)for(var y=this.getScaledCoordinates(f,o),_=0,S=d;_<S.length;_+=1){var P=S[_];if(Math.abs(P.coord.x-y.x)<=s&&Math.abs(P.coord.y-y.y)<=s&&!n[P.crossTileID]){n[P.crossTileID]=!0,f.crossTileID=P.crossTileID;break}}}}};var Us=function(){this.maxCrossTileID=0};Us.prototype.generate=function(){return++this.maxCrossTileID};var jr=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};jr.prototype.handleWrapJump=function(i){var o=Math.round((i-this.lng)/360);if(o!==0)for(var n in this.indexes){var s=this.indexes[n],p={};for(var f in s){var d=s[f];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+o),p[d.tileID.key]=d}this.indexes[n]=p}this.lng=i},jr.prototype.addBucket=function(i,o,n){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(var s=0;s<o.symbolInstances.length;s++)o.symbolInstances.get(s).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});var p=this.usedCrossTileIDs[i.overscaledZ];for(var f in this.indexes){var d=this.indexes[f];if(Number(f)>i.overscaledZ)for(var y in d){var _=d[y];_.tileID.isChildOf(i)&&_.findMatches(o.symbolInstances,i,p)}else{var S=d[i.scaledTo(Number(f)).key];S&&S.findMatches(o.symbolInstances,i,p)}}for(var P=0;P<o.symbolInstances.length;P++){var k=o.symbolInstances.get(P);k.crossTileID||(k.crossTileID=n.generate(),p[k.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Ra(i,o.symbolInstances,o.bucketInstanceId),!0},jr.prototype.removeBucketCrossTileIDs=function(i,o){for(var n in o.indexedSymbolInstances)for(var s=0,p=o.indexedSymbolInstances[n];s<p.length;s+=1)delete this.usedCrossTileIDs[i][p[s].crossTileID]},jr.prototype.removeStaleBuckets=function(i){var o=!1;for(var n in this.indexes){var s=this.indexes[n];for(var p in s)i[s[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,s[p]),delete s[p],o=!0)}return o};var Nn=function(){this.layerIndexes={},this.crossTileIDs=new Us,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Nn.prototype.addLayer=function(i,o,n){var s=this.layerIndexes[i.id];s===void 0&&(s=this.layerIndexes[i.id]=new jr);var p=!1,f={};s.handleWrapJump(n);for(var d=0,y=o;d<y.length;d+=1){var _=y[d],S=_.getBucket(i);S&&i.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),s.addBucket(_.tileID,S,this.crossTileIDs)&&(p=!0),f[S.bucketInstanceId]=!0)}return s.removeStaleBuckets(f)&&(p=!0),p},Nn.prototype.pruneUnusedLayers=function(i){var o={};for(var n in i.forEach(function(s){o[s]=!0}),this.layerIndexes)o[n]||delete this.layerIndexes[n]};var un=function(i,o){return u.emitValidationErrors(i,o&&o.filter(function(n){return n.identifier!=="source.canvas"}))},Ba=u.pick(ft,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),cn=u.pick(ft,["setCenter","setZoom","setBearing","setPitch"]),pn=function(){var i={},o=u.styleSpec.$version;for(var n in u.styleSpec.$root){var s,p=u.styleSpec.$root[n];p.required&&(s=n==="version"?o:p.type==="array"?[]:{})!=null&&(i[n]=s)}return i}(),Ki=function(i){function o(n,s){var p=this;s===void 0&&(s={}),i.call(this),this.map=n,this.dispatcher=new Kr(Ft(),this),this.imageManager=new He,this.imageManager.setEventedParent(this),this.glyphManager=new kr(n._requestManager,s.localIdeographFontFamily),this.lineAtlas=new qe(256,512),this.crossTileSymbolIndex=new Nn,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new u.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",u.getReferrer());var f=this;this._rtlTextPluginCallback=o.registerForPluginStateChange(function(d){f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:d.pluginStatus,pluginURL:d.pluginURL},function(y,_){if(u.triggerPluginCompletionEvent(y),_&&_.every(function(P){return P}))for(var S in f.sourceCaches)f.sourceCaches[S].reload()})}),this.on("data",function(d){if(d.dataType==="source"&&d.sourceDataType==="metadata"){var y=p.sourceCaches[d.sourceId];if(y){var _=y.getSource();if(_&&_.vectorLayerIds)for(var S in p._layers){var P=p._layers[S];P.source===_.id&&p._validateLayer(P)}}}})}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.loadURL=function(n,s){var p=this;s===void 0&&(s={}),this.fire(new u.Event("dataloading",{dataType:"style"}));var f=typeof s.validate=="boolean"?s.validate:!u.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,s.accessToken);var d=this.map._requestManager.transformRequest(n,u.ResourceType.Style);this._request=u.getJSON(d,function(y,_){p._request=null,y?p.fire(new u.ErrorEvent(y)):_&&p._load(_,f)})},o.prototype.loadJSON=function(n,s){var p=this;s===void 0&&(s={}),this.fire(new u.Event("dataloading",{dataType:"style"})),this._request=u.browser.frame(function(){p._request=null,p._load(n,s.validate!==!1)})},o.prototype.loadEmpty=function(){this.fire(new u.Event("dataloading",{dataType:"style"})),this._load(pn,!1)},o.prototype._load=function(n,s){if(!s||!un(this,u.validateStyle(n))){for(var p in this._loaded=!0,this.stylesheet=n,n.sources)this.addSource(p,n.sources[p],{validate:!1});n.sprite?this._loadSprite(n.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(n.glyphs);var f=wt(this.stylesheet.layers);this._order=f.map(function(S){return S.id}),this._layers={},this._serializedLayers={};for(var d=0,y=f;d<y.length;d+=1){var _=y[d];(_=u.createStyleLayer(_)).setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ho(this.stylesheet.light),this.fire(new u.Event("data",{dataType:"style"})),this.fire(new u.Event("style.load"))}},o.prototype._loadSprite=function(n){var s=this;this._spriteRequest=function(p,f,d){var y,_,S,P=u.browser.devicePixelRatio>1?"@2x":"",k=u.getJSON(f.transformRequest(f.normalizeSpriteURL(p,P,".json"),u.ResourceType.SpriteJSON),function(O,G){k=null,S||(S=O,y=G,U())}),z=u.getImage(f.transformRequest(f.normalizeSpriteURL(p,P,".png"),u.ResourceType.SpriteImage),function(O,G){z=null,S||(S=O,_=G,U())});function U(){if(S)d(S);else if(y&&_){var O=u.browser.getImageData(_),G={};for(var B in y){var Z=y[B],H=Z.width,Q=Z.height,at=Z.x,nt=Z.y,lt=Z.sdf,ct=Z.pixelRatio,_t=Z.stretchX,yt=Z.stretchY,Et=Z.content,Vt=new u.RGBAImage({width:H,height:Q});u.RGBAImage.copy(O,Vt,{x:at,y:nt},{x:0,y:0},{width:H,height:Q}),G[B]={data:Vt,pixelRatio:ct,sdf:lt,stretchX:_t,stretchY:yt,content:Et}}d(null,G)}}return{cancel:function(){k&&(k.cancel(),k=null),z&&(z.cancel(),z=null)}}}(n,this.map._requestManager,function(p,f){if(s._spriteRequest=null,p)s.fire(new u.ErrorEvent(p));else if(f)for(var d in f)s.imageManager.addImage(d,f[d]);s.imageManager.setLoaded(!0),s._availableImages=s.imageManager.listImages(),s.dispatcher.broadcast("setImages",s._availableImages),s.fire(new u.Event("data",{dataType:"style"}))})},o.prototype._validateLayer=function(n){var s=this.sourceCaches[n.source];if(s){var p=n.sourceLayer;if(p){var f=s.getSource();(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(p)===-1)&&this.fire(new u.ErrorEvent(new Error('Source layer "'+p+'" does not exist on source "'+f.id+'" as specified by style layer "'+n.id+'"')))}}},o.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var n in this.sourceCaches)if(!this.sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()},o.prototype._serializeLayers=function(n){for(var s=[],p=0,f=n;p<f.length;p+=1){var d=this._layers[f[p]];d.type!=="custom"&&s.push(d.serialize())}return s},o.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var n in this.sourceCaches)if(this.sourceCaches[n].hasTransition())return!0;for(var s in this._layers)if(this._layers[s].hasTransition())return!0;return!1},o.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},o.prototype.update=function(n){if(this._loaded){var s=this._changed;if(this._changed){var p=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);for(var d in(p.length||f.length)&&this._updateWorkerLayers(p,f),this._updatedSources){var y=this._updatedSources[d];y==="reload"?this._reloadSource(d):y==="clear"&&this._clearSource(d)}for(var _ in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[_].updateTransitions(n);this.light.updateTransitions(n),this._resetUpdates()}var S={};for(var P in this.sourceCaches){var k=this.sourceCaches[P];S[P]=k.used,k.used=!1}for(var z=0,U=this._order;z<U.length;z+=1){var O=this._layers[U[z]];O.recalculate(n,this._availableImages),!O.isHidden(n.zoom)&&O.source&&(this.sourceCaches[O.source].used=!0)}for(var G in S){var B=this.sourceCaches[G];S[G]!==B.used&&B.fire(new u.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:G}))}this.light.recalculate(n),this.z=n.zoom,s&&this.fire(new u.Event("data",{dataType:"style"}))}},o.prototype._updateTilesForChangedImages=function(){var n=Object.keys(this._changedImages);if(n.length){for(var s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}},o.prototype._updateWorkerLayers=function(n,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:s})},o.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},o.prototype.setState=function(n){var s=this;if(this._checkLoaded(),un(this,u.validateStyle(n)))return!1;(n=u.clone$1(n)).layers=wt(n.layers);var p=function(d,y){if(!d)return[{command:ft.setStyle,args:[y]}];var _=[];try{if(!u.deepEqual(d.version,y.version))return[{command:ft.setStyle,args:[y]}];u.deepEqual(d.center,y.center)||_.push({command:ft.setCenter,args:[y.center]}),u.deepEqual(d.zoom,y.zoom)||_.push({command:ft.setZoom,args:[y.zoom]}),u.deepEqual(d.bearing,y.bearing)||_.push({command:ft.setBearing,args:[y.bearing]}),u.deepEqual(d.pitch,y.pitch)||_.push({command:ft.setPitch,args:[y.pitch]}),u.deepEqual(d.sprite,y.sprite)||_.push({command:ft.setSprite,args:[y.sprite]}),u.deepEqual(d.glyphs,y.glyphs)||_.push({command:ft.setGlyphs,args:[y.glyphs]}),u.deepEqual(d.transition,y.transition)||_.push({command:ft.setTransition,args:[y.transition]}),u.deepEqual(d.light,y.light)||_.push({command:ft.setLight,args:[y.light]});var S={},P=[];(function(z,U,O,G){var B;for(B in U=U||{},z=z||{})z.hasOwnProperty(B)&&(U.hasOwnProperty(B)||$t(B,O,G));for(B in U)U.hasOwnProperty(B)&&(z.hasOwnProperty(B)?u.deepEqual(z[B],U[B])||(z[B].type==="geojson"&&U[B].type==="geojson"&&Te(z,U,B)?O.push({command:ft.setGeoJSONSourceData,args:[B,U[B].data]}):Lt(B,U,O,G)):Qt(B,U,O))})(d.sources,y.sources,P,S);var k=[];d.layers&&d.layers.forEach(function(z){S[z.source]?_.push({command:ft.removeLayer,args:[z.id]}):k.push(z)}),_=_.concat(P),function(z,U,O){U=U||[];var G,B,Z,H,Q,at,nt,lt=(z=z||[]).map(Ae),ct=U.map(Ae),_t=z.reduce(Ce,{}),yt=U.reduce(Ce,{}),Et=lt.slice(),Vt=Object.create(null);for(G=0,B=0;G<lt.length;G++)yt.hasOwnProperty(Z=lt[G])?B++:(O.push({command:ft.removeLayer,args:[Z]}),Et.splice(Et.indexOf(Z,B),1));for(G=0,B=0;G<ct.length;G++)Et[Et.length-1-G]!==(Z=ct[ct.length-1-G])&&(_t.hasOwnProperty(Z)?(O.push({command:ft.removeLayer,args:[Z]}),Et.splice(Et.lastIndexOf(Z,Et.length-B),1)):B++,O.push({command:ft.addLayer,args:[yt[Z],at=Et[Et.length-G]]}),Et.splice(Et.length-G,0,Z),Vt[Z]=!0);for(G=0;G<ct.length;G++)if(H=_t[Z=ct[G]],Q=yt[Z],!Vt[Z]&&!u.deepEqual(H,Q))if(u.deepEqual(H.source,Q.source)&&u.deepEqual(H["source-layer"],Q["source-layer"])&&u.deepEqual(H.type,Q.type)){for(nt in oe(H.layout,Q.layout,O,Z,null,ft.setLayoutProperty),oe(H.paint,Q.paint,O,Z,null,ft.setPaintProperty),u.deepEqual(H.filter,Q.filter)||O.push({command:ft.setFilter,args:[Z,Q.filter]}),u.deepEqual(H.minzoom,Q.minzoom)&&u.deepEqual(H.maxzoom,Q.maxzoom)||O.push({command:ft.setLayerZoomRange,args:[Z,Q.minzoom,Q.maxzoom]}),H)H.hasOwnProperty(nt)&&nt!=="layout"&&nt!=="paint"&&nt!=="filter"&&nt!=="metadata"&&nt!=="minzoom"&&nt!=="maxzoom"&&(nt.indexOf("paint.")===0?oe(H[nt],Q[nt],O,Z,nt.slice(6),ft.setPaintProperty):u.deepEqual(H[nt],Q[nt])||O.push({command:ft.setLayerProperty,args:[Z,nt,Q[nt]]}));for(nt in Q)Q.hasOwnProperty(nt)&&!H.hasOwnProperty(nt)&&nt!=="layout"&&nt!=="paint"&&nt!=="filter"&&nt!=="metadata"&&nt!=="minzoom"&&nt!=="maxzoom"&&(nt.indexOf("paint.")===0?oe(H[nt],Q[nt],O,Z,nt.slice(6),ft.setPaintProperty):u.deepEqual(H[nt],Q[nt])||O.push({command:ft.setLayerProperty,args:[Z,nt,Q[nt]]}))}else O.push({command:ft.removeLayer,args:[Z]}),at=Et[Et.lastIndexOf(Z)+1],O.push({command:ft.addLayer,args:[Q,at]})}(k,y.layers,_)}catch(z){console.warn("Unable to compute style diff:",z),_=[{command:ft.setStyle,args:[y]}]}return _}(this.serialize(),n).filter(function(d){return!(d.command in cn)});if(p.length===0)return!1;var f=p.filter(function(d){return!(d.command in Ba)});if(f.length>0)throw new Error("Unimplemented: "+f.map(function(d){return d.command}).join(", ")+".");return p.forEach(function(d){d.command!=="setTransition"&&s[d.command].apply(s,d.args)}),this.stylesheet=n,!0},o.prototype.addImage=function(n,s){if(this.getImage(n))return this.fire(new u.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(n,s),this._afterImageUpdated(n)},o.prototype.updateImage=function(n,s){this.imageManager.updateImage(n,s)},o.prototype.getImage=function(n){return this.imageManager.getImage(n)},o.prototype.removeImage=function(n){if(!this.getImage(n))return this.fire(new u.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(n),this._afterImageUpdated(n)},o.prototype._afterImageUpdated=function(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"}))},o.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},o.prototype.addSource=function(n,s,p){var f=this;if(p===void 0&&(p={}),this._checkLoaded(),this.sourceCaches[n]!==void 0)throw new Error("There is already a source with this ID");if(!s.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(s).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(u.validateStyle.source,"sources."+n,s,null,p))){this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);var d=this.sourceCaches[n]=new D(n,s,this.dispatcher);d.style=this,d.setEventedParent(this,function(){return{isSourceLoaded:f.loaded(),source:d.serialize(),sourceId:n}}),d.onAdd(this.map),this._changed=!0}},o.prototype.removeSource=function(n){if(this._checkLoaded(),this.sourceCaches[n]===void 0)throw new Error("There is no source with this ID");for(var s in this._layers)if(this._layers[s].source===n)return this.fire(new u.ErrorEvent(new Error('Source "'+n+'" cannot be removed while layer "'+s+'" is using it.')));var p=this.sourceCaches[n];delete this.sourceCaches[n],delete this._updatedSources[n],p.fire(new u.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:n})),p.setEventedParent(null),p.clearTiles(),p.onRemove&&p.onRemove(this.map),this._changed=!0},o.prototype.setGeoJSONSourceData=function(n,s){this._checkLoaded(),this.sourceCaches[n].getSource().setData(s),this._changed=!0},o.prototype.getSource=function(n){return this.sourceCaches[n]&&this.sourceCaches[n].getSource()},o.prototype.addLayer=function(n,s,p){p===void 0&&(p={}),this._checkLoaded();var f=n.id;if(this.getLayer(f))this.fire(new u.ErrorEvent(new Error('Layer with id "'+f+'" already exists on this map')));else{var d;if(n.type==="custom"){if(un(this,u.validateCustomStyleLayer(n)))return;d=u.createStyleLayer(n)}else{if(typeof n.source=="object"&&(this.addSource(f,n.source),n=u.clone$1(n),n=u.extend(n,{source:f})),this._validate(u.validateStyle.layer,"layers."+f,n,{arrayIndex:-1},p))return;d=u.createStyleLayer(n),this._validateLayer(d),d.setEventedParent(this,{layer:{id:f}}),this._serializedLayers[d.id]=d.serialize()}var y=s?this._order.indexOf(s):this._order.length;if(s&&y===-1)this.fire(new u.ErrorEvent(new Error('Layer with id "'+s+'" does not exist on this map.')));else{if(this._order.splice(y,0,f),this._layerOrderChanged=!0,this._layers[f]=d,this._removedLayers[f]&&d.source&&d.type!=="custom"){var _=this._removedLayers[f];delete this._removedLayers[f],_.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map)}}},o.prototype.moveLayer=function(n,s){if(this._checkLoaded(),this._changed=!0,this._layers[n]){if(n!==s){var p=this._order.indexOf(n);this._order.splice(p,1);var f=s?this._order.indexOf(s):this._order.length;s&&f===-1?this.fire(new u.ErrorEvent(new Error('Layer with id "'+s+'" does not exist on this map.'))):(this._order.splice(f,0,n),this._layerOrderChanged=!0)}}else this.fire(new u.ErrorEvent(new Error("The layer '"+n+"' does not exist in the map's style and cannot be moved.")))},o.prototype.removeLayer=function(n){this._checkLoaded();var s=this._layers[n];if(s){s.setEventedParent(null);var p=this._order.indexOf(n);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=s,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],s.onRemove&&s.onRemove(this.map)}else this.fire(new u.ErrorEvent(new Error("The layer '"+n+"' does not exist in the map's style and cannot be removed.")))},o.prototype.getLayer=function(n){return this._layers[n]},o.prototype.hasLayer=function(n){return n in this._layers},o.prototype.setLayerZoomRange=function(n,s,p){this._checkLoaded();var f=this.getLayer(n);f?f.minzoom===s&&f.maxzoom===p||(s!=null&&(f.minzoom=s),p!=null&&(f.maxzoom=p),this._updateLayer(f)):this.fire(new u.ErrorEvent(new Error("The layer '"+n+"' does not exist in the map's style and cannot have zoom extent.")))},o.prototype.setFilter=function(n,s,p){p===void 0&&(p={}),this._checkLoaded();var f=this.getLayer(n);if(f){if(!u.deepEqual(f.filter,s))return s==null?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(u.validateStyle.filter,"layers."+f.id+".filter",s,null,p)||(f.filter=u.clone$1(s),this._updateLayer(f)))}else this.fire(new u.ErrorEvent(new Error("The layer '"+n+"' does not exist in the map's style and cannot be filtered.")))},o.prototype.getFilter=function(n){return u.clone$1(this.getLayer(n).filter)},o.prototype.setLayoutProperty=function(n,s,p,f){f===void 0&&(f={}),this._checkLoaded();var d=this.getLayer(n);d?u.deepEqual(d.getLayoutProperty(s),p)||(d.setLayoutProperty(s,p,f),this._updateLayer(d)):this.fire(new u.ErrorEvent(new Error("The layer '"+n+"' does not exist in the map's style and cannot be styled.")))},o.prototype.getLayoutProperty=function(n,s){var p=this.getLayer(n);if(p)return p.getLayoutProperty(s);this.fire(new u.ErrorEvent(new Error("The layer '"+n+"' does not exist in the map's style.")))},o.prototype.setPaintProperty=function(n,s,p,f){f===void 0&&(f={}),this._checkLoaded();var d=this.getLayer(n);d?u.deepEqual(d.getPaintProperty(s),p)||(d.setPaintProperty(s,p,f)&&this._updateLayer(d),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new u.ErrorEvent(new Error("The layer '"+n+"' does not exist in the map's style and cannot be styled.")))},o.prototype.getPaintProperty=function(n,s){return this.getLayer(n).getPaintProperty(s)},o.prototype.setFeatureState=function(n,s){this._checkLoaded();var p=n.source,f=n.sourceLayer,d=this.sourceCaches[p];if(d!==void 0){var y=d.getSource().type;y==="geojson"&&f?this.fire(new u.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):y!=="vector"||f?(n.id===void 0&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided."))),d.setFeatureState(f,n.id,s)):this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new u.ErrorEvent(new Error("The source '"+p+"' does not exist in the map's style.")))},o.prototype.removeFeatureState=function(n,s){this._checkLoaded();var p=n.source,f=this.sourceCaches[p];if(f!==void 0){var d=f.getSource().type,y=d==="vector"?n.sourceLayer:void 0;d!=="vector"||y?s&&typeof n.id!="string"&&typeof n.id!="number"?this.fire(new u.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):f.removeFeatureState(y,n.id,s):this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new u.ErrorEvent(new Error("The source '"+p+"' does not exist in the map's style.")))},o.prototype.getFeatureState=function(n){this._checkLoaded();var s=n.source,p=n.sourceLayer,f=this.sourceCaches[s];if(f!==void 0){if(f.getSource().type!=="vector"||p)return n.id===void 0&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided."))),f.getFeatureState(p,n.id);this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new u.ErrorEvent(new Error("The source '"+s+"' does not exist in the map's style.")))},o.prototype.getTransition=function(){return u.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},o.prototype.serialize=function(){return u.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:u.mapObject(this.sourceCaches,function(n){return n.serialize()}),layers:this._serializeLayers(this._order)},function(n){return n!==void 0})},o.prototype._updateLayer=function(n){this._updatedLayers[n.id]=!0,n.source&&!this._updatedSources[n.source]&&this.sourceCaches[n.source].getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",this.sourceCaches[n.source].pause()),this._changed=!0},o.prototype._flattenAndSortRenderedFeatures=function(n){for(var s=this,p=function(_t){return s._layers[_t].type==="fill-extrusion"},f={},d=[],y=this._order.length-1;y>=0;y--){var _=this._order[y];if(p(_)){f[_]=y;for(var S=0,P=n;S<P.length;S+=1){var k=P[S][_];if(k)for(var z=0,U=k;z<U.length;z+=1)d.push(U[z])}}}d.sort(function(_t,yt){return yt.intersectionZ-_t.intersectionZ});for(var O=[],G=this._order.length-1;G>=0;G--){var B=this._order[G];if(p(B))for(var Z=d.length-1;Z>=0;Z--){var H=d[Z].feature;if(f[H.layer.id]<G)break;O.push(H),d.pop()}else for(var Q=0,at=n;Q<at.length;Q+=1){var nt=at[Q][B];if(nt)for(var lt=0,ct=nt;lt<ct.length;lt+=1)O.push(ct[lt].feature)}}return O},o.prototype.queryRenderedFeatures=function(n,s,p){s&&s.filter&&this._validate(u.validateStyle.filter,"queryRenderedFeatures.filter",s.filter,null,s);var f={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new u.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var d=0,y=s.layers;d<y.length;d+=1){var _=y[d],S=this._layers[_];if(!S)return this.fire(new u.ErrorEvent(new Error("The layer '"+_+"' does not exist in the map's style and cannot be queried for features."))),[];f[S.source]=!0}}var P=[];for(var k in s.availableImages=this._availableImages,this.sourceCaches)s.layers&&!f[k]||P.push(Cr(this.sourceCaches[k],this._layers,this._serializedLayers,n,s,p));return this.placement&&P.push(function(z,U,O,G,B,Z,H){for(var Q={},at=Z.queryRenderedSymbols(G),nt=[],lt=0,ct=Object.keys(at).map(Number);lt<ct.length;lt+=1)nt.push(H[ct[lt]]);nt.sort(Gi);for(var _t=function(){var Nt=Et[yt],he=Nt.featureIndex.lookupSymbolFeatures(at[Nt.bucketInstanceId],U,Nt.bucketIndex,Nt.sourceLayerIndex,B.filter,B.layers,B.availableImages,z);for(var Ct in he){var Jt=Q[Ct]=Q[Ct]||[],re=he[Ct];re.sort(function(Kt,Wt){var Zt=Nt.featureSortOrder;if(Zt){var we=Zt.indexOf(Kt.featureIndex);return Zt.indexOf(Wt.featureIndex)-we}return Wt.featureIndex-Kt.featureIndex});for(var Yt=0,Ht=re;Yt<Ht.length;Yt+=1)Jt.push(Ht[Yt])}},yt=0,Et=nt;yt<Et.length;yt+=1)_t();var Vt=function(Nt){Q[Nt].forEach(function(he){var Ct=he.feature,Jt=O[z[Nt].source].getFeatureState(Ct.layer["source-layer"],Ct.id);Ct.source=Ct.layer.source,Ct.layer["source-layer"]&&(Ct.sourceLayer=Ct.layer["source-layer"]),Ct.state=Jt})};for(var qt in Q)Vt(qt);return Q}(this._layers,this._serializedLayers,this.sourceCaches,n,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(P)},o.prototype.querySourceFeatures=function(n,s){s&&s.filter&&this._validate(u.validateStyle.filter,"querySourceFeatures.filter",s.filter,null,s);var p=this.sourceCaches[n];return p?function(f,d){for(var y=f.getRenderableIds().map(function(U){return f.getTileByID(U)}),_=[],S={},P=0;P<y.length;P++){var k=y[P],z=k.tileID.canonical.key;S[z]||(S[z]=!0,k.querySourceFeatures(_,d))}return _}(p,s):[]},o.prototype.addSourceType=function(n,s,p){return o.getSourceType(n)?p(new Error('A source type called "'+n+'" already exists.')):(o.setSourceType(n,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:s.workerSourceURL},p):p(null,null))},o.prototype.getLight=function(){return this.light.getLight()},o.prototype.setLight=function(n,s){s===void 0&&(s={}),this._checkLoaded();var p=this.light.getLight(),f=!1;for(var d in n)if(!u.deepEqual(n[d],p[d])){f=!0;break}if(f){var y={now:u.browser.now(),transition:u.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(n,s),this.light.updateTransitions(y)}},o.prototype._validate=function(n,s,p,f,d){return d===void 0&&(d={}),(!d||d.validate!==!1)&&un(this,n.call(u.validateStyle,u.extend({key:s,style:this.serialize(),value:p,styleSpec:u.styleSpec},f)))},o.prototype._remove=function(){for(var n in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),u.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[n].setEventedParent(null);for(var s in this.sourceCaches)this.sourceCaches[s].clearTiles(),this.sourceCaches[s].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},o.prototype._clearSource=function(n){this.sourceCaches[n].clearTiles()},o.prototype._reloadSource=function(n){this.sourceCaches[n].resume(),this.sourceCaches[n].reload()},o.prototype._updateSources=function(n){for(var s in this.sourceCaches)this.sourceCaches[s].update(n)},o.prototype._generateCollisionBoxes=function(){for(var n in this.sourceCaches)this._reloadSource(n)},o.prototype._updatePlacement=function(n,s,p,f,d){d===void 0&&(d=!1);for(var y=!1,_=!1,S={},P=0,k=this._order;P<k.length;P+=1){var z=this._layers[k[P]];if(z.type==="symbol"){if(!S[z.source]){var U=this.sourceCaches[z.source];S[z.source]=U.getRenderableIds(!0).map(function(H){return U.getTileByID(H)}).sort(function(H,Q){return Q.tileID.overscaledZ-H.tileID.overscaledZ||(H.tileID.isLessThan(Q.tileID)?-1:1)})}var O=this.crossTileSymbolIndex.addLayer(z,S[z.source],n.center.lng);y=y||O}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((d=d||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(u.browser.now(),n.zoom))&&(this.pauseablePlacement=new Xo(n,this._order,d,s,p,f,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(u.browser.now()),_=!0),y&&this.pauseablePlacement.placement.setStale()),_||y)for(var G=0,B=this._order;G<B.length;G+=1){var Z=this._layers[B[G]];Z.type==="symbol"&&this.placement.updateLayerOpacities(Z,S[Z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(u.browser.now())},o.prototype._releaseSymbolFadeTiles=function(){for(var n in this.sourceCaches)this.sourceCaches[n].releaseSymbolFadeTiles()},o.prototype.getImages=function(n,s,p){this.imageManager.getImages(s.icons,p),this._updateTilesForChangedImages();var f=this.sourceCaches[s.source];f&&f.setDependencies(s.tileID.key,s.type,s.icons)},o.prototype.getGlyphs=function(n,s,p){this.glyphManager.getGlyphs(s.stacks,p)},o.prototype.getResource=function(n,s,p){return u.makeRequest(s,p)},o}(u.Evented);Ki.getSourceType=function(i){return an[i]},Ki.setSourceType=function(i,o){an[i]=o},Ki.registerForPluginStateChange=u.registerForPluginStateChange;var ki=u.createLayout([{name:"a_pos",type:"Int16",components:2}]),ir=Re(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Oa=Re(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Vl=Re(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ku=Re(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Hu=Re("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Vs=Re(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Ns=Re(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),js=Re("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),qs=Re("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),Nl=Re("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),jl=Re(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Ju=Re(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Wo=Re(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Ko=Re(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),ql=Re(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Sr=Re(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Zs=Re(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hn=Re(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),fn=Re(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),jn=Re(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),qn=Re(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),dn=Re(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Zn=Re(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Gn=Re(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),mn=Re(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Zl=Re(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Re(i,o){var n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,s=o.match(/attribute ([\w]+) ([\w]+)/g),p=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),d=f?f.concat(p):p,y={};return{fragmentSource:i=i.replace(n,function(_,S,P,k,z){return y[z]=!0,S==="define"?`
#ifndef HAS_UNIFORM_u_`+z+`
varying `+P+" "+k+" "+z+`;
#else
uniform `+P+" "+k+" u_"+z+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+z+`
    `+P+" "+k+" "+z+" = u_"+z+`;
#endif
`}),vertexSource:o=o.replace(n,function(_,S,P,k,z){var U=k==="float"?"vec2":"vec4",O=z.match(/color/)?"color":U;return y[z]?S==="define"?`
#ifndef HAS_UNIFORM_u_`+z+`
uniform lowp float u_`+z+`_t;
attribute `+P+" "+U+" a_"+z+`;
varying `+P+" "+k+" "+z+`;
#else
uniform `+P+" "+k+" u_"+z+`;
#endif
`:O==="vec4"?`
#ifndef HAS_UNIFORM_u_`+z+`
    `+z+" = a_"+z+`;
#else
    `+P+" "+k+" "+z+" = u_"+z+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+z+`
    `+z+" = unpack_mix_"+O+"(a_"+z+", u_"+z+`_t);
#else
    `+P+" "+k+" "+z+" = u_"+z+`;
#endif
`:S==="define"?`
#ifndef HAS_UNIFORM_u_`+z+`
uniform lowp float u_`+z+`_t;
attribute `+P+" "+U+" a_"+z+`;
#else
uniform `+P+" "+k+" u_"+z+`;
#endif
`:O==="vec4"?`
#ifndef HAS_UNIFORM_u_`+z+`
    `+P+" "+k+" "+z+" = a_"+z+`;
#else
    `+P+" "+k+" "+z+" = u_"+z+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+z+`
    `+P+" "+k+" "+z+" = unpack_mix_"+O+"(a_"+z+", u_"+z+`_t);
#else
    `+P+" "+k+" "+z+" = u_"+z+`;
#endif
`}),staticAttributes:s,staticUniforms:d}}var So=Object.freeze({__proto__:null,prelude:ir,background:Oa,backgroundPattern:Vl,circle:Ku,clippingMask:Hu,heatmap:Vs,heatmapTexture:Ns,collisionBox:js,collisionCircle:qs,debug:Nl,fill:jl,fillOutline:Ju,fillOutlinePattern:Wo,fillPattern:Ko,fillExtrusion:ql,fillExtrusionPattern:Sr,hillshadePrepare:Zs,hillshade:hn,line:fn,lineGradient:jn,linePattern:qn,lineSDF:dn,raster:Zn,symbolIcon:Gn,symbolSDF:mn,symbolTextAndIcon:Zl}),Fa=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Gl(i){for(var o=[],n=0;n<i.length;n++)if(i[n]!==null){var s=i[n].split(" ");o.push(s.pop())}return o}Fa.prototype.bind=function(i,o,n,s,p,f,d,y){this.context=i;for(var _=this.boundPaintVertexBuffers.length!==s.length,S=0;!_&&S<s.length;S++)this.boundPaintVertexBuffers[S]!==s[S]&&(_=!0);i.extVertexArrayObject&&this.vao&&this.boundProgram===o&&this.boundLayoutVertexBuffer===n&&!_&&this.boundIndexBuffer===p&&this.boundVertexOffset===f&&this.boundDynamicVertexBuffer===d&&this.boundDynamicVertexBuffer2===y?(i.bindVertexArrayOES.set(this.vao),d&&d.bind(),p&&p.dynamicDraw&&p.bind(),y&&y.bind()):this.freshBind(o,n,s,p,f,d,y)},Fa.prototype.freshBind=function(i,o,n,s,p,f,d){var y,_=i.numAttributes,S=this.context,P=S.gl;if(S.extVertexArrayObject)this.vao&&this.destroy(),this.vao=S.extVertexArrayObject.createVertexArrayOES(),S.bindVertexArrayOES.set(this.vao),y=0,this.boundProgram=i,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=s,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=f,this.boundDynamicVertexBuffer2=d;else{y=S.currentNumAttributes||0;for(var k=_;k<y;k++)P.disableVertexAttribArray(k)}o.enableAttributes(P,i);for(var z=0,U=n;z<U.length;z+=1)U[z].enableAttributes(P,i);f&&f.enableAttributes(P,i),d&&d.enableAttributes(P,i),o.bind(),o.setVertexAttribPointers(P,i,p);for(var O=0,G=n;O<G.length;O+=1){var B=G[O];B.bind(),B.setVertexAttribPointers(P,i,p)}f&&(f.bind(),f.setVertexAttribPointers(P,i,p)),s&&s.bind(),d&&(d.bind(),d.setVertexAttribPointers(P,i,p)),S.currentNumAttributes=_},Fa.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Xl=function(i,o,n,s,p,f){var d=i.gl;this.program=d.createProgram();for(var y=Gl(n.staticAttributes),_=s?s.getBinderAttributes():[],S=y.concat(_),P=n.staticUniforms?Gl(n.staticUniforms):[],k=s?s.getBinderUniforms():[],z=[],U=0,O=P.concat(k);U<O.length;U+=1){var G=O[U];z.indexOf(G)<0&&z.push(G)}var B=s?s.defines():[];f&&B.push("#define OVERDRAW_INSPECTOR;");var Z=B.concat(ir.fragmentSource,n.fragmentSource).join(`
`),H=B.concat(ir.vertexSource,n.vertexSource).join(`
`),Q=d.createShader(d.FRAGMENT_SHADER);if(d.isContextLost())this.failedToCreate=!0;else{d.shaderSource(Q,Z),d.compileShader(Q),d.attachShader(this.program,Q);var at=d.createShader(d.VERTEX_SHADER);if(d.isContextLost())this.failedToCreate=!0;else{d.shaderSource(at,H),d.compileShader(at),d.attachShader(this.program,at),this.attributes={};var nt={};this.numAttributes=S.length;for(var lt=0;lt<this.numAttributes;lt++)S[lt]&&(d.bindAttribLocation(this.program,lt,S[lt]),this.attributes[S[lt]]=lt);d.linkProgram(this.program),d.deleteShader(at),d.deleteShader(Q);for(var ct=0;ct<z.length;ct++){var _t=z[ct];if(_t&&!nt[_t]){var yt=d.getUniformLocation(this.program,_t);yt&&(nt[_t]=yt)}}this.fixedUniforms=p(i,nt),this.binderUniforms=s?s.getUniforms(i,nt):[]}}};function Wl(i,o,n){var s=1/Nr(n,1,o.transform.tileZoom),p=Math.pow(2,n.tileID.overscaledZ),f=n.tileSize*Math.pow(2,o.transform.tileZoom)/p,d=f*(n.tileID.canonical.x+n.tileID.wrap*p),y=f*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[s,i.fromScale,i.toScale],u_fade:i.t,u_pixel_coord_upper:[d>>16,y>>16],u_pixel_coord_lower:[65535&d,65535&y]}}Xl.prototype.draw=function(i,o,n,s,p,f,d,y,_,S,P,k,z,U,O,G){var B,Z=i.gl;if(!this.failedToCreate){for(var H in i.program.set(this.program),i.setDepthMode(n),i.setStencilMode(s),i.setColorMode(p),i.setCullFace(f),this.fixedUniforms)this.fixedUniforms[H].set(d[H]);U&&U.setUniforms(i,this.binderUniforms,k,{zoom:z});for(var Q=(B={},B[Z.LINES]=2,B[Z.TRIANGLES]=3,B[Z.LINE_STRIP]=1,B)[o],at=0,nt=P.get();at<nt.length;at+=1){var lt=nt[at],ct=lt.vaos||(lt.vaos={});(ct[y]||(ct[y]=new Fa)).bind(i,this,_,U?U.getPaintVertexBuffers():[],S,lt.vertexOffset,O,G),Z.drawElements(o,lt.primitiveLength*Q,Z.UNSIGNED_SHORT,lt.primitiveOffset*Q*2)}}};var Kl=function(i,o,n,s){var p=o.style.light,f=p.properties.get("position"),d=[f.x,f.y,f.z],y=u.create$1();p.properties.get("anchor")==="viewport"&&u.fromRotation(y,-o.transform.angle),u.transformMat3(d,d,y);var _=p.properties.get("color");return{u_matrix:i,u_lightpos:d,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[_.r,_.g,_.b],u_vertical_gradient:+n,u_opacity:s}},Yu=function(i,o,n,s,p,f,d){return u.extend(Kl(i,o,n,s),Wl(f,o,d),{u_height_factor:-Math.pow(2,p.overscaledZ)/d.tileSize/8})},yn=function(i){return{u_matrix:i}},gn=function(i,o,n,s){return u.extend(yn(i),Wl(n,o,s))},To=function(i,o){return{u_matrix:i,u_world:o}},Hl=function(i,o,n,s,p){return u.extend(gn(i,o,n,s),{u_world:p})},Jl=function(i,o,n,s){var p,f,d=i.transform;if(s.paint.get("circle-pitch-alignment")==="map"){var y=Nr(n,1,d.zoom);p=!0,f=[y,y]}else p=!1,f=d.pixelsToGLUnits;return{u_camera_to_center_distance:d.cameraToCenterDistance,u_scale_with_map:+(s.paint.get("circle-pitch-scale")==="map"),u_matrix:i.translatePosMatrix(o.posMatrix,n,s.paint.get("circle-translate"),s.paint.get("circle-translate-anchor")),u_pitch_with_map:+p,u_device_pixel_ratio:u.browser.devicePixelRatio,u_extrude_scale:f}},Gs=function(i,o,n){var s=Nr(n,1,o.zoom),p=Math.pow(2,o.zoom-n.tileID.overscaledZ),f=n.tileID.overscaleFactor();return{u_matrix:i,u_camera_to_center_distance:o.cameraToCenterDistance,u_pixels_to_tile_units:s,u_extrude_scale:[o.pixelsToGLUnits[0]/(s*p),o.pixelsToGLUnits[1]/(s*p)],u_overscale_factor:f}},Xn=function(i,o,n){return{u_matrix:i,u_inv_matrix:o,u_camera_to_center_distance:n.cameraToCenterDistance,u_viewport_size:[n.width,n.height]}},Xs=function(i,o,n){return n===void 0&&(n=1),{u_matrix:i,u_color:o,u_overlay:0,u_overlay_scale:n}},Wn=function(i){return{u_matrix:i}},Io=function(i,o,n,s){return{u_matrix:i,u_extrude_scale:Nr(o,1,n),u_intensity:s}},Ua=function(i,o,n){var s=i.transform;return{u_matrix:Eo(i,o,n),u_ratio:1/Nr(o,1,s.zoom),u_device_pixel_ratio:u.browser.devicePixelRatio,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]]}},Ws=function(i,o,n,s){return u.extend(Ua(i,o,n),{u_image:0,u_image_height:s})},Pe=function(i,o,n,s){var p=i.transform,f=Yl(o,p);return{u_matrix:Eo(i,o,n),u_texsize:o.imageAtlasTexture.size,u_ratio:1/Nr(o,1,p.zoom),u_device_pixel_ratio:u.browser.devicePixelRatio,u_image:0,u_scale:[f,s.fromScale,s.toScale],u_fade:s.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Va=function(i,o,n,s,p){var f=i.lineAtlas,d=Yl(o,i.transform),y=n.layout.get("line-cap")==="round",_=f.getDash(s.from,y),S=f.getDash(s.to,y),P=_.width*p.fromScale,k=S.width*p.toScale;return u.extend(Ua(i,o,n),{u_patternscale_a:[d/P,-_.height/2],u_patternscale_b:[d/k,-S.height/2],u_sdfgamma:f.width/(256*Math.min(P,k)*u.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:_.y,u_tex_y_b:S.y,u_mix:p.t})};function Yl(i,o){return 1/Nr(i,1,o.tileZoom)}function Eo(i,o,n){return i.translatePosMatrix(o.tileID.posMatrix,o,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}var Qu=function(i,o,n,s,p){return{u_matrix:i,u_tl_parent:o,u_scale_parent:n,u_buffer_scale:1,u_fade_t:s.mix,u_opacity:s.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(d=p.paint.get("raster-saturation"),d>0?1-1/(1.001-d):-d),u_contrast_factor:(f=p.paint.get("raster-contrast"),f>0?1/(1-f):1+f),u_spin_weights:$u(p.paint.get("raster-hue-rotate"))};var f,d};function $u(i){i*=Math.PI/180;var o=Math.sin(i),n=Math.cos(i);return[(2*n+1)/3,(-Math.sqrt(3)*o-n+1)/3,(Math.sqrt(3)*o-n+1)/3]}var Ho,Ql=function(i,o,n,s,p,f,d,y,_,S){var P=p.transform;return{u_is_size_zoom_constant:+(i==="constant"||i==="source"),u_is_size_feature_constant:+(i==="constant"||i==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:P.cameraToCenterDistance,u_pitch:P.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:P.width/P.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:f,u_label_plane_matrix:d,u_coord_matrix:y,u_is_text:+_,u_pitch_with_map:+s,u_texsize:S,u_texture:0}},Ao=function(i,o,n,s,p,f,d,y,_,S,P){var k=p.transform;return u.extend(Ql(i,o,n,s,p,f,d,y,_,S),{u_gamma_scale:s?Math.cos(k._pitch)*k.cameraToCenterDistance:1,u_device_pixel_ratio:u.browser.devicePixelRatio,u_is_halo:+P})},Na=function(i,o,n,s,p,f,d,y,_,S){return u.extend(Ao(i,o,n,s,p,f,d,y,!0,_,!0),{u_texsize_icon:S,u_texture_icon:1})},ja=function(i,o,n){return{u_matrix:i,u_opacity:o,u_color:n}},Jo=function(i,o,n,s,p,f){return u.extend(function(d,y,_,S){var P=_.imageManager.getPattern(d.from.toString()),k=_.imageManager.getPattern(d.to.toString()),z=_.imageManager.getPixelSize(),U=z.width,O=z.height,G=Math.pow(2,S.tileID.overscaledZ),B=S.tileSize*Math.pow(2,_.transform.tileZoom)/G,Z=B*(S.tileID.canonical.x+S.tileID.wrap*G),H=B*S.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:P.tl,u_pattern_br_a:P.br,u_pattern_tl_b:k.tl,u_pattern_br_b:k.br,u_texsize:[U,O],u_mix:y.t,u_pattern_size_a:P.displaySize,u_pattern_size_b:k.displaySize,u_scale_a:y.fromScale,u_scale_b:y.toScale,u_tile_units_to_pixels:1/Nr(S,1,_.transform.tileZoom),u_pixel_coord_upper:[Z>>16,H>>16],u_pixel_coord_lower:[65535&Z,65535&H]}}(s,f,n,p),{u_matrix:i,u_opacity:o})},Po={fillExtrusion:function(i,o){return{u_matrix:new u.UniformMatrix4f(i,o.u_matrix),u_lightpos:new u.Uniform3f(i,o.u_lightpos),u_lightintensity:new u.Uniform1f(i,o.u_lightintensity),u_lightcolor:new u.Uniform3f(i,o.u_lightcolor),u_vertical_gradient:new u.Uniform1f(i,o.u_vertical_gradient),u_opacity:new u.Uniform1f(i,o.u_opacity)}},fillExtrusionPattern:function(i,o){return{u_matrix:new u.UniformMatrix4f(i,o.u_matrix),u_lightpos:new u.Uniform3f(i,o.u_lightpos),u_lightintensity:new u.Uniform1f(i,o.u_lightintensity),u_lightcolor:new u.Uniform3f(i,o.u_lightcolor),u_vertical_gradient:new u.Uniform1f(i,o.u_vertical_gradient),u_height_factor:new u.Uniform1f(i,o.u_height_factor),u_image:new u.Uniform1i(i,o.u_image),u_texsize:new u.Uniform2f(i,o.u_texsize),u_pixel_coord_upper:new u.Uniform2f(i,o.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(i,o.u_pixel_coord_lower),u_scale:new u.Uniform3f(i,o.u_scale),u_fade:new u.Uniform1f(i,o.u_fade),u_opacity:new u.Uniform1f(i,o.u_opacity)}},fill:function(i,o){return{u_matrix:new u.UniformMatrix4f(i,o.u_matrix)}},fillPattern:function(i,o){return{u_matrix:new u.UniformMatrix4f(i,o.u_matrix),u_image:new u.Uniform1i(i,o.u_image),u_texsize:new u.Uniform2f(i,o.u_texsize),u_pixel_coord_upper:new u.Uniform2f(i,o.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(i,o.u_pixel_coord_lower),u_scale:new u.Uniform3f(i,o.u_scale),u_fade:new u.Uniform1f(i,o.u_fade)}},fillOutline:function(i,o){return{u_matrix:new u.UniformMatrix4f(i,o.u_matrix),u_world:new u.Uniform2f(i,o.u_world)}},fillOutlinePattern:function(i,o){return{u_matrix:new u.UniformMatrix4f(i,o.u_matrix),u_world:new u.Uniform2f(i,o.u_world),u_image:new u.Uniform1i(i,o.u_image),u_texsize:new u.Uniform2f(i,o.u_texsize),u_pixel_coord_upper:new u.Uniform2f(i,o.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(i,o.u_pixel_coord_lower),u_scale:new u.Uniform3f(i,o.u_scale),u_fade:new u.Uniform1f(i,o.u_fade)}},circle:function(i,o){return{u_camera_to_center_distance:new u.Uniform1f(i,o.u_camera_to_center_distance),u_scale_with_map:new u.Uniform1i(i,o.u_scale_with_map),u_pitch_with_map:new u.Uniform1i(i,o.u_pitch_with_map),u_extrude_scale:new u.Uniform2f(i,o.u_extrude_scale),u_device_pixel_ratio:new u.Uniform1f(i,o.u_device_pixel_ratio),u_matrix:new u.UniformMatrix4f(i,o.u_matrix)}},collisionBox:function(i,o){return{u_matrix:new u.UniformMatrix4f(i,o.u_matrix),u_camera_to_center_distance:new u.Uniform1f(i,o.u_camera_to_center_distance),u_pixels_to_tile_units:new u.Uniform1f(i,o.u_pixels_to_tile_units),u_extrude_scale:new u.Uniform2f(i,o.u_extrude_scale),u_overscale_factor:new u.Uniform1f(i,o.u_overscale_factor)}},collisionCircle:function(i,o){return{u_matrix:new u.UniformMatrix4f(i,o.u_matrix),u_inv_matrix:new u.UniformMatrix4f(i,o.u_inv_matrix),u_camera_to_center_distance:new u.Uniform1f(i,o.u_camera_to_center_distance),u_viewport_size:new u.Uniform2f(i,o.u_viewport_size)}},debug:function(i,o){return{u_color:new u.UniformColor(i,o.u_color),u_matrix:new u.UniformMatrix4f(i,o.u_matrix),u_overlay:new u.Uniform1i(i,o.u_overlay),u_overlay_scale:new u.Uniform1f(i,o.u_overlay_scale)}},clippingMask:function(i,o){return{u_matrix:new u.UniformMatrix4f(i,o.u_matrix)}},heatmap:function(i,o){return{u_extrude_scale:new u.Uniform1f(i,o.u_extrude_scale),u_intensity:new u.Uniform1f(i,o.u_intensity),u_matrix:new u.UniformMatrix4f(i,o.u_matrix)}},heatmapTexture:function(i,o){return{u_matrix:new u.UniformMatrix4f(i,o.u_matrix),u_world:new u.Uniform2f(i,o.u_world),u_image:new u.Uniform1i(i,o.u_image),u_color_ramp:new u.Uniform1i(i,o.u_color_ramp),u_opacity:new u.Uniform1f(i,o.u_opacity)}},hillshade:function(i,o){return{u_matrix:new u.UniformMatrix4f(i,o.u_matrix),u_image:new u.Uniform1i(i,o.u_image),u_latrange:new u.Uniform2f(i,o.u_latrange),u_light:new u.Uniform2f(i,o.u_light),u_shadow:new u.UniformColor(i,o.u_shadow),u_highlight:new u.UniformColor(i,o.u_highlight),u_accent:new u.UniformColor(i,o.u_accent)}},hillshadePrepare:function(i,o){return{u_matrix:new u.UniformMatrix4f(i,o.u_matrix),u_image:new u.Uniform1i(i,o.u_image),u_dimension:new u.Uniform2f(i,o.u_dimension),u_zoom:new u.Uniform1f(i,o.u_zoom),u_unpack:new u.Uniform4f(i,o.u_unpack)}},line:function(i,o){return{u_matrix:new u.UniformMatrix4f(i,o.u_matrix),u_ratio:new u.Uniform1f(i,o.u_ratio),u_device_pixel_ratio:new u.Uniform1f(i,o.u_device_pixel_ratio),u_units_to_pixels:new u.Uniform2f(i,o.u_units_to_pixels)}},lineGradient:function(i,o){return{u_matrix:new u.UniformMatrix4f(i,o.u_matrix),u_ratio:new u.Uniform1f(i,o.u_ratio),u_device_pixel_ratio:new u.Uniform1f(i,o.u_device_pixel_ratio),u_units_to_pixels:new u.Uniform2f(i,o.u_units_to_pixels),u_image:new u.Uniform1i(i,o.u_image),u_image_height:new u.Uniform1f(i,o.u_image_height)}},linePattern:function(i,o){return{u_matrix:new u.UniformMatrix4f(i,o.u_matrix),u_texsize:new u.Uniform2f(i,o.u_texsize),u_ratio:new u.Uniform1f(i,o.u_ratio),u_device_pixel_ratio:new u.Uniform1f(i,o.u_device_pixel_ratio),u_image:new u.Uniform1i(i,o.u_image),u_units_to_pixels:new u.Uniform2f(i,o.u_units_to_pixels),u_scale:new u.Uniform3f(i,o.u_scale),u_fade:new u.Uniform1f(i,o.u_fade)}},lineSDF:function(i,o){return{u_matrix:new u.UniformMatrix4f(i,o.u_matrix),u_ratio:new u.Uniform1f(i,o.u_ratio),u_device_pixel_ratio:new u.Uniform1f(i,o.u_device_pixel_ratio),u_units_to_pixels:new u.Uniform2f(i,o.u_units_to_pixels),u_patternscale_a:new u.Uniform2f(i,o.u_patternscale_a),u_patternscale_b:new u.Uniform2f(i,o.u_patternscale_b),u_sdfgamma:new u.Uniform1f(i,o.u_sdfgamma),u_image:new u.Uniform1i(i,o.u_image),u_tex_y_a:new u.Uniform1f(i,o.u_tex_y_a),u_tex_y_b:new u.Uniform1f(i,o.u_tex_y_b),u_mix:new u.Uniform1f(i,o.u_mix)}},raster:function(i,o){return{u_matrix:new u.UniformMatrix4f(i,o.u_matrix),u_tl_parent:new u.Uniform2f(i,o.u_tl_parent),u_scale_parent:new u.Uniform1f(i,o.u_scale_parent),u_buffer_scale:new u.Uniform1f(i,o.u_buffer_scale),u_fade_t:new u.Uniform1f(i,o.u_fade_t),u_opacity:new u.Uniform1f(i,o.u_opacity),u_image0:new u.Uniform1i(i,o.u_image0),u_image1:new u.Uniform1i(i,o.u_image1),u_brightness_low:new u.Uniform1f(i,o.u_brightness_low),u_brightness_high:new u.Uniform1f(i,o.u_brightness_high),u_saturation_factor:new u.Uniform1f(i,o.u_saturation_factor),u_contrast_factor:new u.Uniform1f(i,o.u_contrast_factor),u_spin_weights:new u.Uniform3f(i,o.u_spin_weights)}},symbolIcon:function(i,o){return{u_is_size_zoom_constant:new u.Uniform1i(i,o.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(i,o.u_is_size_feature_constant),u_size_t:new u.Uniform1f(i,o.u_size_t),u_size:new u.Uniform1f(i,o.u_size),u_camera_to_center_distance:new u.Uniform1f(i,o.u_camera_to_center_distance),u_pitch:new u.Uniform1f(i,o.u_pitch),u_rotate_symbol:new u.Uniform1i(i,o.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(i,o.u_aspect_ratio),u_fade_change:new u.Uniform1f(i,o.u_fade_change),u_matrix:new u.UniformMatrix4f(i,o.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(i,o.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(i,o.u_coord_matrix),u_is_text:new u.Uniform1i(i,o.u_is_text),u_pitch_with_map:new u.Uniform1i(i,o.u_pitch_with_map),u_texsize:new u.Uniform2f(i,o.u_texsize),u_texture:new u.Uniform1i(i,o.u_texture)}},symbolSDF:function(i,o){return{u_is_size_zoom_constant:new u.Uniform1i(i,o.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(i,o.u_is_size_feature_constant),u_size_t:new u.Uniform1f(i,o.u_size_t),u_size:new u.Uniform1f(i,o.u_size),u_camera_to_center_distance:new u.Uniform1f(i,o.u_camera_to_center_distance),u_pitch:new u.Uniform1f(i,o.u_pitch),u_rotate_symbol:new u.Uniform1i(i,o.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(i,o.u_aspect_ratio),u_fade_change:new u.Uniform1f(i,o.u_fade_change),u_matrix:new u.UniformMatrix4f(i,o.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(i,o.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(i,o.u_coord_matrix),u_is_text:new u.Uniform1i(i,o.u_is_text),u_pitch_with_map:new u.Uniform1i(i,o.u_pitch_with_map),u_texsize:new u.Uniform2f(i,o.u_texsize),u_texture:new u.Uniform1i(i,o.u_texture),u_gamma_scale:new u.Uniform1f(i,o.u_gamma_scale),u_device_pixel_ratio:new u.Uniform1f(i,o.u_device_pixel_ratio),u_is_halo:new u.Uniform1i(i,o.u_is_halo)}},symbolTextAndIcon:function(i,o){return{u_is_size_zoom_constant:new u.Uniform1i(i,o.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(i,o.u_is_size_feature_constant),u_size_t:new u.Uniform1f(i,o.u_size_t),u_size:new u.Uniform1f(i,o.u_size),u_camera_to_center_distance:new u.Uniform1f(i,o.u_camera_to_center_distance),u_pitch:new u.Uniform1f(i,o.u_pitch),u_rotate_symbol:new u.Uniform1i(i,o.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(i,o.u_aspect_ratio),u_fade_change:new u.Uniform1f(i,o.u_fade_change),u_matrix:new u.UniformMatrix4f(i,o.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(i,o.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(i,o.u_coord_matrix),u_is_text:new u.Uniform1i(i,o.u_is_text),u_pitch_with_map:new u.Uniform1i(i,o.u_pitch_with_map),u_texsize:new u.Uniform2f(i,o.u_texsize),u_texsize_icon:new u.Uniform2f(i,o.u_texsize_icon),u_texture:new u.Uniform1i(i,o.u_texture),u_texture_icon:new u.Uniform1i(i,o.u_texture_icon),u_gamma_scale:new u.Uniform1f(i,o.u_gamma_scale),u_device_pixel_ratio:new u.Uniform1f(i,o.u_device_pixel_ratio),u_is_halo:new u.Uniform1i(i,o.u_is_halo)}},background:function(i,o){return{u_matrix:new u.UniformMatrix4f(i,o.u_matrix),u_opacity:new u.Uniform1f(i,o.u_opacity),u_color:new u.UniformColor(i,o.u_color)}},backgroundPattern:function(i,o){return{u_matrix:new u.UniformMatrix4f(i,o.u_matrix),u_opacity:new u.Uniform1f(i,o.u_opacity),u_image:new u.Uniform1i(i,o.u_image),u_pattern_tl_a:new u.Uniform2f(i,o.u_pattern_tl_a),u_pattern_br_a:new u.Uniform2f(i,o.u_pattern_br_a),u_pattern_tl_b:new u.Uniform2f(i,o.u_pattern_tl_b),u_pattern_br_b:new u.Uniform2f(i,o.u_pattern_br_b),u_texsize:new u.Uniform2f(i,o.u_texsize),u_mix:new u.Uniform1f(i,o.u_mix),u_pattern_size_a:new u.Uniform2f(i,o.u_pattern_size_a),u_pattern_size_b:new u.Uniform2f(i,o.u_pattern_size_b),u_scale_a:new u.Uniform1f(i,o.u_scale_a),u_scale_b:new u.Uniform1f(i,o.u_scale_b),u_pixel_coord_upper:new u.Uniform2f(i,o.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(i,o.u_pixel_coord_lower),u_tile_units_to_pixels:new u.Uniform1f(i,o.u_tile_units_to_pixels)}}};function Ks(i,o,n,s,p,f,d){for(var y=i.context,_=y.gl,S=i.useProgram("collisionBox"),P=[],k=0,z=0,U=0;U<s.length;U++){var O=s[U],G=o.getTile(O),B=G.getBucket(n);if(B){var Z=O.posMatrix;p[0]===0&&p[1]===0||(Z=i.translatePosMatrix(O.posMatrix,G,p,f));var H=d?B.textCollisionBox:B.iconCollisionBox,Q=B.collisionCircleArray;if(Q.length>0){var at=u.create(),nt=Z;u.mul(at,B.placementInvProjMatrix,i.transform.glCoordMatrix),u.mul(at,at,B.placementViewportMatrix),P.push({circleArray:Q,circleOffset:z,transform:nt,invTransform:at}),z=k+=Q.length/4}H&&S.draw(y,_.LINES,C.disabled,F.disabled,i.colorModeForRenderPass(),J.disabled,Gs(Z,i.transform,G),n.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,null,i.transform.zoom,null,null,H.collisionVertexBuffer)}}if(d&&P.length){var lt=i.useProgram("collisionCircle"),ct=new u.StructArrayLayout2f1f2i16;ct.resize(4*k),ct._trim();for(var _t=0,yt=0,Et=P;yt<Et.length;yt+=1)for(var Vt=Et[yt],qt=0;qt<Vt.circleArray.length/4;qt++){var Nt=4*qt,he=Vt.circleArray[Nt+0],Ct=Vt.circleArray[Nt+1],Jt=Vt.circleArray[Nt+2],re=Vt.circleArray[Nt+3];ct.emplace(_t++,he,Ct,Jt,re,0),ct.emplace(_t++,he,Ct,Jt,re,1),ct.emplace(_t++,he,Ct,Jt,re,2),ct.emplace(_t++,he,Ct,Jt,re,3)}(!Ho||Ho.length<2*k)&&(Ho=function(Je){var Dr=2*Je,pr=new u.StructArrayLayout3ui6;pr.resize(Dr),pr._trim();for(var hr=0;hr<Dr;hr++){var Ye=6*hr;pr.uint16[Ye+0]=4*hr+0,pr.uint16[Ye+1]=4*hr+1,pr.uint16[Ye+2]=4*hr+2,pr.uint16[Ye+3]=4*hr+2,pr.uint16[Ye+4]=4*hr+3,pr.uint16[Ye+5]=4*hr+0}return pr}(k));for(var Yt=y.createIndexBuffer(Ho,!0),Ht=y.createVertexBuffer(ct,u.collisionCircleLayout.members,!0),Kt=0,Wt=P;Kt<Wt.length;Kt+=1){var Zt=Wt[Kt],we=Xn(Zt.transform,Zt.invTransform,i.transform);lt.draw(y,_.TRIANGLES,C.disabled,F.disabled,i.colorModeForRenderPass(),J.disabled,we,n.id,Ht,Yt,u.SegmentVector.simpleSegment(0,2*Zt.circleOffset,Zt.circleArray.length,Zt.circleArray.length/2),null,i.transform.zoom,null,null,null)}Ht.destroy(),Yt.destroy()}}var Yo=u.identity(new Float32Array(16));function Ci(i,o,n,s,p,f){var d=u.getAnchorAlignment(i),y=-(d.horizontalAlign-.5)*o,_=-(d.verticalAlign-.5)*n,S=u.evaluateVariableOffset(i,s);return new u.Point((y/p+S[0])*f,(_/p+S[1])*f)}function $l(i,o,n,s,p,f,d,y,_,S,P){var k=i.text.placedSymbolArray,z=i.text.dynamicLayoutVertexArray,U=i.icon.dynamicLayoutVertexArray,O={};z.clear();for(var G=0;G<k.length;G++){var B=k.get(G),Z=B.hidden||!B.crossTileID||i.allowVerticalPlacement&&!B.placedOrientation?null:s[B.crossTileID];if(Z){var H=new u.Point(B.anchorX,B.anchorY),Q=ie(H,n?y:d),at=bo(f.cameraToCenterDistance,Q.signedDistanceFromCamera),nt=p.evaluateSizeForFeature(i.textSizeData,S,B)*at/u.ONE_EM;n&&(nt*=i.tilePixelRatio/_);for(var lt=Ci(Z.anchor,Z.width,Z.height,Z.textOffset,Z.textBoxScale,nt),ct=n?ie(H.add(lt),d).point:Q.point.add(o?lt.rotate(-f.angle):lt),_t=i.allowVerticalPlacement&&B.placedOrientation===u.WritingMode.vertical?Math.PI/2:0,yt=0;yt<B.numGlyphs;yt++)u.addDynamicAttributes(z,ct,_t);P&&B.associatedIconIndex>=0&&(O[B.associatedIconIndex]={shiftedAnchor:ct,angle:_t})}else Bi(B.numGlyphs,z)}if(P){U.clear();for(var Et=i.icon.placedSymbolArray,Vt=0;Vt<Et.length;Vt++){var qt=Et.get(Vt);if(qt.hidden)Bi(qt.numGlyphs,U);else{var Nt=O[Vt];if(Nt)for(var he=0;he<qt.numGlyphs;he++)u.addDynamicAttributes(U,Nt.shiftedAnchor,Nt.angle);else Bi(qt.numGlyphs,U)}}i.icon.dynamicLayoutVertexBuffer.updateData(U)}i.text.dynamicLayoutVertexBuffer.updateData(z)}function tu(i,o,n){return n.iconsInText&&o?"symbolTextAndIcon":i?"symbolSDF":"symbolIcon"}function Hs(i,o,n,s,p,f,d,y,_,S,P,k){for(var z=i.context,U=z.gl,O=i.transform,G=y==="map",B=_==="map",Z=G&&n.layout.get("symbol-placement")!=="point",H=G&&!B&&!Z,Q=!n.layout.get("symbol-sort-key").isConstant(),at=!1,nt=i.depthModeForSublayer(0,C.ReadOnly),lt=n.layout.get("text-variable-anchor"),ct=[],_t=0,yt=s;_t<yt.length;_t+=1){var Et=yt[_t],Vt=o.getTile(Et),qt=Vt.getBucket(n);if(qt){var Nt=p?qt.text:qt.icon;if(Nt&&Nt.segments.get().length){var he=Nt.programConfigurations.get(n.id),Ct=p||qt.sdfIcons,Jt=p?qt.textSizeData:qt.iconSizeData,re=B||O.pitch!==0,Yt=i.useProgram(tu(Ct,p,qt),he),Ht=u.evaluateSizeForZoom(Jt,O.zoom),Kt=void 0,Wt=[0,0],Zt=void 0,we=void 0,Je=null,Dr=void 0;if(p)Zt=Vt.glyphAtlasTexture,we=U.LINEAR,Kt=Vt.glyphAtlasTexture.size,qt.iconsInText&&(Wt=Vt.imageAtlasTexture.size,Je=Vt.imageAtlasTexture,Dr=re||i.options.rotating||i.options.zooming||Jt.kind==="composite"||Jt.kind==="camera"?U.LINEAR:U.NEAREST);else{var pr=n.layout.get("icon-size").constantOr(0)!==1||qt.iconsNeedLinear;Zt=Vt.imageAtlasTexture,we=Ct||i.options.rotating||i.options.zooming||pr||re?U.LINEAR:U.NEAREST,Kt=Vt.imageAtlasTexture.size}var hr=Nr(Vt,1,i.transform.zoom),Ye=Ne(Et.posMatrix,B,G,i.transform,hr),Ar=Ee(Et.posMatrix,B,G,i.transform,hr),Ui=lt&&qt.hasTextData(),Lr=n.layout.get("icon-text-fit")!=="none"&&Ui&&qt.hasIconData();Z&&Un(qt,Et.posMatrix,i,p,Ye,Ar,B,S);var Rr=i.translatePosMatrix(Et.posMatrix,Vt,f,d),Vi=Z||p&&lt||Lr?Yo:Ye,ui=i.translatePosMatrix(Ar,Vt,f,d,!0),ll=Ct&&n.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Sn={program:Yt,buffers:Nt,uniformValues:Ct?qt.iconsInText?Na(Jt.kind,Ht,H,B,i,Rr,Vi,ui,Kt,Wt):Ao(Jt.kind,Ht,H,B,i,Rr,Vi,ui,p,Kt,!0):Ql(Jt.kind,Ht,H,B,i,Rr,Vi,ui,p,Kt),atlasTexture:Zt,atlasTextureIcon:Je,atlasInterpolation:we,atlasInterpolationIcon:Dr,isSDF:Ct,hasHalo:ll};if(Q&&qt.canOverlap){at=!0;for(var Mo=0,eo=Nt.segments.get();Mo<eo.length;Mo+=1){var ca=eo[Mo];ct.push({segments:new u.SegmentVector([ca]),sortKey:ca.sortKey,state:Sn})}}else ct.push({segments:Nt.segments,sortKey:0,state:Sn})}}}at&&ct.sort(function(Di,ro){return Di.sortKey-ro.sortKey});for(var Do=0,Ni=ct;Do<Ni.length;Do+=1){var Lo=Ni[Do],ar=Lo.state;if(z.activeTexture.set(U.TEXTURE0),ar.atlasTexture.bind(ar.atlasInterpolation,U.CLAMP_TO_EDGE),ar.atlasTextureIcon&&(z.activeTexture.set(U.TEXTURE1),ar.atlasTextureIcon&&ar.atlasTextureIcon.bind(ar.atlasInterpolationIcon,U.CLAMP_TO_EDGE)),ar.isSDF){var $i=ar.uniformValues;ar.hasHalo&&($i.u_is_halo=1,Kn(ar.buffers,Lo.segments,n,i,ar.program,nt,P,k,$i)),$i.u_is_halo=0}Kn(ar.buffers,Lo.segments,n,i,ar.program,nt,P,k,ar.uniformValues)}}function Kn(i,o,n,s,p,f,d,y,_){var S=s.context;p.draw(S,S.gl.TRIANGLES,f,d,y,J.disabled,_,n.id,i.layoutVertexBuffer,i.indexBuffer,o,n.paint,s.transform.zoom,i.programConfigurations.get(n.id),i.dynamicLayoutVertexBuffer,i.opacityVertexBuffer)}function Qo(i,o,n,s,p,f,d){var y,_,S,P,k,z=i.context.gl,U=n.paint.get("fill-pattern"),O=U&&U.constantOr(1),G=n.getCrossfadeParameters();d?(_=O&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",y=z.LINES):(_=O?"fillPattern":"fill",y=z.TRIANGLES);for(var B=0,Z=s;B<Z.length;B+=1){var H=Z[B],Q=o.getTile(H);if(!O||Q.patternsLoaded()){var at=Q.getBucket(n);if(at){var nt=at.programConfigurations.get(n.id),lt=i.useProgram(_,nt);O&&(i.context.activeTexture.set(z.TEXTURE0),Q.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),nt.updatePaintBuffers(G));var ct=U.constantOr(null);if(ct&&Q.imageAtlas){var _t=Q.imageAtlas,yt=_t.patternPositions[ct.to.toString()],Et=_t.patternPositions[ct.from.toString()];yt&&Et&&nt.setConstantPatternPositions(yt,Et)}var Vt=i.translatePosMatrix(H.posMatrix,Q,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(d){P=at.indexBuffer2,k=at.segments2;var qt=[z.drawingBufferWidth,z.drawingBufferHeight];S=_==="fillOutlinePattern"&&O?Hl(Vt,i,G,Q,qt):To(Vt,qt)}else P=at.indexBuffer,k=at.segments,S=O?gn(Vt,i,G,Q):yn(Vt);lt.draw(i.context,y,p,i.stencilModeForClipping(H),f,J.disabled,S,n.id,at.layoutVertexBuffer,P,k,n.paint,i.transform.zoom,nt)}}}}function $o(i,o,n,s,p,f,d){for(var y=i.context,_=y.gl,S=n.paint.get("fill-extrusion-pattern"),P=S.constantOr(1),k=n.getCrossfadeParameters(),z=n.paint.get("fill-extrusion-opacity"),U=0,O=s;U<O.length;U+=1){var G=O[U],B=o.getTile(G),Z=B.getBucket(n);if(Z){var H=Z.programConfigurations.get(n.id),Q=i.useProgram(P?"fillExtrusionPattern":"fillExtrusion",H);P&&(i.context.activeTexture.set(_.TEXTURE0),B.imageAtlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),H.updatePaintBuffers(k));var at=S.constantOr(null);if(at&&B.imageAtlas){var nt=B.imageAtlas,lt=nt.patternPositions[at.to.toString()],ct=nt.patternPositions[at.from.toString()];lt&&ct&&H.setConstantPatternPositions(lt,ct)}var _t=i.translatePosMatrix(G.posMatrix,B,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),yt=n.paint.get("fill-extrusion-vertical-gradient"),Et=P?Yu(_t,i,yt,z,G,k,B):Kl(_t,i,yt,z);Q.draw(y,y.gl.TRIANGLES,p,f,d,J.backCCW,Et,n.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,n.paint,i.transform.zoom,H)}}}function tc(i,o,n,s,p,f){var d=i.context,y=d.gl,_=o.fbo;if(_){var S=i.useProgram("hillshade");d.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,_.colorAttachment.get());var P=function(k,z,U){var O=U.paint.get("hillshade-shadow-color"),G=U.paint.get("hillshade-highlight-color"),B=U.paint.get("hillshade-accent-color"),Z=U.paint.get("hillshade-illumination-direction")*(Math.PI/180);U.paint.get("hillshade-illumination-anchor")==="viewport"&&(Z-=k.transform.angle);var H,Q,at,nt=!k.options.moving;return{u_matrix:k.transform.calculatePosMatrix(z.tileID.toUnwrapped(),nt),u_image:0,u_latrange:(H=z.tileID,Q=Math.pow(2,H.canonical.z),at=H.canonical.y,[new u.MercatorCoordinate(0,at/Q).toLngLat().lat,new u.MercatorCoordinate(0,(at+1)/Q).toLngLat().lat]),u_light:[U.paint.get("hillshade-exaggeration"),Z],u_shadow:O,u_highlight:G,u_accent:B}}(i,o,n);S.draw(d,y.TRIANGLES,s,p,f,J.disabled,P,n.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments)}}function qa(i,o,n,s,p,f){var d=i.context,y=d.gl,_=o.dem;if(_&&_.data){var S=_.dim,P=_.stride,k=_.getPixels();if(d.activeTexture.set(y.TEXTURE1),d.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||i.getTileTexture(P),o.demTexture){var z=o.demTexture;z.update(k,{premultiply:!1}),z.bind(y.NEAREST,y.CLAMP_TO_EDGE)}else o.demTexture=new u.Texture(d,k,y.RGBA,{premultiply:!1}),o.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);d.activeTexture.set(y.TEXTURE0);var U=o.fbo;if(!U){var O=new u.Texture(d,{width:S,height:S,data:null},y.RGBA);O.bind(y.LINEAR,y.CLAMP_TO_EDGE),(U=o.fbo=d.createFramebuffer(S,S,!0)).colorAttachment.set(O.texture)}d.bindFramebuffer.set(U.framebuffer),d.viewport.set([0,0,S,S]),i.useProgram("hillshadePrepare").draw(d,y.TRIANGLES,s,p,f,J.disabled,function(G,B){var Z=B.stride,H=u.create();return u.ortho(H,0,u.EXTENT,-u.EXTENT,0,0,1),u.translate(H,H,[0,-u.EXTENT,0]),{u_matrix:H,u_image:1,u_dimension:[Z,Z],u_zoom:G.overscaledZ,u_unpack:B.getUnpackVector()}}(o.tileID,_),n.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function ec(i,o,n,s,p){var f=s.paint.get("raster-fade-duration");if(f>0){var d=u.browser.now(),y=(d-i.timeAdded)/f,_=o?(d-o.timeAdded)/f:-1,S=n.getSource(),P=p.coveringZoomLevel({tileSize:S.tileSize,roundZoom:S.roundZoom}),k=!o||Math.abs(o.tileID.overscaledZ-P)>Math.abs(i.tileID.overscaledZ-P),z=k&&i.refreshedUponExpiration?1:u.clamp(k?y:1-_,0,1);return i.refreshedUponExpiration&&y>=1&&(i.refreshedUponExpiration=!1),o?{opacity:1,mix:1-z}:{opacity:z,mix:0}}return{opacity:1,mix:0}}var Za=new u.Color(1,0,0,1),Js=new u.Color(0,1,0,1),eu=new u.Color(0,0,1,1),ru=new u.Color(1,0,1,1),Ga=new u.Color(0,1,1,1);function Xa(i,o,n,s){ta(i,0,o+n/2,i.transform.width,n,s)}function Ys(i,o,n,s){ta(i,o-n/2,0,n,i.transform.height,s)}function ta(i,o,n,s,p,f){var d=i.context,y=d.gl;y.enable(y.SCISSOR_TEST),y.scissor(o*u.browser.devicePixelRatio,n*u.browser.devicePixelRatio,s*u.browser.devicePixelRatio,p*u.browser.devicePixelRatio),d.clear({color:f}),y.disable(y.SCISSOR_TEST)}function iu(i,o,n){var s=i.context,p=s.gl,f=n.posMatrix,d=i.useProgram("debug"),y=C.disabled,_=F.disabled,S=i.colorModeForRenderPass();s.activeTexture.set(p.TEXTURE0),i.emptyTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),d.draw(s,p.LINE_STRIP,y,_,S,J.disabled,Xs(f,u.Color.red),"$debug",i.debugBuffer,i.tileBorderIndexBuffer,i.debugSegments);var P=o.getTileByID(n.key).latestRawTileData,k=Math.floor((P&&P.byteLength||0)/1024),z=o.getTile(n).tileSize,U=512/Math.min(z,512)*(n.overscaledZ/i.transform.zoom)*.5,O=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(O+=" => "+n.overscaledZ),function(G,B){G.initDebugOverlayCanvas();var Z=G.debugOverlayCanvas,H=G.context.gl,Q=G.debugOverlayCanvas.getContext("2d");Q.clearRect(0,0,Z.width,Z.height),Q.shadowColor="white",Q.shadowBlur=2,Q.lineWidth=1.5,Q.strokeStyle="white",Q.textBaseline="top",Q.font="bold 36px Open Sans, sans-serif",Q.fillText(B,5,5),Q.strokeText(B,5,5),G.debugOverlayTexture.update(Z),G.debugOverlayTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE)}(i,O+" "+k+"kb"),d.draw(s,p.TRIANGLES,y,_,K.alphaBlended,J.disabled,Xs(f,u.Color.transparent,U),"$debug",i.debugBuffer,i.quadTriangleIndexBuffer,i.debugSegments)}var Qs={symbol:function(i,o,n,s,p){if(i.renderPass==="translucent"){var f=F.disabled,d=i.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(y,_,S,P,k,z,U){for(var O=_.transform,G=k==="map",B=z==="map",Z=0,H=y;Z<H.length;Z+=1){var Q=H[Z],at=P.getTile(Q),nt=at.getBucket(S);if(nt&&nt.text&&nt.text.segments.get().length){var lt=u.evaluateSizeForZoom(nt.textSizeData,O.zoom),ct=Nr(at,1,_.transform.zoom),_t=Ne(Q.posMatrix,B,G,_.transform,ct),yt=S.layout.get("icon-text-fit")!=="none"&&nt.hasIconData();if(lt){var Et=Math.pow(2,O.zoom-at.tileID.overscaledZ);$l(nt,G,B,U,u.symbolSize,O,_t,Q.posMatrix,Et,lt,yt)}}}}(s,i,n,o,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),p),n.paint.get("icon-opacity").constantOr(1)!==0&&Hs(i,o,n,s,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),f,d),n.paint.get("text-opacity").constantOr(1)!==0&&Hs(i,o,n,s,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),f,d),o.map.showCollisionBoxes&&(Ks(i,o,n,s,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),Ks(i,o,n,s,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))}},circle:function(i,o,n,s){if(i.renderPass==="translucent"){var p=n.paint.get("circle-opacity"),f=n.paint.get("circle-stroke-width"),d=n.paint.get("circle-stroke-opacity"),y=!n.layout.get("circle-sort-key").isConstant();if(p.constantOr(1)!==0||f.constantOr(1)!==0&&d.constantOr(1)!==0){for(var _=i.context,S=_.gl,P=i.depthModeForSublayer(0,C.ReadOnly),k=F.disabled,z=i.colorModeForRenderPass(),U=[],O=0;O<s.length;O++){var G=s[O],B=o.getTile(G),Z=B.getBucket(n);if(Z){var H=Z.programConfigurations.get(n.id),Q={programConfiguration:H,program:i.useProgram("circle",H),layoutVertexBuffer:Z.layoutVertexBuffer,indexBuffer:Z.indexBuffer,uniformValues:Jl(i,G,B,n)};if(y)for(var at=0,nt=Z.segments.get();at<nt.length;at+=1){var lt=nt[at];U.push({segments:new u.SegmentVector([lt]),sortKey:lt.sortKey,state:Q})}else U.push({segments:Z.segments,sortKey:0,state:Q})}}y&&U.sort(function(Vt,qt){return Vt.sortKey-qt.sortKey});for(var ct=0,_t=U;ct<_t.length;ct+=1){var yt=_t[ct],Et=yt.state;Et.program.draw(_,S.TRIANGLES,P,k,z,J.disabled,Et.uniformValues,n.id,Et.layoutVertexBuffer,Et.indexBuffer,yt.segments,n.paint,i.transform.zoom,Et.programConfiguration)}}}},heatmap:function(i,o,n,s){if(n.paint.get("heatmap-opacity")!==0)if(i.renderPass==="offscreen"){var p=i.context,f=p.gl,d=F.disabled,y=new K([f.ONE,f.ONE],u.Color.transparent,[!0,!0,!0,!0]);(function(U,O,G){var B=U.gl;U.activeTexture.set(B.TEXTURE1),U.viewport.set([0,0,O.width/4,O.height/4]);var Z=G.heatmapFbo;if(Z)B.bindTexture(B.TEXTURE_2D,Z.colorAttachment.get()),U.bindFramebuffer.set(Z.framebuffer);else{var H=B.createTexture();B.bindTexture(B.TEXTURE_2D,H),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.LINEAR),Z=G.heatmapFbo=U.createFramebuffer(O.width/4,O.height/4,!1),function(Q,at,nt,lt){var ct=Q.gl;ct.texImage2D(ct.TEXTURE_2D,0,ct.RGBA,at.width/4,at.height/4,0,ct.RGBA,Q.extRenderToTextureHalfFloat?Q.extTextureHalfFloat.HALF_FLOAT_OES:ct.UNSIGNED_BYTE,null),lt.colorAttachment.set(nt)}(U,O,H,Z)}})(p,i,n),p.clear({color:u.Color.transparent});for(var _=0;_<s.length;_++){var S=s[_];if(!o.hasRenderableParent(S)){var P=o.getTile(S),k=P.getBucket(n);if(k){var z=k.programConfigurations.get(n.id);i.useProgram("heatmap",z).draw(p,f.TRIANGLES,C.disabled,d,y,J.disabled,Io(S.posMatrix,P,i.transform.zoom,n.paint.get("heatmap-intensity")),n.id,k.layoutVertexBuffer,k.indexBuffer,k.segments,n.paint,i.transform.zoom,z)}}}p.viewport.set([0,0,i.width,i.height])}else i.renderPass==="translucent"&&(i.context.setColorMode(i.colorModeForRenderPass()),function(U,O){var G=U.context,B=G.gl,Z=O.heatmapFbo;if(Z){G.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,Z.colorAttachment.get()),G.activeTexture.set(B.TEXTURE1);var H=O.colorRampTexture;H||(H=O.colorRampTexture=new u.Texture(G,O.colorRamp,B.RGBA)),H.bind(B.LINEAR,B.CLAMP_TO_EDGE),U.useProgram("heatmapTexture").draw(G,B.TRIANGLES,C.disabled,F.disabled,U.colorModeForRenderPass(),J.disabled,function(Q,at,nt,lt){var ct=u.create();u.ortho(ct,0,Q.width,Q.height,0,0,1);var _t=Q.context.gl;return{u_matrix:ct,u_world:[_t.drawingBufferWidth,_t.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:at.paint.get("heatmap-opacity")}}(U,O),O.id,U.viewportBuffer,U.quadTriangleIndexBuffer,U.viewportSegments,O.paint,U.transform.zoom)}}(i,n))},line:function(i,o,n,s){if(i.renderPass==="translucent"){var p=n.paint.get("line-opacity"),f=n.paint.get("line-width");if(p.constantOr(1)!==0&&f.constantOr(1)!==0)for(var d=i.depthModeForSublayer(0,C.ReadOnly),y=i.colorModeForRenderPass(),_=n.paint.get("line-dasharray"),S=n.paint.get("line-pattern"),P=S.constantOr(1),k=n.paint.get("line-gradient"),z=n.getCrossfadeParameters(),U=P?"linePattern":_?"lineSDF":k?"lineGradient":"line",O=i.context,G=O.gl,B=!0,Z=0,H=s;Z<H.length;Z+=1){var Q=H[Z],at=o.getTile(Q);if(!P||at.patternsLoaded()){var nt=at.getBucket(n);if(nt){var lt=nt.programConfigurations.get(n.id),ct=i.context.program.get(),_t=i.useProgram(U,lt),yt=B||_t.program!==ct,Et=S.constantOr(null);if(Et&&at.imageAtlas){var Vt=at.imageAtlas,qt=Vt.patternPositions[Et.to.toString()],Nt=Vt.patternPositions[Et.from.toString()];qt&&Nt&&lt.setConstantPatternPositions(qt,Nt)}var he=P?Pe(i,at,n,z):_?Va(i,at,n,_,z):k?Ws(i,at,n,nt.lineClipsArray.length):Ua(i,at,n);if(P)O.activeTexture.set(G.TEXTURE0),at.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),lt.updatePaintBuffers(z);else if(_&&(yt||i.lineAtlas.dirty))O.activeTexture.set(G.TEXTURE0),i.lineAtlas.bind(O);else if(k){var Ct=nt.gradients[n.id],Jt=Ct.texture;if(n.gradientVersion!==Ct.version){var re=256;if(n.stepInterpolant){var Yt=o.getSource().maxzoom,Ht=Q.canonical.z===Yt?Math.ceil(1<<i.transform.maxZoom-Q.canonical.z):1;re=u.clamp(u.nextPowerOfTwo(nt.maxLineLength/u.EXTENT*1024*Ht),256,O.maxTextureSize)}Ct.gradient=u.renderColorRamp({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:re,image:Ct.gradient||void 0,clips:nt.lineClipsArray}),Ct.texture?Ct.texture.update(Ct.gradient):Ct.texture=new u.Texture(O,Ct.gradient,G.RGBA),Ct.version=n.gradientVersion,Jt=Ct.texture}O.activeTexture.set(G.TEXTURE0),Jt.bind(n.stepInterpolant?G.NEAREST:G.LINEAR,G.CLAMP_TO_EDGE)}_t.draw(O,G.TRIANGLES,d,i.stencilModeForClipping(Q),y,J.disabled,he,n.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,n.paint,i.transform.zoom,lt,nt.layoutVertexBuffer2),B=!1}}}}},fill:function(i,o,n,s){var p=n.paint.get("fill-color"),f=n.paint.get("fill-opacity");if(f.constantOr(1)!==0){var d=i.colorModeForRenderPass(),y=n.paint.get("fill-pattern"),_=i.opaquePassEnabledForLayer()&&!y.constantOr(1)&&p.constantOr(u.Color.transparent).a===1&&f.constantOr(0)===1?"opaque":"translucent";if(i.renderPass===_){var S=i.depthModeForSublayer(1,i.renderPass==="opaque"?C.ReadWrite:C.ReadOnly);Qo(i,o,n,s,S,d,!1)}if(i.renderPass==="translucent"&&n.paint.get("fill-antialias")){var P=i.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,C.ReadOnly);Qo(i,o,n,s,P,d,!0)}}},"fill-extrusion":function(i,o,n,s){var p=n.paint.get("fill-extrusion-opacity");if(p!==0&&i.renderPass==="translucent"){var f=new C(i.context.gl.LEQUAL,C.ReadWrite,i.depthRangeFor3D);if(p!==1||n.paint.get("fill-extrusion-pattern").constantOr(1))$o(i,o,n,s,f,F.disabled,K.disabled),$o(i,o,n,s,f,i.stencilModeFor3D(),i.colorModeForRenderPass());else{var d=i.colorModeForRenderPass();$o(i,o,n,s,f,F.disabled,d)}}},hillshade:function(i,o,n,s){if(i.renderPass==="offscreen"||i.renderPass==="translucent"){for(var p=i.context,f=i.depthModeForSublayer(0,C.ReadOnly),d=i.colorModeForRenderPass(),y=i.renderPass==="translucent"?i.stencilConfigForOverlap(s):[{},s],_=y[0],S=0,P=y[1];S<P.length;S+=1){var k=P[S],z=o.getTile(k);z.needsHillshadePrepare&&i.renderPass==="offscreen"?qa(i,z,n,f,F.disabled,d):i.renderPass==="translucent"&&tc(i,z,n,f,_[k.overscaledZ],d)}p.viewport.set([0,0,i.width,i.height])}},raster:function(i,o,n,s){if(i.renderPass==="translucent"&&n.paint.get("raster-opacity")!==0&&s.length)for(var p=i.context,f=p.gl,d=o.getSource(),y=i.useProgram("raster"),_=i.colorModeForRenderPass(),S=d instanceof Li?[{},s]:i.stencilConfigForOverlap(s),P=S[0],k=S[1],z=k[k.length-1].overscaledZ,U=!i.options.moving,O=0,G=k;O<G.length;O+=1){var B=G[O],Z=i.depthModeForSublayer(B.overscaledZ-z,n.paint.get("raster-opacity")===1?C.ReadWrite:C.ReadOnly,f.LESS),H=o.getTile(B),Q=i.transform.calculatePosMatrix(B.toUnwrapped(),U);H.registerFadeDuration(n.paint.get("raster-fade-duration"));var at=o.findLoadedParent(B,0),nt=ec(H,at,o,n,i.transform),lt=void 0,ct=void 0,_t=n.paint.get("raster-resampling")==="nearest"?f.NEAREST:f.LINEAR;p.activeTexture.set(f.TEXTURE0),H.texture.bind(_t,f.CLAMP_TO_EDGE,f.LINEAR_MIPMAP_NEAREST),p.activeTexture.set(f.TEXTURE1),at?(at.texture.bind(_t,f.CLAMP_TO_EDGE,f.LINEAR_MIPMAP_NEAREST),lt=Math.pow(2,at.tileID.overscaledZ-H.tileID.overscaledZ),ct=[H.tileID.canonical.x*lt%1,H.tileID.canonical.y*lt%1]):H.texture.bind(_t,f.CLAMP_TO_EDGE,f.LINEAR_MIPMAP_NEAREST);var yt=Qu(Q,ct||[0,0],lt||1,nt,n);d instanceof Li?y.draw(p,f.TRIANGLES,Z,F.disabled,_,J.disabled,yt,n.id,d.boundsBuffer,i.quadTriangleIndexBuffer,d.boundsSegments):y.draw(p,f.TRIANGLES,Z,P[B.overscaledZ],_,J.disabled,yt,n.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments)}},background:function(i,o,n){var s=n.paint.get("background-color"),p=n.paint.get("background-opacity");if(p!==0){var f=i.context,d=f.gl,y=i.transform,_=y.tileSize,S=n.paint.get("background-pattern");if(!i.isPatternMissing(S)){var P=!S&&s.a===1&&p===1&&i.opaquePassEnabledForLayer()?"opaque":"translucent";if(i.renderPass===P){var k=F.disabled,z=i.depthModeForSublayer(0,P==="opaque"?C.ReadWrite:C.ReadOnly),U=i.colorModeForRenderPass(),O=i.useProgram(S?"backgroundPattern":"background"),G=y.coveringTiles({tileSize:_});S&&(f.activeTexture.set(d.TEXTURE0),i.imageManager.bind(i.context));for(var B=n.getCrossfadeParameters(),Z=0,H=G;Z<H.length;Z+=1){var Q=H[Z],at=i.transform.calculatePosMatrix(Q.toUnwrapped()),nt=S?Jo(at,p,i,S,{tileID:Q,tileSize:_},B):ja(at,p,s);O.draw(f,d.TRIANGLES,z,k,U,J.disabled,nt,n.id,i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}}}},debug:function(i,o,n){for(var s=0;s<n.length;s++)iu(i,o,n[s])},custom:function(i,o,n){var s=i.context,p=n.implementation;if(i.renderPass==="offscreen"){var f=p.prerender;f&&(i.setCustomLayerDefaults(),s.setColorMode(i.colorModeForRenderPass()),f.call(p,s.gl,i.transform.customLayerMatrix()),s.setDirty(),i.setBaseState())}else if(i.renderPass==="translucent"){i.setCustomLayerDefaults(),s.setColorMode(i.colorModeForRenderPass()),s.setStencilMode(F.disabled);var d=p.renderingMode==="3d"?new C(i.context.gl.LEQUAL,C.ReadWrite,i.depthRangeFor3D):i.depthModeForSublayer(0,C.ReadOnly);s.setDepthMode(d),p.render(s.gl,i.transform.customLayerMatrix()),s.setDirty(),i.setBaseState(),s.bindFramebuffer.set(null)}}},be=function(i,o){this.context=new X(i),this.transform=o,this._tileTextures={},this.setup(),this.numSublayers=D.maxUnderzooming+D.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Nn,this.gpuTimers={}};be.prototype.resize=function(i,o){if(this.width=i*u.browser.devicePixelRatio,this.height=o*u.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var n=0,s=this.style._order;n<s.length;n+=1)this.style._layers[s[n]].resize()},be.prototype.setup=function(){var i=this.context,o=new u.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(u.EXTENT,0),o.emplaceBack(0,u.EXTENT),o.emplaceBack(u.EXTENT,u.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(o,ki.members),this.tileExtentSegments=u.SegmentVector.simpleSegment(0,0,4,2);var n=new u.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(u.EXTENT,0),n.emplaceBack(0,u.EXTENT),n.emplaceBack(u.EXTENT,u.EXTENT),this.debugBuffer=i.createVertexBuffer(n,ki.members),this.debugSegments=u.SegmentVector.simpleSegment(0,0,4,5);var s=new u.StructArrayLayout4i8;s.emplaceBack(0,0,0,0),s.emplaceBack(u.EXTENT,0,u.EXTENT,0),s.emplaceBack(0,u.EXTENT,0,u.EXTENT),s.emplaceBack(u.EXTENT,u.EXTENT,u.EXTENT,u.EXTENT),this.rasterBoundsBuffer=i.createVertexBuffer(s,Ei.members),this.rasterBoundsSegments=u.SegmentVector.simpleSegment(0,0,4,2);var p=new u.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(1,0),p.emplaceBack(0,1),p.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(p,ki.members),this.viewportSegments=u.SegmentVector.simpleSegment(0,0,4,2);var f=new u.StructArrayLayout1ui2;f.emplaceBack(0),f.emplaceBack(1),f.emplaceBack(3),f.emplaceBack(2),f.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(f);var d=new u.StructArrayLayout3ui6;d.emplaceBack(0,1,2),d.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(d),this.emptyTexture=new u.Texture(i,{width:1,height:1,data:new Uint8Array([0,0,0,0])},i.gl.RGBA);var y=this.context.gl;this.stencilClearMode=new F({func:y.ALWAYS,mask:0},0,255,y.ZERO,y.ZERO,y.ZERO)},be.prototype.clearStencil=function(){var i=this.context,o=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var n=u.create();u.ortho(n,0,this.width,this.height,0,0,1),u.scale(n,n,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,o.TRIANGLES,C.disabled,this.stencilClearMode,K.disabled,J.disabled,Wn(n),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},be.prototype._renderTileClippingMasks=function(i,o){if(this.currentStencilSource!==i.source&&i.isTileClipped()&&o&&o.length){this.currentStencilSource=i.source;var n=this.context,s=n.gl;this.nextStencilID+o.length>256&&this.clearStencil(),n.setColorMode(K.disabled),n.setDepthMode(C.disabled);var p=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var f=0,d=o;f<d.length;f+=1){var y=d[f],_=this._tileClippingMaskIDs[y.key]=this.nextStencilID++;p.draw(n,s.TRIANGLES,C.disabled,new F({func:s.ALWAYS,mask:0},_,255,s.KEEP,s.KEEP,s.REPLACE),K.disabled,J.disabled,Wn(y.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},be.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var i=this.nextStencilID++,o=this.context.gl;return new F({func:o.NOTEQUAL,mask:255},i,255,o.KEEP,o.KEEP,o.REPLACE)},be.prototype.stencilModeForClipping=function(i){var o=this.context.gl;return new F({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,o.KEEP,o.KEEP,o.REPLACE)},be.prototype.stencilConfigForOverlap=function(i){var o,n=this.context.gl,s=i.sort(function(_,S){return S.overscaledZ-_.overscaledZ}),p=s[s.length-1].overscaledZ,f=s[0].overscaledZ-p+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();for(var d={},y=0;y<f;y++)d[y+p]=new F({func:n.GEQUAL,mask:255},y+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=f,[d,s]}return[(o={},o[p]=F.disabled,o),s]},be.prototype.colorModeForRenderPass=function(){var i=this.context.gl;return this._showOverdrawInspector?new K([i.CONSTANT_COLOR,i.ONE],new u.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?K.unblended:K.alphaBlended},be.prototype.depthModeForSublayer=function(i,o,n){if(!this.opaquePassEnabledForLayer())return C.disabled;var s=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new C(n||this.context.gl.LEQUAL,o,[s,s])},be.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},be.prototype.render=function(i,o){var n=this;this.style=i,this.options=o,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(u.browser.now()),this.imageManager.beginFrame();var s=this.style._order,p=this.style.sourceCaches;for(var f in p){var d=p[f];d.used&&d.prepare(this.context)}var y,_,S={},P={},k={};for(var z in p){var U=p[z];S[z]=U.getVisibleCoordinates(),P[z]=S[z].slice().reverse(),k[z]=U.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var O=0;O<s.length;O++)if(this.style._layers[s[O]].is3D()){this.opaquePassCutoff=O;break}this.renderPass="offscreen";for(var G=0,B=s;G<B.length;G+=1){var Z=this.style._layers[B[G]];if(Z.hasOffscreenPass()&&!Z.isHidden(this.transform.zoom)){var H=P[Z.source];(Z.type==="custom"||H.length)&&this.renderLayer(this,p[Z.source],Z,H)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?u.Color.black:u.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=s.length-1;this.currentLayer>=0;this.currentLayer--){var Q=this.style._layers[s[this.currentLayer]],at=p[Q.source],nt=S[Q.source];this._renderTileClippingMasks(Q,nt),this.renderLayer(this,at,Q,nt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<s.length;this.currentLayer++){var lt=this.style._layers[s[this.currentLayer]],ct=p[lt.source],_t=(lt.type==="symbol"?k:P)[lt.source];this._renderTileClippingMasks(lt,S[lt.source]),this.renderLayer(this,ct,lt,_t)}this.options.showTileBoundaries&&(u.values(this.style._layers).forEach(function(yt){yt.source&&!yt.isHidden(n.transform.zoom)&&(yt.source!==(_&&_.id)&&(_=n.style.sourceCaches[yt.source]),(!y||y.getSource().maxzoom<_.getSource().maxzoom)&&(y=_))}),y&&Qs.debug(this,y,y.getVisibleCoordinates())),this.options.showPadding&&function(yt){var Et=yt.transform.padding;Xa(yt,yt.transform.height-(Et.top||0),3,Za),Xa(yt,Et.bottom||0,3,Js),Ys(yt,Et.left||0,3,eu),Ys(yt,yt.transform.width-(Et.right||0),3,ru);var Vt=yt.transform.centerPoint;(function(qt,Nt,he,Ct){ta(qt,Nt-1,he-10,2,20,Ct),ta(qt,Nt-10,he-1,20,2,Ct)})(yt,Vt.x,yt.transform.height-Vt.y,Ga)}(this),this.context.setDefault()},be.prototype.renderLayer=function(i,o,n,s){n.isHidden(this.transform.zoom)||(n.type==="background"||n.type==="custom"||s.length)&&(this.id=n.id,this.gpuTimingStart(n),Qs[n.type](i,o,n,s,this.style.placement.variableOffsets),this.gpuTimingEnd())},be.prototype.gpuTimingStart=function(i){if(this.options.gpuTiming){var o=this.context.extTimerQuery,n=this.gpuTimers[i.id];n||(n=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:o.createQueryEXT()}),n.calls++,o.beginQueryEXT(o.TIME_ELAPSED_EXT,n.query)}},be.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}},be.prototype.collectGpuTimers=function(){var i=this.gpuTimers;return this.gpuTimers={},i},be.prototype.queryGpuTimers=function(i){var o={};for(var n in i){var s=i[n],p=this.context.extTimerQuery,f=p.getQueryObjectEXT(s.query,p.QUERY_RESULT_EXT)/1e6;p.deleteQueryEXT(s.query),o[n]=f}return o},be.prototype.translatePosMatrix=function(i,o,n,s,p){if(!n[0]&&!n[1])return i;var f=p?s==="map"?this.transform.angle:0:s==="viewport"?-this.transform.angle:0;if(f){var d=Math.sin(f),y=Math.cos(f);n=[n[0]*y-n[1]*d,n[0]*d+n[1]*y]}var _=[p?n[0]:Nr(o,n[0],this.transform.zoom),p?n[1]:Nr(o,n[1],this.transform.zoom),0],S=new Float32Array(16);return u.translate(S,i,_),S},be.prototype.saveTileTexture=function(i){var o=this._tileTextures[i.size[0]];o?o.push(i):this._tileTextures[i.size[0]]=[i]},be.prototype.getTileTexture=function(i){var o=this._tileTextures[i];return o&&o.length>0?o.pop():null},be.prototype.isPatternMissing=function(i){if(!i)return!1;if(!i.from||!i.to)return!0;var o=this.imageManager.getPattern(i.from.toString()),n=this.imageManager.getPattern(i.to.toString());return!o||!n},be.prototype.useProgram=function(i,o){this.cache=this.cache||{};var n=""+i+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[n]||(this.cache[n]=new Xl(this.context,i,So[i],o,Po[i],this._showOverdrawInspector)),this.cache[n]},be.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},be.prototype.setBaseState=function(){var i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)},be.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=u.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new u.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},be.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Wa=function(i,o){this.points=i,this.planes=o};Wa.fromInvProjectionMatrix=function(i,o,n){var s=Math.pow(2,n),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(d){return u.transformMat4([],d,i)}).map(function(d){return u.scale$1([],d,1/d[3]/o*s)}),f=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(d){var y=u.sub([],p[d[0]],p[d[1]]),_=u.sub([],p[d[2]],p[d[1]]),S=u.normalize([],u.cross([],y,_)),P=-u.dot(S,p[d[1]]);return S.concat(P)});return new Wa(p,f)};var Hn=function(i,o){this.min=i,this.max=o,this.center=u.scale$2([],u.add([],this.min,this.max),.5)};Hn.prototype.quadrant=function(i){for(var o=[i%2==0,i<2],n=u.clone$2(this.min),s=u.clone$2(this.max),p=0;p<o.length;p++)n[p]=o[p]?this.min[p]:this.center[p],s[p]=o[p]?this.center[p]:this.max[p];return s[2]=this.max[2],new Hn(n,s)},Hn.prototype.distanceX=function(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]},Hn.prototype.distanceY=function(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]},Hn.prototype.intersects=function(i){for(var o=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],n=!0,s=0;s<i.planes.length;s++){for(var p=i.planes[s],f=0,d=0;d<o.length;d++)f+=u.dot$1(p,o[d])>=0;if(f===0)return 0;f!==o.length&&(n=!1)}if(n)return 2;for(var y=0;y<3;y++){for(var _=Number.MAX_VALUE,S=-Number.MAX_VALUE,P=0;P<i.points.length;P++){var k=i.points[P][y]-this.min[y];_=Math.min(_,k),S=Math.max(S,k)}if(S<0||_>this.max[y]-this.min[y])return 0}return 1};var vn=function(i,o,n,s){if(i===void 0&&(i=0),o===void 0&&(o=0),n===void 0&&(n=0),s===void 0&&(s=0),isNaN(i)||i<0||isNaN(o)||o<0||isNaN(n)||n<0||isNaN(s)||s<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=o,this.left=n,this.right=s};vn.prototype.interpolate=function(i,o,n){return o.top!=null&&i.top!=null&&(this.top=u.number(i.top,o.top,n)),o.bottom!=null&&i.bottom!=null&&(this.bottom=u.number(i.bottom,o.bottom,n)),o.left!=null&&i.left!=null&&(this.left=u.number(i.left,o.left,n)),o.right!=null&&i.right!=null&&(this.right=u.number(i.right,o.right,n)),this},vn.prototype.getCenter=function(i,o){var n=u.clamp((this.left+i-this.right)/2,0,i),s=u.clamp((this.top+o-this.bottom)/2,0,o);return new u.Point(n,s)},vn.prototype.equals=function(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right},vn.prototype.clone=function(){return new vn(this.top,this.bottom,this.left,this.right)},vn.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var _e=function(i,o,n,s,p){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=p===void 0||p,this._minZoom=i||0,this._maxZoom=o||22,this._minPitch=n==null?0:n,this._maxPitch=s==null?60:s,this.setMaxBounds(),this.width=0,this.height=0,this._center=new u.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new vn,this._posMatrixCache={},this._alignedPosMatrixCache={}},pe={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};_e.prototype.clone=function(){var i=new _e(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.tileSize=this.tileSize,i.latRange=this.latRange,i.width=this.width,i.height=this.height,i._center=this._center,i.zoom=this.zoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._calcMatrices(),i},pe.minZoom.get=function(){return this._minZoom},pe.minZoom.set=function(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))},pe.maxZoom.get=function(){return this._maxZoom},pe.maxZoom.set=function(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))},pe.minPitch.get=function(){return this._minPitch},pe.minPitch.set=function(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))},pe.maxPitch.get=function(){return this._maxPitch},pe.maxPitch.set=function(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))},pe.renderWorldCopies.get=function(){return this._renderWorldCopies},pe.renderWorldCopies.set=function(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i},pe.worldSize.get=function(){return this.tileSize*this.scale},pe.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},pe.size.get=function(){return new u.Point(this.width,this.height)},pe.bearing.get=function(){return-this.angle/Math.PI*180},pe.bearing.set=function(i){var o=-u.wrap(i,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=u.create$2(),u.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},pe.pitch.get=function(){return this._pitch/Math.PI*180},pe.pitch.set=function(i){var o=u.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())},pe.fov.get=function(){return this._fov/Math.PI*180},pe.fov.set=function(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())},pe.zoom.get=function(){return this._zoom},pe.zoom.set=function(i){var o=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom,this._constrain(),this._calcMatrices())},pe.center.get=function(){return this._center},pe.center.set=function(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())},pe.padding.get=function(){return this._edgeInsets.toJSON()},pe.padding.set=function(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())},pe.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},_e.prototype.isPaddingEqual=function(i){return this._edgeInsets.equals(i)},_e.prototype.interpolatePadding=function(i,o,n){this._unmodified=!1,this._edgeInsets.interpolate(i,o,n),this._constrain(),this._calcMatrices()},_e.prototype.coveringZoomLevel=function(i){var o=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,o)},_e.prototype.getVisibleUnwrappedCoordinates=function(i){var o=[new u.UnwrappedTileID(0,i)];if(this._renderWorldCopies)for(var n=this.pointCoordinate(new u.Point(0,0)),s=this.pointCoordinate(new u.Point(this.width,0)),p=this.pointCoordinate(new u.Point(this.width,this.height)),f=this.pointCoordinate(new u.Point(0,this.height)),d=Math.floor(Math.min(n.x,s.x,p.x,f.x)),y=Math.floor(Math.max(n.x,s.x,p.x,f.x)),_=d-1;_<=y+1;_++)_!==0&&o.push(new u.UnwrappedTileID(_,i));return o},_e.prototype.coveringTiles=function(i){var o=this.coveringZoomLevel(i),n=o;if(i.minzoom!==void 0&&o<i.minzoom)return[];i.maxzoom!==void 0&&o>i.maxzoom&&(o=i.maxzoom);var s=u.MercatorCoordinate.fromLngLat(this.center),p=Math.pow(2,o),f=[p*s.x,p*s.y,0],d=Wa.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o),y=i.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(y=o);var _=function(yt){return{aabb:new Hn([yt*p,0,0],[(yt+1)*p,p,0]),zoom:0,x:0,y:0,wrap:yt,fullyVisible:!1}},S=[],P=[],k=o,z=i.reparseOverscaled?n:o;if(this._renderWorldCopies)for(var U=1;U<=3;U++)S.push(_(-U)),S.push(_(U));for(S.push(_(0));S.length>0;){var O=S.pop(),G=O.x,B=O.y,Z=O.fullyVisible;if(!Z){var H=O.aabb.intersects(d);if(H===0)continue;Z=H===2}var Q=O.aabb.distanceX(f),at=O.aabb.distanceY(f),nt=Math.max(Math.abs(Q),Math.abs(at));if(O.zoom===k||nt>3+(1<<k-O.zoom)-2&&O.zoom>=y)P.push({tileID:new u.OverscaledTileID(O.zoom===k?z:O.zoom,O.wrap,O.zoom,G,B),distanceSq:u.sqrLen([f[0]-.5-G,f[1]-.5-B])});else for(var lt=0;lt<4;lt++){var ct=(G<<1)+lt%2,_t=(B<<1)+(lt>>1);S.push({aabb:O.aabb.quadrant(lt),zoom:O.zoom+1,x:ct,y:_t,wrap:O.wrap,fullyVisible:Z})}}return P.sort(function(yt,Et){return yt.distanceSq-Et.distanceSq}).map(function(yt){return yt.tileID})},_e.prototype.resize=function(i,o){this.width=i,this.height=o,this.pixelsToGLUnits=[2/i,-2/o],this._constrain(),this._calcMatrices()},pe.unmodified.get=function(){return this._unmodified},_e.prototype.zoomScale=function(i){return Math.pow(2,i)},_e.prototype.scaleZoom=function(i){return Math.log(i)/Math.LN2},_e.prototype.project=function(i){var o=u.clamp(i.lat,-this.maxValidLatitude,this.maxValidLatitude);return new u.Point(u.mercatorXfromLng(i.lng)*this.worldSize,u.mercatorYfromLat(o)*this.worldSize)},_e.prototype.unproject=function(i){return new u.MercatorCoordinate(i.x/this.worldSize,i.y/this.worldSize).toLngLat()},pe.point.get=function(){return this.project(this.center)},_e.prototype.setLocationAtPoint=function(i,o){var n=this.pointCoordinate(o),s=this.pointCoordinate(this.centerPoint),p=this.locationCoordinate(i),f=new u.MercatorCoordinate(p.x-(n.x-s.x),p.y-(n.y-s.y));this.center=this.coordinateLocation(f),this._renderWorldCopies&&(this.center=this.center.wrap())},_e.prototype.locationPoint=function(i){return this.coordinatePoint(this.locationCoordinate(i))},_e.prototype.pointLocation=function(i){return this.coordinateLocation(this.pointCoordinate(i))},_e.prototype.locationCoordinate=function(i){return u.MercatorCoordinate.fromLngLat(i)},_e.prototype.coordinateLocation=function(i){return i.toLngLat()},_e.prototype.pointCoordinate=function(i){var o=[i.x,i.y,0,1],n=[i.x,i.y,1,1];u.transformMat4(o,o,this.pixelMatrixInverse),u.transformMat4(n,n,this.pixelMatrixInverse);var s=o[3],p=n[3],f=o[1]/s,d=n[1]/p,y=o[2]/s,_=n[2]/p,S=y===_?0:(0-y)/(_-y);return new u.MercatorCoordinate(u.number(o[0]/s,n[0]/p,S)/this.worldSize,u.number(f,d,S)/this.worldSize)},_e.prototype.coordinatePoint=function(i){var o=[i.x*this.worldSize,i.y*this.worldSize,0,1];return u.transformMat4(o,o,this.pixelMatrix),new u.Point(o[0]/o[3],o[1]/o[3])},_e.prototype.getBounds=function(){return new u.LngLatBounds().extend(this.pointLocation(new u.Point(0,0))).extend(this.pointLocation(new u.Point(this.width,0))).extend(this.pointLocation(new u.Point(this.width,this.height))).extend(this.pointLocation(new u.Point(0,this.height)))},_e.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new u.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},_e.prototype.setMaxBounds=function(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},_e.prototype.calculatePosMatrix=function(i,o){o===void 0&&(o=!1);var n=i.key,s=o?this._alignedPosMatrixCache:this._posMatrixCache;if(s[n])return s[n];var p=i.canonical,f=this.worldSize/this.zoomScale(p.z),d=p.x+Math.pow(2,p.z)*i.wrap,y=u.identity(new Float64Array(16));return u.translate(y,y,[d*f,p.y*f,0]),u.scale(y,y,[f/u.EXTENT,f/u.EXTENT,1]),u.multiply(y,o?this.alignedProjMatrix:this.projMatrix,y),s[n]=new Float32Array(y),s[n]},_e.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},_e.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var i,o,n,s,p=-90,f=90,d=-180,y=180,_=this.size,S=this._unmodified;if(this.latRange){var P=this.latRange;p=u.mercatorYfromLat(P[1])*this.worldSize,i=(f=u.mercatorYfromLat(P[0])*this.worldSize)-p<_.y?_.y/(f-p):0}if(this.lngRange){var k=this.lngRange;d=u.mercatorXfromLng(k[0])*this.worldSize,o=(y=u.mercatorXfromLng(k[1])*this.worldSize)-d<_.x?_.x/(y-d):0}var z=this.point,U=Math.max(o||0,i||0);if(U)return this.center=this.unproject(new u.Point(o?(y+d)/2:z.x,i?(f+p)/2:z.y)),this.zoom+=this.scaleZoom(U),this._unmodified=S,void(this._constraining=!1);if(this.latRange){var O=z.y,G=_.y/2;O-G<p&&(s=p+G),O+G>f&&(s=f-G)}if(this.lngRange){var B=z.x,Z=_.x/2;B-Z<d&&(n=d+Z),B+Z>y&&(n=y-Z)}n===void 0&&s===void 0||(this.center=this.unproject(new u.Point(n!==void 0?n:z.x,s!==void 0?s:z.y))),this._unmodified=S,this._constraining=!1}},_e.prototype._calcMatrices=function(){if(this.height){var i=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var o=Math.PI/2+this._pitch,n=this._fov*(.5+i.y/this.height),s=Math.sin(n)*this.cameraToCenterDistance/Math.sin(u.clamp(Math.PI-o-n,.01,Math.PI-.01)),p=this.point,f=p.x,d=p.y,y=1.01*(Math.cos(Math.PI/2-this._pitch)*s+this.cameraToCenterDistance),_=this.height/50,S=new Float64Array(16);u.perspective(S,this._fov,this.width/this.height,_,y),S[8]=2*-i.x/this.width,S[9]=2*i.y/this.height,u.scale(S,S,[1,-1,1]),u.translate(S,S,[0,0,-this.cameraToCenterDistance]),u.rotateX(S,S,this._pitch),u.rotateZ(S,S,this.angle),u.translate(S,S,[-f,-d,0]),this.mercatorMatrix=u.scale([],S,[this.worldSize,this.worldSize,this.worldSize]),u.scale(S,S,[1,1,u.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=S,this.invProjMatrix=u.invert([],this.projMatrix);var P=this.width%2/2,k=this.height%2/2,z=Math.cos(this.angle),U=Math.sin(this.angle),O=f-Math.round(f)+z*P+U*k,G=d-Math.round(d)+z*k+U*P,B=new Float64Array(S);if(u.translate(B,B,[O>.5?O-1:O,G>.5?G-1:G,0]),this.alignedProjMatrix=B,S=u.create(),u.scale(S,S,[this.width/2,-this.height/2,1]),u.translate(S,S,[1,-1,0]),this.labelPlaneMatrix=S,S=u.create(),u.scale(S,S,[1,-1,1]),u.translate(S,S,[-1,-1,0]),u.scale(S,S,[2/this.width,2/this.height,1]),this.glCoordMatrix=S,this.pixelMatrix=u.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(S=u.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=S,this._posMatrixCache={},this._alignedPosMatrixCache={}}},_e.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var i=this.pointCoordinate(new u.Point(0,0)),o=[i.x*this.worldSize,i.y*this.worldSize,0,1];return u.transformMat4(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance},_e.prototype.getCameraPoint=function(){var i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.Point(0,i))},_e.prototype.getCameraQueryGeometry=function(i){var o=this.getCameraPoint();if(i.length===1)return[i[0],o];for(var n=o.x,s=o.y,p=o.x,f=o.y,d=0,y=i;d<y.length;d+=1){var _=y[d];n=Math.min(n,_.x),s=Math.min(s,_.y),p=Math.max(p,_.x),f=Math.max(f,_.y)}return[new u.Point(n,s),new u.Point(p,s),new u.Point(p,f),new u.Point(n,f),new u.Point(n,s)]},Object.defineProperties(_e.prototype,pe);var Jn=function(i){var o,n,s,p;this._hashName=i&&encodeURIComponent(i),u.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(o=this._updateHashUnthrottled.bind(this),n=!1,s=null,p=function(){s=null,n&&(o(),s=setTimeout(p,300),n=!1)},function(){return n=!0,s||p(),s})};Jn.prototype.addTo=function(i){return this._map=i,u.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Jn.prototype.remove=function(){return u.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Jn.prototype.getHashString=function(i){var o=this._map.getCenter(),n=Math.round(100*this._map.getZoom())/100,s=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,s),f=Math.round(o.lng*p)/p,d=Math.round(o.lat*p)/p,y=this._map.getBearing(),_=this._map.getPitch(),S="";if(S+=i?"/"+f+"/"+d+"/"+n:n+"/"+d+"/"+f,(y||_)&&(S+="/"+Math.round(10*y)/10),_&&(S+="/"+Math.round(_)),this._hashName){var P=this._hashName,k=!1,z=u.window.location.hash.slice(1).split("&").map(function(U){var O=U.split("=")[0];return O===P?(k=!0,O+"="+S):U}).filter(function(U){return U});return k||z.push(P+"="+S),"#"+z.join("&")}return"#"+S},Jn.prototype._getCurrentHash=function(){var i,o=this,n=u.window.location.hash.replace("#","");return this._hashName?(n.split("&").map(function(s){return s.split("=")}).forEach(function(s){s[0]===o._hashName&&(i=s)}),(i&&i[1]||"").split("/")):n.split("/")},Jn.prototype._onHashChange=function(){var i=this._getCurrentHash();if(i.length>=3&&!i.some(function(n){return isNaN(n)})){var o=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:o,pitch:+(i[4]||0)}),!0}return!1},Jn.prototype._updateHashUnthrottled=function(){var i=u.window.location.href.replace(/(#.+)?$/,this.getHashString());try{u.window.history.replaceState(u.window.history.state,null,i)}catch{}};var Oi={linearity:.3,easing:u.bezier(0,0,.3,1)},nu=u.extend({deceleration:2500,maxSpeed:1400},Oi),zo=u.extend({deceleration:20,maxSpeed:1400},Oi),ea=u.extend({deceleration:1e3,maxSpeed:360},Oi),rc=u.extend({deceleration:1e3,maxSpeed:90},Oi),ra=function(i){this._map=i,this.clear()};function Ka(i,o){(!i.duration||i.duration<o.duration)&&(i.duration=o.duration,i.easing=o.easing)}function ia(i,o,n){var s=n.maxSpeed,p=n.linearity,f=n.deceleration,d=u.clamp(i*p/(o/1e3),-s,s),y=Math.abs(d)/(f*p);return{easing:n.easing,duration:1e3*y,amount:d*(y/2)}}ra.prototype.clear=function(){this._inertiaBuffer=[]},ra.prototype.record=function(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:u.browser.now(),settings:i})},ra.prototype._drainInertiaBuffer=function(){for(var i=this._inertiaBuffer,o=u.browser.now();i.length>0&&o-i[0].time>160;)i.shift()},ra.prototype._onMoveEnd=function(i){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var o={zoom:0,bearing:0,pitch:0,pan:new u.Point(0,0),pinchAround:void 0,around:void 0},n=0,s=this._inertiaBuffer;n<s.length;n+=1){var p=s[n].settings;o.zoom+=p.zoomDelta||0,o.bearing+=p.bearingDelta||0,o.pitch+=p.pitchDelta||0,p.panDelta&&o.pan._add(p.panDelta),p.around&&(o.around=p.around),p.pinchAround&&(o.pinchAround=p.pinchAround)}var f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(o.pan.mag()){var y=ia(o.pan.mag(),f,u.extend({},nu,i||{}));d.offset=o.pan.mult(y.amount/o.pan.mag()),d.center=this._map.transform.center,Ka(d,y)}if(o.zoom){var _=ia(o.zoom,f,zo);d.zoom=this._map.transform.zoom+_.amount,Ka(d,_)}if(o.bearing){var S=ia(o.bearing,f,ea);d.bearing=this._map.transform.bearing+u.clamp(S.amount,-179,179),Ka(d,S)}if(o.pitch){var P=ia(o.pitch,f,rc);d.pitch=this._map.transform.pitch+P.amount,Ka(d,P)}if(d.zoom||d.bearing){var k=o.pinchAround===void 0?o.around:o.pinchAround;d.around=k?this._map.unproject(k):this._map.getCenter()}return this.clear(),u.extend(d,{noMoveStart:!0})}};var Er=function(i){function o(s,p,f,d){d===void 0&&(d={});var y=st.mousePos(p.getCanvasContainer(),f),_=p.unproject(y);i.call(this,s,u.extend({point:y,lngLat:_,originalEvent:f},d)),this._defaultPrevented=!1,this.target=p}i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o;var n={defaultPrevented:{configurable:!0}};return o.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(o.prototype,n),o}(u.Event),ni=function(i){function o(s,p,f){var d=s==="touchend"?f.changedTouches:f.touches,y=st.touchPos(p.getCanvasContainer(),d),_=y.map(function(k){return p.unproject(k)}),S=y.reduce(function(k,z,U,O){return k.add(z.div(O.length))},new u.Point(0,0)),P=p.unproject(S);i.call(this,s,{points:y,point:S,lngLats:_,lngLat:P,originalEvent:f}),this._defaultPrevented=!1}i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o;var n={defaultPrevented:{configurable:!0}};return o.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(o.prototype,n),o}(u.Event),ou=function(i){function o(s,p,f){i.call(this,s,{originalEvent:f}),this._defaultPrevented=!1}i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o;var n={defaultPrevented:{configurable:!0}};return o.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(o.prototype,n),o}(u.Event),vr=function(i,o){this._map=i,this._clickTolerance=o.clickTolerance};vr.prototype.reset=function(){delete this._mousedownPos},vr.prototype.wheel=function(i){return this._firePreventable(new ou(i.type,this._map,i))},vr.prototype.mousedown=function(i,o){return this._mousedownPos=o,this._firePreventable(new Er(i.type,this._map,i))},vr.prototype.mouseup=function(i){this._map.fire(new Er(i.type,this._map,i))},vr.prototype.click=function(i,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new Er(i.type,this._map,i))},vr.prototype.dblclick=function(i){return this._firePreventable(new Er(i.type,this._map,i))},vr.prototype.mouseover=function(i){this._map.fire(new Er(i.type,this._map,i))},vr.prototype.mouseout=function(i){this._map.fire(new Er(i.type,this._map,i))},vr.prototype.touchstart=function(i){return this._firePreventable(new ni(i.type,this._map,i))},vr.prototype.touchmove=function(i){this._map.fire(new ni(i.type,this._map,i))},vr.prototype.touchend=function(i){this._map.fire(new ni(i.type,this._map,i))},vr.prototype.touchcancel=function(i){this._map.fire(new ni(i.type,this._map,i))},vr.prototype._firePreventable=function(i){if(this._map.fire(i),i.defaultPrevented)return{}},vr.prototype.isEnabled=function(){return!0},vr.prototype.isActive=function(){return!1},vr.prototype.enable=function(){},vr.prototype.disable=function(){};var Jr=function(i){this._map=i};Jr.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Jr.prototype.mousemove=function(i){this._map.fire(new Er(i.type,this._map,i))},Jr.prototype.mousedown=function(){this._delayContextMenu=!0},Jr.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Er("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Jr.prototype.contextmenu=function(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Er(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()},Jr.prototype.isEnabled=function(){return!0},Jr.prototype.isActive=function(){return!1},Jr.prototype.enable=function(){},Jr.prototype.disable=function(){};var Pt=function(i,o){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=o.clickTolerance||1};function na(i,o){for(var n={},s=0;s<i.length;s++)n[i[s].identifier]=o[s];return n}Pt.prototype.isEnabled=function(){return!!this._enabled},Pt.prototype.isActive=function(){return!!this._active},Pt.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Pt.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Pt.prototype.mousedown=function(i,o){this.isEnabled()&&i.shiftKey&&i.button===0&&(st.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)},Pt.prototype.mousemoveWindow=function(i,o){if(this._active){var n=o;if(!(this._lastPos.equals(n)||!this._box&&n.dist(this._startPos)<this._clickTolerance)){var s=this._startPos;this._lastPos=n,this._box||(this._box=st.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));var p=Math.min(s.x,n.x),f=Math.max(s.x,n.x),d=Math.min(s.y,n.y),y=Math.max(s.y,n.y);st.setTransform(this._box,"translate("+p+"px,"+d+"px)"),this._box.style.width=f-p+"px",this._box.style.height=y-d+"px"}}},Pt.prototype.mouseupWindow=function(i,o){var n=this;if(this._active&&i.button===0){var s=this._startPos,p=o;if(this.reset(),st.suppressClick(),s.x!==p.x||s.y!==p.y)return this._map.fire(new u.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:function(f){return f.fitScreenCoordinates(s,p,n._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",i)}},Pt.prototype.keydown=function(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))},Pt.prototype.reset=function(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(st.remove(this._box),this._box=null),st.enableDrag(),delete this._startPos,delete this._lastPos},Pt.prototype._fireEvent=function(i,o){return this._map.fire(new u.Event(i,{originalEvent:o}))};var ko=function(i){this.reset(),this.numTouches=i.numTouches};ko.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},ko.prototype.touchstart=function(i,o,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),n.length===this.numTouches&&(this.centroid=function(s){for(var p=new u.Point(0,0),f=0,d=s;f<d.length;f+=1)p._add(d[f]);return p.div(s.length)}(o),this.touches=na(n,o)))},ko.prototype.touchmove=function(i,o,n){if(!this.aborted&&this.centroid){var s=na(n,o);for(var p in this.touches){var f=s[p];(!f||f.dist(this.touches[p])>30)&&(this.aborted=!0)}}},ko.prototype.touchend=function(i,o,n){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),n.length===0){var s=!this.aborted&&this.centroid;if(this.reset(),s)return s}};var _n=function(i){this.singleTap=new ko(i),this.numTaps=i.numTaps,this.reset()};_n.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},_n.prototype.touchstart=function(i,o,n){this.singleTap.touchstart(i,o,n)},_n.prototype.touchmove=function(i,o,n){this.singleTap.touchmove(i,o,n)},_n.prototype.touchend=function(i,o,n){var s=this.singleTap.touchend(i,o,n);if(s){var p=i.timeStamp-this.lastTime<500,f=!this.lastTap||this.lastTap.dist(s)<30;if(p&&f||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=s,this.count===this.numTaps)return this.reset(),s}};var Yr=function(){this._zoomIn=new _n({numTouches:1,numTaps:2}),this._zoomOut=new _n({numTouches:2,numTaps:1}),this.reset()};Yr.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Yr.prototype.touchstart=function(i,o,n){this._zoomIn.touchstart(i,o,n),this._zoomOut.touchstart(i,o,n)},Yr.prototype.touchmove=function(i,o,n){this._zoomIn.touchmove(i,o,n),this._zoomOut.touchmove(i,o,n)},Yr.prototype.touchend=function(i,o,n){var s=this,p=this._zoomIn.touchend(i,o,n),f=this._zoomOut.touchend(i,o,n);return p?(this._active=!0,i.preventDefault(),setTimeout(function(){return s.reset()},0),{cameraAnimation:function(d){return d.easeTo({duration:300,zoom:d.getZoom()+1,around:d.unproject(p)},{originalEvent:i})}}):f?(this._active=!0,i.preventDefault(),setTimeout(function(){return s.reset()},0),{cameraAnimation:function(d){return d.easeTo({duration:300,zoom:d.getZoom()-1,around:d.unproject(f)},{originalEvent:i})}}):void 0},Yr.prototype.touchcancel=function(){this.reset()},Yr.prototype.enable=function(){this._enabled=!0},Yr.prototype.disable=function(){this._enabled=!1,this.reset()},Yr.prototype.isEnabled=function(){return this._enabled},Yr.prototype.isActive=function(){return this._active};var oa={0:1,2:2},qr=function(i){this.reset(),this._clickTolerance=i.clickTolerance||1};qr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},qr.prototype._correctButton=function(i,o){return!1},qr.prototype._move=function(i,o){return{}},qr.prototype.mousedown=function(i,o){if(!this._lastPoint){var n=st.mouseButton(i);this._correctButton(i,n)&&(this._lastPoint=o,this._eventButton=n)}},qr.prototype.mousemoveWindow=function(i,o){var n=this._lastPoint;if(n){if(i.preventDefault(),function(s,p){var f=oa[p];return s.buttons===void 0||(s.buttons&f)!==f}(i,this._eventButton))this.reset();else if(this._moved||!(o.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(n,o)}},qr.prototype.mouseupWindow=function(i){this._lastPoint&&st.mouseButton(i)===this._eventButton&&(this._moved&&st.suppressClick(),this.reset())},qr.prototype.enable=function(){this._enabled=!0},qr.prototype.disable=function(){this._enabled=!1,this.reset()},qr.prototype.isEnabled=function(){return this._enabled},qr.prototype.isActive=function(){return this._active};var kt=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.mousedown=function(n,s){i.prototype.mousedown.call(this,n,s),this._lastPoint&&(this._active=!0)},o.prototype._correctButton=function(n,s){return s===0&&!n.ctrlKey},o.prototype._move=function(n,s){return{around:s,panDelta:s.sub(n)}},o}(qr),Ha=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype._correctButton=function(n,s){return s===0&&n.ctrlKey||s===2},o.prototype._move=function(n,s){var p=.8*(s.x-n.x);if(p)return this._active=!0,{bearingDelta:p}},o.prototype.contextmenu=function(n){n.preventDefault()},o}(qr),Ja=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype._correctButton=function(n,s){return s===0&&n.ctrlKey||s===2},o.prototype._move=function(n,s){var p=-.5*(s.y-n.y);if(p)return this._active=!0,{pitchDelta:p}},o.prototype.contextmenu=function(n){n.preventDefault()},o}(qr),gi=function(i){this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset()};gi.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new u.Point(0,0)},gi.prototype.touchstart=function(i,o,n){return this._calculateTransform(i,o,n)},gi.prototype.touchmove=function(i,o,n){if(this._active&&!(n.length<this._minTouches))return i.preventDefault(),this._calculateTransform(i,o,n)},gi.prototype.touchend=function(i,o,n){this._calculateTransform(i,o,n),this._active&&n.length<this._minTouches&&this.reset()},gi.prototype.touchcancel=function(){this.reset()},gi.prototype._calculateTransform=function(i,o,n){n.length>0&&(this._active=!0);var s=na(n,o),p=new u.Point(0,0),f=new u.Point(0,0),d=0;for(var y in s){var _=s[y],S=this._touches[y];S&&(p._add(_),f._add(_.sub(S)),d++,s[y]=_)}if(this._touches=s,!(d<this._minTouches)&&f.mag()){var P=f.div(d);if(this._sum._add(P),!(this._sum.mag()<this._clickTolerance))return{around:p.div(d),panDelta:P}}},gi.prototype.enable=function(){this._enabled=!0},gi.prototype.disable=function(){this._enabled=!1,this.reset()},gi.prototype.isEnabled=function(){return this._enabled},gi.prototype.isActive=function(){return this._active};var Zr=function(){this.reset()};function Ya(i,o,n){for(var s=0;s<i.length;s++)if(i[s].identifier===n)return o[s]}function au(i,o){return Math.log(i/o)/Math.LN2}Zr.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Zr.prototype._start=function(i){},Zr.prototype._move=function(i,o,n){return{}},Zr.prototype.touchstart=function(i,o,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([o[0],o[1]]))},Zr.prototype.touchmove=function(i,o,n){if(this._firstTwoTouches){i.preventDefault();var s=this._firstTwoTouches,p=s[1],f=Ya(n,o,s[0]),d=Ya(n,o,p);if(f&&d){var y=this._aroundCenter?null:f.add(d).div(2);return this._move([f,d],y,i)}}},Zr.prototype.touchend=function(i,o,n){if(this._firstTwoTouches){var s=this._firstTwoTouches,p=s[1],f=Ya(n,o,s[0]),d=Ya(n,o,p);f&&d||(this._active&&st.suppressClick(),this.reset())}},Zr.prototype.touchcancel=function(){this.reset()},Zr.prototype.enable=function(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"},Zr.prototype.disable=function(){this._enabled=!1,this.reset()},Zr.prototype.isEnabled=function(){return this._enabled},Zr.prototype.isActive=function(){return this._active};var $s=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.reset=function(){i.prototype.reset.call(this),delete this._distance,delete this._startDistance},o.prototype._start=function(n){this._startDistance=this._distance=n[0].dist(n[1])},o.prototype._move=function(n,s){var p=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(au(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:au(this._distance,p),pinchAround:s}},o}(Zr);function Gr(i,o){return 180*i.angleWith(o)/Math.PI}var xn=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.reset=function(){i.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},o.prototype._start=function(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])},o.prototype._move=function(n,s){var p=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Gr(this._vector,p),pinchAround:s}},o.prototype._isBelowThreshold=function(n){this._minDiameter=Math.min(this._minDiameter,n.mag());var s=25/(Math.PI*this._minDiameter)*360,p=Gr(n,this._startVector);return Math.abs(p)<s},o}(Zr);function Qa(i){return Math.abs(i.y)>Math.abs(i.x)}var tl=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.reset=function(){i.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},o.prototype._start=function(n){this._lastPoints=n,Qa(n[0].sub(n[1]))&&(this._valid=!1)},o.prototype._move=function(n,s,p){var f=n[0].sub(this._lastPoints[0]),d=n[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(f,d,p.timeStamp),this._valid)return this._lastPoints=n,this._active=!0,{pitchDelta:(f.y+d.y)/2*-.5}},o.prototype.gestureBeginsVertically=function(n,s,p){if(this._valid!==void 0)return this._valid;var f=n.mag()>=2,d=s.mag()>=2;if(f||d){if(!f||!d)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;var y=n.y>0==s.y>0;return Qa(n)&&Qa(s)&&y}},o}(Zr),el={panStep:100,bearingStep:15,pitchStep:10},Mi=function(){var i=el;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1};function su(i){return i*(2-i)}Mi.prototype.reset=function(){this._active=!1},Mi.prototype.keydown=function(i){var o=this;if(!(i.altKey||i.ctrlKey||i.metaKey)){var n=0,s=0,p=0,f=0,d=0;switch(i.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:i.shiftKey?s=-1:(i.preventDefault(),f=-1);break;case 39:i.shiftKey?s=1:(i.preventDefault(),f=1);break;case 38:i.shiftKey?p=1:(i.preventDefault(),d=-1);break;case 40:i.shiftKey?p=-1:(i.preventDefault(),d=1);break;default:return}return this._rotationDisabled&&(s=0,p=0),{cameraAnimation:function(y){var _=y.getZoom();y.easeTo({duration:300,easeId:"keyboardHandler",easing:su,zoom:n?Math.round(_)+n*(i.shiftKey?2:1):_,bearing:y.getBearing()+s*o._bearingStep,pitch:y.getPitch()+p*o._pitchStep,offset:[-f*o._panStep,-d*o._panStep],center:y.getCenter()},{originalEvent:i})}}}},Mi.prototype.enable=function(){this._enabled=!0},Mi.prototype.disable=function(){this._enabled=!1,this.reset()},Mi.prototype.isEnabled=function(){return this._enabled},Mi.prototype.isActive=function(){return this._active},Mi.prototype.disableRotation=function(){this._rotationDisabled=!0},Mi.prototype.enableRotation=function(){this._rotationDisabled=!1};var Ue=function(i,o){this._map=i,this._el=i.getCanvasContainer(),this._handler=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,u.bindAll(["_onTimeout"],this)};Ue.prototype.setZoomRate=function(i){this._defaultZoomRate=i},Ue.prototype.setWheelZoomRate=function(i){this._wheelZoomRate=i},Ue.prototype.isEnabled=function(){return!!this._enabled},Ue.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Ue.prototype.isZooming=function(){return!!this._zooming},Ue.prototype.enable=function(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=i&&i.around==="center")},Ue.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ue.prototype.wheel=function(i){if(this.isEnabled()){var o=i.deltaMode===u.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY,n=u.browser.now(),s=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,o!==0&&o%4.000244140625==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":s>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(s*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),i.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=i,this._delta-=o,this._active||this._start(i)),i.preventDefault()}},Ue.prototype._onTimeout=function(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)},Ue.prototype._start=function(i){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var o=st.mousePos(this._el,i);this._around=u.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(o)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Ue.prototype.renderFrame=function(){var i=this;if(this._frameId&&(this._frameId=null,this.isActive())){var o=this._map.transform;if(this._delta!==0){var n=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,s=2/(1+Math.exp(-Math.abs(this._delta*n)));this._delta<0&&s!==0&&(s=1/s);var p=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(p*s))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var f,d=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,y=this._startZoom,_=this._easing,S=!1;if(this._type==="wheel"&&y&&_){var P=Math.min((u.browser.now()-this._lastWheelEventTime)/200,1),k=_(P);f=u.number(y,d,k),P<1?this._frameId||(this._frameId=!0):S=!0}else f=d,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(function(){i._zooming=!1,i._handler._triggerRenderFrame(),delete i._targetZoom,delete i._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:f-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Ue.prototype._smoothOutEasing=function(i){var o=u.ease;if(this._prevEase){var n=this._prevEase,s=(u.browser.now()-n.start)/n.duration,p=n.easing(s+.01)-n.easing(s),f=.27/Math.sqrt(p*p+1e-4)*.01,d=Math.sqrt(.0729-f*f);o=u.bezier(f,d,.25,1)}return this._prevEase={start:u.browser.now(),duration:i,easing:o},o},Ue.prototype.reset=function(){this._active=!1};var ye=function(i,o){this._clickZoom=i,this._tapZoom=o};ye.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},ye.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},ye.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},ye.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var vi=function(){this.reset()};vi.prototype.reset=function(){this._active=!1},vi.prototype.dblclick=function(i,o){return i.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(i.shiftKey?-1:1),around:n.unproject(o)},{originalEvent:i})}}},vi.prototype.enable=function(){this._enabled=!0},vi.prototype.disable=function(){this._enabled=!1,this.reset()},vi.prototype.isEnabled=function(){return this._enabled},vi.prototype.isActive=function(){return this._active};var Qr=function(){this._tap=new _n({numTouches:1,numTaps:1}),this.reset()};Qr.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Qr.prototype.touchstart=function(i,o,n){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=o[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(i,o,n))},Qr.prototype.touchmove=function(i,o,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;var s=o[0],p=s.y-this._swipePoint.y;return this._swipePoint=s,i.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(i,o,n)},Qr.prototype.touchend=function(i,o,n){this._tapTime?this._swipePoint&&n.length===0&&this.reset():this._tap.touchend(i,o,n)&&(this._tapTime=i.timeStamp)},Qr.prototype.touchcancel=function(){this.reset()},Qr.prototype.enable=function(){this._enabled=!0},Qr.prototype.disable=function(){this._enabled=!1,this.reset()},Qr.prototype.isEnabled=function(){return this._enabled},Qr.prototype.isActive=function(){return this._active};var oi=function(i,o,n){this._el=i,this._mousePan=o,this._touchPan=n};oi.prototype.enable=function(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")},oi.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")},oi.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},oi.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Yn=function(i,o,n){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=o,this._mousePitch=n};Yn.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Yn.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Yn.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Yn.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Fi=function(i,o,n,s){this._el=i,this._touchZoom=o,this._touchRotate=n,this._tapDragZoom=s,this._rotationDisabled=!1,this._enabled=!0};Fi.prototype.enable=function(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")},Fi.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")},Fi.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Fi.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Fi.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Fi.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var bn=function(i){return i.zoom||i.drag||i.pitch||i.rotate},ai=function(i){function o(){i.apply(this,arguments)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o}(u.Event);function Qn(i){return i.panDelta&&i.panDelta.mag()||i.zoomDelta||i.bearingDelta||i.pitchDelta}var It=function(i,o){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ra(i),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o),u.bindAll(["handleEvent","handleWindowEvent"],this);var n=this._el;this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[u.window.document,"mousemove",{capture:!0}],[u.window.document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[u.window,"blur",void 0]];for(var s=0,p=this._listeners;s<p.length;s+=1){var f=p[s],d=f[0];st.addEventListener(d,f[1],d===u.window.document?this.handleWindowEvent:this.handleEvent,f[2])}};It.prototype.destroy=function(){for(var i=0,o=this._listeners;i<o.length;i+=1){var n=o[i],s=n[0];st.removeEventListener(s,n[1],s===u.window.document?this.handleWindowEvent:this.handleEvent,n[2])}},It.prototype._addDefaultHandlers=function(i){var o=this._map,n=o.getCanvasContainer();this._add("mapEvent",new vr(o,i));var s=o.boxZoom=new Pt(o,i);this._add("boxZoom",s);var p=new Yr,f=new vi;o.doubleClickZoom=new ye(f,p),this._add("tapZoom",p),this._add("clickZoom",f);var d=new Qr;this._add("tapDragZoom",d);var y=o.touchPitch=new tl;this._add("touchPitch",y);var _=new Ha(i),S=new Ja(i);o.dragRotate=new Yn(i,_,S),this._add("mouseRotate",_,["mousePitch"]),this._add("mousePitch",S,["mouseRotate"]);var P=new kt(i),k=new gi(i);o.dragPan=new oi(n,P,k),this._add("mousePan",P),this._add("touchPan",k,["touchZoom","touchRotate"]);var z=new xn,U=new $s;o.touchZoomRotate=new Fi(n,U,z,d),this._add("touchRotate",z,["touchPan","touchZoom"]),this._add("touchZoom",U,["touchPan","touchRotate"]);var O=o.scrollZoom=new Ue(o,this);this._add("scrollZoom",O,["mousePan"]);var G=o.keyboard=new Mi;this._add("keyboard",G),this._add("blockableMapEvent",new Jr(o));for(var B=0,Z=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];B<Z.length;B+=1){var H=Z[B];i.interactive&&i[H]&&o[H].enable(i[H])}},It.prototype._add=function(i,o,n){this._handlers.push({handlerName:i,handler:o,allowed:n}),this._handlersById[i]=o},It.prototype.stop=function(i){if(!this._updatingCamera){for(var o=0,n=this._handlers;o<n.length;o+=1)n[o].handler.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}},It.prototype.isActive=function(){for(var i=0,o=this._handlers;i<o.length;i+=1)if(o[i].handler.isActive())return!0;return!1},It.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},It.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},It.prototype.isMoving=function(){return Boolean(bn(this._eventsInProgress))||this.isZooming()},It.prototype._blockedByActive=function(i,o,n){for(var s in i)if(s!==n&&(!o||o.indexOf(s)<0))return!0;return!1},It.prototype.handleWindowEvent=function(i){this.handleEvent(i,i.type+"Window")},It.prototype._getMapTouches=function(i){for(var o=[],n=0,s=i;n<s.length;n+=1){var p=s[n];this._el.contains(p.target)&&o.push(p)}return o},It.prototype.handleEvent=function(i,o){if(i.type!=="blur"){this._updatingCamera=!0;for(var n=i.type==="renderFrame"?void 0:i,s={needsRenderFrame:!1},p={},f={},d=i.touches?this._getMapTouches(i.touches):void 0,y=d?st.touchPos(this._el,d):st.mousePos(this._el,i),_=0,S=this._handlers;_<S.length;_+=1){var P=S[_],k=P.handlerName,z=P.handler,U=P.allowed;if(z.isEnabled()){var O=void 0;this._blockedByActive(f,U,k)?z.reset():z[o||i.type]&&(O=z[o||i.type](i,y,d),this.mergeHandlerResult(s,p,O,k,n),O&&O.needsRenderFrame&&this._triggerRenderFrame()),(O||z.isActive())&&(f[k]=z)}}var G={};for(var B in this._previousActiveHandlers)f[B]||(G[B]=n);this._previousActiveHandlers=f,(Object.keys(G).length||Qn(s))&&(this._changes.push([s,p,G]),this._triggerRenderFrame()),(Object.keys(f).length||Qn(s))&&this._map._stop(!0),this._updatingCamera=!1;var Z=s.cameraAnimation;Z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Z(this._map))}else this.stop(!0)},It.prototype.mergeHandlerResult=function(i,o,n,s,p){if(n){u.extend(i,n);var f={handlerName:s,originalEvent:n.originalEvent||p};n.zoomDelta!==void 0&&(o.zoom=f),n.panDelta!==void 0&&(o.drag=f),n.pitchDelta!==void 0&&(o.pitch=f),n.bearingDelta!==void 0&&(o.rotate=f)}},It.prototype._applyChanges=function(){for(var i={},o={},n={},s=0,p=this._changes;s<p.length;s+=1){var f=p[s],d=f[0],y=f[1],_=f[2];d.panDelta&&(i.panDelta=(i.panDelta||new u.Point(0,0))._add(d.panDelta)),d.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+d.pitchDelta),d.around!==void 0&&(i.around=d.around),d.pinchAround!==void 0&&(i.pinchAround=d.pinchAround),d.noInertia&&(i.noInertia=d.noInertia),u.extend(o,y),u.extend(n,_)}this._updateMapTransform(i,o,n),this._changes=[]},It.prototype._updateMapTransform=function(i,o,n){var s=this._map,p=s.transform;if(!Qn(i))return this._fireEvents(o,n,!0);var f=i.panDelta,d=i.zoomDelta,y=i.bearingDelta,_=i.pitchDelta,S=i.around,P=i.pinchAround;P!==void 0&&(S=P),s._stop(!0),S=S||s.transform.centerPoint;var k=p.pointLocation(f?S.sub(f):S);y&&(p.bearing+=y),_&&(p.pitch+=_),d&&(p.zoom+=d),p.setLocationAtPoint(k,S),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(o,n,!0)},It.prototype._fireEvents=function(i,o,n){var s=this,p=bn(this._eventsInProgress),f=bn(i),d={};for(var y in i)this._eventsInProgress[y]||(d[y+"start"]=i[y].originalEvent),this._eventsInProgress[y]=i[y];for(var _ in!p&&f&&this._fireEvent("movestart",f.originalEvent),d)this._fireEvent(_,d[_]);for(var S in f&&this._fireEvent("move",f.originalEvent),i)this._fireEvent(S,i[S].originalEvent);var P,k={};for(var z in this._eventsInProgress){var U=this._eventsInProgress[z],O=U.handlerName,G=U.originalEvent;this._handlersById[O].isActive()||(delete this._eventsInProgress[z],k[z+"end"]=P=o[O]||G)}for(var B in k)this._fireEvent(B,k[B]);var Z=bn(this._eventsInProgress);if(n&&(p||f)&&!Z){this._updatingCamera=!0;var H=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Q=function(at){return at!==0&&-s._bearingSnap<at&&at<s._bearingSnap};H?(Q(H.bearing||this._map.getBearing())&&(H.bearing=0),this._map.easeTo(H,{originalEvent:P})):(this._map.fire(new u.Event("moveend",{originalEvent:P})),Q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},It.prototype._fireEvent=function(i,o){this._map.fire(new u.Event(i,o?{originalEvent:o}:{}))},It.prototype._requestFrame=function(){var i=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(o){delete i._frameId,i.handleEvent(new ai("renderFrame",{timeStamp:o})),i._applyChanges()})},It.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Xt=function(i){function o(n,s){i.call(this),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=s.bearingSnap,u.bindAll(["_renderFrameCallback"],this)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.getCenter=function(){return new u.LngLat(this.transform.center.lng,this.transform.center.lat)},o.prototype.setCenter=function(n,s){return this.jumpTo({center:n},s)},o.prototype.panBy=function(n,s,p){return n=u.Point.convert(n).mult(-1),this.panTo(this.transform.center,u.extend({offset:n},s),p)},o.prototype.panTo=function(n,s,p){return this.easeTo(u.extend({center:n},s),p)},o.prototype.getZoom=function(){return this.transform.zoom},o.prototype.setZoom=function(n,s){return this.jumpTo({zoom:n},s),this},o.prototype.zoomTo=function(n,s,p){return this.easeTo(u.extend({zoom:n},s),p)},o.prototype.zoomIn=function(n,s){return this.zoomTo(this.getZoom()+1,n,s),this},o.prototype.zoomOut=function(n,s){return this.zoomTo(this.getZoom()-1,n,s),this},o.prototype.getBearing=function(){return this.transform.bearing},o.prototype.setBearing=function(n,s){return this.jumpTo({bearing:n},s),this},o.prototype.getPadding=function(){return this.transform.padding},o.prototype.setPadding=function(n,s){return this.jumpTo({padding:n},s),this},o.prototype.rotateTo=function(n,s,p){return this.easeTo(u.extend({bearing:n},s),p)},o.prototype.resetNorth=function(n,s){return this.rotateTo(0,u.extend({duration:1e3},n),s),this},o.prototype.resetNorthPitch=function(n,s){return this.easeTo(u.extend({bearing:0,pitch:0,duration:1e3},n),s),this},o.prototype.snapToNorth=function(n,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,s):this},o.prototype.getPitch=function(){return this.transform.pitch},o.prototype.setPitch=function(n,s){return this.jumpTo({pitch:n},s),this},o.prototype.cameraForBounds=function(n,s){n=u.LngLatBounds.convert(n);var p=s&&s.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),p,s)},o.prototype._cameraForBoxAndBearing=function(n,s,p,f){var d={top:0,bottom:0,right:0,left:0};if(typeof(f=u.extend({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},f)).padding=="number"){var y=f.padding;f.padding={top:y,bottom:y,right:y,left:y}}f.padding=u.extend(d,f.padding);var _=this.transform,S=_.padding,P=_.project(u.LngLat.convert(n)),k=_.project(u.LngLat.convert(s)),z=P.rotate(-p*Math.PI/180),U=k.rotate(-p*Math.PI/180),O=new u.Point(Math.max(z.x,U.x),Math.max(z.y,U.y)),G=new u.Point(Math.min(z.x,U.x),Math.min(z.y,U.y)),B=O.sub(G),Z=(_.width-(S.left+S.right+f.padding.left+f.padding.right))/B.x,H=(_.height-(S.top+S.bottom+f.padding.top+f.padding.bottom))/B.y;if(!(H<0||Z<0)){var Q=Math.min(_.scaleZoom(_.scale*Math.min(Z,H)),f.maxZoom),at=typeof f.offset.x=="number"?new u.Point(f.offset.x,f.offset.y):u.Point.convert(f.offset),nt=new u.Point((f.padding.left-f.padding.right)/2,(f.padding.top-f.padding.bottom)/2).rotate(p*Math.PI/180),lt=at.add(nt).mult(_.scale/_.zoomScale(Q));return{center:_.unproject(P.add(k).div(2).sub(lt)),zoom:Q,bearing:p}}u.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},o.prototype.fitBounds=function(n,s,p){return this._fitInternal(this.cameraForBounds(n,s),s,p)},o.prototype.fitScreenCoordinates=function(n,s,p,f,d){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(u.Point.convert(n)),this.transform.pointLocation(u.Point.convert(s)),p,f),f,d)},o.prototype._fitInternal=function(n,s,p){return n?(delete(s=u.extend(n,s)).padding,s.linear?this.easeTo(s,p):this.flyTo(s,p)):this},o.prototype.jumpTo=function(n,s){this.stop();var p=this.transform,f=!1,d=!1,y=!1;return"zoom"in n&&p.zoom!==+n.zoom&&(f=!0,p.zoom=+n.zoom),n.center!==void 0&&(p.center=u.LngLat.convert(n.center)),"bearing"in n&&p.bearing!==+n.bearing&&(d=!0,p.bearing=+n.bearing),"pitch"in n&&p.pitch!==+n.pitch&&(y=!0,p.pitch=+n.pitch),n.padding==null||p.isPaddingEqual(n.padding)||(p.padding=n.padding),this.fire(new u.Event("movestart",s)).fire(new u.Event("move",s)),f&&this.fire(new u.Event("zoomstart",s)).fire(new u.Event("zoom",s)).fire(new u.Event("zoomend",s)),d&&this.fire(new u.Event("rotatestart",s)).fire(new u.Event("rotate",s)).fire(new u.Event("rotateend",s)),y&&this.fire(new u.Event("pitchstart",s)).fire(new u.Event("pitch",s)).fire(new u.Event("pitchend",s)),this.fire(new u.Event("moveend",s))},o.prototype.easeTo=function(n,s){var p=this;this._stop(!1,n.easeId),((n=u.extend({offset:[0,0],duration:500,easing:u.ease},n)).animate===!1||!n.essential&&u.browser.prefersReducedMotion)&&(n.duration=0);var f=this.transform,d=this.getZoom(),y=this.getBearing(),_=this.getPitch(),S=this.getPadding(),P="zoom"in n?+n.zoom:d,k="bearing"in n?this._normalizeBearing(n.bearing,y):y,z="pitch"in n?+n.pitch:_,U="padding"in n?n.padding:f.padding,O=u.Point.convert(n.offset),G=f.centerPoint.add(O),B=f.pointLocation(G),Z=u.LngLat.convert(n.center||B);this._normalizeCenter(Z);var H,Q,at=f.project(B),nt=f.project(Z).sub(at),lt=f.zoomScale(P-d);n.around&&(H=u.LngLat.convert(n.around),Q=f.locationPoint(H));var ct={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||P!==d,this._rotating=this._rotating||y!==k,this._pitching=this._pitching||z!==_,this._padding=!f.isPaddingEqual(U),this._easeId=n.easeId,this._prepareEase(s,n.noMoveStart,ct),this._ease(function(_t){if(p._zooming&&(f.zoom=u.number(d,P,_t)),p._rotating&&(f.bearing=u.number(y,k,_t)),p._pitching&&(f.pitch=u.number(_,z,_t)),p._padding&&(f.interpolatePadding(S,U,_t),G=f.centerPoint.add(O)),H)f.setLocationAtPoint(H,Q);else{var yt=f.zoomScale(f.zoom-d),Et=P>d?Math.min(2,lt):Math.max(.5,lt),Vt=Math.pow(Et,1-_t),qt=f.unproject(at.add(nt.mult(_t*Vt)).mult(yt));f.setLocationAtPoint(f.renderWorldCopies?qt.wrap():qt,G)}p._fireMoveEvents(s)},function(_t){p._afterEase(s,_t)},n),this},o.prototype._prepareEase=function(n,s,p){p===void 0&&(p={}),this._moving=!0,s||p.moving||this.fire(new u.Event("movestart",n)),this._zooming&&!p.zooming&&this.fire(new u.Event("zoomstart",n)),this._rotating&&!p.rotating&&this.fire(new u.Event("rotatestart",n)),this._pitching&&!p.pitching&&this.fire(new u.Event("pitchstart",n))},o.prototype._fireMoveEvents=function(n){this.fire(new u.Event("move",n)),this._zooming&&this.fire(new u.Event("zoom",n)),this._rotating&&this.fire(new u.Event("rotate",n)),this._pitching&&this.fire(new u.Event("pitch",n))},o.prototype._afterEase=function(n,s){if(!this._easeId||!s||this._easeId!==s){delete this._easeId;var p=this._zooming,f=this._rotating,d=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new u.Event("zoomend",n)),f&&this.fire(new u.Event("rotateend",n)),d&&this.fire(new u.Event("pitchend",n)),this.fire(new u.Event("moveend",n))}},o.prototype.flyTo=function(n,s){var p=this;if(!n.essential&&u.browser.prefersReducedMotion){var f=u.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(f,s)}this.stop(),n=u.extend({offset:[0,0],speed:1.2,curve:1.42,easing:u.ease},n);var d=this.transform,y=this.getZoom(),_=this.getBearing(),S=this.getPitch(),P=this.getPadding(),k="zoom"in n?u.clamp(+n.zoom,d.minZoom,d.maxZoom):y,z="bearing"in n?this._normalizeBearing(n.bearing,_):_,U="pitch"in n?+n.pitch:S,O="padding"in n?n.padding:d.padding,G=d.zoomScale(k-y),B=u.Point.convert(n.offset),Z=d.centerPoint.add(B),H=d.pointLocation(Z),Q=u.LngLat.convert(n.center||H);this._normalizeCenter(Q);var at=d.project(H),nt=d.project(Q).sub(at),lt=n.curve,ct=Math.max(d.width,d.height),_t=ct/G,yt=nt.mag();if("minZoom"in n){var Et=u.clamp(Math.min(n.minZoom,y,k),d.minZoom,d.maxZoom),Vt=ct/d.zoomScale(Et-y);lt=Math.sqrt(Vt/yt*2)}var qt=lt*lt;function Nt(Wt){var Zt=(_t*_t-ct*ct+(Wt?-1:1)*qt*qt*yt*yt)/(2*(Wt?_t:ct)*qt*yt);return Math.log(Math.sqrt(Zt*Zt+1)-Zt)}function he(Wt){return(Math.exp(Wt)-Math.exp(-Wt))/2}function Ct(Wt){return(Math.exp(Wt)+Math.exp(-Wt))/2}var Jt=Nt(0),re=function(Wt){return Ct(Jt)/Ct(Jt+lt*Wt)},Yt=function(Wt){return ct*((Ct(Jt)*(he(Zt=Jt+lt*Wt)/Ct(Zt))-he(Jt))/qt)/yt;var Zt},Ht=(Nt(1)-Jt)/lt;if(Math.abs(yt)<1e-6||!isFinite(Ht)){if(Math.abs(ct-_t)<1e-6)return this.easeTo(n,s);var Kt=_t<ct?-1:1;Ht=Math.abs(Math.log(_t/ct))/lt,Yt=function(){return 0},re=function(Wt){return Math.exp(Kt*lt*Wt)}}return n.duration="duration"in n?+n.duration:1e3*Ht/("screenSpeed"in n?+n.screenSpeed/lt:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0),this._zooming=!0,this._rotating=_!==z,this._pitching=U!==S,this._padding=!d.isPaddingEqual(O),this._prepareEase(s,!1),this._ease(function(Wt){var Zt=Wt*Ht,we=1/re(Zt);d.zoom=Wt===1?k:y+d.scaleZoom(we),p._rotating&&(d.bearing=u.number(_,z,Wt)),p._pitching&&(d.pitch=u.number(S,U,Wt)),p._padding&&(d.interpolatePadding(P,O,Wt),Z=d.centerPoint.add(B));var Je=Wt===1?Q:d.unproject(at.add(nt.mult(Yt(Zt))).mult(we));d.setLocationAtPoint(d.renderWorldCopies?Je.wrap():Je,Z),p._fireMoveEvents(s)},function(){return p._afterEase(s)},n),this},o.prototype.isEasing=function(){return!!this._easeFrameId},o.prototype.stop=function(){return this._stop()},o.prototype._stop=function(n,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,s)}if(!n){var f=this.handlers;f&&f.stop(!1)}return this},o.prototype._ease=function(n,s,p){p.animate===!1||p.duration===0?(n(1),s()):(this._easeStart=u.browser.now(),this._easeOptions=p,this._onEaseFrame=n,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},o.prototype._renderFrameCallback=function(){var n=Math.min((u.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},o.prototype._normalizeBearing=function(n,s){n=u.wrap(n,-180,180);var p=Math.abs(n-s);return Math.abs(n-360-s)<p&&(n-=360),Math.abs(n+360-s)<p&&(n+=360),n},o.prototype._normalizeCenter=function(n){var s=this.transform;if(s.renderWorldCopies&&!s.lngRange){var p=n.lng-s.center.lng;n.lng+=p>180?-360:p<-180?360:0}},o}(u.Evented),$r=function(i){i===void 0&&(i={}),this.options=i,u.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};$r.prototype.getDefaultPosition=function(){return"bottom-right"},$r.prototype.onAdd=function(i){var o=this.options&&this.options.compact;return this._map=i,this._container=st.create("div","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=st.create("button","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.type="button",this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=st.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),o&&this._container.classList.add("maplibregl-compact","mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},$r.prototype.onRemove=function(){st.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},$r.prototype._setElementTitle=function(i,o){var n=this._map._getUIString("AttributionControl."+o);i.title=n,i.setAttribute("aria-label",n)},$r.prototype._toggleAttribution=function(){this._container.classList.contains("maplibregl-compact-show")||this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},$r.prototype._updateEditLink=function(){var i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));var o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||u.config.ACCESS_TOKEN}];if(i){var n=o.reduce(function(s,p,f){return p.value&&(s+=p.key+"="+p.value+(f<o.length-1?"&":"")),s},"?");i.href=u.config.FEEDBACK_URL+"/"+n+(this._map._hash?this._map._hash.getHashString(!0):""),i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}},$r.prototype._updateData=function(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},$r.prototype._updateAttributions=function(){if(this._map.style){var i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(function(y){return typeof y!="string"?"":y})):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){var o=this._map.style.stylesheet;this.styleOwner=o.owner,this.styleId=o.id}var n=this._map.style.sourceCaches;for(var s in n){var p=n[s];if(p.used){var f=p.getSource();f.attribution&&i.indexOf(f.attribution)<0&&i.push(f.attribution)}}i.sort(function(y,_){return y.length-_.length});var d=(i=i.filter(function(y,_){for(var S=_+1;S<i.length;S++)if(i[S].indexOf(y)>=0)return!1;return!0})).join(" | ");d!==this._attribHTML&&(this._attribHTML=d,i.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._editLink=null)}},$r.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("maplibregl-compact","mapboxgl-compact"):this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show")};var _i=function(){u.bindAll(["_updateLogo"],this),u.bindAll(["_updateCompact"],this)};_i.prototype.onAdd=function(i){this._map=i,this._container=st.create("div","maplibregl-ctrl mapboxgl-ctrl");var o=st.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},_i.prototype.onRemove=function(){st.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},_i.prototype.getDefaultPosition=function(){return"bottom-left"},_i.prototype._updateLogo=function(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},_i.prototype._logoRequired=function(){if(this._map.style){var i=this._map.style.sourceCaches;for(var o in i)if(i[o].getSource().mapbox_logo)return!0;return!1}},_i.prototype._updateCompact=function(){var i=this._container.children;if(i.length){var o=i[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("maplibregl-compact","mapboxgl-compact"):o.classList.remove("maplibregl-compact","mapboxgl-compact")}};var Hi=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Hi.prototype.add=function(i){var o=++this._id;return this._queue.push({callback:i,id:o,cancelled:!1}),o},Hi.prototype.remove=function(i){for(var o=this._currentlyRunning,n=0,s=o?this._queue.concat(o):this._queue;n<s.length;n+=1){var p=s[n];if(p.id===i)return void(p.cancelled=!0)}},Hi.prototype.run=function(i){i===void 0&&(i=0);var o=this._currentlyRunning=this._queue;this._queue=[];for(var n=0,s=o;n<s.length;n+=1){var p=s[n];if(!p.cancelled&&(p.callback(i),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Hi.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var ti={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},xi=u.window.HTMLImageElement,ic=u.window.HTMLElement,Ji=u.window.ImageBitmap,ze={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},_r=function(i){function o(s){var p=this;if((s=u.extend({},ze,s)).minZoom!=null&&s.maxZoom!=null&&s.minZoom>s.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(s.minPitch!=null&&s.maxPitch!=null&&s.minPitch>s.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(s.minPitch!=null&&s.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(s.maxPitch!=null&&s.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var f=new _e(s.minZoom,s.maxZoom,s.minPitch,s.maxPitch,s.renderWorldCopies);if(i.call(this,f,s),this._interactive=s.interactive,this._maxTileCacheSize=s.maxTileCacheSize,this._failIfMajorPerformanceCaveat=s.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=s.preserveDrawingBuffer,this._antialias=s.antialias,this._trackResize=s.trackResize,this._bearingSnap=s.bearingSnap,this._refreshExpiredTiles=s.refreshExpiredTiles,this._fadeDuration=s.fadeDuration,this._crossSourceCollisions=s.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=s.collectResourceTiming,this._renderTaskQueue=new Hi,this._controls=[],this._mapId=u.uniqueId(),this._locale=u.extend({},ti,s.locale),this._clickTolerance=s.clickTolerance,this._requestManager=new u.RequestManager(s.transformRequest,s.accessToken),typeof s.container=="string"){if(this._container=u.window.document.getElementById(s.container),!this._container)throw new Error("Container '"+s.container+"' not found.")}else{if(!(s.container instanceof ic))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=s.container}if(s.maxBounds&&this.setMaxBounds(s.maxBounds),u.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return p._update(!1)}),this.on("moveend",function(){return p._update(!1)}),this.on("zoom",function(){return p._update(!0)}),u.window!==void 0&&(u.window.addEventListener("online",this._onWindowOnline,!1),u.window.addEventListener("resize",this._onWindowResize,!1),u.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new It(this,s),this._hash=s.hash&&new Jn(typeof s.hash=="string"&&s.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:s.center,zoom:s.zoom,bearing:s.bearing,pitch:s.pitch}),s.bounds&&(this.resize(),this.fitBounds(s.bounds,u.extend({},s.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=s.localIdeographFontFamily,s.style&&this.setStyle(s.style,{localIdeographFontFamily:s.localIdeographFontFamily}),s.attributionControl&&this.addControl(new $r({customAttribution:s.customAttribution})),this.addControl(new _i,s.logoPosition),this.on("style.load",function(){p.transform.unmodified&&p.jumpTo(p.style.stylesheet)}),this.on("data",function(d){p._update(d.dataType==="style"),p.fire(new u.Event(d.dataType+"data",d))}),this.on("dataloading",function(d){p.fire(new u.Event(d.dataType+"dataloading",d))})}i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o;var n={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return o.prototype._getMapId=function(){return this._mapId},o.prototype.addControl=function(s,p){if(p===void 0&&(p=s.getDefaultPosition?s.getDefaultPosition():"top-right"),!s||!s.onAdd)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var f=s.onAdd(this);this._controls.push(s);var d=this._controlPositions[p];return p.indexOf("bottom")!==-1?d.insertBefore(f,d.firstChild):d.appendChild(f),this},o.prototype.removeControl=function(s){if(!s||!s.onRemove)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var p=this._controls.indexOf(s);return p>-1&&this._controls.splice(p,1),s.onRemove(this),this},o.prototype.hasControl=function(s){return this._controls.indexOf(s)>-1},o.prototype.resize=function(s){var p=this._containerDimensions(),f=p[0],d=p[1];this._resizeCanvas(f,d),this.transform.resize(f,d),this.painter.resize(f,d);var y=!this._moving;return y&&(this.stop(),this.fire(new u.Event("movestart",s)).fire(new u.Event("move",s))),this.fire(new u.Event("resize",s)),y&&this.fire(new u.Event("moveend",s)),this},o.prototype.getBounds=function(){return this.transform.getBounds()},o.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},o.prototype.setMaxBounds=function(s){return this.transform.setMaxBounds(u.LngLatBounds.convert(s)),this._update()},o.prototype.setMinZoom=function(s){if((s=s==null?-2:s)>=-2&&s<=this.transform.maxZoom)return this.transform.minZoom=s,this._update(),this.getZoom()<s&&this.setZoom(s),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},o.prototype.getMinZoom=function(){return this.transform.minZoom},o.prototype.setMaxZoom=function(s){if((s=s==null?22:s)>=this.transform.minZoom)return this.transform.maxZoom=s,this._update(),this.getZoom()>s&&this.setZoom(s),this;throw new Error("maxZoom must be greater than the current minZoom")},o.prototype.getMaxZoom=function(){return this.transform.maxZoom},o.prototype.setMinPitch=function(s){if((s=s==null?0:s)<0)throw new Error("minPitch must be greater than or equal to 0");if(s>=0&&s<=this.transform.maxPitch)return this.transform.minPitch=s,this._update(),this.getPitch()<s&&this.setPitch(s),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},o.prototype.getMinPitch=function(){return this.transform.minPitch},o.prototype.setMaxPitch=function(s){if((s=s==null?60:s)>60)throw new Error("maxPitch must be less than or equal to 60");if(s>=this.transform.minPitch)return this.transform.maxPitch=s,this._update(),this.getPitch()>s&&this.setPitch(s),this;throw new Error("maxPitch must be greater than the current minPitch")},o.prototype.getMaxPitch=function(){return this.transform.maxPitch},o.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},o.prototype.setRenderWorldCopies=function(s){return this.transform.renderWorldCopies=s,this._update()},o.prototype.project=function(s){return this.transform.locationPoint(u.LngLat.convert(s))},o.prototype.unproject=function(s){return this.transform.pointLocation(u.Point.convert(s))},o.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},o.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},o.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},o.prototype._createDelegatedListener=function(s,p,f){var d,y=this;if(s==="mouseenter"||s==="mouseover"){var _=!1;return{layer:p,listener:f,delegates:{mousemove:function(P){var k=y.getLayer(p)?y.queryRenderedFeatures(P.point,{layers:[p]}):[];k.length?_||(_=!0,f.call(y,new Er(s,y,P.originalEvent,{features:k}))):_=!1},mouseout:function(){_=!1}}}}if(s==="mouseleave"||s==="mouseout"){var S=!1;return{layer:p,listener:f,delegates:{mousemove:function(P){(y.getLayer(p)?y.queryRenderedFeatures(P.point,{layers:[p]}):[]).length?S=!0:S&&(S=!1,f.call(y,new Er(s,y,P.originalEvent)))},mouseout:function(P){S&&(S=!1,f.call(y,new Er(s,y,P.originalEvent)))}}}}return{layer:p,listener:f,delegates:(d={},d[s]=function(P){var k=y.getLayer(p)?y.queryRenderedFeatures(P.point,{layers:[p]}):[];k.length&&(P.features=k,f.call(y,P),delete P.features)},d)}},o.prototype.on=function(s,p,f){if(f===void 0)return i.prototype.on.call(this,s,p);var d=this._createDelegatedListener(s,p,f);for(var y in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[s]=this._delegatedListeners[s]||[],this._delegatedListeners[s].push(d),d.delegates)this.on(y,d.delegates[y]);return this},o.prototype.once=function(s,p,f){if(f===void 0)return i.prototype.once.call(this,s,p);var d=this._createDelegatedListener(s,p,f);for(var y in d.delegates)this.once(y,d.delegates[y]);return this},o.prototype.off=function(s,p,f){var d=this;return f===void 0?i.prototype.off.call(this,s,p):(this._delegatedListeners&&this._delegatedListeners[s]&&function(y){for(var _=y[s],S=0;S<_.length;S++){var P=_[S];if(P.layer===p&&P.listener===f){for(var k in P.delegates)d.off(k,P.delegates[k]);return _.splice(S,1),d}}}(this._delegatedListeners),this)},o.prototype.queryRenderedFeatures=function(s,p){if(!this.style)return[];var f;if(p!==void 0||s===void 0||s instanceof u.Point||Array.isArray(s)||(p=s,s=void 0),p=p||{},(s=s||[[0,0],[this.transform.width,this.transform.height]])instanceof u.Point||typeof s[0]=="number")f=[u.Point.convert(s)];else{var d=u.Point.convert(s[0]),y=u.Point.convert(s[1]);f=[d,new u.Point(y.x,d.y),y,new u.Point(d.x,y.y),d]}return this.style.queryRenderedFeatures(f,p,this.transform)},o.prototype.querySourceFeatures=function(s,p){return this.style.querySourceFeatures(s,p)},o.prototype.setStyle=function(s,p){return(p=u.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},p)).diff!==!1&&p.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&s?(this._diffStyle(s,p),this):(this._localIdeographFontFamily=p.localIdeographFontFamily,this._updateStyle(s,p))},o.prototype.setTransformRequest=function(s){return this._requestManager.setTransformRequest(s),this},o.prototype._getUIString=function(s){var p=this._locale[s];if(p==null)throw new Error("Missing UI string '"+s+"'");return p},o.prototype._updateStyle=function(s,p){return this.style&&(this.style.setEventedParent(null),this.style._remove()),s?(this.style=new Ki(this,p||{}),this.style.setEventedParent(this,{style:this.style}),typeof s=="string"?this.style.loadURL(s):this.style.loadJSON(s),this):(delete this.style,this)},o.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Ki(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},o.prototype._diffStyle=function(s,p){var f=this;if(typeof s=="string"){var d=this._requestManager.normalizeStyleURL(s),y=this._requestManager.transformRequest(d,u.ResourceType.Style);u.getJSON(y,function(_,S){_?f.fire(new u.ErrorEvent(_)):S&&f._updateDiff(S,p)})}else typeof s=="object"&&this._updateDiff(s,p)},o.prototype._updateDiff=function(s,p){try{this.style.setState(s)&&this._update(!0)}catch(f){u.warnOnce("Unable to perform style diff: "+(f.message||f.error||f)+".  Rebuilding the style from scratch."),this._updateStyle(s,p)}},o.prototype.getStyle=function(){if(this.style)return this.style.serialize()},o.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():u.warnOnce("There is no style added to the map.")},o.prototype.addSource=function(s,p){return this._lazyInitEmptyStyle(),this.style.addSource(s,p),this._update(!0)},o.prototype.isSourceLoaded=function(s){var p=this.style&&this.style.sourceCaches[s];if(p!==void 0)return p.loaded();this.fire(new u.ErrorEvent(new Error("There is no source with ID '"+s+"'")))},o.prototype.areTilesLoaded=function(){var s=this.style&&this.style.sourceCaches;for(var p in s){var f=s[p]._tiles;for(var d in f){var y=f[d];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0},o.prototype.addSourceType=function(s,p,f){return this._lazyInitEmptyStyle(),this.style.addSourceType(s,p,f)},o.prototype.removeSource=function(s){return this.style.removeSource(s),this._update(!0)},o.prototype.getSource=function(s){return this.style.getSource(s)},o.prototype.addImage=function(s,p,f){f===void 0&&(f={});var d=f.pixelRatio;d===void 0&&(d=1);var y=f.sdf;y===void 0&&(y=!1);var _=f.stretchX,S=f.stretchY,P=f.content;if(this._lazyInitEmptyStyle(),p instanceof xi||Ji&&p instanceof Ji){var k=u.browser.getImageData(p);this.style.addImage(s,{data:new u.RGBAImage({width:k.width,height:k.height},k.data),pixelRatio:d,stretchX:_,stretchY:S,content:P,sdf:y,version:0})}else{if(p.width===void 0||p.height===void 0)return this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var z=p;this.style.addImage(s,{data:new u.RGBAImage({width:p.width,height:p.height},new Uint8Array(p.data)),pixelRatio:d,stretchX:_,stretchY:S,content:P,sdf:y,version:0,userImage:z}),z.onAdd&&z.onAdd(this,s)}},o.prototype.updateImage=function(s,p){var f=this.style.getImage(s);if(!f)return this.fire(new u.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var d=p instanceof xi||Ji&&p instanceof Ji?u.browser.getImageData(p):p,y=d.width,_=d.height,S=d.data;return y===void 0||_===void 0?this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):y!==f.data.width||_!==f.data.height?this.fire(new u.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(f.data.replace(S,!(p instanceof xi||Ji&&p instanceof Ji)),void this.style.updateImage(s,f))},o.prototype.hasImage=function(s){return s?!!this.style.getImage(s):(this.fire(new u.ErrorEvent(new Error("Missing required image id"))),!1)},o.prototype.removeImage=function(s){this.style.removeImage(s)},o.prototype.loadImage=function(s,p){u.getImage(this._requestManager.transformRequest(s,u.ResourceType.Image),p)},o.prototype.listImages=function(){return this.style.listImages()},o.prototype.addLayer=function(s,p){return this._lazyInitEmptyStyle(),this.style.addLayer(s,p),this._update(!0)},o.prototype.moveLayer=function(s,p){return this.style.moveLayer(s,p),this._update(!0)},o.prototype.removeLayer=function(s){return this.style.removeLayer(s),this._update(!0)},o.prototype.getLayer=function(s){return this.style.getLayer(s)},o.prototype.setLayerZoomRange=function(s,p,f){return this.style.setLayerZoomRange(s,p,f),this._update(!0)},o.prototype.setFilter=function(s,p,f){return f===void 0&&(f={}),this.style.setFilter(s,p,f),this._update(!0)},o.prototype.getFilter=function(s){return this.style.getFilter(s)},o.prototype.setPaintProperty=function(s,p,f,d){return d===void 0&&(d={}),this.style.setPaintProperty(s,p,f,d),this._update(!0)},o.prototype.getPaintProperty=function(s,p){return this.style.getPaintProperty(s,p)},o.prototype.setLayoutProperty=function(s,p,f,d){return d===void 0&&(d={}),this.style.setLayoutProperty(s,p,f,d),this._update(!0)},o.prototype.getLayoutProperty=function(s,p){return this.style.getLayoutProperty(s,p)},o.prototype.setLight=function(s,p){return p===void 0&&(p={}),this._lazyInitEmptyStyle(),this.style.setLight(s,p),this._update(!0)},o.prototype.getLight=function(){return this.style.getLight()},o.prototype.setFeatureState=function(s,p){return this.style.setFeatureState(s,p),this._update()},o.prototype.removeFeatureState=function(s,p){return this.style.removeFeatureState(s,p),this._update()},o.prototype.getFeatureState=function(s){return this.style.getFeatureState(s)},o.prototype.getContainer=function(){return this._container},o.prototype.getCanvasContainer=function(){return this._canvasContainer},o.prototype.getCanvas=function(){return this._canvas},o.prototype._containerDimensions=function(){var s=0,p=0;return this._container&&(s=this._container.clientWidth||400,p=this._container.clientHeight||300),[s,p]},o.prototype._setupContainer=function(){var s=this._container;s.classList.add("maplibregl-map","mapboxgl-map");var p=this._canvasContainer=st.create("div","maplibregl-canvas-container mapboxgl-canvas-container",s);this._interactive&&p.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=st.create("canvas","maplibregl-canvas mapboxgl-canvas",p),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var f=this._containerDimensions();this._resizeCanvas(f[0],f[1]);var d=this._controlContainer=st.create("div","maplibregl-control-container mapboxgl-control-container",s),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(_){y[_]=st.create("div","maplibregl-ctrl-"+_+" mapboxgl-ctrl-"+_,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},o.prototype._resizeCanvas=function(s,p){var f=u.browser.devicePixelRatio||1;this._canvas.width=f*s,this._canvas.height=f*p,this._canvas.style.width=s+"px",this._canvas.style.height=p+"px"},o.prototype._setupPainter=function(){var s=u.extend({},Ot.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),p=this._canvas.getContext("webgl",s)||this._canvas.getContext("experimental-webgl",s);p?(this.painter=new be(p,this.transform),u.webpSupported.testSupport(p)):this.fire(new u.ErrorEvent(new Error("Failed to initialize WebGL")))},o.prototype._contextLost=function(s){s.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new u.Event("webglcontextlost",{originalEvent:s}))},o.prototype._contextRestored=function(s){this._setupPainter(),this.resize(),this._update(),this.fire(new u.Event("webglcontextrestored",{originalEvent:s}))},o.prototype._onMapScroll=function(s){if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},o.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},o.prototype._update=function(s){return this.style?(this._styleDirty=this._styleDirty||s,this._sourcesDirty=!0,this.triggerRepaint(),this):this},o.prototype._requestRenderFrame=function(s){return this._update(),this._renderTaskQueue.add(s)},o.prototype._cancelRenderFrame=function(s){this._renderTaskQueue.remove(s)},o.prototype._render=function(s){var p,f=this,d=0,y=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(p=y.createQueryEXT(),y.beginQueryEXT(y.TIME_ELAPSED_EXT,p),d=u.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(s),!this._removed){var _=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var S=this.transform.zoom,P=u.browser.now();this.style.zoomHistory.update(S,P);var k=new u.EvaluationParameters(S,{now:P,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),z=k.crossFadingFactor();z===1&&z===this._crossFadingFactor||(_=!0,this._crossFadingFactor=z),this.style.update(k)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new u.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new u.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var U=u.browser.now()-d;y.endQueryEXT(y.TIME_ELAPSED_EXT,p),setTimeout(function(){var B=y.getQueryObjectEXT(p,y.QUERY_RESULT_EXT)/1e6;y.deleteQueryEXT(p),f.fire(new u.Event("gpu-timing-frame",{cpuTime:U,gpuTime:B}))},50)}if(this.listens("gpu-timing-layer")){var O=this.painter.collectGpuTimers();setTimeout(function(){var B=f.painter.queryGpuTimers(O);f.fire(new u.Event("gpu-timing-layer",{layerTimes:B}))},50)}var G=this._sourcesDirty||this._styleDirty||this._placementDirty;return G||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new u.Event("idle")),!this._loaded||this._fullyLoaded||G||(this._fullyLoaded=!0),this}},o.prototype.remove=function(){this._hash&&this._hash.remove();for(var s=0,p=this._controls;s<p.length;s+=1)p[s].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),u.window!==void 0&&(u.window.removeEventListener("resize",this._onWindowResize,!1),u.window.removeEventListener("orientationchange",this._onWindowResize,!1),u.window.removeEventListener("online",this._onWindowOnline,!1));var f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),rl(this._canvasContainer),rl(this._controlContainer),this._container.classList.remove("maplibregl-map","mapboxgl-map"),this._removed=!0,this.fire(new u.Event("remove"))},o.prototype.triggerRepaint=function(){var s=this;this.style&&!this._frame&&(this._frame=u.browser.frame(function(p){s._frame=null,s._render(p)}))},o.prototype._onWindowOnline=function(){this._update()},o.prototype._onWindowResize=function(s){this._trackResize&&this.resize({originalEvent:s})._update()},n.showTileBoundaries.get=function(){return!!this._showTileBoundaries},n.showTileBoundaries.set=function(s){this._showTileBoundaries!==s&&(this._showTileBoundaries=s,this._update())},n.showPadding.get=function(){return!!this._showPadding},n.showPadding.set=function(s){this._showPadding!==s&&(this._showPadding=s,this._update())},n.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},n.showCollisionBoxes.set=function(s){this._showCollisionBoxes!==s&&(this._showCollisionBoxes=s,s?this.style._generateCollisionBoxes():this._update())},n.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},n.showOverdrawInspector.set=function(s){this._showOverdrawInspector!==s&&(this._showOverdrawInspector=s,this._update())},n.repaint.get=function(){return!!this._repaint},n.repaint.set=function(s){this._repaint!==s&&(this._repaint=s,this.triggerRepaint())},n.vertices.get=function(){return!!this._vertices},n.vertices.set=function(s){this._vertices=s,this._update()},o.prototype._setCacheLimits=function(s,p){u.setCacheLimits(s,p)},n.version.get=function(){return u.version},Object.defineProperties(o.prototype,n),o}(Xt);function rl(i){i.parentNode&&i.parentNode.removeChild(i)}var aa={showCompass:!0,showZoom:!0,visualizePitch:!1},Yi=function(i){var o=this;this.options=u.extend({},aa,i),this._container=st.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(n){return n.preventDefault()}),this.options.showZoom&&(u.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",function(n){return o._map.zoomIn({},{originalEvent:n})}),st.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",function(n){return o._map.zoomOut({},{originalEvent:n})}),st.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(u.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",function(n){o.options.visualizePitch?o._map.resetNorthPitch({},{originalEvent:n}):o._map.resetNorth({},{originalEvent:n})}),this._compassIcon=st.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Yi.prototype._updateZoomButtons=function(){var i=this._map.getZoom(),o=i===this._map.getMaxZoom(),n=i===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())},Yi.prototype._rotateCompassArrow=function(){var i=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=i},Yi.prototype.onAdd=function(i){return this._map=i,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ei(this._map,this._compass,this.options.visualizePitch)),this._container},Yi.prototype.onRemove=function(){st.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Yi.prototype._createButton=function(i,o){var n=st.create("button",i,this._container);return n.type="button",n.addEventListener("click",o),n},Yi.prototype._setButtonTitle=function(i,o){var n=this._map._getUIString("NavigationControl."+o);i.title=n,i.setAttribute("aria-label",n)};var ei=function(i,o,n){n===void 0&&(n=!1),this._clickTolerance=10,this.element=o,this.mouseRotate=new Ha({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,n&&(this.mousePitch=new Ja({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),u.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),st.addEventListener(o,"mousedown",this.mousedown),st.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),st.addEventListener(o,"touchmove",this.touchmove),st.addEventListener(o,"touchend",this.touchend),st.addEventListener(o,"touchcancel",this.reset)};function $a(i,o,n){if(i=new u.LngLat(i.lng,i.lat),o){var s=new u.LngLat(i.lng-360,i.lat),p=new u.LngLat(i.lng+360,i.lat),f=n.locationPoint(i).distSqr(o);n.locationPoint(s).distSqr(o)<f?i=s:n.locationPoint(p).distSqr(o)<f&&(i=p)}for(;Math.abs(i.lng-n.center.lng)>180;){var d=n.locationPoint(i);if(d.x>=0&&d.y>=0&&d.x<=n.width&&d.y<=n.height)break;i.lng>n.center.lng?i.lng-=360:i.lng+=360}return i}ei.prototype.down=function(i,o){this.mouseRotate.mousedown(i,o),this.mousePitch&&this.mousePitch.mousedown(i,o),st.disableDrag()},ei.prototype.move=function(i,o){var n=this.map,s=this.mouseRotate.mousemoveWindow(i,o);if(s&&s.bearingDelta&&n.setBearing(n.getBearing()+s.bearingDelta),this.mousePitch){var p=this.mousePitch.mousemoveWindow(i,o);p&&p.pitchDelta&&n.setPitch(n.getPitch()+p.pitchDelta)}},ei.prototype.off=function(){var i=this.element;st.removeEventListener(i,"mousedown",this.mousedown),st.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),st.removeEventListener(i,"touchmove",this.touchmove),st.removeEventListener(i,"touchend",this.touchend),st.removeEventListener(i,"touchcancel",this.reset),this.offTemp()},ei.prototype.offTemp=function(){st.enableDrag(),st.removeEventListener(u.window,"mousemove",this.mousemove),st.removeEventListener(u.window,"mouseup",this.mouseup)},ei.prototype.mousedown=function(i){this.down(u.extend({},i,{ctrlKey:!0,preventDefault:function(){return i.preventDefault()}}),st.mousePos(this.element,i)),st.addEventListener(u.window,"mousemove",this.mousemove),st.addEventListener(u.window,"mouseup",this.mouseup)},ei.prototype.mousemove=function(i){this.move(i,st.mousePos(this.element,i))},ei.prototype.mouseup=function(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()},ei.prototype.touchstart=function(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=st.touchPos(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return i.preventDefault()}},this._startPos))},ei.prototype.touchmove=function(i){i.targetTouches.length!==1?this.reset():(this._lastPos=st.touchPos(this.element,i.targetTouches)[0],this.move({preventDefault:function(){return i.preventDefault()}},this._lastPos))},ei.prototype.touchend=function(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},ei.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var $n={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Qi(i,o,n){var s=i.classList;for(var p in $n)s.remove("maplibregl-"+n+"-anchor-"+p,"mapboxgl-"+n+"-anchor-"+p);s.add("maplibregl-"+n+"-anchor-"+o,"mapboxgl-"+n+"-anchor-"+o)}var Co,sa=function(i){function o(n,s){if(i.call(this),(n instanceof u.window.HTMLElement||s)&&(n=u.extend({element:n},s)),u.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment!=="auto"?n.pitchAlignment:this._rotationAlignment,n&&n.element)this._element=n.element,this._offset=u.Point.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=st.create("div"),this._element.setAttribute("aria-label","Map marker");var p=st.createNS("http://www.w3.org/2000/svg","svg");p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height","41px"),p.setAttributeNS(null,"width","27px"),p.setAttributeNS(null,"viewBox","0 0 27 41");var f=st.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"stroke","none"),f.setAttributeNS(null,"stroke-width","1"),f.setAttributeNS(null,"fill","none"),f.setAttributeNS(null,"fill-rule","evenodd");var d=st.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"fill-rule","nonzero");var y=st.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(3.0, 29.0)"),y.setAttributeNS(null,"fill","#000000");for(var _=0,S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];_<S.length;_+=1){var P=S[_],k=st.createNS("http://www.w3.org/2000/svg","ellipse");k.setAttributeNS(null,"opacity","0.04"),k.setAttributeNS(null,"cx","10.5"),k.setAttributeNS(null,"cy","5.80029008"),k.setAttributeNS(null,"rx",P.rx),k.setAttributeNS(null,"ry",P.ry),y.appendChild(k)}var z=st.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);var U=st.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(U);var O=st.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"opacity","0.25"),O.setAttributeNS(null,"fill","#000000");var G=st.createNS("http://www.w3.org/2000/svg","path");G.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),O.appendChild(G);var B=st.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"transform","translate(6.0, 7.0)"),B.setAttributeNS(null,"fill","#FFFFFF");var Z=st.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(8.0, 8.0)");var H=st.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#000000"),H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962");var Q=st.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#FFFFFF"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962"),Z.appendChild(H),Z.appendChild(Q),d.appendChild(y),d.appendChild(z),d.appendChild(O),d.appendChild(B),d.appendChild(Z),p.appendChild(d),p.setAttributeNS(null,"height",41*this._scale+"px"),p.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(p),this._offset=u.Point.convert(n&&n.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",function(at){at.preventDefault()}),this._element.addEventListener("mousedown",function(at){at.preventDefault()}),Qi(this._element,this._anchor,"marker"),this._popup=null}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.addTo=function(n){return this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._update),n.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},o.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),st.remove(this._element),this._popup&&this._popup.remove(),this},o.prototype.getLngLat=function(){return this._lngLat},o.prototype.setLngLat=function(n){return this._lngLat=u.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},o.prototype.getElement=function(){return this._element},o.prototype.setPopup=function(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){var s=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[s,-1*(24.6+s)],"bottom-right":[-s,-1*(24.6+s)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=n,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},o.prototype._onKeyPress=function(n){var s=n.code,p=n.charCode||n.keyCode;s!=="Space"&&s!=="Enter"&&p!==32&&p!==13||this.togglePopup()},o.prototype._onMapClick=function(n){var s=n.originalEvent.target,p=this._element;this._popup&&(s===p||p.contains(s))&&this.togglePopup()},o.prototype.getPopup=function(){return this._popup},o.prototype.togglePopup=function(){var n=this._popup;return n?(n.isOpen()?n.remove():n.addTo(this._map),this):this},o.prototype._update=function(n){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=$a(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var s="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?s="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(s="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var p="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?p="rotateX(0deg)":this._pitchAlignment==="map"&&(p="rotateX("+this._map.getPitch()+"deg)"),n&&n.type!=="moveend"||(this._pos=this._pos.round()),st.setTransform(this._element,$n[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+p+" "+s)}},o.prototype.getOffset=function(){return this._offset},o.prototype.setOffset=function(n){return this._offset=u.Point.convert(n),this._update(),this},o.prototype._onMove=function(n){if(!this._isDragging){var s=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=s}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new u.Event("dragstart"))),this.fire(new u.Event("drag")))},o.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new u.Event("dragend")),this._state="inactive"},o.prototype._addDragHandler=function(n){this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},o.prototype.setDraggable=function(n){return this._draggable=!!n,this._map&&(n?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},o.prototype.isDraggable=function(){return this._draggable},o.prototype.setRotation=function(n){return this._rotation=n||0,this._update(),this},o.prototype.getRotation=function(){return this._rotation},o.prototype.setRotationAlignment=function(n){return this._rotationAlignment=n||"auto",this._update(),this},o.prototype.getRotationAlignment=function(){return this._rotationAlignment},o.prototype.setPitchAlignment=function(n){return this._pitchAlignment=n&&n!=="auto"?n:this._rotationAlignment,this._update(),this},o.prototype.getPitchAlignment=function(){return this._pitchAlignment},o}(u.Evented),il={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},la=0,wn=!1,nl=function(i){function o(n){i.call(this),this.options=u.extend({},il,n),u.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.onAdd=function(n){var s;return this._map=n,this._container=st.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),s=this._setupUI,Co!==void 0?s(Co):u.window.navigator.permissions!==void 0?u.window.navigator.permissions.query({name:"geolocation"}).then(function(p){s(Co=p.state!=="denied")}):s(Co=!!u.window.navigator.geolocation),this._container},o.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(u.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),st.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,la=0,wn=!1},o.prototype._isOutOfMapMaxBounds=function(n){var s=this._map.getMaxBounds(),p=n.coords;return s&&(p.longitude<s.getWest()||p.longitude>s.getEast()||p.latitude<s.getSouth()||p.latitude>s.getNorth())},o.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting")}},o.prototype._onSuccess=function(n){if(this._map){if(this._isOutOfMapMaxBounds(n))return this._setErrorState(),this.fire(new u.Event("outofmaxbounds",n)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=n,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(n),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(n),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new u.Event("geolocate",n)),this._finish()}},o.prototype._updateCamera=function(n){var s=new u.LngLat(n.coords.longitude,n.coords.latitude),p=n.coords.accuracy,f=this._map.getBearing(),d=u.extend({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(p),d,{geolocateSource:!0})},o.prototype._updateMarker=function(n){if(n){var s=new u.LngLat(n.coords.longitude,n.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=n.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},o.prototype._updateCircleRadius=function(){var n=this._map._container.clientHeight/2,s=this._map.unproject([0,n]),p=this._map.unproject([1,n]),f=s.distanceTo(p),d=Math.ceil(2*this._accuracy/f);this._circleElement.style.width=d+"px",this._circleElement.style.height=d+"px"},o.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},o.prototype._onError=function(n){if(this._map){if(this.options.trackUserLocation)if(n.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(n.code===3&&wn)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new u.Event("error",n)),this._finish()}},o.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},o.prototype._setupUI=function(n){var s=this;if(this._container.addEventListener("contextmenu",function(d){return d.preventDefault()}),this._geolocateButton=st.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),st.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",n===!1){u.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var p=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=p,this._geolocateButton.setAttribute("aria-label",p)}else{var f=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=st.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new sa(this._dotElement),this._circleElement=st.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new sa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(d){d.geolocateSource||s._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(s._watchState="BACKGROUND",s._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),s._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),s.fire(new u.Event("trackuserlocationend")))})},o.prototype.trigger=function(){if(!this._setup)return u.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":la--,wn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new u.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var n;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++la>1?(n={maximumAge:6e5,timeout:0},wn=!0):(n=this.options.positionOptions,wn=!1),this._geolocationWatchID=u.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,n)}}else u.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},o.prototype._clearWatch=function(){u.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},o}(u.Evented),ol={maxWidth:100,unit:"metric"},si=function(i){this.options=u.extend({},ol,i),u.bindAll(["_onMove","setUnit"],this)};function ts(i,o,n){var s=n&&n.maxWidth||100,p=i._container.clientHeight/2,f=i.unproject([0,p]),d=i.unproject([s,p]),y=f.distanceTo(d);if(n&&n.unit==="imperial"){var _=3.2808*y;_>5280?to(o,s,_/5280,i._getUIString("ScaleControl.Miles")):to(o,s,_,i._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?to(o,s,y/1852,i._getUIString("ScaleControl.NauticalMiles")):y>=1e3?to(o,s,y/1e3,i._getUIString("ScaleControl.Kilometers")):to(o,s,y,i._getUIString("ScaleControl.Meters"))}function to(i,o,n,s){var p,f,d,y=(p=n,(f=Math.pow(10,(""+Math.floor(p)).length-1))*(d=(d=p/f)>=10?10:d>=5?5:d>=3?3:d>=2?2:d>=1?1:function(_){var S=Math.pow(10,Math.ceil(-Math.log(_)/Math.LN10));return Math.round(_*S)/S}(d)));i.style.width=o*(y/n)+"px",i.innerHTML=y+"&nbsp;"+s}si.prototype.getDefaultPosition=function(){return"bottom-left"},si.prototype._onMove=function(){ts(this._map,this._container,this.options)},si.prototype.onAdd=function(i){return this._map=i,this._container=st.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",i.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},si.prototype.onRemove=function(){st.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},si.prototype.setUnit=function(i){this.options.unit=i,ts(this._map,this._container,this.options)};var li=function(i){this._fullscreen=!1,i&&i.container&&(i.container instanceof u.window.HTMLElement?this._container=i.container:u.warnOnce("Full screen control 'container' must be a DOM element.")),u.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in u.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in u.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in u.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in u.window.document&&(this._fullscreenchange="MSFullscreenChange")};li.prototype.onAdd=function(i){return this._map=i,this._container||(this._container=this._map.getContainer()),this._controlContainer=st.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",u.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},li.prototype.onRemove=function(){st.remove(this._controlContainer),this._map=null,u.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},li.prototype._checkFullscreenSupport=function(){return!!(u.window.document.fullscreenEnabled||u.window.document.mozFullScreenEnabled||u.window.document.msFullscreenEnabled||u.window.document.webkitFullscreenEnabled)},li.prototype._setupUI=function(){var i=this._fullscreenButton=st.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);st.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",i).setAttribute("aria-hidden",!0),i.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),u.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},li.prototype._updateTitle=function(){var i=this._getTitle();this._fullscreenButton.setAttribute("aria-label",i),this._fullscreenButton.title=i},li.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},li.prototype._isFullscreen=function(){return this._fullscreen},li.prototype._changeIcon=function(){(u.window.document.fullscreenElement||u.window.document.mozFullScreenElement||u.window.document.webkitFullscreenElement||u.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},li.prototype._onClickFullscreen=function(){this._isFullscreen()?u.window.document.exitFullscreen?u.window.document.exitFullscreen():u.window.document.mozCancelFullScreen?u.window.document.mozCancelFullScreen():u.window.document.msExitFullscreen?u.window.document.msExitFullscreen():u.window.document.webkitCancelFullScreen&&u.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var al={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},sl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),ua=function(i){function o(n){i.call(this),this.options=u.extend(Object.create(al),n),u.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return i&&(o.__proto__=i),(o.prototype=Object.create(i&&i.prototype)).constructor=o,o.prototype.addTo=function(n){return this._map&&this.remove(),this._map=n,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new u.Event("open")),this},o.prototype.isOpen=function(){return!!this._map},o.prototype.remove=function(){return this._content&&st.remove(this._content),this._container&&(st.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new u.Event("close")),this},o.prototype.getLngLat=function(){return this._lngLat},o.prototype.setLngLat=function(n){return this._lngLat=u.LngLat.convert(n),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this},o.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this},o.prototype.getElement=function(){return this._container},o.prototype.setText=function(n){return this.setDOMContent(u.window.document.createTextNode(n))},o.prototype.setHTML=function(n){var s,p=u.window.document.createDocumentFragment(),f=u.window.document.createElement("body");for(f.innerHTML=n;s=f.firstChild;)p.appendChild(s);return this.setDOMContent(p)},o.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},o.prototype.setMaxWidth=function(n){return this.options.maxWidth=n,this._update(),this},o.prototype.setDOMContent=function(n){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=st.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(n),this._createCloseButton(),this._update(),this._focusFirstElement(),this},o.prototype.addClassName=function(n){this._container&&this._container.classList.add(n)},o.prototype.removeClassName=function(n){this._container&&this._container.classList.remove(n)},o.prototype.setOffset=function(n){return this.options.offset=n,this._update(),this},o.prototype.toggleClassName=function(n){if(this._container)return this._container.classList.toggle(n)},o.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=st.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},o.prototype._onMouseUp=function(n){this._update(n.point)},o.prototype._onMouseMove=function(n){this._update(n.point)},o.prototype._onDrag=function(n){this._update(n.point)},o.prototype._update=function(n){var s=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=st.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=st.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(k){return s._container.classList.add(k)}),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=$a(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||n)){var p=this._pos=this._trackPointer&&n?n:this._map.project(this._lngLat),f=this.options.anchor,d=function k(z){if(z){if(typeof z=="number"){var U=Math.round(Math.sqrt(.5*Math.pow(z,2)));return{center:new u.Point(0,0),top:new u.Point(0,z),"top-left":new u.Point(U,U),"top-right":new u.Point(-U,U),bottom:new u.Point(0,-z),"bottom-left":new u.Point(U,-U),"bottom-right":new u.Point(-U,-U),left:new u.Point(z,0),right:new u.Point(-z,0)}}if(z instanceof u.Point||Array.isArray(z)){var O=u.Point.convert(z);return{center:O,top:O,"top-left":O,"top-right":O,bottom:O,"bottom-left":O,"bottom-right":O,left:O,right:O}}return{center:u.Point.convert(z.center||[0,0]),top:u.Point.convert(z.top||[0,0]),"top-left":u.Point.convert(z["top-left"]||[0,0]),"top-right":u.Point.convert(z["top-right"]||[0,0]),bottom:u.Point.convert(z.bottom||[0,0]),"bottom-left":u.Point.convert(z["bottom-left"]||[0,0]),"bottom-right":u.Point.convert(z["bottom-right"]||[0,0]),left:u.Point.convert(z.left||[0,0]),right:u.Point.convert(z.right||[0,0])}}return k(new u.Point(0,0))}(this.options.offset);if(!f){var y,_=this._container.offsetWidth,S=this._container.offsetHeight;y=p.y+d.bottom.y<S?["top"]:p.y>this._map.transform.height-S?["bottom"]:[],p.x<_/2?y.push("left"):p.x>this._map.transform.width-_/2&&y.push("right"),f=y.length===0?"bottom":y.join("-")}var P=p.add(d[f]).round();st.setTransform(this._container,$n[f]+" translate("+P.x+"px,"+P.y+"px)"),Qi(this._container,f,"popup")}},o.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var n=this._container.querySelector(sl);n&&n.focus()}},o.prototype._onClose=function(){this.remove()},o}(u.Evented),es={version:u.version,supported:Ot,setRTLTextPlugin:u.setRTLTextPlugin,getRTLTextPluginStatus:u.getRTLTextPluginStatus,Map:_r,NavigationControl:Yi,GeolocateControl:nl,AttributionControl:$r,ScaleControl:si,FullscreenControl:li,Popup:ua,Marker:sa,Style:Ki,LngLat:u.LngLat,LngLatBounds:u.LngLatBounds,Point:u.Point,MercatorCoordinate:u.MercatorCoordinate,Evented:u.Evented,config:u.config,prewarm:function(){Ft().acquire(et)},clearPrewarmedResources:function(){var i=At;i&&(i.isPreloaded()&&i.numActive()===1?(i.release(et),At=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return u.config.ACCESS_TOKEN},set accessToken(i){u.config.ACCESS_TOKEN=i},get baseApiUrl(){return u.config.API_URL},set baseApiUrl(i){u.config.API_URL=i},get workerCount(){return mt.workerCount},set workerCount(i){mt.workerCount=i},get maxParallelImageRequests(){return u.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(i){u.config.MAX_PARALLEL_IMAGE_REQUESTS=i},clearStorage:function(i){u.clearTileCache(i)},workerUrl:"",addProtocol:function(i,o){u.config.REGISTERED_PROTOCOLS[i]=o},removeProtocol:function(i){delete u.config.REGISTERED_PROTOCOLS[i]}};return es}),ot})})(fh);var um=fh.exports;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Rc=function(M,N){return Rc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(V,tt){V.__proto__=tt}||function(V,tt){for(var ot in tt)Object.prototype.hasOwnProperty.call(tt,ot)&&(V[ot]=tt[ot])},Rc(M,N)};function Cs(M,N){if(typeof N!="function"&&N!==null)throw new TypeError("Class extends value "+String(N)+" is not a constructor or null");Rc(M,N);function V(){this.constructor=M}M.prototype=N===null?Object.create(N):(V.prototype=N.prototype,new V)}function xd(M,N,V,tt){function ot(ht){return ht instanceof V?ht:new V(function(u){u(ht)})}return new(V||(V=Promise))(function(ht,u){function Ot(Dt){try{Mt(tt.next(Dt))}catch(Ke){u(Ke)}}function st(Dt){try{Mt(tt.throw(Dt))}catch(Ke){u(Ke)}}function Mt(Dt){Dt.done?ht(Dt.value):ot(Dt.value).then(Ot,st)}Mt((tt=tt.apply(M,N||[])).next())})}function dh(M,N){var V={label:0,sent:function(){if(ht[0]&1)throw ht[1];return ht[1]},trys:[],ops:[]},tt,ot,ht,u;return u={next:Ot(0),throw:Ot(1),return:Ot(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function Ot(Mt){return function(Dt){return st([Mt,Dt])}}function st(Mt){if(tt)throw new TypeError("Generator is already executing.");for(;V;)try{if(tt=1,ot&&(ht=Mt[0]&2?ot.return:Mt[0]?ot.throw||((ht=ot.return)&&ht.call(ot),0):ot.next)&&!(ht=ht.call(ot,Mt[1])).done)return ht;switch(ot=0,ht&&(Mt=[Mt[0]&2,ht.value]),Mt[0]){case 0:case 1:ht=Mt;break;case 4:return V.label++,{value:Mt[1],done:!1};case 5:V.label++,ot=Mt[1],Mt=[0];continue;case 7:Mt=V.ops.pop(),V.trys.pop();continue;default:if(ht=V.trys,!(ht=ht.length>0&&ht[ht.length-1])&&(Mt[0]===6||Mt[0]===2)){V=0;continue}if(Mt[0]===3&&(!ht||Mt[1]>ht[0]&&Mt[1]<ht[3])){V.label=Mt[1];break}if(Mt[0]===6&&V.label<ht[1]){V.label=ht[1],ht=Mt;break}if(ht&&V.label<ht[2]){V.label=ht[2],V.ops.push(Mt);break}ht[2]&&V.ops.pop(),V.trys.pop();continue}Mt=N.call(M,V)}catch(Dt){Mt=[6,Dt],ot=0}finally{tt=ht=0}if(Mt[0]&5)throw Mt[1];return{value:Mt[0]?Mt[1]:void 0,done:!0}}}function Ll(M){var N=typeof Symbol=="function"&&Symbol.iterator,V=N&&M[N],tt=0;if(V)return V.call(M);if(M&&typeof M.length=="number")return{next:function(){return M&&tt>=M.length&&(M=void 0),{value:M&&M[tt++],done:!M}}};throw new TypeError(N?"Object is not iterable.":"Symbol.iterator is not defined.")}function ba(M,N){var V=typeof Symbol=="function"&&M[Symbol.iterator];if(!V)return M;var tt=V.call(M),ot,ht=[],u;try{for(;(N===void 0||N-- >0)&&!(ot=tt.next()).done;)ht.push(ot.value)}catch(Ot){u={error:Ot}}finally{try{ot&&!ot.done&&(V=tt.return)&&V.call(tt)}finally{if(u)throw u.error}}return ht}function Ms(M,N){for(var V=0,tt=N.length,ot=M.length;V<tt;V++,ot++)M[ot]=N[V];return M}function Ds(M){return this instanceof Ds?(this.v=M,this):new Ds(M)}function bd(M,N,V){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var tt=V.apply(M,N||[]),ot,ht=[];return ot={},u("next"),u("throw"),u("return"),ot[Symbol.asyncIterator]=function(){return this},ot;function u(vt){tt[vt]&&(ot[vt]=function(mr){return new Promise(function(rr,De){ht.push([vt,mr,rr,De])>1||Ot(vt,mr)})})}function Ot(vt,mr){try{st(tt[vt](mr))}catch(rr){Ke(ht[0][3],rr)}}function st(vt){vt.value instanceof Ds?Promise.resolve(vt.value.v).then(Mt,Dt):Ke(ht[0][2],vt)}function Mt(vt){Ot("next",vt)}function Dt(vt){Ot("throw",vt)}function Ke(vt,mr){vt(mr),ht.shift(),ht.length&&Ot(ht[0][0],ht[0][1])}}function wd(M){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var N=M[Symbol.asyncIterator],V;return N?N.call(M):(M=typeof Ll=="function"?Ll(M):M[Symbol.iterator](),V={},tt("next"),tt("throw"),tt("return"),V[Symbol.asyncIterator]=function(){return this},V);function tt(ht){V[ht]=M[ht]&&function(u){return new Promise(function(Ot,st){u=M[ht](u),ot(Ot,st,u.done,u.value)})}}function ot(ht,u,Ot,st){Promise.resolve(st).then(function(Mt){ht({value:Mt,done:Ot})},u)}}function We(M){return typeof M=="function"}function Sd(M){var N=function(tt){Error.call(tt),tt.stack=new Error().stack},V=M(N);return V.prototype=Object.create(Error.prototype),V.prototype.constructor=V,V}var Bc=Sd(function(M){return function(V){M(this),this.message=V?V.length+` errors occurred during unsubscription:
`+V.map(function(tt,ot){return ot+1+") "+tt.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=V}});function Oc(M,N){if(M){var V=M.indexOf(N);0<=V&&M.splice(V,1)}}var Fc=function(){function M(N){this.initialTeardown=N,this.closed=!1,this._parentage=null,this._teardowns=null}return M.prototype.unsubscribe=function(){var N,V,tt,ot,ht;if(!this.closed){this.closed=!0;var u=this._parentage;if(u)if(this._parentage=null,Array.isArray(u))try{for(var Ot=Ll(u),st=Ot.next();!st.done;st=Ot.next()){var Mt=st.value;Mt.remove(this)}}catch(De){N={error:De}}finally{try{st&&!st.done&&(V=Ot.return)&&V.call(Ot)}finally{if(N)throw N.error}}else u.remove(this);var Dt=this.initialTeardown;if(We(Dt))try{Dt()}catch(De){ht=De instanceof Bc?De.errors:[De]}var Ke=this._teardowns;if(Ke){this._teardowns=null;try{for(var vt=Ll(Ke),mr=vt.next();!mr.done;mr=vt.next()){var rr=mr.value;try{yh(rr)}catch(De){ht=ht!=null?ht:[],De instanceof Bc?ht=Ms(Ms([],ba(ht)),ba(De.errors)):ht.push(De)}}}catch(De){tt={error:De}}finally{try{mr&&!mr.done&&(ot=vt.return)&&ot.call(vt)}finally{if(tt)throw tt.error}}}if(ht)throw new Bc(ht)}},M.prototype.add=function(N){var V;if(N&&N!==this)if(this.closed)yh(N);else{if(N instanceof M){if(N.closed||N._hasParent(this))return;N._addParent(this)}(this._teardowns=(V=this._teardowns)!==null&&V!==void 0?V:[]).push(N)}},M.prototype._hasParent=function(N){var V=this._parentage;return V===N||Array.isArray(V)&&V.includes(N)},M.prototype._addParent=function(N){var V=this._parentage;this._parentage=Array.isArray(V)?(V.push(N),V):V?[V,N]:N},M.prototype._removeParent=function(N){var V=this._parentage;V===N?this._parentage=null:Array.isArray(V)&&Oc(V,N)},M.prototype.remove=function(N){var V=this._teardowns;V&&Oc(V,N),N instanceof M&&N._removeParent(this)},M.EMPTY=function(){var N=new M;return N.closed=!0,N}(),M}();function mh(M){return M instanceof Fc||M&&"closed"in M&&We(M.remove)&&We(M.add)&&We(M.unsubscribe)}function yh(M){We(M)?M():M.unsubscribe()}var Uc={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Vc={setTimeout:function(){for(var M=[],N=0;N<arguments.length;N++)M[N]=arguments[N];var V=Vc.delegate;return((V==null?void 0:V.setTimeout)||setTimeout).apply(void 0,Ms([],ba(M)))},clearTimeout:function(M){var N=Vc.delegate;return((N==null?void 0:N.clearTimeout)||clearTimeout)(M)},delegate:void 0};function gh(M){Vc.setTimeout(function(){var N=Uc.onUnhandledError;if(N)N(M);else throw M})}function Nu(){}function Td(M){M()}var Nc=function(M){Cs(N,M);function N(V){var tt=M.call(this)||this;return tt.isStopped=!1,V?(tt.destination=V,mh(V)&&V.add(tt)):tt.destination=Id,tt}return N.create=function(V,tt,ot){return new vh(V,tt,ot)},N.prototype.next=function(V){this.isStopped||this._next(V)},N.prototype.error=function(V){this.isStopped||(this.isStopped=!0,this._error(V))},N.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},N.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,M.prototype.unsubscribe.call(this),this.destination=null)},N.prototype._next=function(V){this.destination.next(V)},N.prototype._error=function(V){try{this.destination.error(V)}finally{this.unsubscribe()}},N.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},N}(Fc),vh=function(M){Cs(N,M);function N(V,tt,ot){var ht=M.call(this)||this,u;if(We(V))u=V;else if(V){u=V.next,tt=V.error,ot=V.complete;var Ot;ht&&Uc.useDeprecatedNextContext?(Ot=Object.create(V),Ot.unsubscribe=function(){return ht.unsubscribe()}):Ot=V,u=u==null?void 0:u.bind(Ot),tt=tt==null?void 0:tt.bind(Ot),ot=ot==null?void 0:ot.bind(Ot)}return ht.destination={next:u?jc(u):Nu,error:jc(tt!=null?tt:_h),complete:ot?jc(ot):Nu},ht}return N}(Nc);function jc(M,N){return function(){for(var V=[],tt=0;tt<arguments.length;tt++)V[tt]=arguments[tt];try{M.apply(void 0,Ms([],ba(V)))}catch(ot){gh(ot)}}}function _h(M){throw M}var Id={closed:!0,next:Nu,error:_h,complete:Nu},qc=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function xh(M){return M}function Ed(M){return M.length===0?xh:M.length===1?M[0]:function(V){return M.reduce(function(tt,ot){return ot(tt)},V)}}var nn=function(){function M(N){N&&(this._subscribe=N)}return M.prototype.lift=function(N){var V=new M;return V.source=this,V.operator=N,V},M.prototype.subscribe=function(N,V,tt){var ot=this,ht=Pd(N)?N:new vh(N,V,tt);return Td(function(){var u=ot,Ot=u.operator,st=u.source;ht.add(Ot?Ot.call(ht,st):st?ot._subscribe(ht):ot._trySubscribe(ht))}),ht},M.prototype._trySubscribe=function(N){try{return this._subscribe(N)}catch(V){N.error(V)}},M.prototype.forEach=function(N,V){var tt=this;return V=bh(V),new V(function(ot,ht){var u;u=tt.subscribe(function(Ot){try{N(Ot)}catch(st){ht(st),u==null||u.unsubscribe()}},ht,ot)})},M.prototype._subscribe=function(N){var V;return(V=this.source)===null||V===void 0?void 0:V.subscribe(N)},M.prototype[qc]=function(){return this},M.prototype.pipe=function(){for(var N=[],V=0;V<arguments.length;V++)N[V]=arguments[V];return Ed(N)(this)},M.prototype.toPromise=function(N){var V=this;return N=bh(N),new N(function(tt,ot){var ht;V.subscribe(function(u){return ht=u},function(u){return ot(u)},function(){return tt(ht)})})},M.create=function(N){return new M(N)},M}();function bh(M){var N;return(N=M!=null?M:Uc.Promise)!==null&&N!==void 0?N:Promise}function Ad(M){return M&&We(M.next)&&We(M.error)&&We(M.complete)}function Pd(M){return M&&M instanceof Nc||Ad(M)&&mh(M)}function zd(M){return We(M==null?void 0:M.lift)}function Rl(M){return function(N){if(zd(N))return N.lift(function(V){try{return M(V,this)}catch(tt){this.error(tt)}});throw new TypeError("Unable to lift unknown Observable type")}}var Bl=function(M){Cs(N,M);function N(V,tt,ot,ht,u){var Ot=M.call(this,V)||this;return Ot.onFinalize=u,Ot._next=tt?function(st){try{tt(st)}catch(Mt){V.error(Mt)}}:M.prototype._next,Ot._error=ht?function(st){try{ht(st)}catch(Mt){V.error(Mt)}finally{this.unsubscribe()}}:M.prototype._error,Ot._complete=ot?function(){try{ot()}catch(st){V.error(st)}finally{this.unsubscribe()}}:M.prototype._complete,Ot}return N.prototype.unsubscribe=function(){var V,tt=this.closed;M.prototype.unsubscribe.call(this),!tt&&((V=this.onFinalize)===null||V===void 0||V.call(this))},N}(Nc),wh={now:function(){return(wh.delegate||Date).now()},delegate:void 0},kd=function(M){Cs(N,M);function N(V,tt){return M.call(this)||this}return N.prototype.schedule=function(V,tt){return this},N}(Fc),ju={setInterval:function(){for(var M=[],N=0;N<arguments.length;N++)M[N]=arguments[N];var V=ju.delegate;return((V==null?void 0:V.setInterval)||setInterval).apply(void 0,Ms([],ba(M)))},clearInterval:function(M){var N=ju.delegate;return((N==null?void 0:N.clearInterval)||clearInterval)(M)},delegate:void 0},Cd=function(M){Cs(N,M);function N(V,tt){var ot=M.call(this,V,tt)||this;return ot.scheduler=V,ot.work=tt,ot.pending=!1,ot}return N.prototype.schedule=function(V,tt){if(tt===void 0&&(tt=0),this.closed)return this;this.state=V;var ot=this.id,ht=this.scheduler;return ot!=null&&(this.id=this.recycleAsyncId(ht,ot,tt)),this.pending=!0,this.delay=tt,this.id=this.id||this.requestAsyncId(ht,this.id,tt),this},N.prototype.requestAsyncId=function(V,tt,ot){return ot===void 0&&(ot=0),ju.setInterval(V.flush.bind(V,this),ot)},N.prototype.recycleAsyncId=function(V,tt,ot){if(ot===void 0&&(ot=0),ot!=null&&this.delay===ot&&this.pending===!1)return tt;ju.clearInterval(tt)},N.prototype.execute=function(V,tt){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var ot=this._execute(V,tt);if(ot)return ot;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},N.prototype._execute=function(V,tt){var ot=!1,ht;try{this.work(V)}catch(u){ot=!0,ht=u||new Error("Scheduled action threw falsy error")}if(ot)return this.unsubscribe(),ht},N.prototype.unsubscribe=function(){if(!this.closed){var V=this,tt=V.id,ot=V.scheduler,ht=ot.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Oc(ht,this),tt!=null&&(this.id=this.recycleAsyncId(ot,tt,null)),this.delay=null,M.prototype.unsubscribe.call(this)}},N}(kd),Sh=function(){function M(N,V){V===void 0&&(V=M.now),this.schedulerActionCtor=N,this.now=V}return M.prototype.schedule=function(N,V,tt){return V===void 0&&(V=0),new this.schedulerActionCtor(this,N).schedule(tt,V)},M.now=wh.now,M}(),Md=function(M){Cs(N,M);function N(V,tt){tt===void 0&&(tt=Sh.now);var ot=M.call(this,V,tt)||this;return ot.actions=[],ot._active=!1,ot._scheduled=void 0,ot}return N.prototype.flush=function(V){var tt=this.actions;if(this._active){tt.push(V);return}var ot;this._active=!0;do if(ot=V.execute(V.state,V.delay))break;while(V=tt.shift());if(this._active=!1,ot){for(;V=tt.shift();)V.unsubscribe();throw ot}},N}(Sh),Dd=new Md(Cd),Ld=new nn(function(M){return M.complete()});function Rd(M){return M&&We(M.schedule)}function Th(M){return M[M.length-1]}function Bd(M){return Rd(Th(M))?M.pop():void 0}function Od(M,N){return typeof Th(M)=="number"?M.pop():N}var Zc=function(M){return M&&typeof M.length=="number"&&typeof M!="function"};function Ih(M){return We(M==null?void 0:M.then)}function Eh(M){return We(M[qc])}function Ah(M){return Symbol.asyncIterator&&We(M==null?void 0:M[Symbol.asyncIterator])}function Ph(M){return new TypeError("You provided "+(M!==null&&typeof M=="object"?"an invalid object":"'"+M+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Fd(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var zh=Fd();function kh(M){return We(M==null?void 0:M[zh])}function Ch(M){return bd(this,arguments,function(){var V,tt,ot,ht;return dh(this,function(u){switch(u.label){case 0:V=M.getReader(),u.label=1;case 1:u.trys.push([1,,9,10]),u.label=2;case 2:return[4,Ds(V.read())];case 3:return tt=u.sent(),ot=tt.value,ht=tt.done,ht?[4,Ds(void 0)]:[3,5];case 4:return[2,u.sent()];case 5:return[4,Ds(ot)];case 6:return[4,u.sent()];case 7:return u.sent(),[3,2];case 8:return[3,10];case 9:return V.releaseLock(),[7];case 10:return[2]}})})}function Mh(M){return We(M==null?void 0:M.getReader)}function wa(M){if(M instanceof nn)return M;if(M!=null){if(Eh(M))return Ud(M);if(Zc(M))return Vd(M);if(Ih(M))return Nd(M);if(Ah(M))return Dh(M);if(kh(M))return jd(M);if(Mh(M))return qd(M)}throw Ph(M)}function Ud(M){return new nn(function(N){var V=M[qc]();if(We(V.subscribe))return V.subscribe(N);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Vd(M){return new nn(function(N){for(var V=0;V<M.length&&!N.closed;V++)N.next(M[V]);N.complete()})}function Nd(M){return new nn(function(N){M.then(function(V){N.closed||(N.next(V),N.complete())},function(V){return N.error(V)}).then(null,gh)})}function jd(M){return new nn(function(N){var V,tt;try{for(var ot=Ll(M),ht=ot.next();!ht.done;ht=ot.next()){var u=ht.value;if(N.next(u),N.closed)return}}catch(Ot){V={error:Ot}}finally{try{ht&&!ht.done&&(tt=ot.return)&&tt.call(ot)}finally{if(V)throw V.error}}N.complete()})}function Dh(M){return new nn(function(N){Zd(M,N).catch(function(V){return N.error(V)})})}function qd(M){return Dh(Ch(M))}function Zd(M,N){var V,tt,ot,ht;return xd(this,void 0,void 0,function(){var u,Ot;return dh(this,function(st){switch(st.label){case 0:st.trys.push([0,5,6,11]),V=wd(M),st.label=1;case 1:return[4,V.next()];case 2:if(tt=st.sent(),!!tt.done)return[3,4];if(u=tt.value,N.next(u),N.closed)return[2];st.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return Ot=st.sent(),ot={error:Ot},[3,11];case 6:return st.trys.push([6,,9,10]),tt&&!tt.done&&(ht=V.return)?[4,ht.call(V)]:[3,8];case 7:st.sent(),st.label=8;case 8:return[3,10];case 9:if(ot)throw ot.error;return[7];case 10:return[7];case 11:return N.complete(),[2]}})})}function Uo(M,N,V,tt,ot){tt===void 0&&(tt=0),ot===void 0&&(ot=!1);var ht=N.schedule(function(){V(),ot?M.add(this.schedule(null,tt)):this.unsubscribe()},tt);if(M.add(ht),!ot)return ht}function Lh(M,N){return N===void 0&&(N=0),Rl(function(V,tt){V.subscribe(new Bl(tt,function(ot){return Uo(tt,M,function(){return tt.next(ot)},N)},function(){return Uo(tt,M,function(){return tt.complete()},N)},function(ot){return Uo(tt,M,function(){return tt.error(ot)},N)}))})}function Rh(M,N){return N===void 0&&(N=0),Rl(function(V,tt){tt.add(M.schedule(function(){return V.subscribe(tt)},N))})}function Gd(M,N){return wa(M).pipe(Rh(N),Lh(N))}function Xd(M,N){return wa(M).pipe(Rh(N),Lh(N))}function Wd(M,N){return new nn(function(V){var tt=0;return N.schedule(function(){tt===M.length?V.complete():(V.next(M[tt++]),V.closed||this.schedule())})})}function Kd(M,N){return new nn(function(V){var tt;return Uo(V,N,function(){tt=M[zh](),Uo(V,N,function(){var ot,ht,u;try{ot=tt.next(),ht=ot.value,u=ot.done}catch(Ot){V.error(Ot);return}u?V.complete():V.next(ht)},0,!0)}),function(){return We(tt==null?void 0:tt.return)&&tt.return()}})}function Bh(M,N){if(!M)throw new Error("Iterable cannot be null");return new nn(function(V){Uo(V,N,function(){var tt=M[Symbol.asyncIterator]();Uo(V,N,function(){tt.next().then(function(ot){ot.done?V.complete():V.next(ot.value)})},0,!0)})})}function Hd(M,N){return Bh(Ch(M),N)}function Jd(M,N){if(M!=null){if(Eh(M))return Gd(M,N);if(Zc(M))return Wd(M,N);if(Ih(M))return Xd(M,N);if(Ah(M))return Bh(M,N);if(kh(M))return Kd(M,N);if(Mh(M))return Hd(M,N)}throw Ph(M)}function Yd(M,N){return N?Jd(M,N):wa(M)}function Oh(M,N){return Rl(function(V,tt){var ot=0;V.subscribe(new Bl(tt,function(ht){tt.next(M.call(N,ht,ot++))}))})}var Qd=Array.isArray;function $d(M,N){return Qd(N)?M.apply(void 0,Ms([],ba(N))):M(N)}function tm(M){return Oh(function(N){return $d(M,N)})}function em(M,N,V,tt,ot,ht,u,Ot){var st=[],Mt=0,Dt=0,Ke=!1,vt=function(){Ke&&!st.length&&!Mt&&N.complete()},mr=function(De){return Mt<tt?rr(De):st.push(De)},rr=function(De){ht&&N.next(De),Mt++;var Tr=!1;wa(V(De,Dt++)).subscribe(new Bl(N,function(Ti){ot==null||ot(Ti),ht?mr(Ti):N.next(Ti)},function(){Tr=!0},void 0,function(){if(Tr)try{Mt--;for(var Ti=function(){var He=st.shift();u?Uo(N,u,function(){return rr(He)}):rr(He)};st.length&&Mt<tt;)Ti();vt()}catch(He){N.error(He)}}))};return M.subscribe(new Bl(N,mr,function(){Ke=!0,vt()})),function(){Ot==null||Ot()}}function Gc(M,N,V){return V===void 0&&(V=1/0),We(N)?Gc(function(tt,ot){return Oh(function(ht,u){return N(tt,ht,ot,u)})(wa(M(tt,ot)))},V):(typeof N=="number"&&(V=N),Rl(function(tt,ot){return em(tt,ot,M,V)}))}function rm(M){return M===void 0&&(M=1/0),Gc(xh,M)}var im=["addListener","removeListener"],nm=["addEventListener","removeEventListener"],om=["on","off"];function Fh(M,N,V,tt){if(We(V)&&(tt=V,V=void 0),tt)return Fh(M,N,V).pipe(tm(tt));var ot=ba(lm(M)?nm.map(function(Ot){return function(st){return M[Ot](N,st,V)}}):am(M)?im.map(Uh(M,N)):sm(M)?om.map(Uh(M,N)):[],2),ht=ot[0],u=ot[1];if(!ht&&Zc(M))return Gc(function(Ot){return Fh(Ot,N,V)})(wa(M));if(!ht)throw new TypeError("Invalid event target");return new nn(function(Ot){var st=function(){for(var Mt=[],Dt=0;Dt<arguments.length;Dt++)Mt[Dt]=arguments[Dt];return Ot.next(1<Mt.length?Mt:Mt[0])};return ht(st),function(){return u(st)}})}function Uh(M,N){return function(V){return function(tt){return M[V](N,tt)}}}function am(M){return We(M.addListener)&&We(M.removeListener)}function sm(M){return We(M.on)&&We(M.off)}function lm(M){return We(M.addEventListener)&&We(M.removeEventListener)}function cm(){for(var M=[],N=0;N<arguments.length;N++)M[N]=arguments[N];var V=Bd(M),tt=Od(M,1/0),ot=M;return ot.length?ot.length===1?wa(ot[0]):rm(tt)(Yd(ot,V)):Ld}function pm(M,N){return N===void 0&&(N=Dd),Rl(function(V,tt){var ot=null,ht=null,u=null,Ot=function(){if(ot){ot.unsubscribe(),ot=null;var Mt=ht;ht=null,tt.next(Mt)}};function st(){var Mt=u+M,Dt=N.now();if(Dt<Mt){ot=this.schedule(void 0,Mt-Dt),tt.add(ot);return}Ot()}V.subscribe(new Bl(tt,function(Mt){ht=Mt,u=N.now(),ot||(ot=N.schedule(st,M),tt.add(ot))},function(){Ot(),tt.complete()},void 0,function(){ht=ot=null}))})}export{cm as a,pm as d,Fh as f,um as m};
