var E=Object.defineProperty;var v=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var u=(o,t,e)=>t in o?E(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,f=(o,t)=>{for(var e in t||(t={}))k.call(t,e)&&u(o,e,t[e]);if(v)for(var e of v(t))M.call(t,e)&&u(o,e,t[e]);return o};var l=(o,t,e)=>(u(o,typeof t!="symbol"?t+"":t,e),e);import"./modulepreload-polyfill.b7f2da20.js";import{d as F}from"./pie-chart.9a516d1f.js";import{m as b,a as O,f as y,d as T}from"./vendor.0dd871b3.js";class x{constructor(t){l(this,"onAdd",t=>{this.map=t;const e=window.devicePixelRatio,{width:r,graphWidth:a,graphHeight:i,color:n,background:p,font:m}=this.options,s=this.container=document.createElement("div");return s.className="mapboxgl-ctrl mapboxgl-ctrl-fps",s.style.backgroundColor=p,s.style.borderRadius="6px",this.readOutput=document.createElement("div"),this.readOutput.style.color=n,this.readOutput.style.fontFamily=m,this.readOutput.style.padding="0 5px 5px",this.readOutput.style.fontSize="9px",this.readOutput.style.fontWeight="bold",this.readOutput.textContent="Waiting\u2026",this.canvas=document.createElement("canvas"),this.canvas.className="mapboxgl-ctrl-canvas",this.canvas.width=r,this.canvas.height=i,this.canvas.style.cssText=`width: ${r/e}px; height: ${i/e}px;`,s.appendChild(this.readOutput),s.appendChild(this.canvas),this.map.on("movestart",this.onMoveStart),this.map.on("moveend",this.onMoveEnd),this.container});l(this,"onMoveStart",()=>{this.frames=0,this.time=performance.now(),this.map.on("render",this.onRender)});l(this,"onMoveEnd",()=>{const t=performance.now();this.updateGraph(this.getFPS(t)),this.frames=0,this.time=null,this.map.off("render",this.onRender)});l(this,"onRender",()=>{this.frames++;const t=performance.now();t>=this.time+1e3&&(this.updateGraph(this.getFPS(t)),this.frames=0,this.time=t)});l(this,"getFPS",t=>(this.totalTime+=t-this.time,this.totalFrames+=this.frames,Math.round(1e3*this.frames/(t-this.time))||0));l(this,"updateGraph",t=>{const{barWidth:e,graphRight:r,graphTop:a,graphWidth:i,graphHeight:n,background:p,color:m}=this.options,s=this.canvas.getContext("2d"),C=Math.round(1e3*this.totalFrames/this.totalTime)||0,d=e;s.fillStyle=p,s.globalAlpha=1,s.fillRect(0,0,i,a),s.fillStyle=m,this.readOutput.textContent=`${t} FPS (${C} Avg)`,s.drawImage(this.canvas,r+d,a,i-d,n,r,a,i-d,n),s.fillRect(r+i-d,a,d,n),s.fillStyle=p,s.globalAlpha=.75,s.fillRect(r+i-d,a,d,(1-t/100)*n)});l(this,"onRemove",()=>(this.map.off("render",this.onRender),this.map.off("movestart",this.onMoveStart),this.map.off("moveend",this.onMoveEnd),this.container.parentNode.removeChild(this.container),this.map=null,this));const e=window.devicePixelRatio,r={background:"rgba(0,0,0,0.9)",barWidth:4*e,color:"#7cf859",font:"Monaco, Consolas, Courier, monospace",graphHeight:60*e,graphWidth:90*e,graphTop:0,graphRight:5*e,width:100*e};this.frames=0,this.totalTime=0,this.totalFrames=0,this.options=f(f({},t),r)}}window.mapboxgl&&(mapboxgl.FrameRateControl=x);const h={},_=()=>F([{label:"Food",value:1,color:"#003f5c"},{label:"Party",value:1,color:"#7a5195"},{label:"Rent",value:1,color:"#ef5675"},{label:"Chocolates",value:1,color:"#ffa600"}]),P=(o,t)=>{if(!t)return;const e=o.toString(10).padStart(3);t.innerText="Total:"+e},w=(o,t,e)=>{const r=o.queryRenderedFeatures(void 0,{layers:e});console.log("update markers",r),Object.keys(h).filter(a=>!r.map(i=>String(i.properties.id)).includes(a)).forEach(a=>{h[a].remove(),delete h[a]}),r.forEach(({geometry:a,properties:i})=>{if(a.type!=="Point")return;if(!i.id)throw Error("id is not provided");if(h[String(i.id)]!==void 0)return;const n=new b.Marker({element:_()});n.setLngLat([a.coordinates[0],a.coordinates[1]]).addTo(o),h[String(i.id)]=n}),P(Object.keys(h).length,t)},L={"circle-color":"#777777","circle-stroke-color":"transparent","circle-stroke-width":0,"circle-radius":0},S=document.getElementById("counter"),c=new b.Map({container:"map",zoom:9,minZoom:1,center:[33.32,60.44],style:"https://api.maptiler.com/maps/streets/style.json?key=get_your_own_OpIi9ZULNHzrESv6T2vL"}),W=new x,g=[["hexapoint_800",9.2,11.8],["hexapoint_3000",7.7,9.2],["hexapoint_10000",6.3,7.7],["hexapoint_25000",4.8,6.3],["hexapoint_50000",3.6,4.8],["hexapoint_100000",2.3,3.6],["hexapoint_250000",0,2.3]],R=g.map(([o])=>"public."+o);c.addControl(W);c.on("load",function(){c.on("sourcedata",function(o){var t;!((t=o.sourceId)==null?void 0:t.includes("hexapoint_"))||!o.isSourceLoaded||(O(y(c,"moveend"),y(c,"movestart")).pipe(T(200)).subscribe(()=>{w(c,S,R)}),w(c,S,R))}),j(c,g),$(c,g)});const j=(o,t)=>{t.forEach(([e])=>{o.addSource(e,{type:"vector",tiles:[`https://139.geosemantica.ru/martin/public.${e}/{z}/{x}/{y}.pbf`]})})},$=(o,t)=>{t.forEach(([e,r,a])=>{o.addLayer({minzoom:r,maxzoom:a,id:"public."+e,type:"circle",source:e,"source-layer":"public."+e,paint:L})})};
